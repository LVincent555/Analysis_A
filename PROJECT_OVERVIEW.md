# ğŸ“Š Stock Analysis App - é¡¹ç›®å®Œæ•´è¯´æ˜æ–‡æ¡£

> **æ–‡æ¡£ç›®çš„**: ä¸ºAIåŠ©æ‰‹ï¼ˆClaudeç­‰ï¼‰æä¾›å®Œæ•´çš„é¡¹ç›®ä¸Šä¸‹æ–‡ï¼Œä¾¿äºå¿«é€Ÿç†è§£é¡¹ç›®ç»“æ„å’Œé…ç½®éœ€æ±‚

---

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®åç§°
**Stock Analysis App** - Aè‚¡è‚¡ç¥¨æ•°æ®åˆ†æç³»ç»Ÿ

### ç‰ˆæœ¬ä¿¡æ¯
- **å½“å‰ç‰ˆæœ¬**: v0.2.1
- **æœ€åæ›´æ–°**: 2025-11-06

### é¡¹ç›®ç›®æ ‡
é€šè¿‡åˆ†ææ¯æ—¥è‚¡ç¥¨æ’åæ•°æ®ï¼Œè¯†åˆ«ï¼š
1. **çƒ­ç‚¹è‚¡ç¥¨** - åœ¨å¤šå¤©å†…æŒç»­å‡ºç°åœ¨TOP 100çš„è‚¡ç¥¨
2. **æ’åè·³å˜** - æ’åå¤§å¹…ä¸Šå‡çš„è‚¡ç¥¨
3. **ç¨³æ­¥ä¸Šå‡** - æ’åç¨³å®šä¸Šå‡çš„è‚¡ç¥¨
4. **è¡Œä¸šè¶‹åŠ¿** - å„è¡Œä¸šè‚¡ç¥¨æ•°é‡å˜åŒ–

### æ ¸å¿ƒç‰¹æ€§
- âœ… åŸºäºPostgreSQLçš„æ•°æ®å­˜å‚¨
- âœ… æ”¯æŒåŒ—äº¤æ‰€æ¿å—ç­›é€‰ï¼ˆ920å¼€å¤´ï¼‰
- âœ… è‡ªåŠ¨æ•°æ®å¯¼å…¥å’ŒçŠ¶æ€ç®¡ç†
- âœ… å†…å­˜ç¼“å­˜ä¼˜åŒ–
- âœ… Dockerå®¹å™¨åŒ–éƒ¨ç½²
- âœ… å“åº”å¼Webç•Œé¢

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

**åç«¯**:
- Python 3.10+
- FastAPI (Webæ¡†æ¶)
- SQLAlchemy (ORM)
- PostgreSQL 15 (æ•°æ®åº“)
- Pandas (æ•°æ®å¤„ç†)
- Gunicorn + Uvicorn (ASGIæœåŠ¡å™¨)

**å‰ç«¯**:
- React 18
- Recharts (å›¾è¡¨åº“)
- TailwindCSS (æ ·å¼)
- Lucide React (å›¾æ ‡)

**éƒ¨ç½²**:
- Docker + Docker Compose
- Nginx (åå‘ä»£ç†)

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”¨æˆ·æµè§ˆå™¨                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTP :80
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Nginx (stock_web)                  â”‚
â”‚  - é™æ€æ–‡ä»¶æœåŠ¡                                  â”‚
â”‚  - APIåå‘ä»£ç†                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ /            â”‚ /api         â”‚
      â–¼              â–¼              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React   â”‚   â”‚   FastAPI (stock_api)       â”‚
â”‚  å‰ç«¯    â”‚   â”‚   - RESTful API              â”‚
â”‚  Build   â”‚   â”‚   - æ•°æ®åˆ†ææœåŠ¡              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   - ç¼“å­˜ç®¡ç†                  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   PostgreSQL (stock_db)      â”‚
                â”‚   - è‚¡ç¥¨æ•°æ®                  â”‚
                â”‚   - æ¯æ—¥æ’å                  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

```
Excelæ–‡ä»¶ (.xlsx)
    â”‚
    â–¼
å¯¼å…¥è„šæœ¬ (import_data_robust.py)
    â”‚
    â–¼
æ•°æ®åº“ (PostgreSQL)
    â”‚
    â”œâ”€â–º é¢„åŠ è½½åˆ°ç¼“å­˜ (å¯åŠ¨æ—¶)
    â”‚
    â–¼
åˆ†ææœåŠ¡ (analysis_service_db.py)
    â”‚
    â”œâ”€â–º çƒ­ç‚¹åˆ†æ
    â”œâ”€â–º æ’åè·³å˜
    â”œâ”€â–º ç¨³æ­¥ä¸Šå‡
    â””â”€â–º è¡Œä¸šç»Ÿè®¡
    â”‚
    â–¼
APIè·¯ç”± (/api/...)
    â”‚
    â–¼
å‰ç«¯å±•ç¤º (React)
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
stock_analysis_app/
â”œâ”€â”€ backend/                      # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”‚   â”‚   â”œâ”€â”€ data_manager.py  # æ•°æ®ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ startup.py       # å¯åŠ¨é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ models/              # Pydanticæ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ analysis.py
â”‚   â”‚   â”‚   â”œâ”€â”€ industry.py
â”‚   â”‚   â”‚   â””â”€â”€ stock.py
â”‚   â”‚   â”œâ”€â”€ routers/             # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ analysis.py      # çƒ­ç‚¹åˆ†æ
â”‚   â”‚   â”‚   â”œâ”€â”€ industry.py      # è¡Œä¸šåˆ†æ
â”‚   â”‚   â”‚   â”œâ”€â”€ rank_jump.py     # æ’åè·³å˜
â”‚   â”‚   â”‚   â”œâ”€â”€ steady_rise.py   # ç¨³æ­¥ä¸Šå‡
â”‚   â”‚   â”‚   â””â”€â”€ stock.py         # è‚¡ç¥¨è¯¦æƒ…
â”‚   â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ analysis_service_db.py
â”‚   â”‚   â”‚   â”œâ”€â”€ db_data_loader.py
â”‚   â”‚   â”‚   â”œâ”€â”€ industry_service_db.py
â”‚   â”‚   â”‚   â”œâ”€â”€ rank_jump_service_db.py
â”‚   â”‚   â”‚   â”œâ”€â”€ steady_rise_service_db.py
â”‚   â”‚   â”‚   â””â”€â”€ stock_service_db.py
â”‚   â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ board_filter.py  # æ¿å—ç­›é€‰
â”‚   â”‚   â”‚   â”œâ”€â”€ cache.py         # ç¼“å­˜ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ date_utils.py    # æ—¥æœŸå·¥å…·
â”‚   â”‚   â”œâ”€â”€ config.py            # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ database.py          # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ db_models.py         # SQLAlchemyæ¨¡å‹
â”‚   â”‚   â””â”€â”€ main.py              # FastAPIåº”ç”¨
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â””â”€â”€ import_data_robust.py # æ•°æ®å¯¼å…¥è„šæœ¬
â”‚   â”œâ”€â”€ Dockerfile               # åç«¯é•œåƒ
â”‚   â”œâ”€â”€ docker-entrypoint.sh     # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ requirements.txt         # Pythonä¾èµ–
â”‚   â””â”€â”€ clear_cache.py           # ç¼“å­˜æ¸…ç†
â”œâ”€â”€ frontend/                    # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.js               # ä¸»åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ index.js             # å…¥å£
â”‚   â”‚   â””â”€â”€ index.css            # æ ·å¼
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ index.html
â”‚   â””â”€â”€ package.json             # Nodeä¾èµ–
â”œâ”€â”€ docker/                      # Dockeré…ç½®
â”‚   â””â”€â”€ nginx/
â”‚       â”œâ”€â”€ Dockerfile           # Nginxé•œåƒ
â”‚       â”œâ”€â”€ nginx.conf           # Nginxä¸»é…ç½®
â”‚       â””â”€â”€ default.conf         # ç«™ç‚¹é…ç½®
â”œâ”€â”€ data/                        # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ *.xlsx                   # Excelæ•°æ®æ–‡ä»¶
â”‚   â””â”€â”€ data_import_state.json   # å¯¼å…¥çŠ¶æ€
â”œâ”€â”€ sql/                         # SQLè„šæœ¬
â”‚   â””â”€â”€ init.sql                 # æ•°æ®åº“åˆå§‹åŒ–
â”œâ”€â”€ docker-compose.yml           # Dockerç¼–æ’
â”œâ”€â”€ .env.example                 # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ deploy.sh                    # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ backup.sh                    # å¤‡ä»½è„šæœ¬
â”œâ”€â”€ README_DEPLOY.md             # éƒ¨ç½²æ–‡æ¡£
â””â”€â”€ PROJECT_OVERVIEW.md          # æœ¬æ–‡æ¡£
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### è¡¨ç»“æ„

#### 1. stocksï¼ˆè‚¡ç¥¨åŸºç¡€ä¿¡æ¯ï¼‰
```sql
CREATE TABLE stocks (
    stock_code VARCHAR(10) PRIMARY KEY,
    stock_name VARCHAR(100),
    industry VARCHAR(100),
    market_cap_billions FLOAT
);
```

#### 2. daily_stock_dataï¼ˆæ¯æ—¥è‚¡ç¥¨æ•°æ®ï¼‰
```sql
CREATE TABLE daily_stock_data (
    id SERIAL PRIMARY KEY,
    stock_code VARCHAR(10) REFERENCES stocks(stock_code),
    date DATE NOT NULL,
    rank INTEGER,
    total_score FLOAT,
    open_price FLOAT,
    close_price FLOAT,
    high_price FLOAT,
    low_price FLOAT,
    price_change FLOAT,
    turnover_rate_percent FLOAT,
    volume BIGINT,
    -- ... æ›´å¤šæŠ€æœ¯æŒ‡æ ‡å­—æ®µ
    UNIQUE(stock_code, date)  -- å”¯ä¸€çº¦æŸ
);

CREATE INDEX idx_daily_stock_code ON daily_stock_data(stock_code);
CREATE INDEX idx_daily_date ON daily_stock_data(date);
CREATE INDEX idx_daily_rank ON daily_stock_data(rank);
```

### æ•°æ®æ¥æº

**Excelæ–‡ä»¶æ ¼å¼**: `YYYYMMDD_data_sma_feature_color.xlsx`

**ç¤ºä¾‹**: `20251106_data_sma_feature_color.xlsx`

**å­—æ®µæ˜ å°„** (éƒ¨åˆ†é‡è¦å­—æ®µ):
```python
COLUMN_MAPPING = {
    'CODE2': 'stock_code',
    'NAME2': 'stock_name',
    'æ—¥æœŸ': 'date',
    'æ’å': 'rank',
    'ç»¼åˆå¾—åˆ†': 'total_score',
    'æ¶¨è·Œå¹…2': 'price_change',
    'æ¢æ‰‹ç‡%': 'turnover_rate_percent',
    'è¡Œä¸š': 'industry',
    # ... æ›´å¤šå­—æ®µ
}
```

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. çƒ­ç‚¹åˆ†æ (Hot Analysis)

**API**: `GET /api/analysis/period`

**å‚æ•°**:
- `period`: åˆ†æå‘¨æœŸï¼ˆå¤©æ•°ï¼‰
- `max_count`: æ¯å¤©TOP Nè‚¡ç¥¨æ•°
- `board_type`: æ¿å—ç±»å‹ï¼ˆall/main/bjsï¼‰

**ç®—æ³•é€»è¾‘**:
1. è·å–æœ€è¿‘Nå¤©çš„æ•°æ®
2. è¯†åˆ«æœ€æ–°ä¸€å¤©çš„TOP Nè‚¡ç¥¨ä½œä¸º"é”šå®šè‚¡ç¥¨"
3. å›æº¯è¿™äº›è‚¡ç¥¨åœ¨æ•´ä¸ªå‘¨æœŸå†…çš„å‡ºç°æ¬¡æ•°
4. è¿‡æ»¤å‡ºç°æ¬¡æ•°â‰¥2æ¬¡çš„è‚¡ç¥¨
5. æŒ‰å‡ºç°æ¬¡æ•°é™åºæ’åº

**å…³é”®ä»£ç **:
```python
# backend/app/services/analysis_service_db.py
def analyze_period(self, period: int = 3, max_count: int = 100, board_type: str = 'main'):
    # 1. è·å–æœ€è¿‘Nå¤©æ—¥æœŸ
    # 2. æŸ¥è¯¢æœ€æ–°ä¸€å¤©çš„TOP Nè‚¡ç¥¨ï¼ˆé”šå®šï¼‰
    # 3. å›æº¯é”šå®šè‚¡ç¥¨åœ¨æ‰€æœ‰æ—¥æœŸçš„æ•°æ®
    # 4. ç»Ÿè®¡æ¯åªè‚¡ç¥¨å‡ºç°æ¬¡æ•°
    # 5. è¿‡æ»¤å¹¶æ’åº
    # 6. åº”ç”¨æ¿å—ç­›é€‰
```

### 2. æ’åè·³å˜ (Rank Jump)

**API**: `GET /api/rank-jump`

**å‚æ•°**:
- `period`: åˆ†æå‘¨æœŸ
- `board_type`: æ¿å—ç±»å‹

**ç®—æ³•é€»è¾‘**:
1. è·å–æœ€è¿‘2å¤©æ•°æ®
2. è®¡ç®—æ’åå˜åŒ–: `jump = å‰ä¸€å¤©æ’å - æœ€æ–°æ’å`
3. ç­›é€‰ jump > 0 çš„è‚¡ç¥¨ï¼ˆæ’åä¸Šå‡ï¼‰
4. æŒ‰è·³å˜å¹…åº¦é™åºæ’åº

### 3. ç¨³æ­¥ä¸Šå‡ (Steady Rise)

**API**: `GET /api/steady-rise`

**å‚æ•°**:
- `period`: åˆ†æå‘¨æœŸ
- `board_type`: æ¿å—ç±»å‹

**ç®—æ³•é€»è¾‘**:
1. è·å–æœ€è¿‘Nå¤©æ•°æ®
2. å¯¹æ¯åªè‚¡ç¥¨ï¼Œè®¡ç®—æ’åè¶‹åŠ¿ï¼ˆçº¿æ€§å›å½’ï¼‰
3. ç­›é€‰è¶‹åŠ¿ä¸ºè´Ÿï¼ˆæ’åå˜å°=ä¸Šå‡ï¼‰çš„è‚¡ç¥¨
4. æŒ‰è¶‹åŠ¿æ–œç‡æ’åº

### 4. è¡Œä¸šè¶‹åŠ¿ (Industry Trend)

**API**: `GET /api/industry/trend`

**å‚æ•°**:
- `period`: åˆ†æå‘¨æœŸï¼ˆé»˜è®¤14å¤©ï¼‰
- `top_n`: æ¯å¤©TOP Nè‚¡ç¥¨

**åŠŸèƒ½**:
- ç»Ÿè®¡æ¯å¤©å„è¡Œä¸šåœ¨TOP Nä¸­çš„è‚¡ç¥¨æ•°é‡
- å±•ç¤ºå¤šæ—¥æœŸè¡Œä¸šåˆ†å¸ƒå˜åŒ–

### 5. æ¿å—ç­›é€‰ (Board Filter)

**ç­›é€‰è§„åˆ™**:
```python
def should_filter_stock(stock_code: str, board_type: str) -> bool:
    """
    board_typeå–å€¼:
    - 'all': ä¸ç­›é€‰ï¼Œæ˜¾ç¤ºæ‰€æœ‰è‚¡ç¥¨
    - 'main': ä¸»æ¿ï¼Œæ’é™¤3/68/920å¼€å¤´
    - 'bjs': åŒ—äº¤æ‰€ï¼Œåªæ˜¾ç¤º920å¼€å¤´
    """
    if board_type == 'all':
        return False
    elif board_type == 'main':
        return stock_code.startswith(('3', '68', '920'))
    elif board_type == 'bjs':
        return not stock_code.startswith('920')
    return False
```

---

## ğŸ”„ æ•°æ®å¯¼å…¥æµç¨‹

### å¯¼å…¥è„šæœ¬

**æ–‡ä»¶**: `backend/scripts/import_data_robust.py`

**æµç¨‹**:
1. æ‰«æ `data/` ç›®å½•ä¸‹çš„Excelæ–‡ä»¶
2. æ£€æŸ¥å¯¼å…¥çŠ¶æ€æ–‡ä»¶ `data_import_state.json`
3. è·³è¿‡å·²æˆåŠŸå¯¼å…¥çš„æ–‡ä»¶
4. å¯¹æ–°æ–‡ä»¶:
   - è¯»å–Excelæ•°æ®
   - æ ‡å‡†åŒ–è‚¡ç¥¨ä»£ç ï¼ˆè¡¥é½6ä½ï¼‰
   - åˆ›å»º/æ›´æ–° stocks è¡¨
   - æ‰¹é‡æ’å…¥ daily_stock_data è¡¨
   - æ›´æ–°çŠ¶æ€æ–‡ä»¶
5. å¤±è´¥æ—¶è‡ªåŠ¨å›æ»š

### çŠ¶æ€ç®¡ç†

**æ–‡ä»¶**: `data/data_import_state.json`

```json
{
  "20251106": {
    "filename": "20251106_data_sma_feature_color.xlsx",
    "status": "success",
    "file_hash": "abc123...",
    "imported_count": 5429,
    "start_time": "2025-11-06T10:00:00",
    "end_time": "2025-11-06T10:00:30"
  }
}
```

### è‡ªåŠ¨å¯¼å…¥ï¼ˆDockerï¼‰

å®¹å™¨å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥å¹¶å¯¼å…¥ï¼š
```bash
# backend/docker-entrypoint.sh
if [ æ•°æ®åº“ä¸ºç©º ]; then
    python scripts/import_data_robust.py
fi
```

---

## ğŸš€ éƒ¨ç½²æ¶æ„

### Dockerå®¹å™¨

#### 1. postgres (stock_db)
- **é•œåƒ**: postgres:15-alpine
- **ç«¯å£**: 5432
- **å†…å­˜**: 600MB
- **å·**: postgres_data

#### 2. backend (stock_api)
- **é•œåƒ**: è‡ªå®šä¹‰ï¼ˆPython 3.10-slimï¼‰
- **ç«¯å£**: 8000 (å†…éƒ¨)
- **å†…å­˜**: 500MB
- **å·**: ./data, ./cache

#### 3. nginx (stock_web)
- **é•œåƒ**: è‡ªå®šä¹‰ï¼ˆnginx:alpine + React buildï¼‰
- **ç«¯å£**: 80
- **å†…å­˜**: 100MB

### ç½‘ç»œ

æ‰€æœ‰å®¹å™¨åœ¨ `stock_network` ç½‘æ¡¥ç½‘ç»œä¸­é€šä¿¡ã€‚

### æŒä¹…åŒ–

- **æ•°æ®åº“æ•°æ®**: Dockerå· `postgres_data`
- **Excelæ–‡ä»¶**: ä¸»æœºç›®å½• `./data`
- **ç¼“å­˜çŠ¶æ€**: ä¸»æœºç›®å½• `./backend/cache`

---

## ğŸ” é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

**.envæ–‡ä»¶**:
```env
DATABASE_NAME=stock_analysis
DATABASE_USER=stock_user
DATABASE_PASSWORD=your_strong_password
WEB_PORT=80
```

### é…ç½®æ–‡ä»¶

**backend/app/config.py**:
```python
VERSION = "0.2.1"
DATABASE_URL = f"postgresql://{user}:{password}@{host}:{port}/{database}"
FILE_PATTERNS = ["*_data_sma_feature_color.xlsx"]
DEFAULT_MAX_STOCKS = 100
TOP_N_STOCKS = 1000
CACHE_ENABLED = True
```

---

## ğŸ“Š APIç«¯ç‚¹åˆ—è¡¨

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ | å‚æ•° |
|------|------|------|------|
| `/api/dates` | GET | è·å–å¯ç”¨æ—¥æœŸ | - |
| `/api/analysis/period` | GET | çƒ­ç‚¹åˆ†æ | period, max_count, board_type |
| `/api/rank-jump` | GET | æ’åè·³å˜ | period, board_type |
| `/api/steady-rise` | GET | ç¨³æ­¥ä¸Šå‡ | period, board_type |
| `/api/industry/top1000` | GET | è¡Œä¸šç»Ÿè®¡ | - |
| `/api/industry/trend` | GET | è¡Œä¸šè¶‹åŠ¿ | period, top_n |
| `/api/stock/{code}` | GET | è‚¡ç¥¨è¯¦æƒ… | stock_code |
| `/docs` | GET | APIæ–‡æ¡£ | - |

---

## ğŸ¨ å‰ç«¯ç»„ä»¶

### ä¸»è¦æ¨¡å—

1. **çƒ­ç‚¹åˆ†æ** (Hot Analysis)
   - æœŸæ•°é€‰æ‹©ï¼š2/3/5/7/14å¤©
   - æ¿å—é€‰æ‹©ï¼šå…¨éƒ¨/ä¸»æ¿/åŒ—äº¤æ‰€
   - è¡Œä¸šåˆ†å¸ƒå›¾è¡¨
   - è‚¡ç¥¨åˆ—è¡¨

2. **è‚¡ç¥¨æŸ¥è¯¢** (Stock Query)
   - è‚¡ç¥¨ä»£ç æœç´¢
   - å†å²æ•°æ®è¡¨æ ¼
   - æ’åè¶‹åŠ¿å›¾
   - æŠ€æœ¯æŒ‡æ ‡å›¾

3. **æ’åè·³å˜** (Rank Jump)
   - æœŸæ•°é€‰æ‹©
   - æ¿å—é€‰æ‹©
   - è·³å˜å¹…åº¦æ’åº

4. **ç¨³æ­¥ä¸Šå‡** (Steady Rise)
   - æœŸæ•°é€‰æ‹©
   - æ¿å—é€‰æ‹©
   - è¶‹åŠ¿æ–œç‡æ’åº

5. **è¡Œä¸šè¶‹åŠ¿åˆ†æ** (Industry Trend)
   - 14å¤©è¡Œä¸šå˜åŒ–
   - TOP 1000è‚¡ç¥¨
   - å¤šè¡Œä¸šå¯¹æ¯”å›¾

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥

1. **å†…å­˜ç¼“å­˜**: 
   - ä½¿ç”¨å­—å…¸å­˜å‚¨æŸ¥è¯¢ç»“æœ
   - å¯åŠ¨æ—¶é¢„åŠ è½½å¸¸ç”¨å‘¨æœŸ

2. **ç¼“å­˜é”®è®¾è®¡**:
   ```python
   cache_key = f"analysis_{period}_{max_count}_{board_type}"
   ```

3. **ç¼“å­˜å¤±æ•ˆ**:
   - æ‰‹åŠ¨æ¸…ç†ï¼š`python clear_cache.py`
   - å®¹å™¨é‡å¯è‡ªåŠ¨æ¸…ç†

### æ•°æ®åº“ä¼˜åŒ–

1. **ç´¢å¼•ä¼˜åŒ–**:
   - stock_code, date, rankå­—æ®µå»ºç«‹ç´¢å¼•

2. **æŸ¥è¯¢ä¼˜åŒ–**:
   - ä½¿ç”¨ `filter(date.in_([...]))` æ‰¹é‡æŸ¥è¯¢
   - é¿å…N+1æŸ¥è¯¢é—®é¢˜

3. **è¿æ¥æ± **:
   ```python
   engine = create_engine(
       DATABASE_URL,
       pool_size=5,
       max_overflow=10
   )
   ```

### å‰ç«¯ä¼˜åŒ–

1. **ä»£ç åˆ†å‰²**: ä½¿ç”¨React lazy loading
2. **å›¾è¡¨ä¼˜åŒ–**: RechartsæŒ‰éœ€æ¸²æŸ“
3. **è¯·æ±‚é˜²æŠ–**: æœç´¢è¾“å…¥é˜²æŠ–
4. **Nginxå‹ç¼©**: Gzipé™æ€èµ„æº

---

## ğŸ› å·²çŸ¥é—®é¢˜

### å½“å‰é™åˆ¶

1. **æ•°æ®é‡é™åˆ¶**: 
   - å½“å‰åªæœ‰4å¤©æ•°æ®
   - è¡Œä¸šè¶‹åŠ¿14å¤©éœ€è¦æ›´å¤šå†å²æ•°æ®

2. **å¹¶å‘é™åˆ¶**:
   - 2æ ¸2Gé…ç½®ä¸‹å»ºè®®å¹¶å‘ç”¨æˆ·<10

3. **å®æ—¶æ€§**:
   - æ•°æ®éå®æ—¶ï¼Œéœ€æ‰‹åŠ¨å¯¼å…¥Excel

### æœªæ¥æ”¹è¿›

1. **è‡ªåŠ¨æ•°æ®é‡‡é›†**: å®šæ—¶ä»æ•°æ®æºæŠ“å–
2. **Redisç¼“å­˜**: å¤šå®ä¾‹éƒ¨ç½²æ”¯æŒ
3. **WebSocket**: å®æ—¶æ•°æ®æ¨é€
4. **ç”¨æˆ·ç³»ç»Ÿ**: ç™»å½•å’Œä¸ªäººæ”¶è—

---

## ğŸ“ é‡è¦è¯´æ˜

### ç»™AIåŠ©æ‰‹çš„æç¤º

1. **ä»£ç é£æ ¼**:
   - åç«¯ä½¿ç”¨ type hints
   - éµå¾ª PEP 8
   - ä½¿ç”¨ FastAPI æœ€ä½³å®è·µ

2. **ä¿®æ”¹æ³¨æ„**:
   - ä¿®æ”¹æ•°æ®åº“ç»“æ„éœ€æ›´æ–° `db_models.py`
   - ä¿®æ”¹APIéœ€åŒæ­¥æ›´æ–°å‰ç«¯è°ƒç”¨
   - æ¿å—ç­›é€‰é€»è¾‘é›†ä¸­åœ¨ `board_filter.py`

3. **æµ‹è¯•å»ºè®®**:
   - å…ˆåœ¨æœ¬åœ°æµ‹è¯•
   - ä½¿ç”¨ `clear_cache.py` æ¸…é™¤ç¼“å­˜
   - æ£€æŸ¥ `data_import_state.json` çŠ¶æ€

4. **éƒ¨ç½²æ³¨æ„**:
   - ç¡®ä¿ `.env` æ–‡ä»¶é…ç½®æ­£ç¡®
   - æ£€æŸ¥ç«¯å£å ç”¨
   - ç›‘æ§å†…å­˜ä½¿ç”¨

---

## ğŸ“ å¸¸è§ä»»åŠ¡

### æ·»åŠ æ–°APIç«¯ç‚¹

1. åœ¨ `backend/app/models/` åˆ›å»ºPydanticæ¨¡å‹
2. åœ¨ `backend/app/services/` å®ç°ä¸šåŠ¡é€»è¾‘
3. åœ¨ `backend/app/routers/` åˆ›å»ºè·¯ç”±
4. åœ¨ `backend/app/main.py` æ³¨å†Œè·¯ç”±
5. å‰ç«¯è°ƒç”¨æ–°API

### ä¿®æ”¹æ¿å—ç­›é€‰é€»è¾‘

ç¼–è¾‘ `backend/app/utils/board_filter.py`:
```python
def should_filter_stock(stock_code: str, board_type: str) -> bool:
    # ä¿®æ”¹ç­›é€‰è§„åˆ™
    pass
```

### æ·»åŠ æ–°çš„æŠ€æœ¯æŒ‡æ ‡

1. ç¡®ä¿Excelä¸­æœ‰è¯¥å­—æ®µ
2. åœ¨ `import_data_robust.py` æ·»åŠ å­—æ®µæ˜ å°„
3. åœ¨ `db_models.py` æ·»åŠ å­—æ®µ
4. æ•°æ®åº“è¿ç§»æˆ–é‡æ–°å¯¼å…¥

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰æ£€æŸ¥ï¼š
- [ ] Dockerå’ŒDocker Composeå·²å®‰è£…
- [ ] `.env` æ–‡ä»¶å·²é…ç½®
- [ ] Excelæ•°æ®æ–‡ä»¶å·²æ”¾å…¥ `./data`
- [ ] ç«¯å£80æœªè¢«å ç”¨
- [ ] æœåŠ¡å™¨è‡³å°‘2Gå†…å­˜

éƒ¨ç½²åæ£€æŸ¥ï¼š
- [ ] æ‰€æœ‰å®¹å™¨è¿è¡Œæ­£å¸¸ (`docker-compose ps`)
- [ ] æ•°æ®åº“å¥åº· (`docker-compose exec postgres pg_isready`)
- [ ] APIå¯è®¿é—® (`curl http://localhost/api/dates`)
- [ ] å‰ç«¯å¯è®¿é—® (`curl http://localhost`)
- [ ] æ•°æ®å·²å¯¼å…¥ (æ£€æŸ¥æ—¥å¿—)

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **éƒ¨ç½²æ–‡æ¡£**: README_DEPLOY.md
- **APIæ–‡æ¡£**: http://localhost/api/docs (éƒ¨ç½²å)
- **Gitä»“åº“**: [å¡«å†™æ‚¨çš„ä»“åº“åœ°å€]

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-11-06  
**ç»´æŠ¤è€…**: [æ‚¨çš„åå­—]
