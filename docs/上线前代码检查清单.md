# ä¸Šçº¿å‰ä»£ç æ£€æŸ¥æ¸…å•

## ğŸ¯ æœ¬æ¬¡ä¸Šçº¿åŠŸèƒ½

### å·²å®ŒæˆåŠŸèƒ½ âœ…
1. **å…¨å±€ä¿¡å·é…ç½®ç³»ç»Ÿ**
   - å…¨å±€é…ç½®Context
   - é…ç½®é¢æ¿ç»„ä»¶
   - æ¿å—è¯¦æƒ…é¡µä½¿ç”¨å…¨å±€é…ç½®
   - è‚¡ç¥¨æŸ¥è¯¢é¡µä½¿ç”¨å…¨å±€é…ç½®
   - å¼¹çª—ä½¿ç”¨å…¨å±€é…ç½®

2. **åç«¯ç¼“å­˜ä¼˜åŒ–**
   - industry_detail_service.pyç¼“å­˜keyåŒ…å«é˜ˆå€¼
   - IndustryDetailDialogä½¿ç”¨å…¨å±€é…ç½®

3. **Kå€¼é»˜è®¤ä¿®æ”¹**
   - IndustryWeightedModule.jsé»˜è®¤å€¼æ”¹ä¸º1.0

### æœªå®ŒæˆåŠŸèƒ½ â³
1. **æ¦œå•ä¿¡å·æ ‡ç­¾**ï¼ˆ15%å®Œæˆï¼Œå·²è®°å½•åˆ°å¾…å®ç°æ¸…å•ï¼‰
   - åç«¯APIå·²å‡†å¤‡å¥½
   - Serviceå±‚æœªå®ç°
   - å‰ç«¯æœªå®ç°

---

## âœ… ä»£ç æ£€æŸ¥é¡¹

### 1. å‰ç«¯APIè¯·æ±‚åœ°å€æ£€æŸ¥

#### â‘  æ£€æŸ¥API_BASE_URLé…ç½®
**æ–‡ä»¶**: `frontend/src/constants/config.js`
```javascript
export const API_BASE_URL = 'http://localhost:8000';
```
**âš ï¸ ä¸Šçº¿å‰éœ€è¦ä¿®æ”¹**ï¼š
- å¼€å‘ç¯å¢ƒï¼š`http://localhost:8000`
- ç”Ÿäº§ç¯å¢ƒï¼š`https://your-domain.com` æˆ– `http://your-server-ip:8000`

**ä¿®æ”¹æ–¹å¼**ï¼š
```javascript
// æ–¹æ¡ˆ1ï¼šç¯å¢ƒå˜é‡
export const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000';

// æ–¹æ¡ˆ2ï¼šæ ¹æ®hostnameè‡ªåŠ¨åˆ¤æ–­
export const API_BASE_URL = window.location.hostname === 'localhost' 
  ? 'http://localhost:8000'
  : `${window.location.protocol}//${window.location.hostname}:8000`;
```

#### â‘¡ æ£€æŸ¥æ‰€æœ‰APIè°ƒç”¨
**éœ€è¦æ£€æŸ¥çš„æ–‡ä»¶**ï¼š
- âœ… IndustryDetailPage.js - ä½¿ç”¨API_BASE_URL
- âœ… IndustryDetailDialog.js - ä½¿ç”¨API_BASE_URL
- âœ… StockQueryModule.js - ä½¿ç”¨API_BASE_URL
- âœ… RankJumpModule.js - ä½¿ç”¨API_BASE_URL
- âœ… SteadyRiseModule.js - ä½¿ç”¨API_BASE_URL
- âœ… HotSpotsModule.js - ä½¿ç”¨API_BASE_URL
- âœ… IndustryWeightedModule.js - ä½¿ç”¨API_BASE_URL

**éªŒè¯æ–¹å¼**ï¼š
```bash
# æœç´¢æ‰€æœ‰ç¡¬ç¼–ç çš„localhost
grep -r "localhost:8000" frontend/src/
grep -r "127.0.0.1:8000" frontend/src/
```

---

### 2. åç«¯ç¼“å­˜é€»è¾‘æ£€æŸ¥

#### â‘  industry_detail_service.py
**æ–‡ä»¶**: `backend/app/services/industry_detail_service.py`

**ç¼“å­˜keyé€»è¾‘** âœ… å·²ä¿®å¤ï¼š
```python
if calculate_signals and signal_thresholds:
    threshold_hash = f"{signal_thresholds.rank_jump_min}_{signal_thresholds.steady_rise_days_min}_{signal_thresholds.hot_list_top}"
    cache_key = f"industry_stocks_{industry_name}_{target_date}_{sort_mode}_{calculate_signals}_{threshold_hash}"
else:
    cache_key = f"industry_stocks_{industry_name}_{target_date}_{sort_mode}_{calculate_signals}"
```

**çŠ¶æ€**: âœ… æ­£ç¡®

#### â‘¡ rank_jump_service_db.py
**æ–‡ä»¶**: `backend/app/services/rank_jump_service_db.py`

**ç¼“å­˜keyé€»è¾‘** âœ… å·²ä¿®å¤ï¼š
```python
if calculate_signals and signal_thresholds:
    threshold_hash = f"{signal_thresholds.rank_jump_min}_{signal_thresholds.hot_list_top}"
    cache_key = f"rank_jump_{jump_threshold}_{board_type}_{sigma_multiplier}_{target_date}_{threshold_hash}"
else:
    cache_key = f"rank_jump_{jump_threshold}_{board_type}_{sigma_multiplier}_{target_date}"
```

**çŠ¶æ€**: âœ… æ­£ç¡®

#### â‘¢ å…¶ä»–Serviceçš„ç¼“å­˜
- âœ… steady_rise_service_db.py - æ— ç¼“å­˜ï¼ˆå¯ä»¥è€ƒè™‘æ·»åŠ ï¼‰
- âœ… hot_spots_service.py - æ— ç¼“å­˜ï¼ˆå¯ä»¥è€ƒè™‘æ·»åŠ ï¼‰

---

### 3. å…¨å±€ä¿¡å·é…ç½®æ£€æŸ¥

#### â‘  SignalConfigContext.js
**æ–‡ä»¶**: `frontend/src/contexts/SignalConfigContext.js`

**æ£€æŸ¥é¡¹**ï¼š
- âœ… DEFAULT_THRESHOLDSå®šä¹‰æ­£ç¡®
- âœ… Contextåˆ›å»ºæ­£ç¡®
- âœ… Provideræ­£ç¡®åŒ…è£¹App
- âœ… æ‰€æœ‰æ–¹æ³•æ­£å¸¸å·¥ä½œ
- âœ… è°ƒè¯•æ—¥å¿—å·²åˆ é™¤

**çŠ¶æ€**: âœ… æ­£å¸¸

#### â‘¡ SignalConfigPanel.js
**æ–‡ä»¶**: `frontend/src/components/SignalConfigPanel.js`

**æ£€æŸ¥é¡¹**ï¼š
- âœ… æ˜¾ç¤ºé€»è¾‘æ­£ç¡®
- âœ… zIndexè¶³å¤Ÿé«˜(9999)
- âœ… è¡¨å•éªŒè¯æ­£å¸¸
- âœ… è°ƒè¯•æ—¥å¿—å·²åˆ é™¤

**çŠ¶æ€**: âœ… æ­£å¸¸

#### â‘¢ ä½¿ç”¨å…¨å±€é…ç½®çš„ç»„ä»¶
**æ£€æŸ¥é¡¹**ï¼š
- âœ… IndustryDetailPage.js - æ­£ç¡®ä½¿ç”¨useSignalConfig
- âœ… StockQueryModule.js - æ­£ç¡®ä½¿ç”¨useSignalConfig
- âœ… IndustryDetailDialog.js - æ­£ç¡®ä½¿ç”¨useSignalConfig

**çŠ¶æ€**: âœ… æ­£å¸¸

---

### 4. åç«¯å¯¼å…¥æ£€æŸ¥

#### â‘  rank_jump.py
**æ–‡ä»¶**: `backend/app/routers/rank_jump.py`

**å¯¼å…¥æ£€æŸ¥** âœ… å·²ä¿®å¤ï¼š
```python
from ..services.signal_calculator import SignalThresholds  # âœ… æ­£ç¡®
```

**çŠ¶æ€**: âœ… æ­£å¸¸

#### â‘¡ å…¶ä»–è·¯ç”±
- âœ… industry_detail.py - å¯¼å…¥æ­£ç¡®
- âœ… steady_rise.py - æœªä¿®æ”¹ï¼Œæ— é—®é¢˜
- âœ… stock.py - æœªä¿®æ”¹ï¼Œæ— é—®é¢˜

**çŠ¶æ€**: âœ… æ­£å¸¸

---

### 5. å‰ç«¯ç»„ä»¶æ£€æŸ¥

#### â‘  App.js
**æ£€æŸ¥é¡¹**ï¼š
- âœ… SignalConfigProvideræ­£ç¡®åŒ…è£¹
- âœ… SignalConfigPanelæ­£ç¡®æ¸²æŸ“
- âœ… å…¨å±€é…ç½®æŒ‰é’®æ­£å¸¸å·¥ä½œ
- âœ… è°ƒè¯•æ—¥å¿—å·²åˆ é™¤

**çŠ¶æ€**: âœ… æ­£å¸¸

#### â‘¡ IndustryDetailPage.js
**æ£€æŸ¥é¡¹**ï¼š
- âœ… useEffectä¾èµ–åŒ…å«signalThresholds
- âœ… APIè¯·æ±‚ä¼ é€’å®Œæ•´å‚æ•°
- âœ… æœ¬åœ°é…ç½®UIå·²åˆ é™¤
- âœ… è°ƒè¯•æ—¥å¿—å·²åˆ é™¤

**çŠ¶æ€**: âœ… æ­£å¸¸

#### â‘¢ IndustryDetailDialog.js
**æ£€æŸ¥é¡¹**ï¼š
- âœ… ä½¿ç”¨å…¨å±€é…ç½®
- âœ… useEffectä¾èµ–åŒ…å«signalThresholds
- âœ… APIè¯·æ±‚ä¼ é€’å®Œæ•´å‚æ•°

**çŠ¶æ€**: âœ… æ­£å¸¸

#### â‘£ StockQueryModule.js
**æ£€æŸ¥é¡¹**ï¼š
- âœ… ä½¿ç”¨å…¨å±€é…ç½®
- âœ… æœ¬åœ°é…ç½®UIå·²åˆ é™¤
- âœ… ä¿¡å·åˆ¤æ–­ä½¿ç”¨å…¨å±€é˜ˆå€¼

**çŠ¶æ€**: âœ… æ­£å¸¸

#### â‘¤ IndustryWeightedModule.js
**æ£€æŸ¥é¡¹**ï¼š
- âœ… Kå€¼é»˜è®¤ä¸º1.0

**çŠ¶æ€**: âœ… æ­£å¸¸

---

### 6. ç¯å¢ƒå˜é‡æ£€æŸ¥

#### å‰ç«¯ç¯å¢ƒå˜é‡
**æ–‡ä»¶**: `frontend/.env` æˆ– `frontend/.env.production`

**å»ºè®®é…ç½®**ï¼š
```bash
# å¼€å‘ç¯å¢ƒ
REACT_APP_API_URL=http://localhost:8000

# ç”Ÿäº§ç¯å¢ƒ
REACT_APP_API_URL=https://your-domain.com
```

#### åç«¯ç¯å¢ƒå˜é‡
**æ–‡ä»¶**: `backend/.env`

**æ£€æŸ¥é¡¹**ï¼š
- âœ… DATABASE_URLé…ç½®æ­£ç¡®
- âœ… æ•°æ®åº“è·¯å¾„æ­£ç¡®
- âœ… ç«¯å£é…ç½®ï¼ˆé»˜è®¤8000ï¼‰

---

### 7. æ€§èƒ½æ£€æŸ¥

#### â‘  å†…å­˜ç¼“å­˜
**æ£€æŸ¥é¡¹**ï¼š
- âœ… memory_cacheå·²å…¨é‡åŠ è½½æ•°æ®
- âœ… æŸ¥è¯¢æ€§èƒ½<1ms
- âœ… å¯åŠ¨æ—¶é—´<30ç§’

#### â‘¡ ä¿¡å·è®¡ç®—
**æ£€æŸ¥é¡¹**ï¼š
- âœ… å•åªè‚¡ç¥¨è®¡ç®—<1ms
- âœ… 100åªè‚¡ç¥¨è®¡ç®—<100ms
- âœ… 1000åªè‚¡ç¥¨è®¡ç®—<1s

#### â‘¢ APIå“åº”æ—¶é—´
**æ£€æŸ¥é¡¹**ï¼š
- âœ… /api/industry/{name}/stocks <200ms
- âœ… /api/rank-jump <500ms
- âœ… /api/steady-rise <500ms

---

### 8. è·¨åŸŸé…ç½®æ£€æŸ¥

#### åç«¯CORSé…ç½®
**æ–‡ä»¶**: `backend/app/main.py`

**æ£€æŸ¥é¡¹**ï¼š
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # âš ï¸ ç”Ÿäº§ç¯å¢ƒå»ºè®®æ”¹ä¸ºå…·ä½“åŸŸå
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**âš ï¸ ç”Ÿäº§ç¯å¢ƒå»ºè®®**ï¼š
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "http://localhost:3000",
        "https://your-domain.com"
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

---

## ğŸ”§ ä¸Šçº¿å‰å¿…åšæ“ä½œ

### 1. ä¿®æ”¹APIåœ°å€
```bash
# frontend/src/constants/config.js
export const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000';
```

### 2. æ„å»ºå‰ç«¯
```bash
cd frontend
npm run build
```

### 3. é…ç½®nginxï¼ˆå¦‚æœä½¿ç”¨ï¼‰
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /path/to/frontend/build;
        try_files $uri /index.html;
    }
    
    # åç«¯APIä»£ç†
    location /api {
        proxy_pass http://localhost:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### 4. å¯åŠ¨åç«¯æœåŠ¡
```bash
cd backend
# æ–¹å¼1ï¼šç›´æ¥è¿è¡Œ
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000

# æ–¹å¼2ï¼šä½¿ç”¨gunicornï¼ˆç”Ÿäº§æ¨èï¼‰
gunicorn app.main:app -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000
```

### 5. æ•°æ®åº“æ£€æŸ¥
```bash
# ç¡®ä¿æ•°æ®åº“æ–‡ä»¶å­˜åœ¨
ls -lh backend/data/*.db

# æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
sqlite3 backend/data/stock_analysis.db "SELECT COUNT(*) FROM daily_stock_data;"
```

---

## âš ï¸ å·²çŸ¥é—®é¢˜å’Œä¸´æ—¶æ–¹æ¡ˆ

### 1. æ¦œå•ä¿¡å·æ ‡ç­¾åŠŸèƒ½æœªå®Œæˆ
**çŠ¶æ€**: 15%å®Œæˆ
**å½±å“**: æ’åè·³å˜æ¦œã€ç¨³æ­¥ä¸Šå‡æ¦œæš‚æ— ä¿¡å·æ ‡ç­¾åˆ—
**ä¸´æ—¶æ–¹æ¡ˆ**: åŠŸèƒ½å¯æ­£å¸¸ä½¿ç”¨ï¼Œåªæ˜¯ç¼ºå°‘ä¿¡å·æ ‡ç­¾æ˜¾ç¤º
**å®Œæˆæ—¶é—´**: é¢„è®¡3å°æ—¶

### 2. æœ€æ–°çƒ­ç‚¹æ¦œå­—æ®µæœªå®Œæˆ
**çŠ¶æ€**: 33%å®Œæˆï¼ˆæ¶¨è·Œå¹…å·²å®Œæˆï¼‰
**å½±å“**: ç¼ºå°‘æ”¾é‡å¤©æ•°ã€å¹³å‡é‡æ¯”50å¤©å­—æ®µ
**ä¸´æ—¶æ–¹æ¡ˆ**: å½“å‰å­—æ®µè¶³å¤Ÿä½¿ç”¨
**å®Œæˆæ—¶é—´**: é¢„è®¡1å°æ—¶

---

## âœ… æœ€ç»ˆæ£€æŸ¥æ¸…å•

### ä¸Šçº¿å‰
- [ ] å‰ç«¯APIåœ°å€å·²ä¿®æ”¹ä¸ºç”Ÿäº§ç¯å¢ƒ
- [ ] å‰ç«¯å·²æ„å»ºï¼ˆnpm run buildï¼‰
- [ ] åç«¯CORSé…ç½®æ­£ç¡®
- [ ] æ•°æ®åº“æ•°æ®å®Œæ•´
- [ ] åç«¯æœåŠ¡æ­£å¸¸å¯åŠ¨
- [ ] nginxé…ç½®æ­£ç¡®ï¼ˆå¦‚ä½¿ç”¨ï¼‰

### ä¸Šçº¿åéªŒè¯
- [ ] å…¨å±€é…ç½®æŒ‰é’®æ­£å¸¸å·¥ä½œ
- [ ] æ¿å—è¯¦æƒ…é¡µä¿¡å·æ˜¾ç¤ºæ­£å¸¸
- [ ] è‚¡ç¥¨æŸ¥è¯¢é¡µä¿¡å·æ˜¾ç¤ºæ­£å¸¸
- [ ] å¼¹çª—ä¿¡å·æ˜¾ç¤ºæ­£å¸¸
- [ ] é…ç½®ä¿®æ”¹åç«‹å³ç”Ÿæ•ˆ
- [ ] Kå€¼é»˜è®¤ä¸º1.0
- [ ] æ‰€æœ‰æ¦œå•æ­£å¸¸è®¿é—®

---

## ğŸ“ å›æ»šæ–¹æ¡ˆ

å¦‚æœä¸Šçº¿åå‡ºç°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. **å‰ç«¯å›æ»š**
```bash
# æ¢å¤ä¹‹å‰çš„build
cp -r frontend/build.backup frontend/build
```

2. **åç«¯å›æ»š**
```bash
# ä½¿ç”¨gitå›æ»š
git checkout <previous-commit>
# é‡å¯æœåŠ¡
pkill -f uvicorn
python -m uvicorn app.main:app --reload
```

3. **æ•°æ®åº“å›æ»š**
```bash
# æ¢å¤å¤‡ä»½
cp backend/data/stock_analysis.db.backup backend/data/stock_analysis.db
```

---

## ğŸ‰ ä¸Šçº¿æˆåŠŸæ ‡å¿—

- âœ… æ‰€æœ‰é¡µé¢æ­£å¸¸è®¿é—®
- âœ… å…¨å±€ä¿¡å·é…ç½®æ­£å¸¸å·¥ä½œ
- âœ… æ— æ§åˆ¶å°é”™è¯¯
- âœ… APIå“åº”æ—¶é—´æ­£å¸¸ï¼ˆ<500msï¼‰
- âœ… ç”¨æˆ·åé¦ˆè‰¯å¥½

---

**ä¸Šçº¿æ—¥æœŸ**: 2025-11-09
**ç‰ˆæœ¬å·**: v1.1.0
**ä¸»è¦åŠŸèƒ½**: å…¨å±€ä¿¡å·é…ç½®ç³»ç»Ÿ
