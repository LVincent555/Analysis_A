# 行业趋势分析 - 前N名选择功能

## ✨ 新增功能

为**行业趋势分析**模块添加了可切换的前N名数量选项，用户可以选择查看前1000/2000/3000/5000名的行业分布数据。

---

## 🎯 功能位置

### 今日前N名行业分布
在"今日前1000名行业分布"图表的右上角，添加了数据范围选择器。

```
┌─────────────────────────────────────────────────────────────┐
│ 📊 今日前1000名行业分布 (前30个行业)                         │
│                                                               │
│                          数据范围: [前1000名] 前2000名 前3000名 前5000名 │
│                          共 1000 只股票，78 个行业 · 2025年11月06日 │
└─────────────────────────────────────────────────────────────┘
```

### 行业趋势变化
标题也会同步更新显示当前选择的范围：
- **行业趋势变化（前1000名）**
- **行业趋势变化（前2000名）**
- **行业趋势变化（前3000名）**
- **行业趋势变化（前5000名）**

---

## 🔧 使用方法

### 1. 进入行业趋势分析模块
点击左侧导航 → **行业趋势分析**

### 2. 选择数据范围
在"今日前N名行业分布"图表右上角，点击以下按钮之一：
- **前1000名** (默认)
- **前2000名**
- **前3000名**
- **前5000名**

### 3. 查看更新后的数据
- 图表标题自动更新
- 行业分布数据重新加载
- 股票总数和行业数量更新
- 下方的"行业趋势变化"图表标题也同步更新

---

## 📊 数据说明

### 不同范围的意义

| 范围 | 说明 | 适用场景 |
|------|------|----------|
| **前1000名** | 最活跃的头部股票 | 查看市场最热门板块 |
| **前2000名** | 包含中等活跃股票 | 更全面的行业分布 |
| **前3000名** | 覆盖大部分活跃股票 | 全面了解市场结构 |
| **前5000名** | 几乎全市场覆盖 | 完整的行业生态分析 |

### 数据更新
- 切换范围后，数据会自动重新加载
- 加载过程中显示加载动画
- 加载完成后更新所有相关显示

---

## 🎨 界面样式

### 按钮组样式
```
数据范围: [前1000名] 前2000名 前3000名 前5000名
          ↑选中状态   ↑未选中状态
```

- **选中状态**: 绿色背景 + 白色文字
- **未选中状态**: 灰色文字 + 白色背景
- **悬停效果**: 白色背景高亮

### 响应式设计
- 按钮组自适应宽度
- 文字大小适中（text-xs）
- 圆角设计（rounded-lg）
- 平滑过渡动画

---

## 💡 使用示例

### 示例1：查看头部市场
**场景**：只关注最活跃的股票

**操作**：
1. 选择"前1000名"
2. 查看行业分布
3. 分析热门板块集中度

### 示例2：全面市场分析
**场景**：需要了解整体市场结构

**操作**：
1. 选择"前5000名"
2. 查看完整行业分布
3. 分析长尾行业情况

### 示例3：对比不同范围
**场景**：研究市场活跃度分层

**操作**：
1. 先选择"前1000名"，记录数据
2. 再选择"前3000名"，对比变化
3. 分析中小盘股的行业分布差异

---

## 🔧 技术实现

### 状态管理
```javascript
const [topNLimit, setTopNLimit] = useState(1000);
```

### API调用
```javascript
// 带limit参数的API调用
const response = await axios.get(
  `${API_BASE_URL}/api/industry/top1000?limit=${topNLimit}`
);
```

### 降级处理
如果后端API不支持limit参数，会自动降级使用默认的top1000端点：
```javascript
try {
  // 尝试使用带limit参数的API
  const response = await axios.get(`${API_BASE_URL}/api/industry/top1000?limit=${topNLimit}`);
} catch (err) {
  // 降级使用默认API
  const fallbackResponse = await axios.get(`${API_BASE_URL}/api/industry/top1000`);
}
```

---

## 📝 注意事项

### 1. 数据加载
- 切换范围会触发新的API请求
- 数据量越大，加载时间可能越长
- 建议根据实际需求选择合适的范围

### 2. 后端支持
- 前端已添加limit参数支持
- 如果后端API不支持，会自动降级
- **建议后端添加limit参数支持以获得最佳体验**

### 3. 性能考虑
- 前5000名数据量较大
- 图表渲染可能需要更多时间
- 建议在性能较好的设备上使用大范围数据

---

## 🚀 后端API建议

### 推荐的API端点设计

```python
@app.get("/api/industry/top1000")
async def get_top_n_industry(limit: int = 1000):
    """
    获取前N名股票的行业分布
    
    参数:
        limit: 前N名数量，默认1000，可选1000/2000/3000/5000
    
    返回:
        {
            "date": "20251106",
            "total_stocks": 1000,
            "stats": [
                {"industry": "通用设备", "count": 76, "percentage": "7.6"},
                ...
            ]
        }
    """
    # 实现逻辑...
```

### 参数验证
```python
if limit not in [1000, 2000, 3000, 5000]:
    limit = 1000  # 默认值
```

---

## 📞 反馈与改进

### 已实现
- ✅ 前端UI完成
- ✅ 状态管理完成
- ✅ API调用逻辑完成
- ✅ 降级处理完成

### 待优化
- ⏳ 后端API添加limit参数支持
- ⏳ 添加数据缓存机制
- ⏳ 优化大数据量渲染性能

---

**更新时间**: 2025年11月7日  
**版本**: v1.0  
**状态**: ✅ 前端完成，等待后端API支持
