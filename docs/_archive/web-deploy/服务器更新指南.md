# ğŸ”„ æœåŠ¡å™¨æ›´æ–°æŒ‡å—

> **é€šè¿‡Gitæ›´æ–°æœåŠ¡å™¨ä¸Šçš„ä»£ç **

---

## âš ï¸ é‡è¦ï¼šæœåŠ¡å™¨ä¸Šå·²æœ‰æ—§ç‰ˆæœ¬

æœåŠ¡å™¨ä¸Šæœ‰ä¹‹å‰æ²¡æäº¤çš„ç‰ˆæœ¬ï¼Œæ›´æ–°å‰éœ€è¦æ³¨æ„ä»¥ä¸‹äº‹é¡¹ï¼š

---

## ğŸ“‹ æ›´æ–°å‰æ£€æŸ¥æ¸…å•

### 1. æœ¬åœ°æäº¤å‰æ£€æŸ¥

```bash
# è¿è¡Œå®‰å…¨æäº¤è„šæœ¬
python git_commit_push.py

# è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
# âœ“ æ£€æŸ¥.gitignoreæ˜¯å¦æ­£ç¡®
# âœ“ æ¸…ç†Gitç¼“å­˜
# âœ“ æ£€æŸ¥æ˜¯å¦æœ‰æ•æ„Ÿæ–‡ä»¶
# âœ“ æäº¤å¹¶æ¨é€
```

### 2. æœåŠ¡å™¨ä¸Šéœ€è¦å¤‡ä»½çš„æ–‡ä»¶

**âš ï¸ åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ`git pull`ä¹‹å‰ï¼ŒåŠ¡å¿…å¤‡ä»½è¿™äº›æ–‡ä»¶ï¼š**

```bash
# SSHç™»å½•æœåŠ¡å™¨
ssh root@60.205.251.109
cd /root/stock_analysis_app

# å¤‡ä»½é‡è¦é…ç½®å’Œæ•°æ®
mkdir -p ../backup_$(date +%Y%m%d)

# å¤‡ä»½.envï¼ˆåŒ…å«æ•°æ®åº“å¯†ç ï¼‰
cp backend/.env ../backup_$(date +%Y%m%d)/

# å¤‡ä»½æ•°æ®å¯¼å…¥çŠ¶æ€
cp data/data_import_state.json ../backup_$(date +%Y%m%d)/ 2>/dev/null || true

# å¤‡ä»½è‡ªå®šä¹‰é…ç½®ï¼ˆå¦‚æœæœ‰ä¿®æ”¹ï¼‰
cp deploy/*.service ../backup_$(date +%Y%m%d)/ 2>/dev/null || true
cp deploy/*.conf ../backup_$(date +%Y%m%d)/ 2>/dev/null || true

echo "âœ“ å¤‡ä»½å®Œæˆï¼š../backup_$(date +%Y%m%d)/"
```

---

## ğŸš€ å®Œæ•´æ›´æ–°æµç¨‹

### æ­¥éª¤1ï¼šæœ¬åœ°æäº¤ï¼ˆWindowsï¼‰

```bash
# åœ¨é¡¹ç›®ç›®å½•è¿è¡Œ
python git_commit_push.py

# æˆ–æ‰‹åŠ¨æäº¤
git add .
git commit -m "chore: æ›´æ–°éƒ¨ç½²è„šæœ¬å’Œé…ç½®"
git push origin main
```

### æ­¥éª¤2ï¼šæœåŠ¡å™¨å¤‡ä»½ï¼ˆLinuxï¼‰

```bash
ssh root@60.205.251.109

cd /root/stock_analysis_app

# å¤‡ä»½é‡è¦æ–‡ä»¶ï¼ˆè§ä¸Šé¢çš„å¤‡ä»½å‘½ä»¤ï¼‰
mkdir -p ../backup_$(date +%Y%m%d)
cp backend/.env ../backup_$(date +%Y%m%d)/
cp data/data_import_state.json ../backup_$(date +%Y%m%d)/ 2>/dev/null || true

# åœæ­¢æ­£åœ¨è¿è¡Œçš„æœåŠ¡ï¼ˆå¦‚æœæœ‰ï¼‰
pkill -f uvicorn 2>/dev/null || true
pkill -f "npm start" 2>/dev/null || true
```

### æ­¥éª¤3ï¼šæ‹‰å–æ›´æ–°ï¼ˆLinuxï¼‰

```bash
# æŸ¥çœ‹å½“å‰çŠ¶æ€
git status

# å¦‚æœæœ‰æœ¬åœ°ä¿®æ”¹ï¼Œå…ˆæš‚å­˜
git stash

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# å¦‚æœéœ€è¦æ¢å¤æœ¬åœ°ä¿®æ”¹
# git stash pop
```

### æ­¥éª¤4ï¼šæ¢å¤é…ç½®ï¼ˆLinuxï¼‰

```bash
# æ¢å¤.envæ–‡ä»¶ï¼ˆå¦‚æœè¢«è¦†ç›–ï¼‰
if [ ! -f backend/.env ]; then
    cp ../backup_$(date +%Y%m%d)/.env backend/
    echo "âœ“ å·²æ¢å¤ .env æ–‡ä»¶"
fi

# æ¢å¤æ•°æ®å¯¼å…¥çŠ¶æ€ï¼ˆå¦‚æœéœ€è¦ï¼‰
if [ ! -f data/data_import_state.json ]; then
    cp ../backup_$(date +%Y%m%d)/data_import_state.json data/ 2>/dev/null || true
fi
```

### æ­¥éª¤5ï¼šé‡æ–°éƒ¨ç½²ï¼ˆLinuxï¼‰

```bash
# è¿è¡Œæ™ºèƒ½éƒ¨ç½²è„šæœ¬ï¼ˆä¼šè‡ªåŠ¨æ£€æµ‹å·²æœ‰é…ç½®ï¼‰
python3 deploy_smart.py dev

# å¯åŠ¨æœåŠ¡
./start_backend.sh &
./start_frontend.sh &
```

---

## ğŸ” ç‰¹æ®Šæƒ…å†µå¤„ç†

### æƒ…å†µ1ï¼šæœåŠ¡å™¨ä¸Šæœ‰æœªæäº¤çš„ä¿®æ”¹

```bash
# æŸ¥çœ‹ä¿®æ”¹
git status

# é€‰é¡¹Aï¼šä¿ç•™æœ¬åœ°ä¿®æ”¹
git stash              # æš‚å­˜æœ¬åœ°ä¿®æ”¹
git pull origin main   # æ‹‰å–æ›´æ–°
git stash pop          # æ¢å¤æœ¬åœ°ä¿®æ”¹ï¼ˆå¯èƒ½æœ‰å†²çªéœ€è¦æ‰‹åŠ¨è§£å†³ï¼‰

# é€‰é¡¹Bï¼šæ”¾å¼ƒæœ¬åœ°ä¿®æ”¹
git reset --hard       # æ”¾å¼ƒæ‰€æœ‰æœ¬åœ°ä¿®æ”¹
git pull origin main   # æ‹‰å–æ›´æ–°
```

### æƒ…å†µ2ï¼šæ‹‰å–æ—¶å‡ºç°å†²çª

```bash
# å¦‚æœæ˜¯é…ç½®æ–‡ä»¶å†²çªï¼Œä½¿ç”¨å¤‡ä»½
cp ../backup_*/backend/.env backend/.env

# å¦‚æœæ˜¯ä»£ç æ–‡ä»¶å†²çª
git status                    # æŸ¥çœ‹å†²çªæ–‡ä»¶
nano <conflicted-file>        # æ‰‹åŠ¨è§£å†³å†²çª
git add <conflicted-file>     # æ ‡è®°ä¸ºå·²è§£å†³
git commit -m "fix: è§£å†³åˆå¹¶å†²çª"
```

### æƒ…å†µ3ï¼šæ•°æ®åº“å·²æœ‰æ•°æ®

```bash
# ä¸ç”¨æ‹…å¿ƒï¼Œdeploy_smart.pyä¼šè‡ªåŠ¨æ£€æµ‹
# å®ƒä¼šæŸ¥çœ‹data/data_import_state.json
# å¦‚æœæ•°æ®å·²å¯¼å…¥ï¼Œä¼šè·³è¿‡å¯¼å…¥æ­¥éª¤
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### âœ… ä¼šè¢«Gitç®¡ç†çš„æ–‡ä»¶
- æ‰€æœ‰æºä»£ç ï¼ˆ.py, .js, .jsxç­‰ï¼‰
- é…ç½®æ¨¡æ¿ï¼ˆ.env.exampleï¼‰
- æ–‡æ¡£ï¼ˆ.mdæ–‡ä»¶ï¼‰
- éƒ¨ç½²è„šæœ¬ï¼ˆ.pyè„šæœ¬ï¼‰
- éƒ¨ç½²é…ç½®æ¨¡æ¿ï¼ˆdeploy/ç›®å½•ï¼‰

### âŒ ä¸ä¼šè¢«Gitç®¡ç†çš„æ–‡ä»¶
- `node_modules/` - å‰ç«¯ä¾èµ–ï¼ˆå¤ªå¤§ï¼‰
- `backend/venv/` - Pythonè™šæ‹Ÿç¯å¢ƒï¼ˆå¤ªå¤§ï¼‰
- `backend/.env` - æ•°æ®åº“å¯†ç ï¼ˆæ•æ„Ÿï¼‰
- `data/*.xlsx` - Excelæ•°æ®æ–‡ä»¶ï¼ˆæ•æ„Ÿï¼‰
- `data/data_import_state.json` - å¯¼å…¥çŠ¶æ€ï¼ˆæœ¬åœ°ï¼‰
- `__pycache__/` - Pythonç¼“å­˜
- `*.log` - æ—¥å¿—æ–‡ä»¶

### ğŸ” æ•æ„Ÿä¿¡æ¯ä¿æŠ¤
- `.env` æ–‡ä»¶åŒ…å«æ•°æ®åº“å¯†ç ï¼Œå·²åœ¨ `.gitignore` ä¸­
- æœåŠ¡å™¨æ›´æ–°åéœ€è¦æ£€æŸ¥ `.env` æ˜¯å¦å­˜åœ¨
- å¦‚æœä¸å­˜åœ¨ï¼Œä»å¤‡ä»½æ¢å¤æˆ–é‡æ–°é…ç½®

---

## ğŸ› ï¸ å®ç”¨å‘½ä»¤

### æœ¬åœ°ï¼ˆWindowsï¼‰

```bash
# æŸ¥çœ‹å°†è¦æäº¤çš„æ–‡ä»¶
git status

# æŸ¥çœ‹å…·ä½“ä¿®æ”¹å†…å®¹
git diff

# æ’¤é”€æœªæäº¤çš„ä¿®æ”¹
git checkout -- <file>

# æŸ¥çœ‹æäº¤å†å²
git log --oneline -10
```

### æœåŠ¡å™¨ï¼ˆLinuxï¼‰

```bash
# æŸ¥çœ‹å½“å‰ä»£ç ç‰ˆæœ¬
git log -1 --oneline

# æŸ¥çœ‹è¿œç¨‹æœ‰å“ªäº›æ›´æ–°
git fetch origin
git log HEAD..origin/main --oneline

# æŸ¥çœ‹æœåŠ¡æ˜¯å¦è¿è¡Œ
ps aux | grep uvicorn
ps aux | grep "npm start"

# æŸ¥çœ‹ç«¯å£å ç”¨
sudo netstat -tlnp | grep 3000
sudo netstat -tlnp | grep 8000
```

---

## ğŸ”„ å¿«é€Ÿæ›´æ–°è„šæœ¬ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰

åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨ç«¯çš„æ›´æ–°è„šæœ¬ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»º update.sh
cat > /root/stock_analysis_app/update.sh << 'EOF'
#!/bin/bash
echo "ğŸ”„ å¼€å§‹æ›´æ–°..."

# å¤‡ä»½
BACKUP_DIR=../backup_$(date +%Y%m%d_%H%M%S)
mkdir -p $BACKUP_DIR
cp backend/.env $BACKUP_DIR/ 2>/dev/null || true
cp data/data_import_state.json $BACKUP_DIR/ 2>/dev/null || true
echo "âœ“ å¤‡ä»½å®Œæˆ: $BACKUP_DIR"

# åœæ­¢æœåŠ¡
pkill -f uvicorn 2>/dev/null || true
pkill -f "npm start" 2>/dev/null || true
echo "âœ“ æœåŠ¡å·²åœæ­¢"

# æ‹‰å–æ›´æ–°
git stash 2>/dev/null || true
git pull origin main
echo "âœ“ ä»£ç å·²æ›´æ–°"

# æ¢å¤é…ç½®
if [ ! -f backend/.env ]; then
    cp $BACKUP_DIR/.env backend/
    echo "âœ“ å·²æ¢å¤ .env"
fi

# é‡æ–°éƒ¨ç½²
python3 deploy_smart.py dev
echo "âœ“ éƒ¨ç½²å®Œæˆ"

# å¯åŠ¨æœåŠ¡
nohup ./start_backend.sh > backend.log 2>&1 &
sleep 3
nohup ./start_frontend.sh > frontend.log 2>&1 &
echo "âœ“ æœåŠ¡å·²å¯åŠ¨"

echo "âœ… æ›´æ–°å®Œæˆï¼"
echo "è®¿é—®: http://60.205.251.109:3000"
EOF

chmod +x update.sh
```

ç„¶åæ¯æ¬¡æ›´æ–°åªéœ€ï¼š
```bash
./update.sh
```

---

## âœ… å®Œæ•´æµç¨‹æ€»ç»“

```
ã€æœ¬åœ°ã€‘
1. python git_commit_push.py
2. è¾“å…¥æäº¤ä¿¡æ¯
3. ç¡®è®¤æ¨é€

ã€æœåŠ¡å™¨ã€‘
4. ssh root@60.205.251.109
5. cd /root/stock_analysis_app
6. ./update.sh (æˆ–æŒ‰ä¸Šé¢çš„æ­¥éª¤æ‰‹åŠ¨æ‰§è¡Œ)

ã€éªŒè¯ã€‘
7. è®¿é—® http://60.205.251.109:3000
8. æµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£å¸¸
```

---

## ğŸ†˜ é—®é¢˜æ’æŸ¥

### é—®é¢˜ï¼šæ‹‰å–åæœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æ£€æŸ¥.envæ˜¯å¦å­˜åœ¨
ls -la backend/.env

# å¦‚æœä¸å­˜åœ¨ï¼Œä»å¤‡ä»½æ¢å¤
cp ../backup_*/.env backend/

# é‡æ–°éƒ¨ç½²
python3 deploy_smart.py dev
```

### é—®é¢˜ï¼šæ•°æ®ä¸¢å¤±

```bash
# æ£€æŸ¥æ•°æ®å¯¼å…¥çŠ¶æ€
ls -la data/data_import_state.json

# å¦‚æœæ–‡ä»¶å­˜åœ¨ä½†æ•°æ®åº“ä¸ºç©ºï¼Œé‡æ–°å¯¼å…¥
cd backend
source venv/bin/activate
python scripts/import_data_robust.py
```

### é—®é¢˜ï¼šç«¯å£è¢«å ç”¨

```bash
# æŸ¥æ‰¾å¹¶æ€æ­»å ç”¨è¿›ç¨‹
sudo kill -9 $(sudo lsof -t -i:3000)
sudo kill -9 $(sudo lsof -t -i:8000)
```

---

**ğŸ“ å»ºè®®ï¼š** ç¬¬ä¸€æ¬¡æ›´æ–°æ—¶ï¼Œå»ºè®®æ‰‹åŠ¨æ‰§è¡Œæ¯ä¸€æ­¥ï¼Œç¡®ä¿ç†è§£æ•´ä¸ªæµç¨‹ã€‚ä¹‹åå¯ä»¥ä½¿ç”¨ `update.sh` è„šæœ¬å¿«é€Ÿæ›´æ–°ã€‚

**ğŸ¯ é‡ç‚¹ï¼š** æ°¸è¿œè®°å¾—å…ˆå¤‡ä»½ `backend/.env` å’Œ `data/data_import_state.json`ï¼
