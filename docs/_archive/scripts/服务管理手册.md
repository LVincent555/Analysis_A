# ğŸ“˜ æœåŠ¡ç®¡ç†æ‰‹å†Œ

> **ä¸€é”®ç®¡ç†è‚¡ç¥¨åˆ†æç³»ç»Ÿçš„æ‰€æœ‰æœåŠ¡**

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# æ–¹å¼1ï¼šä½¿ç”¨Pythonè„šæœ¬
python3 service_manager.py start all

# æ–¹å¼2ï¼šä½¿ç”¨Shellå¿«æ·å‘½ä»¤
chmod +x service.sh
./service.sh start all
```

---

## ğŸ“‹ å®Œæ•´å‘½ä»¤åˆ—è¡¨

### 1. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
python3 service_manager.py start all

# åªå¯åŠ¨åç«¯
python3 service_manager.py start backend

# åªå¯åŠ¨å‰ç«¯
python3 service_manager.py start frontend
```

### 2. åœæ­¢æœåŠ¡

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
python3 service_manager.py stop all

# åªåœæ­¢åç«¯
python3 service_manager.py stop backend

# åªåœæ­¢å‰ç«¯
python3 service_manager.py stop frontend
```

### 3. é‡å¯æœåŠ¡

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
python3 service_manager.py restart all

# é‡å¯æŒ‡å®šæœåŠ¡
python3 service_manager.py restart backend
python3 service_manager.py restart frontend
```

### 4. æŸ¥çœ‹çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
python3 service_manager.py status
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
======================================================================
ğŸ“Š æœåŠ¡çŠ¶æ€
======================================================================

ğŸ”¹ åç«¯APIæœåŠ¡
   çŠ¶æ€: âœ… è¿è¡Œä¸­
   PID: 12345
   ç«¯å£: 8000
   CPU: 2.5%
   å†…å­˜: 125.3 MB
   å¯åŠ¨æ—¶é—´: 2025-11-07 10:00:00
   æ—¥å¿—: /root/DA/Analysis_A/logs/backend.log

ğŸ”¹ å‰ç«¯WebæœåŠ¡
   çŠ¶æ€: âœ… è¿è¡Œä¸­
   PID: 12346
   ç«¯å£: 3000
   CPU: 1.2%
   å†…å­˜: 89.7 MB
   å¯åŠ¨æ—¶é—´: 2025-11-07 10:00:05
   æ—¥å¿—: /root/DA/Analysis_A/logs/frontend.log

======================================================================
```

### 5. æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—ï¼ˆé»˜è®¤æœ€è¿‘50è¡Œï¼‰
python3 service_manager.py logs backend

# æŸ¥çœ‹å‰ç«¯æ—¥å¿—
python3 service_manager.py logs frontend

# æŸ¥çœ‹æ›´å¤šè¡Œæ•°
python3 service_manager.py logs backend 100
```

### 6. å®æ—¶ç›‘æ§

```bash
# æ¯5ç§’åˆ·æ–°ä¸€æ¬¡ï¼ˆé»˜è®¤ï¼‰
python3 service_manager.py monitor

# è‡ªå®šä¹‰åˆ·æ–°é—´éš”ï¼ˆç§’ï¼‰
python3 service_manager.py monitor 10

# æŒ‰ Ctrl+C åœæ­¢ç›‘æ§
```

---

## ğŸ—‚ï¸ ç›®å½•ç»“æ„

æœåŠ¡ç®¡ç†å™¨ä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹ç›®å½•ï¼š

```
stock_analysis_app/
â”œâ”€â”€ service_manager.py       # æœåŠ¡ç®¡ç†å™¨ä¸»ç¨‹åº
â”œâ”€â”€ service.sh               # å¿«æ·å‘½ä»¤
â”œâ”€â”€ logs/                    # æ—¥å¿—ç›®å½•
â”‚   â”œâ”€â”€ backend.log         # åç«¯æœåŠ¡æ—¥å¿—
â”‚   â”œâ”€â”€ frontend.log        # å‰ç«¯æœåŠ¡æ—¥å¿—
â”‚   â””â”€â”€ manager_20251107.log # ç®¡ç†å™¨æ—¥å¿—ï¼ˆæŒ‰æ—¥æœŸï¼‰
â”œâ”€â”€ .pids/                   # PIDæ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ backend.pid         # åç«¯PID
â”‚   â””â”€â”€ frontend.pid        # å‰ç«¯PID
â””â”€â”€ service_config.json      # æœåŠ¡é…ç½®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
```

---

## ğŸ”§ æ—¥å¿—ç³»ç»Ÿ

### æ—¥å¿—ç‰¹ç‚¹

1. **åˆ†ç±»æ¸…æ™°**ï¼šæ¯ä¸ªæœåŠ¡ç‹¬ç«‹æ—¥å¿—æ–‡ä»¶
2. **è‡ªåŠ¨å½’æ¡£**ï¼šç®¡ç†å™¨æ—¥å¿—æŒ‰æ—¥æœŸå‘½å
3. **å®Œæ•´è®°å½•**ï¼šå¯åŠ¨æ—¶é—´ã€é”™è¯¯ä¿¡æ¯ã€è¿è¡Œæ—¥å¿—
4. **å®æ—¶è¿½è¸ª**ï¼šæ”¯æŒtailå®æ—¶æŸ¥çœ‹

### æ—¥å¿—ç¤ºä¾‹

**åç«¯æ—¥å¿—** (`logs/backend.log`):
```
============================================================
å¯åŠ¨æ—¶é—´: 2025-11-07 10:00:00
============================================================

INFO:     Started server process [12345]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

**ç®¡ç†å™¨æ—¥å¿—** (`logs/manager_20251107.log`):
```
2025-11-07 10:00:00 [INFO] å¯åŠ¨ åç«¯APIæœåŠ¡...
2025-11-07 10:00:01 [INFO] âœ“ åç«¯APIæœåŠ¡ å·²å¯åŠ¨ (PID: 12345)
2025-11-07 10:00:01 [INFO]   æ—¥å¿—æ–‡ä»¶: /root/DA/Analysis_A/logs/backend.log
2025-11-07 10:00:03 [INFO] å¯åŠ¨ å‰ç«¯WebæœåŠ¡...
2025-11-07 10:00:04 [INFO] âœ“ å‰ç«¯WebæœåŠ¡ å·²å¯åŠ¨ (PID: 12346)
```

---

## ğŸ¯ å¸¸ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæœåŠ¡å™¨é‡å¯åå¯åŠ¨æœåŠ¡

```bash
cd /root/DA/Analysis_A
python3 service_manager.py start all
```

### åœºæ™¯2ï¼šæ›´æ–°ä»£ç åé‡å¯

```bash
git pull origin main
python3 service_manager.py restart all
```

### åœºæ™¯3ï¼šæŸ¥çœ‹æœåŠ¡æ˜¯å¦æ­£å¸¸

```bash
python3 service_manager.py status
```

### åœºæ™¯4ï¼šæ’æŸ¥é—®é¢˜æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹åç«¯æœ€è¿‘100è¡Œæ—¥å¿—
python3 service_manager.py logs backend 100

# å®æ—¶ç›‘æ§æœåŠ¡çŠ¶æ€
python3 service_manager.py monitor
```

### åœºæ™¯5ï¼šä¸´æ—¶åœæ­¢æœåŠ¡

```bash
# åœæ­¢æ‰€æœ‰
python3 service_manager.py stop all

# åªåœæ­¢å‰ç«¯ï¼ˆä¿ç•™åç«¯APIï¼‰
python3 service_manager.py stop frontend
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### è‡ªåŠ¨ç”Ÿæˆçš„é…ç½®

é¦–æ¬¡è¿è¡Œä¼šç”Ÿæˆ `service_config.json`ï¼š

```json
{
  "backend": {
    "name": "åç«¯APIæœåŠ¡",
    "cwd": "/root/DA/Analysis_A/backend",
    "command": "source venv/bin/activate && python -m uvicorn app.main:app --host 0.0.0.0 --port 8000",
    "shell": true,
    "port": 8000,
    "log_file": "backend.log",
    "pid_file": "backend.pid"
  },
  "frontend": {
    "name": "å‰ç«¯WebæœåŠ¡",
    "cwd": "/root/DA/Analysis_A/frontend",
    "command": "npm start",
    "shell": true,
    "port": 3000,
    "log_file": "frontend.log",
    "pid_file": "frontend.pid"
  }
}
```

### è‡ªå®šä¹‰é…ç½®

å¦‚éœ€ä¿®æ”¹ï¼Œç›´æ¥ç¼–è¾‘ `service_config.json`ï¼Œç„¶åé‡å¯æœåŠ¡ã€‚

---

## ğŸ” ç›‘æ§åŠŸèƒ½

å®æ—¶ç›‘æ§ä¼šæ¯éš”å‡ ç§’åˆ·æ–°å¹¶æ˜¾ç¤ºï¼š

- âœ… æœåŠ¡è¿è¡ŒçŠ¶æ€
- ğŸ“Š CPUå’Œå†…å­˜å ç”¨
- â° å¯åŠ¨æ—¶é—´
- ğŸ”¢ è¿›ç¨‹PID
- ğŸ“ æ—¥å¿—æ–‡ä»¶ä½ç½®

```bash
python3 service_manager.py monitor
```

è¾“å‡ºä¼šè‡ªåŠ¨åˆ·æ–°ï¼Œæ˜¾ç¤ºæœ€æ–°çŠ¶æ€ã€‚

---

## ğŸ†˜ æ•…éšœæ’æŸ¥

### æœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# 1. æŸ¥çœ‹ç®¡ç†å™¨æ—¥å¿—
tail -50 logs/manager_$(date +%Y%m%d).log

# 2. æŸ¥çœ‹æœåŠ¡æ—¥å¿—
python3 service_manager.py logs backend
python3 service_manager.py logs frontend

# 3. æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep -E "3000|8000"
```

### æœåŠ¡çŠ¶æ€å¼‚å¸¸

```bash
# å¼ºåˆ¶åœæ­¢å¹¶é‡å¯
python3 service_manager.py stop all
sleep 2
python3 service_manager.py start all
```

### æ—¥å¿—æ–‡ä»¶å¤ªå¤§

```bash
# æ‰‹åŠ¨æ¸…ç†æ—§æ—¥å¿—
cd logs
ls -lh *.log
rm backend.log.old frontend.log.old
```

---

## ğŸ” å¼€æœºè‡ªå¯ï¼ˆå¯é€‰ï¼‰

### ä½¿ç”¨crontab

```bash
crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œ
@reboot cd /root/DA/Analysis_A && python3 service_manager.py start all >> logs/startup.log 2>&1
```

### æˆ–ä½¿ç”¨systemd

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/stock-analysis.service`:

```ini
[Unit]
Description=Stock Analysis Services
After=network.target postgresql.service

[Service]
Type=forking
User=root
WorkingDirectory=/root/DA/Analysis_A
ExecStart=/usr/bin/python3 /root/DA/Analysis_A/service_manager.py start all
ExecStop=/usr/bin/python3 /root/DA/Analysis_A/service_manager.py stop all
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
```

ç„¶åï¼š
```bash
sudo systemctl daemon-reload
sudo systemctl enable stock-analysis
sudo systemctl start stock-analysis
```

---

## ğŸ“ å¿«é€Ÿå‚è€ƒ

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `start all` | å¯åŠ¨æ‰€æœ‰æœåŠ¡ |
| `stop all` | åœæ­¢æ‰€æœ‰æœåŠ¡ |
| `restart all` | é‡å¯æ‰€æœ‰æœåŠ¡ |
| `status` | æŸ¥çœ‹çŠ¶æ€ |
| `logs backend` | æŸ¥çœ‹åç«¯æ—¥å¿— |
| `logs frontend` | æŸ¥çœ‹å‰ç«¯æ—¥å¿— |
| `monitor` | å®æ—¶ç›‘æ§ |

---

## ğŸ‰ ç‰¹æ€§æ€»ç»“

âœ… **ä¸€é”®ç®¡ç†** - ä¸€ä¸ªå‘½ä»¤ç®¡ç†æ‰€æœ‰æœåŠ¡  
âœ… **å®Œæ•´æ—¥å¿—** - è¯¦ç»†çš„æ—¥å¿—è®°å½•å’Œåˆ†ç±»  
âœ… **çŠ¶æ€ç›‘æ§** - å®æ—¶CPUã€å†…å­˜ç›‘æ§  
âœ… **è‡ªåŠ¨PID** - è‡ªåŠ¨ç®¡ç†è¿›ç¨‹ID  
âœ… **å®‰å…¨é‡å¯** - ä¼˜é›…çš„å¯åŠ¨å’Œåœæ­¢  
âœ… **ç®€å•æ˜“ç”¨** - æ¸…æ™°çš„å‘½ä»¤å’Œæç¤º  

---

**ğŸš€ ç°åœ¨å°±å¼€å§‹ä½¿ç”¨å§ï¼**

```bash
python3 service_manager.py start all
```
