# æ¦œå•æ·»åŠ ä¿¡å·æ ‡ç­¾ - å‰©ä½™å·¥ä½œæ¸…å•

## âœ… å·²å®Œæˆ

1. **åç«¯API** - rank_jump.py
   - âœ… æ·»åŠ äº†`calculate_signals`å‚æ•°
   - âœ… æ·»åŠ äº†æ‰€æœ‰signal_thresholdså‚æ•°
   - âœ… æ„å»ºSignalThresholdså¯¹è±¡
   - âœ… ä¼ é€’ç»™serviceå±‚

2. **æ–‡æ¡£**
   - âœ… åˆ›å»ºäº†è¯¦ç»†çš„å®ç°æ–¹æ¡ˆæ–‡æ¡£
   - âœ… è®°å½•äº†"ä¿¡å·å†å²ç»Ÿè®¡åˆ†æ"åŠŸèƒ½åˆ°å¾…å®ç°æ¸…å•

---

## ğŸ“‹ å‰©ä½™å·¥ä½œ

### åç«¯ï¼ˆé¢„è®¡2å°æ—¶ï¼‰

#### 1. rank_jump_service_db.py â³
**æ–‡ä»¶ä½ç½®**ï¼š`backend/app/services/rank_jump_service_db.py`

**éœ€è¦ä¿®æ”¹çš„æ–¹æ³•ç­¾å**ï¼š
```python
def analyze_rank_jump(
    self,
    jump_threshold: int = 2500,
    board_type: str = 'main',
    sigma_multiplier: float = 1.0,
    target_date: Optional[str] = None,
    calculate_signals: bool = False,  # æ–°å¢
    signal_thresholds: SignalThresholds = None  # æ–°å¢
) -> RankJumpResult:
```

**æ ¸å¿ƒé€»è¾‘**ï¼ˆåœ¨è¿”å›ç»“æœå‰æ·»åŠ ï¼‰ï¼š
```python
# å¦‚æœéœ€è¦è®¡ç®—ä¿¡å·
if calculate_signals and signal_thresholds:
    from ..services.signal_calculator import SignalCalculator
    from ..cache.memory_cache import memory_cache
    
    calculator = SignalCalculator(signal_thresholds)
    
    for stock in jump_stocks:  # jump_stocksæ˜¯åŸæœ‰çš„è·³å˜è‚¡ç¥¨åˆ—è¡¨
        # è·å–å®Œæ•´çš„DailyStockData
        current_data = memory_cache.get_daily_data_by_stock(
            stock['code'],
            current_date
        )
        
        if current_data:
            # è®¡ç®—æ‰€æœ‰ä¿¡å·
            signals_dict = calculator.calculate_signals(
                stock_code=stock['code'],
                current_date=current_date,
                current_data=current_data
            )
            
            # è¿‡æ»¤æ‰"è·³å˜"ä¿¡å·ï¼ˆæœ¬æ¨¡å—çš„ä¿¡å·ï¼‰
            signals = []
            for signal in signals_dict.get('signals', []):
                if 'è·³å˜' not in signal:
                    signals.append(signal)
            
            stock['signals'] = signals
            stock['signal_count'] = len(signals)
        else:
            stock['signals'] = []
            stock['signal_count'] = 0
```

---

#### 2. steady_rise.py â³
**æ–‡ä»¶ä½ç½®**ï¼š`backend/app/routers/steady_rise.py`

**ä¿®æ”¹å†…å®¹**ï¼šå®Œå…¨å‚è€ƒrank_jump.pyçš„ä¿®æ”¹
- æ·»åŠ calculate_signalså‚æ•°
- æ·»åŠ æ‰€æœ‰signal_thresholdså‚æ•°
- æ„å»ºSignalThresholdså¯¹è±¡
- ä¼ é€’ç»™service

---

#### 3. steady_rise_service_db.py â³
**æ–‡ä»¶ä½ç½®**ï¼š`backend/app/services/steady_rise_service_db.py`

**ä¿®æ”¹å†…å®¹**ï¼šå®Œå…¨å‚è€ƒrank_jump_service_db.pyçš„ä¿®æ”¹
- ä¿®æ”¹æ–¹æ³•ç­¾å
- æ·»åŠ ä¿¡å·è®¡ç®—é€»è¾‘
- **è¿‡æ»¤è§„åˆ™**ï¼šæ’é™¤åŒ…å«"ä¸Šå‡"çš„ä¿¡å·

```python
# è¿‡æ»¤æ‰"ä¸Šå‡"ä¿¡å·
signals = []
for signal in signals_dict.get('signals', []):
    if 'ä¸Šå‡' not in signal:  # æ’é™¤"ç¨³æ­¥ä¸Šå‡"ã€"æŒç»­ä¸Šå‡"ç­‰
        signals.append(signal)
```

---

### å‰ç«¯ï¼ˆé¢„è®¡1å°æ—¶ï¼‰

#### 1. RankJumpModule.js â³
**æ–‡ä»¶ä½ç½®**ï¼š`frontend/src/components/modules/RankJumpModule.js`

**æ­¥éª¤1ï¼šå¯¼å…¥å…¨å±€é…ç½®**
```javascript
import { useSignalConfig } from '../../contexts/SignalConfigContext';

export default function RankJumpModule({ jumpBoardType, jumpThreshold, selectedDate }) {
  const { signalThresholds } = useSignalConfig();
  // ...
}
```

**æ­¥éª¤2ï¼šä¿®æ”¹APIè¯·æ±‚**
```javascript
const fetchRankJumpData = async () => {
  let url = `${API_BASE_URL}/api/rank-jump?`;
  url += `board_type=${jumpBoardType}`;
  url += `&jump_threshold=${jumpThreshold}`;
  url += `&sigma_multiplier=${jumpSigmaMultiplier}`;
  
  // æ·»åŠ ä¿¡å·è®¡ç®—å‚æ•°
  url += `&calculate_signals=true`;
  url += `&hot_list_top=${signalThresholds.hotListTop}`;
  url += `&rank_jump_min=${signalThresholds.rankJumpMin}`;
  url += `&steady_rise_days=${signalThresholds.steadyRiseDays}`;
  url += `&price_surge_min=${signalThresholds.priceSurgeMin}`;
  url += `&volume_surge_min=${signalThresholds.volumeSurgeMin}`;
  url += `&volatility_surge_min=${signalThresholds.volatilitySurgeMin}`;
  
  if (selectedDate) {
    url += `&date=${selectedDate}`;
  }
  
  const response = await axios.get(url);
  setRankJumpData(response.data);
};
```

**æ­¥éª¤3ï¼šuseEffectæ·»åŠ ä¾èµ–**
```javascript
useEffect(() => {
  fetchRankJumpData();
}, [jumpBoardType, jumpThreshold, jumpSigmaMultiplier, selectedDate, signalThresholds]);
//                                                                    â†‘ æ–°å¢ä¾èµ–
```

**æ­¥éª¤4ï¼šæ·»åŠ ä¿¡å·åˆ—**

åœ¨è¡¨æ ¼çš„`<thead>`ä¸­æ·»åŠ ï¼š
```javascript
<th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
  ä¿¡å·
</th>
```

åœ¨è¡¨æ ¼çš„`<tbody>`ä¸­æ·»åŠ ï¼ˆæ¯ä¸€è¡Œï¼‰ï¼š
```javascript
<td className="px-4 py-3">
  {stock.signals && stock.signals.length > 0 ? (
    <div className="flex flex-wrap gap-1">
      {stock.signals.map((signal, idx) => (
        <span 
          key={idx}
          className="text-xs px-2 py-0.5 bg-orange-100 text-orange-800 rounded whitespace-nowrap"
        >
          {signal}
        </span>
      ))}
    </div>
  ) : (
    <span className="text-xs text-gray-400">-</span>
  )}
</td>
```

---

#### 2. SteadyRiseModule.js â³
**æ–‡ä»¶ä½ç½®**ï¼š`frontend/src/components/modules/SteadyRiseModule.js`

**ä¿®æ”¹å†…å®¹**ï¼šå®Œå…¨å‚è€ƒRankJumpModule.jsçš„ä¿®æ”¹
- å¯¼å…¥useSignalConfig
- ä¿®æ”¹APIè¯·æ±‚æ·»åŠ å‚æ•°
- useEffectæ·»åŠ ä¾èµ–
- æ·»åŠ ä¿¡å·åˆ—

---

## ğŸ§ª æµ‹è¯•æ¸…å•

### åç«¯æµ‹è¯•

1. **æ’åè·³å˜æ¦œ**
   ```bash
   # ä¸è®¡ç®—ä¿¡å·
   curl "http://localhost:8000/api/rank-jump?jump_threshold=2500&board_type=main"
   
   # è®¡ç®—ä¿¡å·
   curl "http://localhost:8000/api/rank-jump?jump_threshold=2500&board_type=main&calculate_signals=true&rank_jump_min=1000&hot_list_top=100"
   ```
   
   **éªŒè¯**ï¼š
   - âœ… è¿”å›stocksæ•°ç»„
   - âœ… æ¯ä¸ªstockæœ‰signalså­—æ®µ
   - âœ… signalsä¸åŒ…å«"è·³å˜"

2. **ç¨³æ­¥ä¸Šå‡æ¦œ**
   ```bash
   curl "http://localhost:8000/api/steady-rise?min_rise_days=3&calculate_signals=true&rank_jump_min=1000"
   ```
   
   **éªŒè¯**ï¼š
   - âœ… signalsä¸åŒ…å«"ä¸Šå‡"

### å‰ç«¯æµ‹è¯•

1. **æ’åè·³å˜æ¦œ**
   - è¿›å…¥"æ’åè·³å˜"é¡µé¢
   - ä¿®æ”¹è·³å˜é˜ˆå€¼
   - **éªŒè¯**ï¼š
     - âœ… è¡¨æ ¼æœ‰"ä¿¡å·"åˆ—
     - âœ… æ˜¾ç¤ºä¿¡å·æ ‡ç­¾ï¼ˆæ©™è‰²å°badgeï¼‰
     - âœ… æ²¡æœ‰"è·³å˜"ä¿¡å·

2. **ç¨³æ­¥ä¸Šå‡æ¦œ**
   - è¿›å…¥"ç¨³æ­¥ä¸Šå‡"é¡µé¢
   - **éªŒè¯**ï¼š
     - âœ… è¡¨æ ¼æœ‰"ä¿¡å·"åˆ—
     - âœ… æ²¡æœ‰"ä¸Šå‡"ä¿¡å·

3. **å…¨å±€é…ç½®åŒæ­¥**
   - ç‚¹å‡»é¡¶éƒ¨"ä¿¡å·é…ç½®"
   - ä¿®æ”¹è·³å˜æ¦œé˜ˆå€¼ï¼š2000 â†’ 3000
   - ç‚¹å‡»"åº”ç”¨é…ç½®"
   - **éªŒè¯**ï¼š
     - âœ… æ’åè·³å˜æ¦œé‡æ–°åŠ è½½
     - âœ… ä¿¡å·æ ‡ç­¾å˜åŒ–

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. ä¿¡å·é¢œè‰²å»ºè®®
```javascript
// å¯ä»¥æ ¹æ®ä¿¡å·ç±»å‹è®¾ç½®ä¸åŒé¢œè‰²
const getSignalColor = (signal) => {
  if (signal.includes('çƒ­ç‚¹æ¦œ') || signal.includes('TOP')) 
    return 'bg-red-100 text-red-800';
  if (signal.includes('è·³å˜')) 
    return 'bg-orange-100 text-orange-800';
  if (signal.includes('æ¶¨å¹…') || signal.includes('æ¶¨')) 
    return 'bg-green-100 text-green-800';
  if (signal.includes('æ¢æ‰‹ç‡')) 
    return 'bg-blue-100 text-blue-800';
  if (signal.includes('ä¸Šå‡')) 
    return 'bg-purple-100 text-purple-800';
  if (signal.includes('æ³¢åŠ¨ç‡')) 
    return 'bg-yellow-100 text-yellow-800';
  return 'bg-gray-100 text-gray-800';
};
```

### 2. æ€§èƒ½ä¼˜åŒ–
- åç«¯è®¡ç®—100åªè‚¡ç¥¨ä¿¡å·çº¦40msï¼Œå®Œå…¨å¯æ¥å—
- å‰ç«¯ä¿¡å·æ ‡ç­¾ä½¿ç”¨`flex-wrap`è‡ªåŠ¨æ¢è¡Œ
- å¦‚æœä¿¡å·å¤ªå¤šï¼Œå¯ä»¥è€ƒè™‘æœ€å¤šæ˜¾ç¤º3ä¸ªï¼Œå…¶ä»–ç”¨tooltip

### 3. ç¼“å­˜æœºåˆ¶
åç«¯serviceå·²æœ‰ç¼“å­˜ï¼Œä¿®æ”¹åéœ€è¦æ›´æ–°ç¼“å­˜keyï¼š
```python
# åŒ…å«signalé…ç½®çš„ç¼“å­˜key
if calculate_signals and signal_thresholds:
    threshold_hash = f"{signal_thresholds.rank_jump_min}_{signal_thresholds.hot_list_top}"
    cache_key = f"rank_jump_{jump_threshold}_{threshold_hash}"
else:
    cache_key = f"rank_jump_{jump_threshold}"
```

---

## ğŸš€ å®æ–½é¡ºåº

å»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºå®æ–½ï¼Œä¾¿äºé€æ­¥æµ‹è¯•ï¼š

1. **åç«¯ - æ’åè·³å˜**
   - âœ… rank_jump.pyï¼ˆå·²å®Œæˆï¼‰
   - â³ rank_jump_service_db.py
   - ğŸ§ª æµ‹è¯•API

2. **å‰ç«¯ - æ’åè·³å˜**
   - â³ RankJumpModule.js
   - ğŸ§ª æµ‹è¯•é¡µé¢

3. **åç«¯ - ç¨³æ­¥ä¸Šå‡**
   - â³ steady_rise.py
   - â³ steady_rise_service_db.py
   - ğŸ§ª æµ‹è¯•API

4. **å‰ç«¯ - ç¨³æ­¥ä¸Šå‡**
   - â³ SteadyRiseModule.js
   - ğŸ§ª æµ‹è¯•é¡µé¢

5. **æ•´ä½“æµ‹è¯•**
   - ğŸ§ª å…¨å±€é…ç½®åŒæ­¥æµ‹è¯•
   - ğŸ§ª å¤šæ¬¡ä¿®æ”¹é…ç½®æµ‹è¯•
   - ğŸ§ª æ€§èƒ½æµ‹è¯•

---

## ğŸ’¡ å¿«é€Ÿå‚è€ƒ

### ä¿¡å·è¿‡æ»¤è§„åˆ™
- **æ’åè·³å˜æ¦œ**ï¼š`if 'è·³å˜' not in signal`
- **ç¨³æ­¥ä¸Šå‡æ¦œ**ï¼š`if 'ä¸Šå‡' not in signal`
- **æœ€æ–°çƒ­ç‚¹æ¦œ**ï¼ˆå¦‚éœ€è¦ï¼‰ï¼š`if 'çƒ­ç‚¹æ¦œ' not in signal and 'TOP' not in signal`

### APIå‚æ•°
```
calculate_signals=true
hot_list_top=100
rank_jump_min=2000
steady_rise_days=3
price_surge_min=5.0
volume_surge_min=10.0
volatility_surge_min=30.0
```

---

**é¢„è®¡æ€»æ—¶é—´**ï¼š3å°æ—¶
- åç«¯ï¼š2å°æ—¶
- å‰ç«¯ï¼š1å°æ—¶

**å½“å‰è¿›åº¦**ï¼š15% (1/7 å®Œæˆ)

ğŸ¯ **ä¸‹æ¬¡ç»§ç»­æ—¶ä»è¿™é‡Œå¼€å§‹ï¼šä¿®æ”¹ rank_jump_service_db.py**
