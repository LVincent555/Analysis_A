# æ¦œå•æ·»åŠ ä¿¡å·æ ‡ç­¾å®ç°æ–¹æ¡ˆ

## ğŸ¯ éœ€æ±‚

ä¸ºä¸‰ä¸ªæ¦œå•æ·»åŠ "ä¿¡å·"åˆ—ï¼Œæ˜¾ç¤ºå…¶ä»–ä¿¡å·æ ‡ç­¾ï¼Œä½†**æ’é™¤æœ¬æ¨¡å—çš„ä¿¡å·**ï¼š

| æ¦œå• | æ’åºæ–¹å¼ | æ˜¾ç¤ºä¿¡å· | æ’é™¤ä¿¡å· |
|-----|---------|---------|---------|
| æ’åè·³å˜æ¦œ | æŒ‰è·³å˜å¹…åº¦ | çƒ­ç‚¹ã€æ¶¨å¹…ã€æ¢æ‰‹ç‡ã€ç¨³æ­¥ä¸Šå‡ã€æ³¢åŠ¨ç‡ | âŒ è·³å˜ä¿¡å· |
| ç¨³æ­¥ä¸Šå‡æ¦œ | æŒ‰ä¸Šå‡å¤©æ•° | çƒ­ç‚¹ã€è·³å˜ã€æ¶¨å¹…ã€æ¢æ‰‹ç‡ã€æ³¢åŠ¨ç‡ | âŒ ç¨³æ­¥ä¸Šå‡ä¿¡å· |
| æœ€æ–°çƒ­ç‚¹æ¦œ | æŒ‰å‘½ä¸­æ¬¡æ•° | è·³å˜ã€æ¶¨å¹…ã€æ¢æ‰‹ç‡ã€ç¨³æ­¥ä¸Šå‡ã€æ³¢åŠ¨ç‡ | âŒ çƒ­ç‚¹ä¿¡å· |

---

## ğŸ“Š å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆæ¦‚è¿°

1. **åç«¯æ·»åŠ ä¿¡å·è®¡ç®—**
   - åœ¨`/api/rank-jump`å’Œ`/api/steady-rise`æ¥å£æ·»åŠ `calculate_signals`å‚æ•°
   - Serviceå±‚è°ƒç”¨`SignalCalculator`è®¡ç®—æ‰€æœ‰ä¿¡å·
   - **è¿‡æ»¤æ‰æœ¬æ¨¡å—çš„ä¿¡å·**
   - è¿”å›`signals`å­—æ®µæ•°ç»„

2. **å‰ç«¯æ˜¾ç¤ºä¿¡å·åˆ—**
   - æ·»åŠ "ä¿¡å·"åˆ—
   - æ˜¾ç¤ºä¿¡å·æ ‡ç­¾ï¼ˆå½©è‰²å°badgeï¼‰
   - è¿æ¥å…¨å±€é…ç½®ç³»ç»Ÿ

---

## ğŸ”§ åç«¯ä¿®æ”¹

### 1. æ’åè·³å˜æ¦œ (rank_jump)

#### â‘  APIè·¯ç”± (`rank_jump.py`)
```python
@router.get("/rank-jump", response_model=RankJumpResult)
async def analyze_rank_jump(
    jump_threshold: int = Query(default=2500),
    board_type: str = Query(default='main'),
    sigma_multiplier: float = Query(default=1.0),
    date: str = Query(default=None),
    # æ–°å¢ï¼šä¿¡å·è®¡ç®—å‚æ•°
    calculate_signals: bool = Query(default=False),
    hot_list_top: int = Query(default=100),
    rank_jump_min: int = Query(default=2000),
    steady_rise_days: int = Query(default=3),
    price_surge_min: float = Query(default=5.0),
    volume_surge_min: float = Query(default=10.0),
    volatility_surge_min: float = Query(default=30.0)
):
    if calculate_signals:
        signal_thresholds = SignalThresholds(...)
    
    return rank_jump_service.analyze_rank_jump(
        ...,
        calculate_signals=calculate_signals,
        signal_thresholds=signal_thresholds
    )
```

#### â‘¡ Service (`rank_jump_service_db.py`)
```python
def analyze_rank_jump(
    self,
    jump_threshold: int,
    board_type: str,
    sigma_multiplier: float,
    target_date: str = None,
    calculate_signals: bool = False,  # æ–°å¢
    signal_thresholds: SignalThresholds = None  # æ–°å¢
) -> RankJumpResult:
    # ... åŸæœ‰é€»è¾‘ ...
    
    # æ–°å¢ï¼šè®¡ç®—ä¿¡å·
    if calculate_signals and signal_thresholds:
        from ..services.signal_calculator import SignalCalculator
        calculator = SignalCalculator(signal_thresholds)
        
        for stock in stocks:
            # è®¡ç®—æ‰€æœ‰ä¿¡å·
            signals_dict = calculator.calculate_signals(
                stock_code=stock['code'],
                current_date=query_date,
                current_data=current_data
            )
            
            # è¿‡æ»¤æ‰"è·³å˜"ä¿¡å·
            signals = []
            for signal in signals_dict.get('signals', []):
                # æ’é™¤åŒ…å«"è·³å˜"çš„ä¿¡å·
                if 'è·³å˜' not in signal:
                    signals.append(signal)
            
            stock['signals'] = signals
            stock['signal_count'] = len(signals)
    
    return result
```

---

### 2. ç¨³æ­¥ä¸Šå‡æ¦œ (steady_rise)

#### â‘  APIè·¯ç”± (`steady_rise.py`)
```python
@router.get("/steady-rise", response_model=SteadyRiseResult)
async def analyze_steady_rise(
    min_rise_days: int = Query(default=3),
    board_type: str = Query(default='main'),
    date: str = Query(default=None),
    # æ–°å¢ï¼šä¿¡å·è®¡ç®—å‚æ•°
    calculate_signals: bool = Query(default=False),
    hot_list_top: int = Query(default=100),
    rank_jump_min: int = Query(default=2000),
    steady_rise_days: int = Query(default=3),
    price_surge_min: float = Query(default=5.0),
    volume_surge_min: float = Query(default=10.0),
    volatility_surge_min: float = Query(default=30.0)
):
    # ... åŒrank_jumpç±»ä¼¼çš„é€»è¾‘
```

#### â‘¡ Service (`steady_rise_service_db.py`)
```python
def analyze_steady_rise(
    self,
    min_rise_days: int,
    board_type: str,
    target_date: str = None,
    calculate_signals: bool = False,  # æ–°å¢
    signal_thresholds: SignalThresholds = None  # æ–°å¢
) -> SteadyRiseResult:
    # ... åŸæœ‰é€»è¾‘ ...
    
    # æ–°å¢ï¼šè®¡ç®—ä¿¡å·å¹¶è¿‡æ»¤
    if calculate_signals and signal_thresholds:
        calculator = SignalCalculator(signal_thresholds)
        
        for stock in stocks:
            signals_dict = calculator.calculate_signals(...)
            
            # è¿‡æ»¤æ‰"ç¨³æ­¥ä¸Šå‡"ã€"ä¸Šå‡"ã€"æŒç»­ä¸Šå‡"ä¿¡å·
            signals = []
            for signal in signals_dict.get('signals', []):
                if 'ä¸Šå‡' not in signal:  # æ’é™¤æ‰€æœ‰åŒ…å«"ä¸Šå‡"çš„ä¿¡å·
                    signals.append(signal)
            
            stock['signals'] = signals
    
    return result
```

---

## ğŸ¨ å‰ç«¯ä¿®æ”¹

### 1. æ’åè·³å˜æ¨¡å— (`RankJumpModule.js`)

#### â‘  å¯¼å…¥å…¨å±€é…ç½®
```javascript
import { useSignalConfig } from '../../contexts/SignalConfigContext';

export default function RankJumpModule({ jumpBoardType, jumpThreshold, selectedDate }) {
  const { signalThresholds } = useSignalConfig();
  // ...
}
```

#### â‘¡ APIè¯·æ±‚æ·»åŠ å‚æ•°
```javascript
const fetchRankJumpData = async () => {
  let url = `${API_BASE_URL}/api/rank-jump?board_type=${jumpBoardType}&jump_threshold=${jumpThreshold}&sigma_multiplier=${jumpSigmaMultiplier}`;
  
  // æ·»åŠ ä¿¡å·è®¡ç®—å‚æ•°
  url += `&calculate_signals=true`;
  url += `&hot_list_top=${signalThresholds.hotListTop}`;
  url += `&rank_jump_min=${signalThresholds.rankJumpMin}`;
  url += `&steady_rise_days=${signalThresholds.steadyRiseDays}`;
  url += `&price_surge_min=${signalThresholds.priceSurgeMin}`;
  url += `&volume_surge_min=${signalThresholds.volumeSurgeMin}`;
  url += `&volatility_surge_min=${signalThresholds.volatilitySurgeMin}`;
  
  if (selectedDate) {
    url += `&date=${selectedDate}`;
  }
  
  const response = await axios.get(url);
  // ...
};
```

#### â‘¢ æ·»åŠ ä¿¡å·åˆ—
```javascript
<table className="min-w-full">
  <thead>
    <tr>
      <th>æ’å</th>
      <th>è‚¡ç¥¨ä»£ç </th>
      <th>è‚¡ç¥¨åç§°</th>
      <th>æ’åè·³å˜</th>
      <th>æ¶¨è·Œå¹…</th>
      <th>ä¿¡å·</th>  {/* æ–°å¢åˆ— */}
    </tr>
  </thead>
  <tbody>
    {stocks.map(stock => (
      <tr key={stock.code}>
        {/* ... å…¶ä»–åˆ— ... */}
        
        {/* ä¿¡å·åˆ— */}
        <td className="px-4 py-3">
          {stock.signals && stock.signals.length > 0 ? (
            <div className="flex flex-wrap gap-1">
              {stock.signals.map((signal, idx) => (
                <span 
                  key={idx}
                  className="text-xs px-2 py-0.5 bg-orange-100 text-orange-800 rounded"
                >
                  {signal}
                </span>
              ))}
            </div>
          ) : (
            <span className="text-xs text-gray-400">-</span>
          )}
        </td>
      </tr>
    ))}
  </tbody>
</table>
```

---

### 2. ç¨³æ­¥ä¸Šå‡æ¨¡å— (`SteadyRiseModule.js`)

åŒæ ·çš„ä¿®æ”¹ï¼š
1. å¯¼å…¥`useSignalConfig`
2. APIè¯·æ±‚æ·»åŠ ä¿¡å·å‚æ•°
3. æ·»åŠ ä¿¡å·åˆ—æ˜¾ç¤º

---

## ğŸ“‹ ä¿¡å·è¿‡æ»¤è§„åˆ™

### åç«¯è¿‡æ»¤é€»è¾‘

```python
# æ’åè·³å˜æ¦œï¼šæ’é™¤"è·³å˜"
def filter_rank_jump_signals(signals: List[str]) -> List[str]:
    return [s for s in signals if 'è·³å˜' not in s]

# ç¨³æ­¥ä¸Šå‡æ¦œï¼šæ’é™¤"ä¸Šå‡"
def filter_steady_rise_signals(signals: List[str]) -> List[str]:
    return [s for s in signals if 'ä¸Šå‡' not in s]

# æœ€æ–°çƒ­ç‚¹æ¦œï¼šæ’é™¤"çƒ­ç‚¹æ¦œ"ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰
def filter_hot_spot_signals(signals: List[str]) -> List[str]:
    return [s for s in signals if 'çƒ­ç‚¹æ¦œ' not in s and 'TOP' not in s]
```

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

### æ’åè·³å˜æ¦œ
```
æ’å  è‚¡ç¥¨ä»£ç   è‚¡ç¥¨åç§°  æ’åè·³å˜   æ¶¨è·Œå¹…  ä¿¡å·
1     920961   åˆ›è¿œä¿¡ç§‘  â†‘3424     +5.87%  [çƒ­ç‚¹æ¦œTOP100] [æ¶¨å¹…5.9%] [æ¢æ‰‹ç‡10.8%]
2     300394   å¤©å­šé€šä¿¡  â†‘1888     +12.67% [çƒ­ç‚¹æ¦œTOP100] [æ¶¨å¹…12.7%] [æ¢æ‰‹ç‡10.2%]
```

### ç¨³æ­¥ä¸Šå‡æ¦œ
```
æ’å  è‚¡ç¥¨ä»£ç   è‚¡ç¥¨åç§°  ä¸Šå‡å¤©æ•°  æ¶¨è·Œå¹…  ä¿¡å·
1     600519   è´µå·èŒ…å°  5å¤©       +2.3%   [çƒ­ç‚¹æ¦œTOP100] [æ¶¨å¹…2.3%]
2     000858   äº”ç²®æ¶²    4å¤©       +1.8%   [è·³å˜â†‘1200] [æ¶¨å¹…1.8%]
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ€§èƒ½è€ƒè™‘
- ä¿¡å·è®¡ç®—ä¼šå¢åŠ å“åº”æ—¶é—´ï¼ˆéœ€è¦éå†æ¯åªè‚¡ç¥¨ï¼‰
- å»ºè®®å‰ç«¯é»˜è®¤`calculate_signals=false`ï¼Œç”¨æˆ·éœ€è¦æ—¶å†å¯ç”¨
- æˆ–è€…åç«¯æ·»åŠ ç¼“å­˜

### 2. ä¿¡å·æ•°é‡
- æœ‰äº›è‚¡ç¥¨å¯èƒ½æœ‰å¾ˆå¤šä¿¡å·ï¼ˆ5-6ä¸ªï¼‰
- å»ºè®®å‰ç«¯ä¿¡å·åˆ—æœ€å¤šæ˜¾ç¤º3-4ä¸ªï¼Œå…¶ä»–ç”¨"..."çœç•¥
- æˆ–è€…ç”¨tooltipæ˜¾ç¤ºå®Œæ•´ä¿¡å·åˆ—è¡¨

### 3. ä¿¡å·é¢œè‰²
å»ºè®®ä¸åŒç±»å‹çš„ä¿¡å·ç”¨ä¸åŒé¢œè‰²ï¼š
- çƒ­ç‚¹æ¦œï¼šçº¢è‰² `bg-red-100 text-red-800`
- è·³å˜ï¼šæ©™è‰² `bg-orange-100 text-orange-800`
- æ¶¨å¹…ï¼šç»¿è‰² `bg-green-100 text-green-800`
- æ¢æ‰‹ç‡ï¼šè“è‰² `bg-blue-100 text-blue-800`
- ç¨³æ­¥ä¸Šå‡ï¼šç´«è‰² `bg-purple-100 text-purple-800`
- æ³¢åŠ¨ç‡ï¼šé»„è‰² `bg-yellow-100 text-yellow-800`

---

## âœ… å®ç°æ­¥éª¤

1. [x] âœ… ä¿®æ”¹åç«¯API - rank_jump.py
2. [ ] ä¿®æ”¹åç«¯Service - rank_jump_service_db.py
3. [ ] ä¿®æ”¹åç«¯API - steady_rise.py
4. [ ] ä¿®æ”¹åç«¯Service - steady_rise_service_db.py
5. [ ] ä¿®æ”¹å‰ç«¯ - RankJumpModule.js
6. [ ] ä¿®æ”¹å‰ç«¯ - SteadyRiseModule.js
7. [ ] æµ‹è¯•éªŒè¯

---

## ğŸ’¬ éœ€è¦ä½ ç¡®è®¤

1. **ä¿¡å·è¿‡æ»¤è§„åˆ™** - æ˜¯å¦åŒæ„ä¸Šé¢çš„è¿‡æ»¤è§„åˆ™ï¼Ÿ
   - æ’åè·³å˜æ¦œï¼šæ’é™¤åŒ…å«"è·³å˜"çš„ä¿¡å· âœ…
   - ç¨³æ­¥ä¸Šå‡æ¦œï¼šæ’é™¤åŒ…å«"ä¸Šå‡"çš„ä¿¡å· âœ…
   - æœ€æ–°çƒ­ç‚¹æ¦œï¼šæ˜¯å¦éœ€è¦ï¼Ÿï¼ˆè¿™ä¸ªæ¦œå•æ•°æ®ç»“æ„ä¸åŒï¼‰

2. **æ˜¾ç¤ºæ–¹å¼** - æ˜¯å¦åŒæ„æ·»åŠ "ä¿¡å·"åˆ—ï¼Ÿè¿˜æ˜¯ç”¨å…¶ä»–æ–¹å¼æ˜¾ç¤ºï¼Ÿ

3. **æ€§èƒ½** - æ˜¯å¦é»˜è®¤å¼€å¯ä¿¡å·è®¡ç®—ï¼Ÿè¿˜æ˜¯è®©ç”¨æˆ·é€‰æ‹©ï¼Ÿ

---

**ç¡®è®¤åæˆ‘ç«‹å³å¼€å§‹å®ç°ï¼** ğŸš€
