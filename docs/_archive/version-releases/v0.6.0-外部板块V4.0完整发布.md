# v0.6.0 - 外部板块系统 V4.0 完整发布

**发布日期**: 2025-12-23  
**版本**: v0.6.0

---

## 🎯 版本概述

本版本完成了**外部板块多对多分析系统 V4.0** 的全部核心功能，实现了从东方财富527个板块的数据同步、热度计算ETL、到前端多维可视化的完整链路。

---

## 📊 核心功能发布

### 1. 外部板块数据体系 (Backend)

#### 1.1 数据同步模块
| 功能 | 说明 | 状态 |
|------|------|------|
| 板块列表同步 | 同步东财527个板块（行业87 + 概念440） | ✅ 完成 |
| 成分股快照 | 每日板块成分股关系快照 | ✅ 完成 |
| A股交易日对齐 | 非交易日自动回退到最近交易日 | ✅ 完成 |
| 快照日期修复 | `fix_snap_date.py` 修复工具 | ✅ 完成 |

#### 1.2 热度计算ETL (`task_board_heat.py`)
| 功能 | 说明 | 状态 |
|------|------|------|
| 稀疏快照寻址 | 个股数据实时 + 板块关系历史复用 | ✅ 完成 |
| 热度守恒分摊 | share_ij = W_type(j) / Σ W_type(k) | ✅ 完成 |
| B/C系指标计算 | B1龙头强度、B2龙头密度、C1资金总量、C2平均能量 | ✅ 完成 |
| 综合热度公式 | heat_raw = α*B1 + β*B2 + γ*C2 + δ*local | ✅ 完成 |
| 黑/灰名单惩罚 | BLACK≈0, GREY=0.1 权重惩罚 | ✅ 完成 |
| 个股信号分级 | S/A/B/NONE 四级信号体系 | ✅ 完成 |
| DNA数据预生成 | dna_json 完整板块诊断信息 | ✅ 完成 |

#### 1.3 后台管理功能
| 功能 | 路径 | 说明 |
|------|------|------|
| 外部板块同步 | `/ext-board-sync` | 触发同步、查看历史、运维统计 |
| 板块热度计算 | `/ext-board-heat-calc` | 指定日期/全部/强制重算、实时日志、任务取消 |

---

### 2. 数据库架构 (V4.0)

#### 2.1 核心表结构
| 表名 | 用途 | 记录数 |
|------|------|--------|
| `ext_board_list` | 板块清单 | 527 |
| `ext_board_daily_snap` | 每日板块成分股快照 | 61,206+ |
| `ext_board_heat_daily` | 板块热度聚合结果 | 526/天 |
| `cache_stock_board_signal` | 个股板块信号缓存 | 5,429/天 |
| `board_blacklist` | 黑/灰名单配置 | 动态 |

#### 2.2 已执行迁移
- `004_ext_board_heat_update.sql` - 本地测试环境
- `004_ext_board_heat_full.sql` - 服务器全新部署
- `006_board_signal_v4.sql` - V4.0字段增强

#### 2.3 配置体系 (`system_configs` category='board')
共16个可调参数：
- 类型权重: `board_w_industry=1.0`, `board_w_concept=0.7`, `board_w_region=0.5`
- 防守/进攻线: `board_safe_pct=0.3`, `board_hot_pct=0.8`
- 合成权重: `board_w_stock=1.0`, `board_w_exposure=0.7`, `board_w_max_concept=0.5`
- 信号阈值: `S=0.97`, `A=0.90`, `B=0.80`
- 热度权重: `α=0.4`, `β=0.2`, `γ=0.3`, `δ=0.1`

---

### 3. API接口 (V4.0)

**前缀**: `/api/board-heat`

| 方法 | 路径 | 功能 |
|------|------|------|
| GET | `/ranking` | 板块热度榜单（支持黑名单过滤） |
| GET | `/stock/{code}` | 个股板块信号 |
| GET | `/stocks/batch` | 批量获取个股信号 |
| GET | `/stock/{code}/dna` | 个股DNA诊断 |
| GET | `/board/{id}` | 板块详情（贡献度排序、分页） |
| GET | `/dates` | 可用日期列表 |
| GET | `/market/treemap` | 市场热力云图 |
| GET | `/market/signal-bar` | 市场信号体检仪 |
| GET | `/market/sector-matrix` | 板块风格罗盘 |
| GET | `/mining/resonance` | 双S级共振猎手 |
| GET | `/mining/hidden-gems` | 隐形冠军挖掘机 |

---

### 4. 前端组件 (V4.0)

#### 4.1 新增页面/组件
| 组件 | 文件 | 功能 |
|------|------|------|
| 板块热度榜 | `ExtBoardHeat.js` | 三大视图Tab（市场全景/风格罗盘/智能掘金） |
| 市场热力云图 | `MarketTreemap.js` | 面积=C1资金总量，色彩=热度 |
| 信号体检仪 | `MarketSignalBar.js` | S/A/B分布统计 |
| 风格罗盘 | `SectorMatrix.js` | X=B2密度, Y=C2能量 散点图 |
| 智能掘金 | `MiningList.js` | 双S共振猎手 + 隐形冠军挖掘机 |
| DNA诊断 | `StockDNADialog.js` | 板块驱动、行业安全、因子占位 |
| 板块详情 | `BoardDetailDialog.js` | 成分股贡献度表、统计卡片、4维指标 |
| 板块分析页 | `BoardAnalysisPage.js` | 多维度信号说明(T1-T6)、趋势图 |

#### 4.2 新旧版切换
通过 `SignalConfigPanel` 中的 `boardDataSource` 配置：
- `dc`: 原版（DC 87行业）
- `eastmoney`: 新版（东财527板块）

---

## 📋 系统功能总览

### 核心分析模块
| 模块 | 路由 | 说明 |
|------|------|------|
| 最新热点 | `hot-spots` | 重复出现的热门股票分析 |
| 排名跳变 | `rank-jump` | 排名大幅跃升股票 |
| 稳步上升 | `steady-rise` | 排名连续上升股票 |
| 单针下二十 | `needle-under-20` | 特定K线形态策略 |

### 查询系统
| 模块 | 功能 |
|------|------|
| 股票查询 | 个股历史数据和走势 |
| 板块查询 | DC 87行业 / 东财527板块 |
| 当日DC数据 | sector_daily原始数据 |
| 当日股票排名 | 全市场排名列表 |

### 行业趋势分析
- 直接数量统计（前1000/2000/3000）
- 权值热度排名
- DC板块趋势变化

### 系统管理
- 数据导入管理
- 用户/角色/会话管理
- 操作日志/登录记录
- 外部板块同步与热度计算

---

## 🗂 项目结构

```
stock_analysis_app/
├── backend/
│   ├── app/
│   │   ├── auth/          # 认证授权
│   │   ├── core/          # 核心功能（16个模块）
│   │   ├── crypto/        # 加密工具
│   │   ├── middleware/    # 中间件
│   │   ├── models/        # Pydantic模型（6个）
│   │   ├── routers/       # API路由（21个）
│   │   ├── services/      # 业务服务（34个）
│   │   ├── utils/         # 工具函数
│   │   ├── config.py
│   │   ├── database.py
│   │   ├── db_models.py
│   │   └── main.py
│   ├── scripts/           # ETL脚本
│   └── migrations/        # 数据库迁移
├── frontend-client/
│   └── src/
│       ├── components/    # 组件（36个）
│       ├── contexts/      # 上下文
│       ├── hooks/         # 自定义Hooks（6个）
│       ├── pages/         # 页面（13个）
│       ├── services/      # API服务（9个）
│       ├── utils/         # 工具函数
│       └── constants/     # 常量定义
└── docs/                  # 文档目录
```

---

## 📈 数据规模

| 数据项 | 当前规模 |
|--------|----------|
| 板块数量 | 527个（行业87 + 概念440） |
| 每日快照记录 | ~61,000条 |
| 每日热度记录 | 526条/天 |
| 每日信号缓存 | 5,429条/天 |
| 个股日数据累计 | 151,985条 |

---

## ⏳ 待完成功能

### 近期规划
- [ ] 各列表模块完整集成板块信号标签（排名跳变、稳步上升等）
- [ ] 数据源切换后自动刷新数据
- [ ] BoardAnalysisPage 板块对比 Tab

### V3.5 规划中
- [ ] 宽指黑名单清洗优化
- [ ] S级评分基准修正（全市场分位制）
- [ ] 算法透明化与深度可视化

---

## 🔧 技术栈

| 层级 | 技术 |
|------|------|
| 后端框架 | FastAPI + SQLAlchemy |
| 数据库 | PostgreSQL 15 |
| 前端框架 | React 18 |
| 样式 | TailwindCSS |
| 图表 | Recharts + ECharts |
| 部署 | Docker + Nginx |

---

## 📚 文档索引

| 文档 | 路径 |
|------|------|
| 项目概览 | `docs/PROJECT_OVERVIEW.md` |
| 系统功能清单 | `docs/系统功能清单.md` |
| 外部板块已实现功能清单 | `docs/外部板块多对多系统-已实现功能清单.md` |
| V3.5规划书 | `docs/V3.5-板块系统算法透明化与深度可视化规划书.md` |
| 多对多系统设计简稿 | `docs/多对多系统设计简稿.md` |

---

**文档作者**: AI Assistant  
**创建日期**: 2025-12-23  
**状态**: ✅ 发布
