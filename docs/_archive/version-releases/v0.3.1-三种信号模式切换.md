# v0.3.1 - ä¸‰ç§çƒ­ç‚¹æ¦œä¿¡å·æ¨¡å¼åˆ‡æ¢

**æ—¥æœŸ**: 2025-11-11  
**ç‰ˆæœ¬**: v0.3.1

---

## ğŸ¯ æ›´æ–°å†…å®¹

### æ–°å¢ä¸‰ç§çƒ­ç‚¹æ¦œä¿¡å·æ¨¡å¼

ç”¨æˆ·ç°åœ¨å¯ä»¥åœ¨é…ç½®é¢æ¿é€‰æ‹©ä¸‰ç§ä¸åŒçš„çƒ­ç‚¹æ¦œä¿¡å·æ¨¡å¼ï¼š

#### 1ï¸âƒ£ æ€»åˆ†TOPä¿¡å·ï¼ˆinstantï¼‰
- **ç‰¹ç‚¹**: åŸºäºå½“æ—¥ç»¼åˆè¯„åˆ†æ’å
- **ä¿¡å·æ ¼å¼**: `çƒ­ç‚¹æ¦œTOP100`ã€`çƒ­ç‚¹æ¦œTOP500`
- **æƒé‡**: å›ºå®š25%
- **é€‚ç”¨åœºæ™¯**: å¿«é€Ÿç­›é€‰å½“æ—¥é¾™å¤´è‚¡ç¥¨

#### 2ï¸âƒ£ æœ€æ–°çƒ­ç‚¹TOPä¿¡å·ï¼ˆåŸç‰ˆ v1ï¼‰
- **ç‰¹ç‚¹**: ä¸çº¿ä¸ŠæœåŠ¡å™¨ç‰ˆæœ¬ä¿æŒä¸€è‡´
- **ä¿¡å·æ ¼å¼**: `TOP100Â·5æ¬¡`ï¼ˆåŒºé—´Â·å‡ºç°æ¬¡æ•°ï¼‰
- **æ¡£ä½å€æ•°**: 
  ```
  TOP100:  2.0Ã— â†’ 50%  âš ï¸ æƒé‡è¾ƒé«˜
  TOP200:  1.5Ã— â†’ 37.5%
  TOP400:  1.2Ã— â†’ 30%
  TOP600:  1.0Ã— â†’ 25%
  TOP800:  0.8Ã— â†’ 20%
  TOP1000: 0.5Ã— â†’ 12.5%
  TOP2000: 0.3Ã— â†’ 7.5%
  TOP3000: 0.2Ã— â†’ 5%
  ```
- **æ’åºæ–¹å¼**: ä¼˜å…ˆæŒ‰**ä¿¡å·æ•°é‡**ï¼Œå…¶æ¬¡ä¿¡å·å¼ºåº¦
- **é€‚ç”¨åœºæ™¯**: å¯»æ‰¾å¤šç»´åº¦å…±æŒ¯çš„è‚¡ç¥¨ï¼ˆä¿¡å·è¶Šå¤šè¶Šå¥½ï¼‰

#### 3ï¸âƒ£ æœ€æ–°çƒ­ç‚¹TOPä¿¡å·ï¼ˆæ–°ç‰ˆ v2ï¼‰â­ æ¨è
- **ç‰¹ç‚¹**: ä¼˜åŒ–åçš„æƒé‡åˆ†é…
- **ä¿¡å·æ ¼å¼**: `TOP100Â·5æ¬¡`ï¼ˆåŒºé—´Â·å‡ºç°æ¬¡æ•°ï¼‰
- **æ¡£ä½å€æ•°**: 
  ```
  TOP100:  1.5Ã— â†’ 37.5% âœ… åˆç†
  TOP200:  1.3Ã— â†’ 32.5%
  TOP400:  1.2Ã— â†’ 30%
  TOP600:  1.0Ã— â†’ 25%
  TOP800:  0.9Ã— â†’ 22.5%
  TOP1000: 0.8Ã— â†’ 20%
  TOP2000: 0.6Ã— â†’ 15%
  TOP3000: 0.5Ã— â†’ 12.5%
  ```
- **æ’åºæ–¹å¼**: ä¼˜å…ˆæŒ‰**ä¿¡å·å¼ºåº¦**ï¼Œå…¶æ¬¡ä¿¡å·æ•°é‡
- **é€‚ç”¨åœºæ™¯**: å¯»æ‰¾ç»¼åˆè´¨é‡æœ€ä½³çš„è‚¡ç¥¨ï¼ˆå¼ºåº¦ä¼˜å…ˆï¼‰

---

## ğŸ“Š ä¸‰ç§æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | æ€»åˆ†TOP | æœ€æ–°çƒ­ç‚¹TOPï¼ˆåŸç‰ˆï¼‰ | æœ€æ–°çƒ­ç‚¹TOPï¼ˆæ–°ç‰ˆï¼‰â­ |
|-----|---------|-------------------|---------------------|
| æ•°æ®æ¥æº | å½“æ—¥æ’å | 14å¤©èšåˆ | 14å¤©èšåˆ |
| ä¿¡å·æ ¼å¼ | çƒ­ç‚¹æ¦œTOP100 | TOP100Â·5æ¬¡ | TOP100Â·5æ¬¡ |
| TOP100æƒé‡ | 25% | **50%** âš ï¸ | **37.5%** âœ… |
| æ’åºä¼˜å…ˆçº§ | æ’å | **æ•°é‡** > å¼ºåº¦ | **å¼ºåº¦** > æ•°é‡ |
| é€‚ç”¨åœºæ™¯ | å³æ—¶é¾™å¤´ | å¤šä¿¡å·å…±æŒ¯ | ç»¼åˆè´¨é‡ä¼˜é€‰ |
| çº¿ä¸Šç‰ˆæœ¬ | âŒ | âœ… ä¸€è‡´ | âŒ æ–°ç‰ˆ |

---

## ğŸ”§ æŠ€æœ¯å®ç°

### åç«¯ä¿®æ”¹

#### 1. `SignalThresholds` ç±»
```python
class SignalThresholds:
    def __init__(
        self,
        hot_list_mode: str = "frequent",  # instant / frequent
        hot_list_version: str = "v2",  # v1=åŸç‰ˆ / v2=æ–°ç‰ˆ
        ...
    ):
        self.hot_list_mode = hot_list_mode
        self.hot_list_version = hot_list_version
```

#### 2. `signal_calculator.py` - åŠ¨æ€å€æ•°é€‰æ‹©
```python
# é€‰æ‹©å€æ•°ï¼ˆv1åŸç‰ˆ vs v2æ–°ç‰ˆï¼‰
if self.thresholds.hot_list_version == "v1":
    # åŸç‰ˆå€æ•°ï¼ˆä¸çº¿ä¸Šä¿æŒä¸€è‡´ï¼‰
    multipliers = {
        100: 2.0,   # 50%
        200: 1.5,   # 37.5%
        ...
    }
else:  # v2æ–°ç‰ˆ
    # æ–°ç‰ˆå€æ•°ï¼ˆä¼˜åŒ–åï¼‰
    multipliers = {
        100: 1.5,   # 37.5%
        200: 1.3,   # 32.5%
        ...
    }
```

#### 3. APIè·¯ç”±æ›´æ–°
- `industry_detail.py`
- `stock.py`
- `rank_jump.py`

æ–°å¢å‚æ•°ï¼š
```python
hot_list_version: str = Query("v2", description="çƒ­ç‚¹æ¦œç‰ˆæœ¬: v1=åŸç‰ˆ, v2=æ–°ç‰ˆï¼ˆé»˜è®¤ï¼‰")
```

### å‰ç«¯ä¿®æ”¹

#### 1. `SignalConfigContext.js`
```javascript
const DEFAULT_THRESHOLDS = {
  hotListMode: 'frequent',
  hotListVersion: 'v2',  // æ–°å¢
  ...
};
```

#### 2. `SignalConfigPanel.js` - ä¸‰é€‰ä¸€ä¸‹æ‹‰æ¡†
```jsx
<select value={...}>
  <option value="instant">æ€»åˆ†TOPä¿¡å·</option>
  <option value="frequent_v1">æœ€æ–°çƒ­ç‚¹TOPä¿¡å·ï¼ˆåŸç‰ˆï¼‰</option>
  <option value="frequent_v2">æœ€æ–°çƒ­ç‚¹TOPä¿¡å·ï¼ˆæ–°ç‰ˆï¼‰</option>
</select>
```

#### 3. APIè°ƒç”¨æ›´æ–°
- `IndustryDetailPage.js`
- `StockQueryModule.js`

æ–°å¢å‚æ•°ï¼š
```javascript
hot_list_version: signalThresholds.hotListVersion || 'v2'
```

---

## ğŸ› BUGä¿®å¤

### 1. ä¿®å¤ `setShouldFetch is not defined` é”™è¯¯
**ä½ç½®**: `IndustryDetailPage.js` ç¬¬405è¡Œ

**ä¿®å¤å‰**:
```javascript
onChange={(e) => {
  setSortMode(e.target.value);
  setShouldFetch(true);  // âŒ ä¸å­˜åœ¨çš„å‡½æ•°
}}
```

**ä¿®å¤å**:
```javascript
onChange={(e) => setSortMode(e.target.value)}  // âœ… ç›´æ¥è®¾ç½®
```

### 2. ä¿®å¤åŸç‰ˆæ’åºä¼˜å…ˆçº§æœªç”Ÿæ•ˆ
**é—®é¢˜**: ç”¨æˆ·é€‰æ‹©"æœ€æ–°çƒ­ç‚¹TOPä¿¡å·ï¼ˆåŸç‰ˆï¼‰"åï¼Œæ’åºä»æŒ‰ä¿¡å·å¼ºåº¦ä¼˜å…ˆï¼Œè€Œä¸æ˜¯æŒ‰ä¿¡å·æ•°é‡ä¼˜å…ˆ

**ä½ç½®**: `industry_detail_service.py` - `_sort_stocks`æ–¹æ³•

**ä¿®å¤æ–¹æ¡ˆ**: æ ¹æ®`hot_list_version`è‡ªåŠ¨è°ƒæ•´æ’åºä¼˜å…ˆçº§

```python
elif sort_mode == "signal":
    if signal_thresholds and signal_thresholds.hot_list_version == "v1":
        # åŸç‰ˆï¼šæ•°é‡ > å¼ºåº¦ > æ’å
        return sorted(stocks, key=lambda x: (
            -x.signal_count,     # ç¬¬1ä¼˜å…ˆçº§ï¼šä¿¡å·æ•°é‡
            -x.signal_strength,  # ç¬¬2ä¼˜å…ˆçº§ï¼šä¿¡å·å¼ºåº¦
            x.rank               # ç¬¬3ä¼˜å…ˆçº§ï¼šåŸå§‹æ’å
        ))
    else:
        # æ–°ç‰ˆï¼ˆé»˜è®¤ï¼‰ï¼šå¼ºåº¦ > æ•°é‡ > æ’å
        return sorted(stocks, key=lambda x: (
            -x.signal_strength,  # ç¬¬1ä¼˜å…ˆçº§ï¼šä¿¡å·å¼ºåº¦
            -x.signal_count,     # ç¬¬2ä¼˜å…ˆçº§ï¼šä¿¡å·æ•°é‡
            x.rank               # ç¬¬3ä¼˜å…ˆçº§ï¼šåŸå§‹æ’å
        ))
```

**æ•ˆæœ**: 
- âœ… v1åŸç‰ˆè‡ªåŠ¨æŒ‰**ä¿¡å·æ•°é‡**ä¼˜å…ˆæ’åºï¼ˆå¤šä¿¡å·å…±æŒ¯ï¼‰
- âœ… v2æ–°ç‰ˆè‡ªåŠ¨æŒ‰**ä¿¡å·å¼ºåº¦**ä¼˜å…ˆæ’åºï¼ˆè´¨é‡ä¼˜å…ˆï¼‰

### 3. æ›´æ–°ç¼“å­˜keyåŒ…å«versionå‚æ•°
**ä½ç½®**: `industry_detail_service.py`

ç¡®ä¿`hot_list_version`åŒ…å«åœ¨ç¼“å­˜keyä¸­ï¼Œé¿å…åˆ‡æ¢ç‰ˆæœ¬åä»è¿”å›æ—§ç¼“å­˜æ•°æ®ã€‚

---

## ğŸ“‹ ä½¿ç”¨æŒ‡å—

### å¦‚ä½•é€‰æ‹©æ¨¡å¼ï¼Ÿ

| éœ€æ±‚ | æ¨èæ¨¡å¼ | ç†ç”± |
|-----|---------|------|
| å¿«é€Ÿçœ‹å½“æ—¥é¾™å¤´ | æ€»åˆ†TOPä¿¡å· | å³æ—¶æ’åï¼Œååº”æœ€å¿« |
| æ‰¾å¤šä¸ªä¿¡å·å åŠ çš„ç¥¨ | æœ€æ–°çƒ­ç‚¹TOPï¼ˆåŸç‰ˆï¼‰ | ä¼˜å…ˆä¿¡å·æ•°é‡ï¼Œå¤šç»´å…±æŒ¯ |
| æ‰¾ç»¼åˆè´¨é‡æœ€ä½³çš„ç¥¨ | æœ€æ–°çƒ­ç‚¹TOPï¼ˆæ–°ç‰ˆï¼‰â­ | æƒé‡åˆç†ï¼Œå¼ºåº¦ä¼˜å…ˆ |
| ä¿æŒä¸çº¿ä¸Šä¸€è‡´ | æœ€æ–°çƒ­ç‚¹TOPï¼ˆåŸç‰ˆï¼‰ | å®Œå…¨ä¸€è‡´ |

### æ¨èé…ç½®

**ä¿å®ˆå‹**ï¼ˆç¨³å¥ï¼‰:
- æ¨¡å¼ï¼šæœ€æ–°çƒ­ç‚¹TOPï¼ˆæ–°ç‰ˆï¼‰â­
- ç†ç”±ï¼šæƒé‡åˆç†ï¼Œä¸æ˜“å‡ºç°å•ä¸€ä¿¡å·è¿‡é«˜æƒ…å†µ

**æ¿€è¿›å‹**ï¼ˆè¿½çƒ­ç‚¹ï¼‰:
- æ¨¡å¼ï¼šæœ€æ–°çƒ­ç‚¹TOPï¼ˆåŸç‰ˆï¼‰
- ç†ç”±ï¼šTOP100æƒé‡é«˜è¾¾50%ï¼Œçƒ­ç‚¹æ˜æ˜¾

**å¿«é€Ÿå‹**ï¼ˆæ—¥å†…ï¼‰:
- æ¨¡å¼ï¼šæ€»åˆ†TOPä¿¡å·
- ç†ç”±ï¼šåŸºäºå½“æ—¥æ’åï¼Œååº”æœ€å¿«

---

## âœ… æµ‹è¯•æ¸…å•

- [x] ç¼–è¯‘é”™è¯¯ä¿®å¤ï¼ˆsetShouldFetchï¼‰
- [ ] åç«¯å¯åŠ¨æ— æŠ¥é”™
- [ ] ä¸‰ç§æ¨¡å¼åˆ‡æ¢æ­£å¸¸
- [ ] æ¨¡å¼1ï¼šæ€»åˆ†TOPä¿¡å·æ˜¾ç¤ºæ­£ç¡®
- [ ] æ¨¡å¼2ï¼šåŸç‰ˆæ¡£ä½å€æ•°æ­£ç¡®ï¼ˆTOP100=50%ï¼‰
- [ ] æ¨¡å¼3ï¼šæ–°ç‰ˆæ¡£ä½å€æ•°æ­£ç¡®ï¼ˆTOP100=37.5%ï¼‰
- [ ] ç¼“å­˜keyåŒ…å«versionï¼Œåˆ‡æ¢æ¨¡å¼æ•°æ®æ›´æ–°
- [ ] å‰ç«¯é…ç½®ä¿å­˜åˆ°localStorage
- [ ] APIå‚æ•°æ­£ç¡®ä¼ é€’
- [ ] ä¿¡å·å¼ºåº¦è®¡ç®—æ­£ç¡®

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

1. **åç«¯**:
   ```bash
   cd backend
   python main.py
   ```

2. **å‰ç«¯**:
   ```bash
   cd frontend
   npm run build
   ```

3. **éªŒè¯**:
   - æ‰“å¼€é…ç½®é¢æ¿
   - åˆ‡æ¢ä¸‰ç§æ¨¡å¼
   - æŸ¥çœ‹æ¿å—è¯¦æƒ…ï¼Œç¡®è®¤ä¿¡å·æ˜¾ç¤ºæ­£ç¡®
   - æ£€æŸ¥ä¿¡å·å¼ºåº¦æ˜¯å¦ç¬¦åˆé¢„æœŸ

---

## ğŸ“ æ›´æ–°æ–‡ä»¶åˆ—è¡¨

### åç«¯
- âœ… `app/services/signal_calculator.py` - æ·»åŠ ç‰ˆæœ¬å‚æ•°å’ŒåŠ¨æ€å€æ•°
- âœ… `app/routers/industry_detail.py` - æ·»åŠ ç‰ˆæœ¬å‚æ•°
- âœ… `app/routers/stock.py` - æ·»åŠ ç‰ˆæœ¬å‚æ•°
- âœ… `app/routers/rank_jump.py` - æ·»åŠ ç‰ˆæœ¬å‚æ•°
- âœ… `app/services/industry_detail_service.py` - ç¼“å­˜keyåŒ…å«version

### å‰ç«¯
- âœ… `contexts/SignalConfigContext.js` - æ·»åŠ hotListVersion
- âœ… `components/SignalConfigPanel.js` - ä¸‰é€‰ä¸€ä¸‹æ‹‰æ¡†
- âœ… `pages/IndustryDetailPage.js` - ä¿®å¤bugï¼Œæ·»åŠ versionå‚æ•°
- âœ… `components/modules/StockQueryModule.js` - æ·»åŠ versionå‚æ•°

---

**æ–‡æ¡£ä½œè€…**: AI Assistant  
**åˆ›å»ºæ—¥æœŸ**: 2025-11-11 13:55  
**çŠ¶æ€**: å·²å®Œæˆ
