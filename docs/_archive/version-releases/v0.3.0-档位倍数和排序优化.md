# v0.3.0 - 档位倍数和排序优化

**日期**: 2025-11-11  
**版本**: v0.3.0

---

## 🎯 更新内容

### 1. 调整热点榜档位倍数

**旧版（v0.2.x）**:
```
TOP100:  2.0×  → 50.0%  ⚠️ 过高
TOP200:  1.5×  → 37.5%
TOP400:  1.2×  → 30.0%
TOP600:  1.0×  → 25.0%
TOP800:  0.8×  → 20.0%
TOP1000: 0.5×  → 12.5%
TOP2000: 0.3×  → 7.5%
TOP3000: 0.2×  → 5.0%
```

**新版（v0.3.0）**:
```
TOP100:  1.5×  → 37.5%  ✅ 合理
TOP200:  1.3×  → 32.5%
TOP400:  1.2×  → 30.0%
TOP600:  1.0×  → 25.0%
TOP800:  0.9×  → 22.5%
TOP1000: 0.8×  → 20.0%
TOP2000: 0.6×  → 15.0%
TOP3000: 0.5×  → 12.5%
```

**优势**:
- ✅ 最高权重从50%降至37.5%，避免单一信号过度主导
- ✅ 档位分布更均匀合理
- ✅ 配合次数加权，最高可达45%（37.5% × 1.2）

---

### 2. 添加排序模式选择

**新增排序模式**:

#### (1) 信号强度排序（默认）
```python
优先级:
1. signal_strength (信号强度)
2. signal_count (信号数量)
3. rank (原始排名)
```

**适用场景**: 找综合质量最高的股票

#### (2) 信号数量排序 ⭐ 新增
```python
优先级:
1. signal_count (信号数量)
2. signal_strength (信号强度)
3. rank (原始排名)
```

**适用场景**: 找多维度共振的股票（多个信号叠加）

#### (3) 其他排序模式
- 市场排名：按原始排名
- 综合评分：按总分
- 涨跌幅：按价格变化

---

## 📊 效果对比

### 案例1：东星医疗（TOP100·6次）

| 版本 | 档位得分 | 次数加权 | 最终强度 |
|-----|---------|---------|---------|
| 旧版 | 50% | 1.0× | **50%** ⚠️ |
| 新版 | 37.5% | 1.0× | **37.5%** ✅ |

### 案例2：持续热点（TOP100·12次）

| 版本 | 档位得分 | 次数加权 | 最终强度 |
|-----|---------|---------|---------|
| 旧版 | 50% | 1.2× | **60%** ⚠️ |
| 新版 | 37.5% | 1.2× | **45%** ✅ |

### 案例3：中等热度（TOP1000·10次）

| 版本 | 档位得分 | 次数加权 | 最终强度 |
|-----|---------|---------|---------|
| 旧版 | 12.5% | 1.1× | **13.75%** |
| 新版 | 20% | 1.1× | **22%** ✅ |

**改进**: 中等热度股票权重提升，区分度更好

---

## 🔧 技术实现

### 后端修改

#### 1. `signal_calculator.py`
```python
# 更新档位倍数
if rank <= 100:
    score = SignalWeights.HOT_LIST_WEIGHT * 1.5  # 37.5%
elif rank <= 200:
    score = SignalWeights.HOT_LIST_WEIGHT * 1.3  # 32.5%
# ... 其他档位
```

#### 2. `industry_detail_service.py`
```python
# 添加signal_count排序
elif sort_mode == "signal_count":
    return sorted(stocks, key=lambda x: (
        -x.signal_count,     # 第1优先级：信号数量
        -x.signal_strength,  # 第2优先级：信号强度
        x.rank               # 第3优先级：原始排名
    ))
```

#### 3. `industry_detail.py` (API)
```python
sort_mode: str = Query(
    "rank", 
    description="排序模式: rank|score|price_change|volume|signal|signal_count"
)
```

### 前端修改

#### 1. `IndustryDetailPage.js`
```jsx
<select value={sortMode} onChange={...}>
  <option value="signal">信号强度</option>
  <option value="signal_count">信号数量</option> {/* 新增 */}
  <option value="rank">市场排名</option>
  <option value="score">综合评分</option>
  <option value="price_change">涨跌幅</option>
</select>
```

#### 2. `SignalConfigPanel.js`
```jsx
<p className="text-xs text-green-600">
  💡 基础权重25%，档位倍数：
  TOP100(1.5×)、TOP200(1.3×)、TOP400(1.2×)、
  TOP600(1.0×)、TOP800(0.9×)、TOP1000(0.8×)、
  TOP2000(0.6×)、TOP3000(0.5×)
</p>
<p className="text-xs text-green-600 mt-1">
  💡 次数加权：12次×1.2、10次×1.1、8次×1.05
</p>
```

---

## 📋 使用建议

### 排序模式选择

| 场景 | 推荐排序 | 说明 |
|-----|---------|------|
| 寻找质量最佳个股 | 信号强度 | 综合考虑强度和数量 |
| 寻找多维共振个股 | 信号数量 | 优先看信号叠加情况 |
| 查看龙头股 | 市场排名 | 按原始排名 |
| 追涨停板 | 涨跌幅 | 按价格涨幅 |

### 档位理解

| 档位 | 基础得分 | 适用范围 | 解读 |
|-----|---------|---------|------|
| TOP100 | 37.5% | 前100名 | 超级龙头，最强信号 |
| TOP200 | 32.5% | 101-200 | 一线热点 |
| TOP400 | 30% | 201-400 | 二线热点 |
| TOP600 | 25% | 401-600 | 三线热点 |
| TOP800 | 22.5% | 601-800 | 中等热度 |
| TOP1000 | 20% | 801-1000 | 一般热度 |
| TOP2000 | 15% | 1001-2000 | 低热度关注 |
| TOP3000 | 12.5% | 2001-3000 | 边缘热点 |

---

## ✅ 测试检查项

- [ ] 后端启动无报错
- [ ] 热点榜缓存加载成功
- [ ] 信号强度计算正确
- [ ] "信号强度"排序正常
- [ ] "信号数量"排序正常（新增）
- [ ] 配置面板说明准确
- [ ] 前端编译通过

---

## 📝 配置说明更新

已更新以下文档：
- ✅ `信号权重优化讨论.md` - 档位方案对比
- ✅ `IndustryDetailPage.js` - 权重说明文本
- ✅ `SignalConfigPanel.js` - 档位倍数详细说明

---

## 🚀 部署步骤

1. **后端**:
   ```bash
   # 重启后端服务
   cd backend
   python main.py
   ```

2. **前端**:
   ```bash
   # 重新编译
   cd frontend
   npm run build
   ```

3. **验证**:
   - 查看启动日志，确认热点榜缓存加载
   - 打开板块详情，测试"信号数量"排序
   - 检查信号强度显示是否合理（不超过45%）

---

**文档作者**: AI Assistant  
**创建日期**: 2025-11-11 13:40  
**状态**: 已完成
