# 版本更新日志 v0.2.7

**发布日期**: 2025-11-11  
**版本号**: v0.2.7

---

## 🎉 新增功能

### 1. 三种热点榜信号模式切换
用户可在配置面板选择三种不同的热点榜信号模式：

#### 📊 总分TOP信号（instant）
- 基于当日综合评分排名
- 信号格式：`热点榜TOP100`
- 权重：固定25%
- 适用：快速筛选当日龙头

#### 🔥 最新热点TOP信号（原版 v1）
- 与线上服务器版本保持一致
- 信号格式：`TOP100·5次`
- 档位倍数：TOP100(2.0×50%)
- 排序：**优先信号数量**（多信号共振）
- 适用：寻找多维度共振股票

#### 🔥 最新热点TOP信号（新版 v2）⭐ 默认推荐
- 优化后的权重分配
- 信号格式：`TOP100·5次`
- 档位倍数：TOP100(1.5×37.5%)
- 排序：**优先信号强度**（质量优先）
- 适用：寻找综合质量最佳股票

### 2. 最新热点模块支持TOP2000/TOP3000
- 左侧"分析股票数"新增：前2000个、前3000个
- 支持更大范围的热点股票分析
- 与信号档位倍数保持一致

---

## 🔧 优化改进

### 1. 热点榜档位倍数优化（新版v2）
**修改前**（原版v1）:
```
TOP100:  2.0× → 50%   ⚠️ 单一信号权重过高
TOP200:  1.5× → 37.5%
TOP1000: 0.5× → 12.5%
TOP2000: 0.3× → 7.5%
TOP3000: 0.2× → 5%
```

**修改后**（新版v2，默认）:
```
TOP100:  1.5× → 37.5%  ✅ 合理
TOP200:  1.3× → 32.5%
TOP400:  1.2× → 30%
TOP600:  1.0× → 25%
TOP800:  0.9× → 22.5%
TOP1000: 0.8× → 20%
TOP2000: 0.6× → 15%
TOP3000: 0.5× → 12.5%
```

**优势**:
- ✅ 避免单一TOP100信号过度主导（50% → 37.5%）
- ✅ 中等热度股票权重提升（TOP1000: 12.5% → 20%）
- ✅ 档位分布更均匀合理

### 2. 排序逻辑优化
根据选择的版本自动调整排序优先级：
- **原版v1**: 信号数量 > 信号强度 > 排名
- **新版v2**: 信号强度 > 信号数量 > 排名

### 3. 新增排序模式
板块详情页面新增"信号数量"排序选项：
- **信号强度**（默认）：质量优先
- **信号数量**（新增）：多维共振优先
- 市场排名、综合评分、涨跌幅

---

## 🐛 BUG修复

### 1. 修复前端编译错误
**问题**: `setShouldFetch is not defined`  
**位置**: `IndustryDetailPage.js`  
**修复**: 删除不存在的函数调用

### 2. 修复原版排序未生效
**问题**: 选择"原版"模式后，排序仍按信号强度而非数量  
**原因**: 排序逻辑未根据version参数动态调整  
**修复**: 
- 传递`signal_thresholds`参数到排序方法
- 根据`hot_list_version`选择不同排序优先级
- 添加调试日志

### 3. 修复弹窗缺少version参数
**问题**: 板块详情弹窗未传递`hot_list_version`参数  
**位置**: `IndustryDetailDialog.js`  
**修复**: 
- API调用添加`hot_list_version`参数
- 依赖项添加`hotListVersion`

### 4. 更新缓存key包含version
**问题**: 切换版本后仍返回旧缓存数据  
**修复**: 缓存key包含`hot_list_version`参数

---

## 📊 效果对比

### 案例：综合行业TOP 10

**原版v1（按信号数量）**:
```
#1 粤桂股份  3个信号  40%  ← 3个信号优先
#2 浙江东日  3个信号  34%
#3 常山北明  2个信号  37%  ← 2个信号
#4 华金资本  2个信号  37%
#5 云南能投  1个信号  38%  ← 1个信号排最后
```

**新版v2（按信号强度，默认）**:
```
#1 粤桂股份  3个信号  40%  ← 强度最高
#2 云南能投  1个信号  38%  ← 虽然1个信号但强度高
#3 常山北明  2个信号  37%
#4 华金资本  2个信号  37%
#5 浙江东日  3个信号  34%
```

---

## 📝 技术实现

### 后端修改
- ✅ `signal_calculator.py` - 版本参数和动态倍数选择
- ✅ `industry_detail.py` - 添加version参数
- ✅ `stock.py` - 添加version参数
- ✅ `rank_jump.py` - 添加version参数
- ✅ `industry_detail_service.py` - 动态排序逻辑和缓存key
- ✅ `analysis.py` - 更新API文档支持2000/3000

### 前端修改
- ✅ `SignalConfigContext.js` - 添加hotListVersion配置
- ✅ `SignalConfigPanel.js` - 三选一下拉框和详细说明
- ✅ `IndustryDetailPage.js` - 修复bug，添加version参数
- ✅ `IndustryDetailDialog.js` - 添加version参数
- ✅ `StockQueryModule.js` - 添加version参数
- ✅ `App.js` - 添加2000/3000选项
- ✅ `package.json` - 版本号更新为0.2.7

---

## 🧪 测试指南

### 清理缓存（重要！）
1. **前端localStorage**:
   ```javascript
   // 浏览器控制台执行
   localStorage.clear()
   // 按 Ctrl+F5 强制刷新
   ```

2. **后端缓存**:
   ```bash
   # 重启后端服务
   Ctrl+C
   python main.py
   ```

### 验证步骤
1. 打开配置面板
2. 切换三种模式
3. 查看板块详情弹窗
4. 确认排序符合预期
5. 测试2000/3000选项

---

## 📋 升级说明

### 从v0.2.6升级
1. 清理前端localStorage（重要！）
2. 重启后端服务
3. 前端重新编译：`npm run build`
4. 默认使用新版v2模式

### 默认配置
```javascript
{
  hotListMode: 'frequent',      // 最新热点TOP信号
  hotListVersion: 'v2',          // 新版（默认）
  hotListTop: 100,
  ...
}
```

---

## 🔍 调试方法

### 后端日志
```
📊 信号配置: mode=frequent, version=v1
🔄 按信号排序，version=v1, 优先级=数量>强度
```

### 前端检查
```javascript
// 查看localStorage
JSON.parse(localStorage.getItem('stock_analysis_signal_thresholds'))

// 查看Network请求参数
hot_list_version: v1 或 v2
```

---

## 📚 相关文档

- `v0.3.0-档位倍数和排序优化.md` - 档位倍数调整详情
- `v0.3.1-三种信号模式切换.md` - 三种模式完整说明
- `BUG修复-原版排序未生效.md` - 排序问题分析
- `测试指南-清理缓存.md` - 详细测试步骤

---

## ⚠️ 注意事项

1. **必须清理缓存**: 升级后必须清理localStorage，否则会使用旧配置
2. **版本选择**: 推荐使用新版v2（默认），权重更合理
3. **排序理解**: 
   - 原版v1：找多信号叠加的股票
   - 新版v2：找综合质量最佳的股票
4. **2000/3000**: 适用于更大范围的热点分析

---

**维护团队**: AI Assistant  
**发布日期**: 2025-11-11  
**下一版本**: v0.2.8（规划中）
