# 信号系统完整指南

> **文档说明**: 本文档整合了信号系统的架构设计、配置说明和权重优化方案。

---

## 📑 目录

1. [架构设计](#架构设计)
2. [信号类型说明](#信号类型说明)
3. [配置项详解](#配置项详解)
4. [权重计算规则](#权重计算规则)
5. [使用指南](#使用指南)

---

## 架构设计

### 设计理念

- **集中管理**：信号配置统一管理，避免分散
- **全局同步**：所有页面使用同一套配置，保证一致性
- **易于扩展**：独立的Context和组件设计，方便未来添加新配置
- **用户友好**：顶部导航栏一键访问，操作便捷

### 核心文件

| 文件 | 路径 | 作用 |
|------|------|------|
| SignalConfigContext.js | `frontend/src/contexts/` | 全局信号配置Context |
| SignalConfigPanel.js | `frontend/src/components/` | 配置面板组件 |
| signal_calculator.py | `backend/app/services/` | 后端信号计算服务 |

### 数据流

```
用户点击[信号配置]
  ↓
openConfig() → 弹出配置面板
  ↓
用户修改配置 → setTempThresholds()
  ↓
点击[应用配置] → applyConfig()
  ↓
setSignalThresholds() → 全局状态更新
  ↓
所有使用signalThresholds的组件重新渲染
  ↓
API重新请求with新配置
```

---

## 信号类型说明

### 6种信号类型

| 信号类型 | 图标 | 判断条件 | 权重 |
|---------|------|---------|------|
| 🔥 热点榜 | fire | 排名 ≤ 阈值 | 25% (基础) |
| 📈 排名跳变 | trending-up | 排名提升 ≥ 阈值 | 20% |
| ⚡ 波动率上升 | zap | 波动率变化 ≥ 阈值 | 20% |
| 🎯 稳步上升 | target | 连续N天上升 | 15% |
| 💰 涨幅榜 | dollar-sign | 涨跌幅 ≥ 阈值 | 10% |
| 📦 成交量榜 | package | 换手率 ≥ 阈值 | 10% |

### 信号标签显示

```
热点榜:   "🔥 热点榜TOP100"
排名跳变: "📈 排名跳变↑2500"
涨幅榜:   "💰 涨幅12.7%"
成交量:   "📦 换手率15.3%"
波动率:   "⚡ 波动率↑8.5%"
稳步上升: "🎯 连续上升3天"
```

---

## 配置项详解

### 默认配置

```javascript
const DEFAULT_THRESHOLDS = {
  hotListTop: 100,           // 热点榜阈值
  rankJumpMin: 2000,         // 跳变榜阈值
  steadyRiseDays: 3,         // 稳步上升天数
  priceSurgeMin: 5.0,        // 涨幅榜阈值
  volumeSurgeMin: 10.0,      // 成交量阈值
  volatilitySurgeMin: 30.0   // 波动率上升阈值
};
```

### 配置范围

| 配置项 | Key | 类型 | 默认值 | 可选范围 | 说明 |
|-------|-----|------|--------|----------|------|
| 热点榜阈值 | hotListTop | int | 100 | 50/100/200/500 | 排名需要≤X名 |
| 跳变榜阈值 | rankJumpMin | int | 2000 | 1000/1500/2000/2500/3000/3500 | 排名提升≥X名 |
| 稳步上升天数 | steadyRiseDays | int | 3 | 2/3/5/7/14 | 连续X天上升 |
| 涨幅榜阈值 | priceSurgeMin | float | 5.0 | 3/5/7/10 | 涨跌幅≥X% |
| 成交量阈值 | volumeSurgeMin | float | 10.0 | 5/10/15/20 | 换手率≥X% |
| 波动率上升阈值 | volatilitySurgeMin | float | 30.0 | 30/50/80/100/150 | 百分比变化≥X% |

### 推荐配置

#### 平衡型（默认）
```
热点榜：TOP 100
跳变榜：≥2000名
稳步上升：≥3天
涨幅榜：≥5%
成交量：≥10%
波动率上升：≥30%
```

#### 激进策略（捕捉更多信号）
```
热点榜：TOP 200
跳变榜：≥1000名
稳步上升：≥2天
涨幅榜：≥3%
成交量：≥5%
波动率上升：≥30%
```

#### 保守策略（只看强信号）
```
热点榜：TOP 50
跳变榜：≥3000名
稳步上升：≥5天
涨幅榜：≥7%
成交量：≥15%
波动率上升：≥50%
```

---

## 权重计算规则

### 热点榜档位倍数

采用**分层加权**方案，避免单一信号权重过高：

| 档位 | 倍数 | 实际权重 |
|------|------|----------|
| TOP100 | 1.3× | 32.5% |
| TOP200 | 1.2× | 30% |
| TOP400 | 1.1× | 27.5% |
| TOP600 | 1.0× | 25% |
| TOP800 | 0.9× | 22.5% |
| TOP1000 | 0.8× | 20% |
| TOP2000 | 0.7× | 17.5% |
| TOP3000 | 0.6× | 15% |

### 次数加权

热点榜信号还会根据出现次数进行加权：

| 出现次数 | 倍数 | 说明 |
|---------|------|------|
| ≥12次 | ×1.2 | 持续热点 |
| ≥10次 | ×1.1 | 稳定热点 |
| ≥8次 | ×1.05 | 一般热点 |
| <8次 | ×1.0 | 普通 |

### 计算示例

```
TOP100·12次: 0.25 × 1.3 × 1.2 = 0.39 (39%) ← 最高
TOP100·6次:  0.25 × 1.3 × 1.0 = 0.325 (32.5%)
TOP1000·12次: 0.25 × 0.8 × 1.2 = 0.24 (24%)
TOP2000·10次: 0.25 × 0.7 × 1.1 = 0.19 (19%)
TOP3000·8次: 0.25 × 0.6 × 1.05 = 0.16 (16%)
```

### 信号强度计算

```python
# 最终信号强度 = 各信号权重之和
total_strength = sum([
    hot_list_score,      # 热点榜（含档位和次数加权）
    rank_jump_score,     # 排名跳变 20%
    volatility_score,    # 波动率上升 20%
    steady_rise_score,   # 稳步上升 15%
    price_surge_score,   # 涨幅榜 10%
    volume_surge_score   # 成交量榜 10%
])
```

---

## 使用指南

### 打开全局配置

1. 点击顶部导航栏的 **「信号配置」** 按钮
2. 弹出配置面板
3. 修改所需配置项
4. 点击 **「应用配置」** 生效

### 在代码中使用

```javascript
// 导入Hook
import { useSignalConfig } from '../contexts/SignalConfigContext';

// 在组件中使用
function MyComponent() {
  const { signalThresholds, openConfig } = useSignalConfig();
  
  // 使用配置
  console.log(signalThresholds.hotListTop); // 100
  
  // 打开配置面板
  <button onClick={openConfig}>配置</button>
}
```

### API调用传递配置

```javascript
axios.get(`${API_BASE_URL}/api/industry/${industryName}/stocks`, {
  params: {
    hot_list_top: signalThresholds.hotListTop,
    rank_jump_min: signalThresholds.rankJumpMin,
    steady_rise_days: signalThresholds.steadyRiseDays,
    price_surge_min: signalThresholds.priceSurgeMin,
    volume_surge_min: signalThresholds.volumeSurgeMin,
    volatility_surge_min: signalThresholds.volatilitySurgeMin
  }
});
```

---

## 扩展开发

### 添加新配置项

1. 在 `DEFAULT_THRESHOLDS` 添加默认值
2. 在 `SignalConfigPanel.js` 添加UI控件
3. 在API调用中传递新参数
4. 在后端 `signal_calculator.py` 处理新参数

### 配置持久化（未实现）

```javascript
// 保存到localStorage
const saveConfig = () => {
  localStorage.setItem('signalConfig', JSON.stringify(signalThresholds));
};

// 加载配置
const loadConfig = () => {
  const saved = localStorage.getItem('signalConfig');
  if (saved) setSignalThresholds(JSON.parse(saved));
};
```

---

**文档版本**: v1.0  
**整合日期**: 2025-12-02  
**原始文档**: 信号功能完善总结.md, 信号配置功能完善总结.md, 全局信号配置架构总结.md, 信号权重优化讨论.md
