# 板块成分股加权分析 - 方案设计

**创建日期**: 2025-11-09  
**状态**: 📝 设计中

---

## 📌 核心需求

1. **板块成分变化追踪** - 股票板块会变动，需要追踪
2. **板块成分股查询** - 查询板块包含哪些股票
3. **板块成分股加权分析** - 对板块内股票进行类似行业加权的分析

---

## 🏗️ 技术方案

### 方案A：基于Excel数据（推荐⭐）

#### 1. 数据库改造

```sql
-- Stock表增加sector字段
ALTER TABLE stocks ADD COLUMN sector VARCHAR(100);
CREATE INDEX idx_stock_sector ON stocks(sector);

-- DailyStockData表增加sector字段（如果板块经常变化）
ALTER TABLE daily_stock_data ADD COLUMN sector VARCHAR(100);
CREATE INDEX idx_daily_sector ON daily_stock_data(sector);
```

#### 2. API设计

**API 1: 查询板块成分股**
```
GET /api/sectors/{sector_name}/stocks?date=20251107&sort_by=rank
```

**API 2: 板块成分变化对比**
```
GET /api/sectors/{sector_name}/changes?date1=20251103&date2=20251107
```

**API 3: 板块成分股加权分析**
```
GET /api/sectors/{sector_name}/weighted?k=0.618&metric=B1&date=20251107
```

#### 3. 加权分析维度

与行业加权完全相同，但针对单个板块内的股票：

- **B1**: 总热度 = Σ(1/rank^k)
- **B2**: 平均热度 = B1 / 股票数
- **C1**: 总分数 = Σ(total_score)
- **C2**: 平均分数 = C1 / 股票数

**额外维度**（板块特有）:
- 按行业细分（板块内不同行业的分布）
- 按排名区间细分（前100/101-500/501+）

---

## 📊 实现示例

### 查询结果示例

```json
{
  "sector_name": "汽车零部件",
  "date": "20251107",
  "stock_count": 245,
  "stocks": [
    {
      "code": "000001",
      "name": "平安银行",
      "rank": 123,
      "total_score": 85.6,
      "industry": "银行"
    }
  ]
}
```

### 成分变化示例

```json
{
  "added_stocks": [{"code": "000001", "name": "新增"}],
  "removed_stocks": [{"code": "000002", "name": "移除"}],
  "statistics": {
    "added_count": 5,
    "removed_count": 4,
    "change_rate": 2.04
  }
}
```

### 加权分析示例

```json
{
  "overall": {
    "total_heat": 125.6,
    "avg_heat": 0.512,
    "stock_count": 245
  },
  "by_industry": [
    {
      "industry": "汽车零部件",
      "B1": 85.2,
      "count": 155,
      "percentage": 63.3
    }
  ]
}
```

---

## 🎯 下一步

1. 确认Excel数据源是否有板块字段
2. 决定板块字段放在Stock表还是DailyStockData表
3. 实现数据导入逻辑
4. 开发3个API
5. 前端UI实现

---

**需要确认**: Excel数据中是否已有板块信息？如果有，字段名是什么？
