# æœåŠ¡å™¨éƒ¨ç½²æŒ‡å— v0.2.2

## ğŸ“‹ éƒ¨ç½²æ¶æ„

```
æœåŠ¡å™¨éƒ¨ç½²æ¶æ„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Nginx (ç«¯å£ 80)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å‰ç«¯é™æ€æ–‡ä»¶  â”‚  â”‚   åç«¯API     â”‚ â”‚
â”‚  â”‚  /build/*    â”‚  â”‚   :8000      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯´æ˜**ï¼š
- **å‰ç«¯**ï¼šæœ¬åœ°ç¼–è¯‘ï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œç”±Nginxç›´æ¥æä¾›é™æ€æ–‡ä»¶
- **åç«¯**ï¼šPythonæœåŠ¡ï¼Œç›‘å¬8000ç«¯å£ï¼Œç”±Nginxä»£ç†

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆæ¨èï¼‰

### æœ¬åœ°æ“ä½œ

```bash
# 1. ç¼–è¯‘å‰ç«¯
cd frontend
npm run build

# 2. æäº¤ä»£ç 
cd ..
git add .
git commit -m "build: æ›´æ–°å‰ç«¯æ„å»ºæ–‡ä»¶"
git push origin main
```

### æœåŠ¡å™¨æ“ä½œ

```bash
# SSHè¿æ¥
ssh root@60.205.251.109

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/stock_analysis_app  # æ›¿æ¢ä¸ºå®é™…è·¯å¾„

# ä¸€é”®éƒ¨ç½²
bash deploy_server.sh
```

**å®Œæˆï¼** æœåŠ¡ä¼šè‡ªåŠ¨å¯åŠ¨ã€‚

---

## ğŸ“– è¯¦ç»†éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1ï¼šæœ¬åœ°å‡†å¤‡

#### 1.1 ç¼–è¯‘å‰ç«¯
```bash
cd D:\ProgramLanguage\py\Test\å¤§Aæ•°æ®\2025å¹´11æœˆ\stock_analysis_app\frontend
npm run build
```

ç¼–è¯‘å®Œæˆåä¼šç”Ÿæˆ `frontend/build/` ç›®å½•ã€‚

#### 1.2 æäº¤åˆ°Git
```bash
cd ..
git add .
git commit -m "build: æ›´æ–°å‰ç«¯æ„å»ºæ–‡ä»¶ v0.2.2"
git push origin main
```

### æ­¥éª¤2ï¼šæœåŠ¡å™¨éƒ¨ç½²

#### 2.1 SSHè¿æ¥
```bash
ssh root@60.205.251.109
```

#### 2.2 æ‹‰å–ä»£ç 
```bash
cd /root/stock_analysis_app
git pull origin main
```

#### 2.3 æ‰§è¡Œéƒ¨ç½²è„šæœ¬
```bash
bash deploy_server.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- âœ… æ£€æŸ¥å‰ç«¯æ„å»ºæ–‡ä»¶
- âœ… æ›´æ–°Pythonä¾èµ–
- âœ… åœæ­¢æ—§æœåŠ¡
- âœ… å¯åŠ¨æ–°æœåŠ¡

#### 2.4 é…ç½®Nginxï¼ˆé¦–æ¬¡éƒ¨ç½²éœ€è¦ï¼‰

**å¤åˆ¶é…ç½®æ–‡ä»¶**ï¼š
```bash
# ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„
sudo nano deploy/nginx.conf.example
# å°† /path/to/stock_analysis_app æ”¹ä¸ºå®é™…è·¯å¾„ï¼Œå¦‚ /root/stock_analysis_app

# å¤åˆ¶åˆ°Nginxé…ç½®ç›®å½•
sudo cp deploy/nginx.conf.example /etc/nginx/sites-available/stock_analysis

# åˆ›å»ºè½¯é“¾æ¥
sudo ln -sf /etc/nginx/sites-available/stock_analysis /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl reload nginx
```

**æˆ–è€…ä½¿ç”¨å·²æœ‰é…ç½®**ï¼š
```bash
# å¦‚æœNginxå·²é…ç½®ï¼Œåªéœ€é‡å¯
sudo systemctl reload nginx
```

### æ­¥éª¤3ï¼šéªŒè¯éƒ¨ç½²

#### 3.1 æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æŸ¥çœ‹åç«¯è¿›ç¨‹
ps aux | grep uvicorn

# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f logs/backend.log
```

#### 3.2 æµ‹è¯•API
```bash
curl http://localhost:8000/api/analyze/2?board_type=main&top_n=1000
```

åº”è¯¥è¿”å›JSONæ•°æ®ã€‚

#### 3.3 æµè§ˆå™¨è®¿é—®
æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://60.205.251.109`

æµ‹è¯•æ–°åŠŸèƒ½ï¼š
- æœ€æ–°çƒ­ç‚¹ï¼šåˆ‡æ¢ä¸åŒçš„"å‰Nä¸ª"
- è¡Œä¸šè¶‹åŠ¿ï¼šåˆ‡æ¢ä¸åŒçš„"å‰Nå"

---

## ğŸ”§ æ‰‹åŠ¨éƒ¨ç½²ï¼ˆé«˜çº§ï¼‰

å¦‚æœè‡ªåŠ¨è„šæœ¬æœ‰é—®é¢˜ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼š

### åœæ­¢æœåŠ¡
```bash
# åœæ­¢åç«¯
pkill -f "uvicorn.*app.main"
```

### å¯åŠ¨åç«¯
```bash
cd /root/stock_analysis_app/backend
nohup python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000 > ../logs/backend.log 2>&1 &
```

### é…ç½®Nginx
ç¼–è¾‘ `/etc/nginx/sites-available/stock_analysis`ï¼š

```nginx
server {
    listen 80;
    server_name 60.205.251.109;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /root/stock_analysis_app/frontend/build;
        try_files $uri $uri/ /index.html;
        
        # ç¦ç”¨ç¼“å­˜
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }

    # åç«¯API
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        
        # ç¦ç”¨APIç¼“å­˜
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
}
```

é‡å¯Nginxï¼š
```bash
sudo nginx -t
sudo systemctl reload nginx
```

---

## ğŸ“ å¸¸è§é—®é¢˜

### Q1: buildç›®å½•æ²¡æœ‰æäº¤åˆ°Gitï¼Ÿ
**A**: æ£€æŸ¥ `.gitignore`ï¼Œç¡®ä¿ `frontend/build/` é‚£è¡Œè¢«æ³¨é‡Šäº†ï¼š
```
# frontend/build/ - æ³¨é‡Šæ‰ï¼Œéœ€è¦æäº¤ç¼–è¯‘åçš„æ–‡ä»¶åˆ°æœåŠ¡å™¨
```

### Q2: æœåŠ¡å™¨2æ ¸2Gæ— æ³•ç¼–è¯‘å‰ç«¯ï¼Ÿ
**A**: æ­£ç¡®ï¼æ‰€ä»¥è¦åœ¨**æœ¬åœ°ç¼–è¯‘**ï¼Œç„¶åæŠŠbuildç›®å½•æäº¤åˆ°Gitã€‚

### Q3: Git pullåæœåŠ¡å™¨é…ç½®è¢«è¦†ç›–ï¼Ÿ
**A**: ä¸ä¼šï¼ä»¥ä¸‹æ–‡ä»¶åœ¨ `.gitignore` ä¸­è¢«æ’é™¤ï¼š
- `deploy/server_config.local.py`
- `backend/app/config.local.py`
- `.env.production`
- `logs/`

### Q4: Nginxæ— æ³•è®¿é—®buildç›®å½•ï¼Ÿ
**A**: æ£€æŸ¥æƒé™ï¼š
```bash
chmod -R 755 /root/stock_analysis_app/frontend/build
```

### Q5: APIè¿”å›æ—§æ•°æ®ï¼Ÿ
**A**: æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆCtrl+Shift+Deleteï¼‰æˆ–æŒ‰F12ï¼Œå‹¾é€‰"Disable cache"

---

## ğŸ”„ æ›´æ–°æµç¨‹ï¼ˆä»¥åæ¯æ¬¡æ›´æ–°ï¼‰

### æœ¬åœ°
```bash
# 1. ä¿®æ”¹ä»£ç 
# 2. ç¼–è¯‘å‰ç«¯
cd frontend && npm run build && cd ..

# 3. æäº¤æ¨é€
git add .
git commit -m "æ›´æ–°è¯´æ˜"
git push
```

### æœåŠ¡å™¨
```bash
# ä¸€é”®éƒ¨ç½²
cd /root/stock_analysis_app
bash deploy_server.sh
```

**å°±è¿™ä¹ˆç®€å•ï¼**

---

## ğŸ›‘ åœæ­¢æœåŠ¡

```bash
# æŸ¥çœ‹åç«¯è¿›ç¨‹
ps aux | grep uvicorn

# åœæ­¢åç«¯
kill <PID>

# æˆ–è€…å¼ºåˆ¶åœæ­¢æ‰€æœ‰
pkill -9 -f "uvicorn.*app.main"
```

---

## ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

### æŸ¥çœ‹æ—¥å¿—
```bash
# å®æ—¶æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f /root/stock_analysis_app/logs/backend.log

# æŸ¥çœ‹Nginxè®¿é—®æ—¥å¿—
tail -f /var/log/nginx/stock_analysis_access.log

# æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/stock_analysis_error.log
```

### æ€§èƒ½ç›‘æ§
```bash
# æŸ¥çœ‹è¿›ç¨‹èµ„æºå ç”¨
top -p $(pgrep -f uvicorn)

# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tlnp | grep 8000
```

---

## ğŸ” å®‰å…¨å»ºè®®

1. **ä½¿ç”¨systemdç®¡ç†æœåŠ¡**ï¼ˆæ¨èï¼‰
2. **é…ç½®é˜²ç«å¢™**ï¼šåªå¼€æ”¾80å’Œ443ç«¯å£
3. **å¯ç”¨HTTPS**ï¼šä½¿ç”¨Let's Encrypt
4. **å®šæœŸå¤‡ä»½æ•°æ®åº“**
5. **é™åˆ¶æ—¥å¿—æ–‡ä»¶å¤§å°**

---

**éƒ¨ç½²å®Œæˆåè®°å¾—æµ‹è¯•æ‰€æœ‰æ–°åŠŸèƒ½ï¼**
