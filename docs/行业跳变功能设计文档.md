# è¡Œä¸šè·³å˜åŠŸèƒ½è®¾è®¡æ–‡æ¡£

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

åœ¨ä¸ªè‚¡æŸ¥è¯¢é¡µå’Œæœ€æ–°çƒ­ç‚¹é¡µä¸­ï¼Œä¸ºæ¯åªè‚¡ç¥¨å¢åŠ "è¡Œä¸šè·³å˜ä¿¡å·"æ ‡ç­¾ï¼Œæ˜¾ç¤ºè¯¥è‚¡ç¥¨æ‰€å±è¡Œä¸šçš„æ’åå˜åŒ–æƒ…å†µã€‚åŒæ—¶åœ¨"è‚¡ç¥¨æ¿å—-æƒå€¼çƒ­åº¦"ä¸‹æ–°å¢"æ¿å—è·³å˜"ä¸‰çº§èœå•ï¼Œå±•ç¤ºæ‰€æœ‰è¡Œä¸šçš„è·³å˜æƒ…å†µã€‚

---

## ğŸ¯ æ ¸å¿ƒéœ€æ±‚

### 1. æ•°æ®æ¥æº
- **æ•°æ®æº**: `daily_stock_data.industry` å­—æ®µï¼ˆè¡Œä¸šåˆ†ç±»ï¼‰
- **é** dcæ¿å—æ•°æ®ï¼ˆ`daily_sector_data`ï¼‰
- åŸºäºè‚¡ç¥¨æ•°æ®çš„è¡Œä¸šç»´åº¦èšåˆåˆ†æ

### 2. è®¡ç®—ç»´åº¦

è¡Œä¸šçƒ­åº¦åˆ†æä¿æŒç°æœ‰é€»è¾‘ï¼š
```python
B1: æ€»çƒ­åº¦ = è¡Œä¸šå†…æ’åå‰1000çš„è‚¡ç¥¨æ•°é‡
B2: å¹³å‡çƒ­åº¦ = è¡Œä¸šå†…è‚¡ç¥¨çš„å¹³å‡æ’å
C1: æ€»åˆ†æ•° = è¡Œä¸šå†…è‚¡ç¥¨æ€»åˆ†ä¹‹å’Œ
C2: å¹³å‡åˆ†æ•° = è¡Œä¸šå†…è‚¡ç¥¨å¹³å‡æ€»åˆ†
```

**æ–°å¢ç»´åº¦**ï¼š
```python
è¡Œä¸šè·³å˜ = ä»Šæ—¥è¡Œä¸šæ’å - æ˜¨æ—¥è¡Œä¸šæ’å
è·³å˜åˆ†æ•° = f(è¡Œä¸šè·³å˜)  # ä½¿ç”¨æŠ€èƒ½æ€¥é€Ÿå…¬å¼
```

### 3. å…³é”®å‚æ•° âœ…

| å‚æ•° | å€¼ | è¯´æ˜ |
|-----|---|------|
| **kå€¼ï¼ˆèšç„¦ç¨‹åº¦ï¼‰** | 1.0 | å›ºå®šå€¼ï¼Œä¸ä½¿ç”¨å…¶ä»–kå€¼ï¼ˆ0.382/0.618/1.618ï¼‰ |
| **Ïƒè¿‡æ»¤** | ä¸ä½¿ç”¨ | ä¸ä½¿ç”¨sigmaç»Ÿè®¡è¿‡æ»¤ |
| **æ’åä¾æ®** | B2ï¼ˆå¹³å‡æ’åï¼‰ | ç”¨äºè®¡ç®—è·³å˜ï¼Œä½¿ç”¨åŸæœ‰å€’æ•°åŠ æƒå…¬å¼ |
| **ç¼“å­˜æ–¹å¼** | æ‡’åŠ è½½ï¼ˆé¦–æ¬¡è®¿é—®æ—¶ï¼‰ | é¦–æ¬¡è®¿é—®æ—¶è®¡ç®—å¹¶ç¼“å­˜åˆ°memory_cache |
| **è·³å˜å±•ç¤ºé˜ˆå€¼** | æ— é˜ˆå€¼ | æ‰€æœ‰è·³å˜éƒ½æ˜¾ç¤ºï¼ˆåŒ…æ‹¬Â±1ä½ï¼‰ |
| **è¡Œä¸šåç§°è§„èŒƒ** | å»é™¤ç©ºæ ¼ | ç»Ÿä¸€å¤„ç†è¡Œä¸šåç§°ï¼Œtrimå»é™¤é¦–å°¾ç©ºæ ¼ |
| **æœªåˆ†ç±»è¡Œä¸š** | æ˜¾ç¤ºä½†ä¸å‚ä¸è·³å˜ | industryä¸ºç©ºçš„è‚¡ç¥¨å½’ç±»ä¸º"æœªåˆ†ç±»" |
| **æ–°è¡Œä¸šå¤„ç†** | æ˜¾ç¤º"æ–°ä¸Šæ¦œæ–°è¡Œä¸š" | æ˜¨æ—¥ä¸å­˜åœ¨çš„è¡Œä¸šæ˜¾ç¤ºç‰¹æ®Šæ ‡ç­¾ |

---

## ğŸ“ è·³å˜åˆ†æ•°è®¡ç®—å…¬å¼

### æŠ€èƒ½æ€¥é€Ÿå…¬å¼ï¼ˆåˆ†æ®µçº¿æ€§ï¼Œæ”¶ç›Šé€’å‡ï¼‰

å‚è€ƒè‹±é›„è”ç›ŸæŠ€èƒ½æ€¥é€Ÿæœºåˆ¶ï¼Œä½¿ç”¨ä»¥ä¸‹å…¬å¼ï¼š

```python
# åŸºç¡€å…¬å¼
jump_score = rank_change / (abs(rank_change) + base_value) Ã— 100

# å‚æ•°è¯´æ˜ï¼š
# - rank_change: æ’åå˜åŒ–ï¼ˆæ­£æ•°=ä¸Šå‡ï¼Œè´Ÿæ•°=ä¸‹é™ï¼‰
# - base_value: åŸºå‡†å€¼ï¼Œæ§åˆ¶æ”¶ç›Šé€’å‡é€Ÿåº¦ï¼ˆå¾…ç¡®å®šï¼‰
# - 100: ç¼©æ”¾ç³»æ•°ï¼Œå°†ç»“æœæ ‡å‡†åŒ–åˆ°åˆç†åŒºé—´
```

### åŸºå‡†å€¼ç¡®å®š âœ…

| base_value | è·³å˜10ä½ | è·³å˜50ä½ | è·³å˜100ä½ | è·³å˜200ä½ | ç‰¹ç‚¹ |
|-----------|---------|---------|----------|----------|------|
| **30** | 25.0 | 62.5 | 76.9 | 87.0 | æ”¶ç›Šå¿«é€Ÿè¡°å‡ï¼Œé€‚åˆå°å¹…è·³å˜ |
| **50** | 16.7 | 50.0 | 66.7 | 80.0 | å¹³è¡¡å‹ â­ **å·²é€‰å®š** |
| **100** | 9.1 | 33.3 | 50.0 | 66.7 | æ”¶ç›Šç¼“æ…¢è¡°å‡ï¼Œé€‚åˆå¤§å¹…è·³å˜ |

**æœ€ç»ˆç¡®å®š**: `base_value = 50`
- è¡Œä¸šæ•°é‡è¾ƒå°‘ï¼ˆ~100ä¸ªï¼‰ï¼Œæ’åè·³å˜å¹…åº¦ç›¸å¯¹è¾ƒå°
- 50ä½è·³å˜å¾—åˆ°50åˆ†ï¼Œç›´è§‚æ˜“æ‡‚
- 200ä½è·³å˜è¾¾åˆ°80åˆ†ï¼Œæœ‰æ˜æ˜¾å¤©èŠ±æ¿æ•ˆåº”

### ç¤ºä¾‹è®¡ç®—

```python
base_value = 50

# ä¸Šå‡ç¤ºä¾‹
jump_change = 10   â†’ score = 10/(10+50)Ã—100 = 16.7  â†’ æ˜¾ç¤º"è¡Œä¸šä¸Šå‡10"
jump_change = 50   â†’ score = 50/(50+50)Ã—100 = 50.0  â†’ æ˜¾ç¤º"è¡Œä¸šä¸Šå‡50"
jump_change = 100  â†’ score = 100/(100+50)Ã—100 = 66.7 â†’ æ˜¾ç¤º"è¡Œä¸šä¸Šå‡100"

# ä¸‹é™ç¤ºä¾‹
jump_change = -10  â†’ score = -10/(10+50)Ã—100 = -16.7 â†’ æ˜¾ç¤º"è¡Œä¸šä¸‹é™10"
jump_change = -50  â†’ score = -50/(50+50)Ã—100 = -50.0 â†’ æ˜¾ç¤º"è¡Œä¸šä¸‹é™50"
```

---

## ğŸ”§ æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### 1. æ•°æ®ç»“æ„

#### IndustryJumpInfoï¼ˆè¡Œä¸šè·³å˜ä¿¡æ¯ï¼‰
```python
@dataclass
class IndustryJumpInfo:
    """è¡Œä¸šè·³å˜ä¿¡æ¯"""
    industry: str           # è¡Œä¸šåç§°ï¼ˆå·²è§„èŒƒåŒ–ï¼‰
    today_rank: int         # ä»Šæ—¥æ’åï¼ˆåŸºäºB2ï¼‰
    yesterday_rank: int     # æ˜¨æ—¥æ’åï¼ˆåŸºäºB2ï¼‰
    jump: int              # è·³å˜å€¼ï¼ˆæ­£=ä¸Šå‡ï¼Œè´Ÿ=ä¸‹é™ï¼‰
    jump_score: float      # è·³å˜åˆ†æ•°ï¼ˆæŠ€èƒ½æ€¥é€Ÿå…¬å¼ï¼‰
    is_new: bool           # æ˜¯å¦æ–°ä¸Šæ¦œè¡Œä¸š
    display_text: str      # æ˜¾ç¤ºæ–‡æœ¬ï¼ˆå¦‚"è¡Œä¸šä¸Šå‡7"ã€"æ–°ä¸Šæ¦œæ–°è¡Œä¸š"ï¼‰
    
    # çƒ­åº¦æŒ‡æ ‡ï¼ˆç”¨äºå±•ç¤ºï¼Œä¸ç”¨äºæ’åºï¼‰
    B1_today: int          # ä»Šæ—¥æ€»çƒ­åº¦
    B2_today: float        # ä»Šæ—¥å¹³å‡æ’å
    C1_today: float        # ä»Šæ—¥æ€»åˆ†æ•°
    C2_today: float        # ä»Šæ—¥å¹³å‡åˆ†æ•°
    
    # æ˜¨æ—¥æ•°æ®ï¼ˆå¯é€‰ï¼‰
    B1_yesterday: int
    B2_yesterday: float
    C1_yesterday: float
    C2_yesterday: float
```

### 2. è®¡ç®—æµç¨‹ âœ…

#### 2.1 æ ¸å¿ƒè®¡ç®—å™¨

```python
class IndustryJumpCalculator:
    """è¡Œä¸šè·³å˜è®¡ç®—å™¨"""
    
    BASE_VALUE = 50  # æŠ€èƒ½æ€¥é€Ÿå…¬å¼åŸºå‡†å€¼ï¼ˆå·²ç¡®å®šï¼‰
    K_VALUE = 1.0    # èšç„¦ç¨‹åº¦ï¼ˆå›ºå®šä¸º1.0ï¼‰
    
    def calculate_industry_jump(
        self, 
        target_date: str,
        k_value: float = 1.0  # å›ºå®šä¸º1.0
    ) -> Dict[str, IndustryJumpInfo]:
        """
        è®¡ç®—è¡Œä¸šè·³å˜
        
        æ­¥éª¤ï¼š
        1. è·å–ä»Šæ—¥å’Œæ˜¨æ—¥çš„è‚¡ç¥¨æ•°æ®
        2. æŒ‰è¡Œä¸šèšåˆè®¡ç®—B1/B2/C1/C2
        3. æ ¹æ®B2å¯¹è¡Œä¸šæ’å
        4. è®¡ç®—æ’åå˜åŒ–ï¼ˆè·³å˜ï¼‰
        5. ä½¿ç”¨æŠ€èƒ½æ€¥é€Ÿå…¬å¼è®¡ç®—è·³å˜åˆ†æ•°
        
        Returns:
            {è¡Œä¸šå: IndustryJumpInfo}
        """
        # 1. è·å–æ•°æ®
        today_stocks = self._get_stocks_by_date(target_date)
        yesterday_stocks = self._get_stocks_by_date(previous_date)
        
        # 2. èšåˆè®¡ç®—
        today_industry_stats = self._aggregate_by_industry(
            today_stocks, k_value
        )
        yesterday_industry_stats = self._aggregate_by_industry(
            yesterday_stocks, k_value
        )
        
        # 3. æ’åï¼ˆåŸºäºB2å¹³å‡æ’åï¼‰
        today_ranks = self._rank_industries(
            today_industry_stats, by='B2'
        )
        yesterday_ranks = self._rank_industries(
            yesterday_industry_stats, by='B2'
        )
        
        # 4. è®¡ç®—è·³å˜
        industry_jumps = {}
        for industry in today_ranks.keys():
            today_rank = today_ranks[industry]
            
            # æ£€æŸ¥æ˜¯å¦æ˜¯æ–°è¡Œä¸š
            if industry not in yesterday_ranks:
                # æ–°ä¸Šæ¦œçš„è¡Œä¸š
                industry_jumps[industry] = IndustryJumpInfo(
                    industry=industry,
                    today_rank=today_rank,
                    yesterday_rank=None,
                    jump=0,
                    jump_score=0.0,
                    is_new=True,
                    display_text="æ–°ä¸Šæ¦œæ–°è¡Œä¸š",
                    B1_today=today_industry_stats[industry]['B1'],
                    B2_today=today_industry_stats[industry]['B2'],
                    C1_today=today_industry_stats[industry]['C1'],
                    C2_today=today_industry_stats[industry]['C2'],
                    B1_yesterday=0,
                    B2_yesterday=0,
                    C1_yesterday=0,
                    C2_yesterday=0
                )
                continue
            
            # å¸¸è§„è¡Œä¸šï¼Œè®¡ç®—è·³å˜
            yesterday_rank = yesterday_ranks[industry]
            jump = yesterday_rank - today_rank  # æ­£æ•°=æ’åä¸Šå‡
            jump_score = self._calculate_jump_score(jump)
            
            # ç”Ÿæˆæ˜¾ç¤ºæ–‡æœ¬
            if jump > 0:
                display_text = f"è¡Œä¸šä¸Šå‡{jump}"
            elif jump < 0:
                display_text = f"è¡Œä¸šä¸‹é™{abs(jump)}"
            else:
                display_text = "è¡Œä¸šæ’åä¸å˜"
            
            industry_jumps[industry] = IndustryJumpInfo(
                industry=industry,
                today_rank=today_rank,
                yesterday_rank=yesterday_rank,
                jump=jump,
                jump_score=jump_score,
                is_new=False,
                display_text=display_text,
                B1_today=today_industry_stats[industry]['B1'],
                B2_today=today_industry_stats[industry]['B2'],
                C1_today=today_industry_stats[industry]['C1'],
                C2_today=today_industry_stats[industry]['C2'],
                B1_yesterday=yesterday_industry_stats[industry]['B1'],
                B2_yesterday=yesterday_industry_stats[industry]['B2'],
                C1_yesterday=yesterday_industry_stats[industry]['C1'],
                C2_yesterday=yesterday_industry_stats[industry]['C2']
            )
        
        return industry_jumps
    
    def _calculate_jump_score(self, rank_change: int) -> float:
        """æŠ€èƒ½æ€¥é€Ÿå…¬å¼"""
        if rank_change == 0:
            return 0.0
        return (rank_change / (abs(rank_change) + self.BASE_VALUE)) * 100
    
    def _normalize_industry(self, industry: str) -> str:
        """è§„èŒƒåŒ–è¡Œä¸šåç§°"""
        if not industry or not industry.strip():
            return "æœªåˆ†ç±»"
        # å»é™¤é¦–å°¾ç©ºæ ¼å’Œå…¨è§’ç©ºæ ¼
        normalized = industry.strip().replace('ã€€', '')
        return normalized if normalized else "æœªåˆ†ç±»"
    
    def _aggregate_by_industry(
        self, 
        stocks: List[StockData],
        k_value: float
    ) -> Dict[str, dict]:
        """æŒ‰è¡Œä¸šèšåˆç»Ÿè®¡"""
        industry_stats = defaultdict(lambda: {
            'stocks': [],
            'B1': 0,  # å‰1000åæ•°é‡
            'B2': 0,  # å¹³å‡æ’å
            'C1': 0,  # æ€»åˆ†
            'C2': 0   # å¹³å‡åˆ†
        })
        
        # èšåˆè‚¡ç¥¨æ•°æ®
        for stock in stocks:
            # è§„èŒƒåŒ–è¡Œä¸šåç§°
            industry = self._normalize_industry(stock.industry)
            
            # è·³è¿‡æœªåˆ†ç±»è¡Œä¸šï¼ˆä¸å‚ä¸è·³å˜è®¡ç®—ï¼‰
            if industry == "æœªåˆ†ç±»":
                continue
                
            industry_stats[industry]['stocks'].append(stock)
        
        # è®¡ç®—å„é¡¹æŒ‡æ ‡
        for industry, stats in industry_stats.items():
            stocks_list = stats['stocks']
            
            if not stocks_list:
                continue
            
            # B1: å‰1000åæ•°é‡
            stats['B1'] = sum(1 for s in stocks_list if s.rank <= 1000)
            
            # B2: å¹³å‡æ’åï¼ˆä½¿ç”¨åŸæœ‰å…¬å¼ï¼šk=1çš„å€’æ•°åŠ æƒï¼‰
            # å…¬å¼ï¼šÎ£(1) / Î£(1/rank_i) = n / Î£(1/rank_i)
            # è¿™æ˜¯è°ƒå’Œå¹³å‡æ•°çš„å€’æ•°å½¢å¼
            total_weight = sum(1.0 / s.rank for s in stocks_list)
            weighted_sum = len(stocks_list)
            stats['B2'] = weighted_sum / total_weight if total_weight > 0 else 0
            
            # C1: æ€»åˆ†
            stats['C1'] = sum(s.total_score for s in stocks_list)
            
            # C2: å¹³å‡åˆ†ï¼ˆç®—æœ¯å¹³å‡ï¼‰
            stats['C2'] = stats['C1'] / len(stocks_list) if stocks_list else 0
        
        return industry_stats
    
    def _rank_industries(
        self, 
        industry_stats: Dict,
        by: str = 'B2'
    ) -> Dict[str, int]:
        """å¯¹è¡Œä¸šæ’å"""
        # æŒ‰B2å‡åºæ’åºï¼ˆB2è¶Šå°è¶Šå¥½ï¼‰
        sorted_industries = sorted(
            industry_stats.items(),
            key=lambda x: x[1][by]
        )
        return {
            industry: rank + 1 
            for rank, (industry, _) in enumerate(sorted_industries)
        }
```

### 3. å†…å­˜ç¼“å­˜é›†æˆ âœ…

#### 3.1 æ‡’åŠ è½½ç­–ç•¥

é‡‡ç”¨**é¦–æ¬¡è®¿é—®æ—¶è®¡ç®—å¹¶ç¼“å­˜**çš„ç­–ç•¥ï¼Œé¿å…å¯åŠ¨æ—¶çš„æ€§èƒ½å½±å“ã€‚

```python
class MemoryCacheManager:
    """å†…å­˜ç¼“å­˜ç®¡ç†å™¨ï¼ˆæ‰©å±•ï¼‰"""
    
    def __init__(self):
        # ...ç°æœ‰å­—æ®µ...
        
        # æ–°å¢ï¼šè¡Œä¸šè·³å˜ç¼“å­˜
        self.industry_jumps = {}  # {date: {industry: IndustryJumpInfo}}
        self._industry_jump_calculator = None  # æ‡’åˆå§‹åŒ–
    
    @property
    def industry_jump_calculator(self):
        """æ‡’åŠ è½½è®¡ç®—å™¨"""
        if self._industry_jump_calculator is None:
            self._industry_jump_calculator = IndustryJumpCalculator()
        return self._industry_jump_calculator
    
    def get_industry_jumps_for_date(
        self, 
        date: str = None
    ) -> Dict[str, IndustryJumpInfo]:
        """
        è·å–æŒ‡å®šæ—¥æœŸçš„æ‰€æœ‰è¡Œä¸šè·³å˜ï¼ˆæ‡’åŠ è½½ï¼‰
        
        Args:
            date: æ—¥æœŸYYYYMMDDï¼Œé»˜è®¤æœ€æ–°æ—¥æœŸ
        
        Returns:
            {industry: IndustryJumpInfo}
        """
        if date is None:
            date = self.latest_date
        
        # æ£€æŸ¥ç¼“å­˜
        if date in self.industry_jumps:
            return self.industry_jumps[date]
        
        # é¦–æ¬¡è®¿é—®ï¼Œè®¡ç®—å¹¶ç¼“å­˜
        try:
            logger.info(f"é¦–æ¬¡è®¡ç®—è¡Œä¸šè·³å˜æ•°æ®: {date}")
            jumps = self.industry_jump_calculator.calculate_industry_jump(date)
            self.industry_jumps[date] = jumps
            logger.info(f"è¡Œä¸šè·³å˜è®¡ç®—å®Œæˆ: {len(jumps)}ä¸ªè¡Œä¸š")
            return jumps
        except Exception as e:
            logger.error(f"è®¡ç®—è¡Œä¸šè·³å˜å¤±è´¥ {date}: {e}")
            return {}
    
    def get_industry_jump(
        self, 
        industry: str, 
        date: str = None
    ) -> Optional[IndustryJumpInfo]:
        """
        è·å–æŒ‡å®šè¡Œä¸šçš„è·³å˜ä¿¡æ¯
        
        Args:
            industry: è¡Œä¸šåç§°ï¼ˆä¼šè‡ªåŠ¨è§„èŒƒåŒ–ï¼‰
            date: æ—¥æœŸYYYYMMDDï¼Œé»˜è®¤æœ€æ–°æ—¥æœŸ
        
        Returns:
            IndustryJumpInfo æˆ– None
        """
        if date is None:
            date = self.latest_date
        
        # è§„èŒƒåŒ–è¡Œä¸šåç§°
        normalized_industry = self._normalize_industry_name(industry)
        
        # è·³è¿‡æœªåˆ†ç±»è¡Œä¸š
        if normalized_industry == "æœªåˆ†ç±»":
            return None
        
        # è·å–è¯¥æ—¥æœŸçš„æ‰€æœ‰è·³å˜æ•°æ®ï¼ˆè§¦å‘æ‡’åŠ è½½ï¼‰
        jumps = self.get_industry_jumps_for_date(date)
        return jumps.get(normalized_industry)
    
    def _normalize_industry_name(self, industry: str) -> str:
        """è§„èŒƒåŒ–è¡Œä¸šåç§°ï¼ˆä¸è®¡ç®—å™¨ä¿æŒä¸€è‡´ï¼‰"""
        if not industry or not industry.strip():
            return "æœªåˆ†ç±»"
        normalized = industry.strip().replace('ã€€', '')
        return normalized if normalized else "æœªåˆ†ç±»"
    
    def clear_industry_jump_cache(self, date: str = None):
        """
        æ¸…é™¤è¡Œä¸šè·³å˜ç¼“å­˜
        
        Args:
            date: æŒ‡å®šæ—¥æœŸï¼ŒNoneåˆ™æ¸…é™¤æ‰€æœ‰
        """
        if date:
            if date in self.industry_jumps:
                del self.industry_jumps[date]
                logger.info(f"æ¸…é™¤è¡Œä¸šè·³å˜ç¼“å­˜: {date}")
        else:
            self.industry_jumps.clear()
            logger.info("æ¸…é™¤æ‰€æœ‰è¡Œä¸šè·³å˜ç¼“å­˜")
```

#### 3.2 æ‡’åŠ è½½ä¼˜åŠ¿

| æ–¹æ¡ˆ | å¯åŠ¨æ—¶é—´ | é¦–æ¬¡è®¿é—® | å†…å­˜å ç”¨ | é€‚ç”¨åœºæ™¯ |
|-----|---------|---------|---------|---------|
| **å¯åŠ¨æ—¶å…¨é‡** | +2-5ç§’ | <1ms | 140KB | é¢‘ç¹ä½¿ç”¨ |
| **æ‡’åŠ è½½ï¼ˆå·²é€‰ï¼‰** â­ | ä¸å˜ | é¦–æ¬¡50-100ms | æŒ‰éœ€å¢é•¿ | å¶å°”ä½¿ç”¨ |

**é€‰æ‹©ç†ç”±**ï¼š
- ä¸æ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½ä¼šä½¿ç”¨è¡Œä¸šè·³å˜åŠŸèƒ½
- é¿å…å¯åŠ¨æ—¶é—´å¢åŠ 
- å†…å­˜æŒ‰éœ€å ç”¨
- è®¡ç®—æ€§èƒ½å……è¶³ï¼ˆ100msä»¥å†…ï¼‰

---

## ğŸ”Œ APIè®¾è®¡

### 1. æ–°å¢APIï¼šè¡Œä¸šè·³å˜æŸ¥è¯¢

```python
# backend/app/routers/industry_jump.py

@router.get("/api/industry-jump", response_model=IndustryJumpResult)
async def get_industry_jump(
    date: str = Query(None, description="æ—¥æœŸYYYYMMDDï¼Œé»˜è®¤æœ€æ–°")
):
    """
    è·å–æ‰€æœ‰è¡Œä¸šçš„è·³å˜æƒ…å†µ
    
    Returns:
        {
            "date": "20251112",
            "previous_date": "20251111",
            "industries": [
                {
                    "industry": "æ–°èƒ½æºæ±½è½¦",
                    "today_rank": 3,
                    "yesterday_rank": 10,
                    "jump": 7,
                    "jump_score": 58.3,
                    "display_text": "è¡Œä¸šä¸Šå‡7",
                    "B1_today": 150,
                    "B2_today": 520.5,
                    "C1_today": 85000,
                    "C2_today": 65.5
                },
                // ...
            ]
        }
    """
    target_date = date or memory_cache.latest_date
    jumps = memory_cache.industry_jumps.get(target_date, {})
    
    industries = []
    for industry, info in jumps.items():
        industries.append({
            "industry": info.industry,
            "today_rank": info.today_rank,
            "yesterday_rank": info.yesterday_rank,
            "jump": info.jump,
            "jump_score": round(info.jump_score, 1),
            "display_text": f"è¡Œä¸š{'ä¸Šå‡' if info.jump > 0 else 'ä¸‹é™'}{abs(info.jump)}",
            "B1_today": info.B1_today,
            "B2_today": round(info.B2_today, 1),
            "C1_today": round(info.C1_today, 1),
            "C2_today": round(info.C2_today, 1)
        })
    
    return {
        "date": target_date,
        "previous_date": previous_date,
        "industries": industries
    }
```

### 2. ä¿®æ”¹ç°æœ‰APIï¼šæ·»åŠ è¡Œä¸šè·³å˜å­—æ®µ

åœ¨ä»¥ä¸‹APIçš„è¿”å›ç»“æœä¸­ï¼Œä¸ºæ¯åªè‚¡ç¥¨æ·»åŠ  `industry_jump` å­—æ®µï¼š

#### A. ä¸ªè‚¡æŸ¥è¯¢ `/api/stock/{keyword}`
```python
@router.get("/api/stock/{keyword}")
async def get_stock_detail(keyword: str, date: str = None):
    # ...ç°æœ‰é€»è¾‘...
    
    # æ–°å¢ï¼šè·å–è¡Œä¸šè·³å˜ä¿¡æ¯
    industry_jump = memory_cache.get_industry_jump(
        stock.industry, date
    )
    
    result = {
        "stock_code": stock.stock_code,
        "stock_name": stock.stock_name,
        "industry": stock.industry,
        "industry_jump": {
            "jump": industry_jump.jump,
            "jump_score": round(industry_jump.jump_score, 1),
            "display_text": f"è¡Œä¸š{'ä¸Šå‡' if industry_jump.jump > 0 else 'ä¸‹é™'}{abs(industry_jump.jump)}"
        } if industry_jump else None,
        # ...å…¶ä»–å­—æ®µ...
    }
    return result
```

#### B. æœ€æ–°çƒ­ç‚¹ `/api/analyze/{period}`
```python
@router.get("/api/analyze/{period}")
async def analyze_hotspots(period: str, date: str = None):
    # ...ç°æœ‰é€»è¾‘...
    
    stocks = []
    for stock in hotspot_stocks:
        # è·å–è¡Œä¸šè·³å˜
        industry_jump = memory_cache.get_industry_jump(
            stock.industry, date
        )
        
        stocks.append({
            # ...ç°æœ‰å­—æ®µ...
            "industry_jump": {
                "jump": industry_jump.jump,
                "display_text": f"{'â†‘' if industry_jump.jump > 0 else 'â†“'}{abs(industry_jump.jump)}"
            } if industry_jump else None
        })
    
    return {"stocks": stocks, ...}
```

#### C. æ’åè·³å˜ `/api/rank-jump`
```python
# åŒæ ·åœ¨è¿”å›çš„è‚¡ç¥¨åˆ—è¡¨ä¸­æ·»åŠ  industry_jump å­—æ®µ
```

#### D. ç¨³æ­¥ä¸Šå‡ `/api/steady-rise`
```python
# åŒæ ·åœ¨è¿”å›çš„è‚¡ç¥¨åˆ—è¡¨ä¸­æ·»åŠ  industry_jump å­—æ®µ
```

---

## ğŸ¨ å‰ç«¯å±•ç¤ºæ–¹æ¡ˆ

### 1. æ–°é¡µé¢ï¼šæ¿å—è·³å˜æ¦œ

**è·¯å¾„**: `è‚¡ç¥¨æ¿å— > æƒå€¼çƒ­åº¦ > æ¿å—è·³å˜`

```jsx
// frontend/src/components/modules/IndustryJumpModule.js

export default function IndustryJumpModule({ selectedDate }) {
  const [jumpData, setJumpData] = useState(null);
  
  useEffect(() => {
    const fetchData = async () => {
      const url = `${API_BASE_URL}/api/industry-jump?date=${selectedDate}`;
      const response = await axios.get(url);
      setJumpData(response.data);
    };
    fetchData();
  }, [selectedDate]);
  
  return (
    <div className="industry-jump-module">
      <h2>è¡Œä¸šè·³å˜åˆ†æ</h2>
      
      {/* æ•°æ®è¡¨æ ¼ */}
      <table>
        <thead>
          <tr>
            <th>è¡Œä¸š</th>
            <th>è·³å˜æƒ…å†µ</th>
            <th>è·³å˜åˆ†æ•°</th>
            <th>ä»Šæ—¥æ’å</th>
            <th>æ˜¨æ—¥æ’å</th>
            <th>æ€»çƒ­åº¦(B1)</th>
            <th>å¹³å‡æ’å(B2)</th>
            <th>æ€»åˆ†æ•°(C1)</th>
            <th>å¹³å‡åˆ†æ•°(C2)</th>
          </tr>
        </thead>
        <tbody>
          {jumpData?.industries.map(ind => (
            <tr key={ind.industry}>
              <td>{ind.industry}</td>
              <td>
                <span className={`jump-badge ${ind.jump > 0 ? 'positive' : 'negative'}`}>
                  {ind.display_text}
                </span>
              </td>
              <td>{ind.jump_score}</td>
              <td>{ind.today_rank}</td>
              <td>{ind.yesterday_rank}</td>
              <td>{ind.B1_today}</td>
              <td>{ind.B2_today}</td>
              <td>{ind.C1_today}</td>
              <td>{ind.C2_today}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
```

### 2. ä¸ªè‚¡æŸ¥è¯¢é¡µï¼šå¢åŠ è¡Œä¸šè·³å˜ä¿¡å· âœ…

#### 2.1 å±•ç¤ºæ–¹å¼
- **ä½ç½®**ï¼šè¡Œä¸šåç§°åæ–¹
- **æ ·å¼**ï¼šç±»ä¼¼ç°æœ‰ä¿¡å·æ ‡ç­¾çš„æ ·å¼
- **äº¤äº’**ï¼šé¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼ˆè·³å˜åˆ†æ•°ã€ä»Šæ—¥/æ˜¨æ—¥æ’åï¼‰

#### 2.2 ä»£ç å®ç°

```jsx
// frontend/src/components/modules/StockQueryModule.js

<div className="stock-detail">
  <h3>{stock.stock_name} ({stock.stock_code})</h3>
  
  <div className="stock-info">
    <span className="industry">{stock.industry}</span>
    
    {/* æ–°å¢ï¼šè¡Œä¸šè·³å˜ä¿¡å·æ ‡ç­¾ */}
    {stock.industry_jump && (
      <span 
        className={`signal-badge industry-jump ${
          stock.industry_jump.is_new ? 'new' :
          stock.industry_jump.jump > 0 ? 'positive' : 
          stock.industry_jump.jump < 0 ? 'negative' : 'neutral'
        }`}
        title={
          stock.industry_jump.is_new 
            ? `æ–°ä¸Šæ¦œè¡Œä¸š | ä»Šæ—¥æ’å: ${stock.industry_jump.today_rank}`
            : `è·³å˜: ${stock.industry_jump.jump > 0 ? '+' : ''}${stock.industry_jump.jump} | ` +
              `è·³å˜åˆ†æ•°: ${stock.industry_jump.jump_score.toFixed(1)} | ` +
              `ä»Šæ—¥æ’å: ${stock.industry_jump.today_rank} | ` +
              `æ˜¨æ—¥æ’å: ${stock.industry_jump.yesterday_rank}`
        }
      >
        {stock.industry_jump.display_text}
      </span>
    )}
  </div>
  
  {/* å…¶ä»–ä¿¡æ¯... */}
</div>
```

#### 2.3 æ³¨æ„äº‹é¡¹
- è¡Œä¸šè·³å˜ä¿¡å·ä¸åº”å–§å®¾å¤ºä¸»ï¼Œå­—ä½“å’Œpaddingè¦æ¯”ä¸»è¦ä¿¡å·ç¨å°
- ä½¿ç”¨æŸ”å’Œçš„é¢œè‰²ï¼ŒåŒºåˆ«äºä»·æ ¼æ¶¨è·Œçš„çº¢ç»¿
- "æœªåˆ†ç±»"è¡Œä¸šä¸æ˜¾ç¤ºè·³å˜ä¿¡å·
- æ–°è¡Œä¸šæ˜¾ç¤ºç‰¹æ®Šçš„"æ–°ä¸Šæ¦œ"æ ‡ç­¾

### 3. æœ€æ–°çƒ­ç‚¹é¡µï¼šå¢åŠ è¡Œä¸šè·³å˜åˆ— âœ…

#### 3.1 åˆ—è¡¨ä½ç½®
åœ¨ç°æœ‰åˆ—è¡¨ä¸­ï¼Œå»ºè®®åœ¨"è¡Œä¸š"åˆ—ä¹‹åå¢åŠ "è¡Œä¸šè·³å˜"åˆ—ï¼š

```
| æ’å | ä»£ç  | åç§° | è¡Œä¸š | [è¡Œä¸šè·³å˜] | æ¶¨è·Œå¹… | ... |
```

#### 3.2 ä»£ç å®ç°

```jsx
// frontend/src/components/modules/HotSpotsModule.js

<table className="stocks-table">
  <thead>
    <tr>
      <th>æ’å</th>
      <th>è‚¡ç¥¨ä»£ç </th>
      <th>è‚¡ç¥¨åç§°</th>
      <th>è¡Œä¸š</th>
      <th>è¡Œä¸šè·³å˜</th>  {/* æ–°å¢åˆ— */}
      <th>æ¶¨è·Œå¹…</th>
      {/* ...å…¶ä»–åˆ—... */}
    </tr>
  </thead>
  <tbody>
    {stocks.map(stock => (
      <tr key={stock.stock_code}>
        <td>{stock.fixed_rank}</td>
        <td>{stock.stock_code}</td>
        <td>{stock.stock_name}</td>
        <td>{stock.industry}</td>
        <td>
          {/* è¡Œä¸šè·³å˜æ˜¾ç¤º */}
          {stock.industry_jump ? (
            <span 
              className={`jump-text ${
                stock.industry_jump.is_new ? 'new' :
                stock.industry_jump.jump > 0 ? 'up' : 
                stock.industry_jump.jump < 0 ? 'down' : 'unchanged'
              }`}
              title={
                stock.industry_jump.is_new 
                  ? `æ–°ä¸Šæ¦œè¡Œä¸š`
                  : `è·³å˜åˆ†æ•°: ${stock.industry_jump.jump_score.toFixed(1)}`
              }
            >
              {/* æ˜¾ç¤ºæ ¼å¼ï¼šä¸Šå‡7 / ä¸‹é™3 / æ–°ä¸Šæ¦œæ–°è¡Œä¸š */}
              {stock.industry_jump.is_new ? (
                <span className="new-badge">æ–°ä¸Šæ¦œ</span>
              ) : stock.industry_jump.jump > 0 ? (
                <>â†‘{stock.industry_jump.jump}</>
              ) : stock.industry_jump.jump < 0 ? (
                <>â†“{Math.abs(stock.industry_jump.jump)}</>
              ) : (
                <>â€”</>
              )}
            </span>
          ) : (
            <span className="no-data">â€”</span>
          )}
        </td>
        <td className={stock.price_change >= 0 ? 'positive' : 'negative'}>
          {stock.price_change}%
        </td>
        {/* ...å…¶ä»–åˆ—... */}
      </tr>
    ))}
  </tbody>
</table>
```

#### 3.3 æ˜¾ç¤ºæ ¼å¼è¯´æ˜

| è·³å˜æƒ…å†µ | æ˜¾ç¤ºå†…å®¹ | é¢œè‰² | ç¤ºä¾‹ |
|---------|---------|------|------|
| ä¸Šå‡ | â†‘æ•°å­— | çº¢è‰² | â†‘7 |
| ä¸‹é™ | â†“æ•°å­— | ç»¿è‰² | â†“3 |
| ä¸å˜ | â€” | ç°è‰² | â€” |
| æ–°è¡Œä¸š | æ–°ä¸Šæ¦œ | æ©™è‰² | æ–°ä¸Šæ¦œ |
| æœªåˆ†ç±» | â€” | ç°è‰² | â€” |

#### 3.4 å“åº”å¼å¤„ç†
- **æ¡Œé¢ç«¯**ï¼šå®Œæ•´æ˜¾ç¤º"è¡Œä¸šè·³å˜"åˆ—
- **å¹³æ¿ç«¯**ï¼šå¯ä»¥è€ƒè™‘ç¼©å†™ä¸º"è·³å˜"
- **ç§»åŠ¨ç«¯**ï¼šå¯ä»¥éšè—æ­¤åˆ—æˆ–åˆå¹¶åˆ°è¡Œä¸šåˆ—ä¸­ï¼ˆè¡Œä¸šå â†‘7ï¼‰

### 4. CSSæ ·å¼ âœ…

```css
/* ==================== è¡Œä¸šè·³å˜æ ·å¼ ==================== */

/* ä¿¡å·æ ‡ç­¾æ ·å¼ï¼ˆç”¨äºä¸ªè‚¡æŸ¥è¯¢é¡µï¼‰ */
.signal-badge.industry-jump {
  display: inline-block;
  padding: 3px 10px;
  margin-left: 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 500;
  white-space: nowrap;
}

/* ä¸Šå‡ - æŸ”å’Œçº¢è‰² */
.signal-badge.industry-jump.positive {
  background-color: #fff1f0;
  color: #ff4d4f;
  border: 1px solid #ffccc7;
}

/* ä¸‹é™ - æŸ”å’Œç»¿è‰² */
.signal-badge.industry-jump.negative {
  background-color: #f0fff4;
  color: #52c41a;
  border: 1px solid #b7eb8f;
}

/* ä¸å˜ - ç°è‰² */
.signal-badge.industry-jump.neutral {
  background-color: #fafafa;
  color: #999;
  border: 1px solid #e8e8e8;
}

/* æ–°è¡Œä¸š - æ©™è‰² */
.signal-badge.industry-jump.new {
  background: linear-gradient(135deg, #ffd666 0%, #ffa940 100%);
  color: white;
  border: none;
}

/* åˆ—è¡¨ä¸­çš„è·³å˜æ–‡æœ¬ï¼ˆç”¨äºæœ€æ–°çƒ­ç‚¹é¡µï¼‰ */
.jump-text {
  display: inline-block;
  font-size: 12px;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 4px;
  transition: all 0.2s;
}

.jump-text.up {
  color: #ff4d4f;
  background-color: #fff1f0;
}

.jump-text.down {
  color: #52c41a;
  background-color: #f0fff4;
}

.jump-text.unchanged {
  color: #999;
}

.jump-text.new {
  color: #fa8c16;
  background-color: #fff7e6;
}

/* æ–°ä¸Šæ¦œå¾½ç«  */
.new-badge {
  display: inline-block;
  padding: 1px 6px;
  border-radius: 4px;
  background: #ffa940;
  color: white;
  font-size: 11px;
}

/* æ— æ•°æ®æ˜¾ç¤º */
.no-data {
  color: #d9d9d9;
}

/* é¼ æ ‡æ‚¬åœæ•ˆæœ */
.signal-badge.industry-jump:hover,
.jump-text:hover {
  opacity: 0.8;
  cursor: help;
}

/* å“åº”å¼ï¼šç§»åŠ¨ç«¯è°ƒæ•´ */
@media (max-width: 768px) {
  .signal-badge.industry-jump {
    font-size: 10px;
    padding: 2px 6px;
  }
  
  .jump-text {
    font-size: 11px;
  }
}
```

---

## ğŸ“Š æ€§èƒ½è¯„ä¼°

### è®¡ç®—å¤æ‚åº¦

```python
# å•æ¬¡è®¡ç®—ï¼š
è¡Œä¸šæ•°: ~100ä¸ª
æ¯è¡Œä¸šè‚¡ç¥¨æ•°: å¹³å‡50åª
æ€»è®¡ç®—é‡: 100è¡Œä¸š Ã— 2å¤© Ã— O(nÂ·log(n)) â‰ˆ 10,000æ¬¡æ“ä½œ

# å¯åŠ¨æ—¶å…¨é‡è®¡ç®—ï¼š
äº¤æ˜“æ—¥: 7å¤©
æ€»è®¡ç®—: 7 Ã— 10,000 = 70,000æ¬¡æ“ä½œ
é¢„è®¡è€—æ—¶: 2-5ç§’
```

### å†…å­˜å ç”¨

```python
# å•æ—¥è¡Œä¸šè·³å˜æ•°æ®ï¼š
100ä¸ªè¡Œä¸š Ã— 200å­—èŠ‚/è¡Œä¸š = 20KB

# 7å¤©ç¼“å­˜ï¼š
7å¤© Ã— 20KB = 140KB

# ç»“è®ºï¼šå†…å­˜å ç”¨å¯å¿½ç•¥
```

---

## ğŸš€ å®æ–½è®¡åˆ’

### Phase 1: æ ¸å¿ƒè®¡ç®—ï¼ˆ2å°æ—¶ï¼‰
- [ ] åˆ›å»º `IndustryJumpCalculator` ç±»
- [ ] å®ç°æŠ€èƒ½æ€¥é€Ÿå…¬å¼
- [ ] å®ç°è¡Œä¸šèšåˆå’Œæ’åé€»è¾‘
- [ ] å•å…ƒæµ‹è¯•

### Phase 2: ç¼“å­˜é›†æˆï¼ˆ1å°æ—¶ï¼‰
- [ ] æ‰©å±• `MemoryCacheManager`
- [ ] å¯åŠ¨æ—¶è®¡ç®—å¹¶ç¼“å­˜
- [ ] éªŒè¯ç¼“å­˜å‘½ä¸­

### Phase 3: APIå¼€å‘ï¼ˆ2å°æ—¶ï¼‰
- [ ] æ–°å»º `/api/industry-jump` æ¥å£
- [ ] ä¿®æ”¹ä¸ªè‚¡æŸ¥è¯¢API
- [ ] ä¿®æ”¹æœ€æ–°çƒ­ç‚¹API
- [ ] ä¿®æ”¹æ’åè·³å˜API
- [ ] ä¿®æ”¹ç¨³æ­¥ä¸Šå‡API

### Phase 4: å‰ç«¯å¼€å‘ï¼ˆ3å°æ—¶ï¼‰
- [ ] æ–°å»º"æ¿å—è·³å˜"é¡µé¢ç»„ä»¶
- [ ] æœ€æ–°çƒ­ç‚¹é¡µå¢åŠ åˆ—
- [ ] ä¸ªè‚¡æŸ¥è¯¢é¡µå¢åŠ ä¿¡å·
- [ ] æ’åè·³å˜é¡µå¢åŠ ä¿¡å·
- [ ] ç¨³æ­¥ä¸Šå‡é¡µå¢åŠ ä¿¡å·
- [ ] CSSæ ·å¼è°ƒæ•´

### Phase 5: æµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ1å°æ—¶ï¼‰
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] UI/UXä¼˜åŒ–
- [ ] æ–‡æ¡£å®Œå–„

**é¢„è®¡æ€»å·¥æ—¶**: 9å°æ—¶

---

## âš ï¸ å®æ–½æ³¨æ„äº‹é¡¹

### 1. æ•°æ®è§„èŒƒåŒ– âœ…

#### 1.1 è¡Œä¸šåç§°å¤„ç†
```python
def normalize_industry(industry: str) -> str:
    """
    è§„èŒƒåŒ–è¡Œä¸šåç§°
    
    å¤„ç†è§„åˆ™ï¼š
    1. å»é™¤é¦–å°¾ç©ºæ ¼ï¼šindustry.strip()
    2. å»é™¤å…¨è§’ç©ºæ ¼ï¼šreplace('ã€€', '')
    3. ç©ºå­—ç¬¦ä¸²æˆ–None â†’ "æœªåˆ†ç±»"
    """
    if not industry or not industry.strip():
        return "æœªåˆ†ç±»"
    normalized = industry.strip().replace('ã€€', '')
    return normalized if normalized else "æœªåˆ†ç±»"
```

#### 1.2 æœªåˆ†ç±»è¡Œä¸šè§„åˆ™
- **å½’ç±»**ï¼šæ‰€æœ‰ `industry` ä¸ºç©ºæˆ–ç©ºç™½çš„è‚¡ç¥¨å½’ä¸º"æœªåˆ†ç±»"
- **å±•ç¤º**ï¼šåœ¨è‚¡ç¥¨è¯¦æƒ…ä¸­æ˜¾ç¤ºä¸º"æœªåˆ†ç±»"è¡Œä¸š
- **è·³å˜è®¡ç®—**ï¼š**ä¸å‚ä¸**è·³å˜è®¡ç®—ï¼ˆè¢«è¿‡æ»¤æ‰ï¼‰
- **è·³å˜æ˜¾ç¤º**ï¼šä¸æ˜¾ç¤ºè·³å˜ä¿¡å·ï¼ˆè¿”å› Noneï¼‰

### 2. è¾¹ç•Œæƒ…å†µå¤„ç† âœ…

#### 2.1 æ–°è¡Œä¸š
```python
# æƒ…å†µï¼šæ˜¨æ—¥ä¸å­˜åœ¨ï¼Œä»Šæ—¥å‡ºç°
if industry not in yesterday_ranks:
    return IndustryJumpInfo(
        is_new=True,
        display_text="æ–°ä¸Šæ¦œæ–°è¡Œä¸š",
        jump=0,
        jump_score=0.0,
        yesterday_rank=None
    )
```

#### 2.2 æ¶ˆå¤±çš„è¡Œä¸š
```python
# æƒ…å†µï¼šæ˜¨æ—¥å­˜åœ¨ï¼Œä»Šæ—¥æ¶ˆå¤±
# å¤„ç†ï¼šåœ¨ä»Šæ—¥æ•°æ®ä¸­ä¸å‡ºç°ï¼Œä¸åšç‰¹æ®Šå¤„ç†
# å†å²æ•°æ®ä¸­ä»å¯æŸ¥è¯¢åˆ°æ˜¨æ—¥çš„è·³å˜ä¿¡æ¯
```

#### 2.3 å°è¡Œä¸šï¼ˆè‚¡ç¥¨æ•°é‡å°‘ï¼‰
```python
# æŸè¡Œä¸šåªæœ‰1-2åªè‚¡ç¥¨
# å¤„ç†ï¼šæ­£å¸¸è®¡ç®—ï¼Œä¸åšç‰¹æ®Šå¤„ç†
# B2 ä¼šæ¥è¿‘è¿™1-2åªè‚¡ç¥¨çš„æ’å
# è·³å˜å¯èƒ½æ³¢åŠ¨è¾ƒå¤§ï¼Œè¿™æ˜¯åˆç†çš„
```

#### 2.4 è·³å˜ä¸º0
```python
# æ’åæœªå˜åŒ–
if jump == 0:
    display_text = "è¡Œä¸šæ’åä¸å˜"
    jump_score = 0.0
```

### 3. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ âœ…

#### 3.1 æ‡’åŠ è½½ç¼“å­˜
- **é¦–æ¬¡è®¿é—®å»¶è¿Ÿ**ï¼š50-100msï¼ˆå¯æ¥å—ï¼‰
- **ç¼“å­˜å‘½ä¸­**ï¼š<1ms
- **å†…å­˜å¢é•¿**ï¼šæ¯æ—¥çº¦20KBï¼Œ7æ—¥çº¦140KB

#### 3.2 è®¡ç®—ä¼˜åŒ–
```python
# ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼å’Œç”Ÿæˆå™¨
stats['B1'] = sum(1 for s in stocks_list if s.rank <= 1000)

# ä½¿ç”¨ defaultdict é¿å…é‡å¤æ£€æŸ¥
industry_stats = defaultdict(lambda: {...})

# ä¸€æ¬¡éå†å®Œæˆå¤šé¡¹ç»Ÿè®¡
for stock in stocks:
    # åŒæ—¶ç´¯åŠ  B1, C1 ç­‰
    pass
```

#### 3.3 æ•°æ®è®¿é—®ä¼˜åŒ–
```python
# æ‰¹é‡è·å–è‚¡ç¥¨æ•°æ®ï¼ˆé¿å…N+1æŸ¥è¯¢ï¼‰
stocks = memory_cache.get_stocks_by_date(date)

# è¡Œä¸šæ’åä¸€æ¬¡æ€§è®¡ç®—æ‰€æœ‰è¡Œä¸š
all_jumps = get_industry_jumps_for_date(date)

# å•ä¸ªæŸ¥è¯¢ç›´æ¥ä»ç¼“å­˜è¯»å–
jump = all_jumps.get(industry)
```

### 4. ç”¨æˆ·ä½“éªŒç»†èŠ‚ âœ…

#### 4.1 è§†è§‰å±‚æ¬¡
- è¡Œä¸šè·³å˜ä¿¡å·æ¯”ä¸»è¦ä¿¡å·ï¼ˆæ¶¨è·Œå¹…ç­‰ï¼‰ç¨å°
- é¢œè‰²æŸ”å’Œï¼Œä¸å¹²æ‰°ä¸»è¦ä¿¡æ¯
- ä½¿ç”¨è¾…åŠ©è‰²ï¼ˆæµ…çº¢/æµ…ç»¿ï¼‰ï¼ŒåŒºåˆ«äºä»·æ ¼çº¢ç»¿

#### 4.2 ä¿¡æ¯å¯†åº¦
```jsx
// ä¸ªè‚¡æŸ¥è¯¢é¡µï¼šä¿¡å·æ ‡ç­¾å½¢å¼ï¼Œç®€æ´
<span className="signal-badge">è¡Œä¸šä¸Šå‡7</span>

// æœ€æ–°çƒ­ç‚¹é¡µï¼šç²¾ç®€ç¬¦å·ï¼ŒèŠ‚çœç©ºé—´
<span className="jump-text">â†‘7</span>

// æ¿å—è·³å˜é¡µï¼šå®Œæ•´ä¿¡æ¯ï¼Œè¯¦ç»†å±•ç¤º
<table>
  <td>è¡Œä¸šä¸Šå‡7</td>
  <td>è·³å˜åˆ†æ•°: 58.3</td>
  <td>ä»Šæ—¥æ’å: 3</td>
  <td>æ˜¨æ—¥æ’å: 10</td>
</table>
```

#### 4.3 äº¤äº’åé¦ˆ
- é¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼ˆtooltipï¼‰
- ç‚¹å‡»å¯èƒ½è·³è½¬åˆ°æ¿å—è·³å˜é¡µï¼ˆå¯é€‰ï¼‰
- ç§»åŠ¨ç«¯é•¿æŒ‰æ˜¾ç¤ºè¯¦æƒ…ï¼ˆå¯é€‰ï¼‰

### 5. é”™è¯¯å¤„ç† âœ…

#### 5.1 æ•°æ®ç¼ºå¤±
```python
try:
    jumps = calculator.calculate_industry_jump(date)
except DataNotFoundError:
    logger.warning(f"æ—¥æœŸ {date} æ— æ•°æ®")
    return {}
except Exception as e:
    logger.error(f"è®¡ç®—å¤±è´¥: {e}")
    return {}
```

#### 5.2 å‰ç«¯å®¹é”™
```jsx
{/* å®‰å…¨è®¿é—®ï¼Œé¿å… undefined é”™è¯¯ */}
{stock.industry_jump && stock.industry_jump.display_text}

{/* æä¾›é»˜è®¤å€¼ */}
{stock.industry_jump?.display_text || 'â€”'}
```

### 6. æµ‹è¯•è¦ç‚¹ âœ…

#### 6.1 å•å…ƒæµ‹è¯•
- [ ] æŠ€èƒ½æ€¥é€Ÿå…¬å¼è®¡ç®—æ­£ç¡®æ€§
- [ ] è¡Œä¸šåç§°è§„èŒƒåŒ–
- [ ] B2è®¡ç®—ï¼ˆå€’æ•°åŠ æƒï¼‰
- [ ] æ–°è¡Œä¸šè¯†åˆ«
- [ ] è¾¹ç•Œå€¼å¤„ç†ï¼ˆjump=0, jump=å¾ˆå¤§å€¼ï¼‰

#### 6.2 é›†æˆæµ‹è¯•
- [ ] æ‡’åŠ è½½è§¦å‘å’Œç¼“å­˜å‘½ä¸­
- [ ] APIè¿”å›æ•°æ®æ ¼å¼
- [ ] å‰ç«¯æ­£ç¡®æ¸²æŸ“

#### 6.3 ç”¨æˆ·åœºæ™¯æµ‹è¯•
- [ ] ä¸ªè‚¡æŸ¥è¯¢é¡µæ˜¾ç¤ºæ­£ç¡®
- [ ] æœ€æ–°çƒ­ç‚¹é¡µåˆ—æ­£ç¡®
- [ ] æ¿å—è·³å˜é¡µå®Œæ•´å±•ç¤º
- [ ] æ–°è¡Œä¸šç‰¹æ®Šæ ‡è®°
- [ ] æœªåˆ†ç±»è¡Œä¸šä¸æ˜¾ç¤º

### 7. å…¼å®¹æ€§è€ƒè™‘ âœ…

#### 7.1 æ•°æ®å…¼å®¹
- ä¸ç°æœ‰è¡Œä¸šçƒ­åº¦åˆ†æä¿æŒä¸€è‡´
- B1/B2/C1/C2è®¡ç®—å…¬å¼å¤ç”¨
- ä¸å½±å“ç°æœ‰åŠŸèƒ½

#### 7.2 å‰ç«¯å…¼å®¹
- æ”¯æŒä¸»æµæµè§ˆå™¨ï¼ˆChrome, Firefox, Safari, Edgeï¼‰
- å“åº”å¼è®¾è®¡ï¼Œé€‚é…ç§»åŠ¨ç«¯
- é™çº§æ–¹æ¡ˆï¼šæ— è·³å˜æ•°æ®æ—¶ä¸æ˜¾ç¤ºï¼ˆè€ŒéæŠ¥é”™ï¼‰

### 8. éƒ¨ç½²æ³¨æ„äº‹é¡¹ âœ…

#### 8.1 æ•°æ®è¿ç§»
- **æ— éœ€æ•°æ®åº“è¿ç§»**ï¼ˆè®¡ç®—å‹åŠŸèƒ½ï¼‰
- ä¸æ–°å¢æ•°æ®è¡¨
- ä¸ä¿®æ”¹ç°æœ‰è¡¨ç»“æ„

#### 8.2 é…ç½®é¡¹
```python
# backend/app/config.pyï¼ˆå¯é€‰ï¼Œä½¿ç”¨é»˜è®¤å€¼å³å¯ï¼‰

# è¡Œä¸šè·³å˜é…ç½®
INDUSTRY_JUMP_BASE_VALUE = 50  # æŠ€èƒ½æ€¥é€Ÿå…¬å¼åŸºå‡†å€¼
INDUSTRY_JUMP_K_VALUE = 1.0    # èšç„¦ç¨‹åº¦
```

#### 8.3 æ€§èƒ½ç›‘æ§
```python
# ç›‘æ§é¦–æ¬¡è®¡ç®—æ—¶é—´
import time
start = time.time()
jumps = calculator.calculate_industry_jump(date)
elapsed = time.time() - start
logger.info(f"è¡Œä¸šè·³å˜è®¡ç®—è€—æ—¶: {elapsed:.3f}ç§’")

# ç›‘æ§ç¼“å­˜å‘½ä¸­ç‡
cache_hits = len([d for d in dates if d in cache])
hit_rate = cache_hits / len(dates) if dates else 0
logger.info(f"ç¼“å­˜å‘½ä¸­ç‡: {hit_rate:.1%}")
```

---

## ğŸ“ åç»­ä¼˜åŒ–æ–¹å‘

1. **è¡Œä¸šè·³å˜æ’è¡Œæ¦œ**
   - æœ€å¤§ä¸Šå‡è¡Œä¸šTOP10
   - æœ€å¤§ä¸‹é™è¡Œä¸šTOP10

2. **è¡Œä¸šè·³å˜å†å²è¶‹åŠ¿**
   - æ˜¾ç¤ºè¡Œä¸šè¿‘7æ—¥/30æ—¥çš„è·³å˜è¶‹åŠ¿å›¾
   - è¯†åˆ«æŒç»­ä¸Šå‡/ä¸‹é™çš„è¡Œä¸š

3. **è¡Œä¸šè·³å˜é¢„è­¦**
   - å½“æŒä»“è‚¡ç¥¨çš„è¡Œä¸šå¤§å¹…ä¸‹è·Œæ—¶é¢„è­¦
   - æ¨é€è¡Œä¸šçƒ­åº¦å‰§çƒˆå˜åŒ–é€šçŸ¥

4. **å¯é…ç½®åŸºå‡†å€¼**
   - å…è®¸ç”¨æˆ·è°ƒæ•´æŠ€èƒ½æ€¥é€Ÿå…¬å¼çš„base_value
   - A/Bæµ‹è¯•ä¸åŒåŸºå‡†å€¼çš„æ•ˆæœ

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [è¡Œä¸šçƒ­åº¦åˆ†æï¼ˆåŠ æƒç‰ˆæœ¬ï¼‰](./æ¿å—æˆåˆ†è‚¡åŠ æƒåˆ†æ-æ–¹æ¡ˆè®¾è®¡.md)
- [ä¿¡å·ç³»ç»Ÿè®¾è®¡](./ä¿¡å·ç³»ç»Ÿè®¾è®¡.md)
- [å†…å­˜ç¼“å­˜æ¶æ„](./å†…å­˜ç¼“å­˜æ¶æ„.md)

---

## âœ… åŠŸèƒ½é…ç½®ç¡®è®¤æ¸…å•

åœ¨å¼€å§‹å®æ–½å‰ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹é…ç½®å·²å…¨éƒ¨ç¡®å®šï¼š

| é…ç½®é¡¹ | ç¡®å®šå€¼ | çŠ¶æ€ |
|--------|--------|------|
| **æŠ€èƒ½æ€¥é€Ÿå…¬å¼åŸºå‡†å€¼** | 50 | âœ… |
| **kå€¼ï¼ˆèšç„¦ç¨‹åº¦ï¼‰** | 1.0ï¼ˆå›ºå®šï¼‰ | âœ… |
| **Ïƒè¿‡æ»¤** | ä¸ä½¿ç”¨ | âœ… |
| **B2è®¡ç®—æ–¹å¼** | å€’æ•°åŠ æƒï¼ˆåŸå…¬å¼ï¼‰ | âœ… |
| **è·³å˜å±•ç¤ºé˜ˆå€¼** | æ— é˜ˆå€¼ï¼ˆå…¨æ˜¾ç¤ºï¼‰ | âœ… |
| **è¡Œä¸šåç§°è§„èŒƒ** | å»é™¤ç©ºæ ¼ | âœ… |
| **æœªåˆ†ç±»è¡Œä¸š** | æ˜¾ç¤ºä½†ä¸å‚ä¸è·³å˜ | âœ… |
| **æ–°è¡Œä¸šå¤„ç†** | æ˜¾ç¤º"æ–°ä¸Šæ¦œæ–°è¡Œä¸š" | âœ… |
| **ç¼“å­˜æ–¹å¼** | æ‡’åŠ è½½ï¼ˆé¦–æ¬¡è®¿é—®æ—¶ï¼‰ | âœ… |
| **ä¸ªè‚¡æŸ¥è¯¢é¡µå±•ç¤º** | ä¿¡å·æ ‡ç­¾ | âœ… |
| **æœ€æ–°çƒ­ç‚¹é¡µå±•ç¤º** | æ–°å¢åˆ— | âœ… |
| **æ’åè·³å˜é¡µå±•ç¤º** | æ–°å¢åˆ— | âœ… |
| **ç¨³æ­¥ä¸Šå‡é¡µå±•ç¤º** | æ–°å¢åˆ— | âœ… |
| **æ¿å—è·³å˜é¡µä½ç½®** | è‚¡ç¥¨æ¿å—>æƒå€¼çƒ­åº¦>æ¿å—è·³å˜ | âœ… |

---

## ğŸ“‹ å®æ–½æ£€æŸ¥æ¸…å•

å¼€å‘å®Œæˆåï¼Œè¯·é€é¡¹æ£€æŸ¥ï¼š

### åç«¯
- [ ] `IndustryJumpCalculator` ç±»å®ç°
- [ ] æŠ€èƒ½æ€¥é€Ÿå…¬å¼ï¼ˆbase_value=50ï¼‰
- [ ] è¡Œä¸šåç§°è§„èŒƒåŒ–å‡½æ•°
- [ ] B2å€’æ•°åŠ æƒè®¡ç®—
- [ ] æ–°è¡Œä¸šè¯†åˆ«é€»è¾‘
- [ ] `MemoryCacheManager` æ‡’åŠ è½½é›†æˆ
- [ ] `/api/industry-jump` API
- [ ] ä¸ªè‚¡æŸ¥è¯¢APIæ·»åŠ  `industry_jump` å­—æ®µ
- [ ] æœ€æ–°çƒ­ç‚¹APIæ·»åŠ  `industry_jump` å­—æ®µ
- [ ] æ’åè·³å˜APIæ·»åŠ  `industry_jump` å­—æ®µ
- [ ] ç¨³æ­¥ä¸Šå‡APIæ·»åŠ  `industry_jump` å­—æ®µ
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–

### å‰ç«¯
- [ ] `IndustryJumpModule` æ–°é¡µé¢ç»„ä»¶
- [ ] ä¸ªè‚¡æŸ¥è¯¢é¡µä¿¡å·æ ‡ç­¾
- [ ] æœ€æ–°çƒ­ç‚¹é¡µæ–°å¢åˆ—
- [ ] æ’åè·³å˜é¡µæ–°å¢åˆ—
- [ ] ç¨³æ­¥ä¸Šå‡é¡µæ–°å¢åˆ—
- [ ] CSSæ ·å¼å®Œå–„
- [ ] å“åº”å¼é€‚é…
- [ ] è¾¹ç•Œæƒ…å†µUIå¤„ç†ï¼ˆæ— æ•°æ®ã€æ–°è¡Œä¸šç­‰ï¼‰

### æµ‹è¯•
- [ ] æŠ€èƒ½æ€¥é€Ÿå…¬å¼æµ‹è¯•
- [ ] è¡Œä¸šåç§°è§„èŒƒåŒ–æµ‹è¯•
- [ ] æ‡’åŠ è½½ç¼“å­˜æµ‹è¯•
- [ ] APIæ•°æ®æ ¼å¼æµ‹è¯•
- [ ] å‰ç«¯æ¸²æŸ“æµ‹è¯•
- [ ] è¾¹ç•Œæƒ…å†µæµ‹è¯•
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•

### éƒ¨ç½²
- [ ] ä»£ç å®¡æŸ¥
- [ ] æ€§èƒ½ç›‘æ§é…ç½®
- [ ] æ–‡æ¡£æ›´æ–°
- [ ] å‘å¸ƒè¯´æ˜ç¼–å†™

---

## ğŸ’¡ å¿«é€Ÿå‚è€ƒ

### å…³é”®å…¬å¼
```python
# æŠ€èƒ½æ€¥é€Ÿå…¬å¼
jump_score = rank_change / (abs(rank_change) + 50) Ã— 100

# B2å€’æ•°åŠ æƒ
B2 = n / Î£(1/rank_i)
```

### æ˜¾ç¤ºæ–‡æœ¬è§„åˆ™
```python
if is_new:
    display_text = "æ–°ä¸Šæ¦œæ–°è¡Œä¸š"
elif jump > 0:
    display_text = f"è¡Œä¸šä¸Šå‡{jump}"
elif jump < 0:
    display_text = f"è¡Œä¸šä¸‹é™{abs(jump)}"
else:
    display_text = "è¡Œä¸šæ’åä¸å˜"
```

### APIè°ƒç”¨ç¤ºä¾‹
```javascript
// è·å–è¡Œä¸šè·³å˜æ¦œ
GET /api/industry-jump?date=20251112

// è·å–è‚¡ç¥¨è¯¦æƒ…ï¼ˆå«è¡Œä¸šè·³å˜ï¼‰
GET /api/stock/300750?date=20251112

// æœ€æ–°çƒ­ç‚¹ï¼ˆå«è¡Œä¸šè·³å˜ï¼‰
GET /api/analyze/7?date=20251112
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [è¡Œä¸šçƒ­åº¦åˆ†æï¼ˆåŠ æƒç‰ˆæœ¬ï¼‰](./æ¿å—æˆåˆ†è‚¡åŠ æƒåˆ†æ-æ–¹æ¡ˆè®¾è®¡.md)
- [ä¿¡å·ç³»ç»Ÿè®¾è®¡](./ä¿¡å·ç³»ç»Ÿè®¾è®¡.md)
- [å†…å­˜ç¼“å­˜æ¶æ„](./å†…å­˜ç¼“å­˜æ¶æ„.md)
- [æ¿å—æ•°æ®å¿«é€Ÿå¼€å§‹](./æ¿å—æ•°æ®å¿«é€Ÿå¼€å§‹.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-11-12  
**æœ€åæ›´æ–°**: 2025-11-12  
**ä½œè€…**: Cascade AI Assistant  
**å®¡æ ¸çŠ¶æ€**: âœ… å·²ç¡®è®¤é…ç½®
