# Aè‚¡è‚¡ç¥¨åˆ†æç³»ç»Ÿ - é¡¹ç›®å®Œæ•´æ¦‚è¿° (Part 2: åŠŸèƒ½ä¸API)

**ç‰ˆæœ¬**: v0.2.5  
**æœ€åæ›´æ–°**: 2025-11-09

---

##æ–‡æ¡£å¯¼èˆª

- **Part 1**: é¡¹ç›®æ€»è§ˆã€æ•°æ®åº“ã€åç«¯ã€å‰ç«¯æ¶æ„
- **Part 2 (æœ¬æ–‡)**: APIæ¥å£ã€åŠŸèƒ½æ¨¡å—ã€æ•°æ®æµç¨‹ã€éƒ¨ç½²

---

## 5. APIæ¥å£å®Œæ•´åˆ—è¡¨

### 5.1 åŸºç¡€æ¥å£

#### `GET /`
- **åŠŸèƒ½**: æ ¹è·¯å¾„
- **è¿”å›**: `{name, version, status}`

#### `GET /health`
- **åŠŸèƒ½**: å¥åº·æ£€æŸ¥
- **è¿”å›**: `{status: "healthy"}`

---

### 5.2 åˆ†ææ¥å£ (`/api`)

#### `GET /api/dates`
- **åŠŸèƒ½**: è·å–æ‰€æœ‰å¯ç”¨æ—¥æœŸ
- **è¿”å›**: 
```json
{
  "dates": ["20251103", "20251104", ...],
  "latest_date": "20251107"
}
```

#### `GET /api/analyze/{period}`
- **åŠŸèƒ½**: å‘¨æœŸçƒ­ç‚¹åˆ†æ
- **å‚æ•°**:
  - `period` (path): åˆ†æå‘¨æœŸ (å¤©æ•°)
  - `board_type` (query): æ¿å—ç±»å‹ (all/main/bjs)
  - `top_n` (query): æ¯å¤©å‰Nå (100/200/400/600/800/1000)
  - `date` (query): æŒ‡å®šç»“æŸæ—¥æœŸ (å¯é€‰)
- **è¿”å›**:
```json
{
  "stocks": [
    {
      "code": "000001",
      "name": "å¹³å®‰é“¶è¡Œ",
      "industry": "é“¶è¡Œ",
      "count": 5,
      "rank": 123,
      "date_rank_info": [
        {"date": "20251103", "rank": 150},
        ...
      ]
    }
  ],
  "dates": ["20251103", ...],
  "total_records": 500
}
```

---

### 5.3 è‚¡ç¥¨æ¥å£ (`/api`)

#### `GET /api/stock/{stock_code}`
- **åŠŸèƒ½**: æŸ¥è¯¢ä¸ªè‚¡å†å²æ’åæ•°æ®
- **å‚æ•°**:
  - `stock_code` (path): è‚¡ç¥¨ä»£ç 
  - `date` (query): æŒ‡å®šæ—¥æœŸ (å¯é€‰)
- **è¿”å›**:
```json
{
  "code": "000001",
  "name": "å¹³å®‰é“¶è¡Œ",
  "industry": "é“¶è¡Œ",
  "date_rank_info": [
    {
      "date": "20251107",
      "rank": 123,
      "price_change": 2.5,
      "turnover_rate": 1.2,
      "volume_days": 3.5,
      "avg_volume_ratio_50": 1.8
    }
  ],
  "appears_count": 5,
  "dates": ["20251103", ...]
}
```

---

### 5.4 è¡Œä¸šæ¥å£ (`/api/industry`)

#### `GET /api/industry/stats`
- **åŠŸèƒ½**: è¡Œä¸šç»Ÿè®¡ (æ•°é‡ç»Ÿè®¡ï¼Œæ—§ç‰ˆ)
- **å‚æ•°**:
  - `period`: å‘¨æœŸ
  - `top_n`: å‰Nå
- **è¿”å›**:
```json
[
  {
    "industry": "æ±½è½¦é›¶éƒ¨ä»¶",
    "count": 45,
    "percentage": 9.0
  }
]
```

#### `GET /api/industry/trend`
- **åŠŸèƒ½**: è¡Œä¸šè¶‹åŠ¿ (å¤šæ—¥æœŸåŠ¨æ€)
- **å‚æ•°**:
  - `period`: å‘¨æœŸ (3-60å¤©)
  - `top_n`: å‰Nå
  - `date`: æŒ‡å®šæ—¥æœŸ
- **è¿”å›**:
```json
{
  "dates": ["20251103", ...],
  "industries": ["æ±½è½¦é›¶éƒ¨ä»¶", ...],
  "data": {
    "æ±½è½¦é›¶éƒ¨ä»¶": [45, 48, 52, ...]
  }
}
```

#### `GET /api/industry/top1000` (å·²å¼ƒç”¨)
- **åŠŸèƒ½**: å‰Nåè¡Œä¸šç»Ÿè®¡
- **å‚æ•°**:
  - `limit`: 1000/2000/3000/5000
  - `date`: æŒ‡å®šæ—¥æœŸ
- **è¯´æ˜**: å·²è¢«`/api/industry/weighted`æ›¿ä»£

#### `GET /api/industry/weighted` â­ æ¨è
- **åŠŸèƒ½**: è¡Œä¸šåŠ æƒçƒ­åº¦åˆ†æ
- **å‚æ•°**:
  - `date`: æŒ‡å®šæ—¥æœŸ
  - `k`: å¹‚å¾‹ç³»æ•° (0.3-2.0ï¼Œé»˜è®¤0.618)
  - `metric`: æ’åºæŒ‡æ ‡ (B1/B2/C1/C2ï¼Œé»˜è®¤B1)
  - `limit`: è¿”å›å‰Nä¸ª (é»˜è®¤50)
- **è¿”å›**:
```json
{
  "k": 0.618,
  "metric": "B1",
  "date": "20251107",
  "top_industries": [
    {
      "industry": "æ±½è½¦é›¶éƒ¨ä»¶",
      "B1": 8.92,      // æ€»çƒ­åº¦
      "B2": 0.056,     // å¹³å‡çƒ­åº¦
      "C1": 1234.5,    // æ€»åˆ†æ•°
      "C2": 78.9,      // å¹³å‡åˆ†æ•°
      "stock_count": 158,
      "percentage": 3.2
    }
  ]
}
```

**å››ä¸ªç»´åº¦è¯´æ˜**:
- **B1 (æ€»çƒ­åº¦)**: `Î£(1/rank^k)` - çœ‹ç²¾è‹±æ•°é‡
- **B2 (å¹³å‡çƒ­åº¦)**: `B1/è‚¡ç¥¨æ•°` - çœ‹ç²¾è‹±å¯†åº¦
- **C1 (æ€»åˆ†æ•°)**: `Î£(total_score)` - çœ‹æ€»èƒ½é‡
- **C2 (å¹³å‡åˆ†æ•°)**: `C1/è‚¡ç¥¨æ•°` - çœ‹å¹³å‡è´¨é‡

---

### 5.5 æ¿å—æ¥å£ (`/api/sectors`)

#### `GET /api/sectors/dates`
- **åŠŸèƒ½**: è·å–æ¿å—æ•°æ®å¯ç”¨æ—¥æœŸ
- **è¿”å›**: `["20251105", "20251106", "20251107"]`

#### `GET /api/sectors/ranking`
- **åŠŸèƒ½**: æ¿å—æ’ååˆ—è¡¨
- **å‚æ•°**:
  - `date`: æŒ‡å®šæ—¥æœŸ (å¯é€‰)
  - `limit`: è¿”å›æ•°é‡ (10-500ï¼Œé»˜è®¤100)
- **è¿”å›**:
```json
{
  "date": "20251107",
  "sectors": [
    {
      "rank": 1,
      "sector_name": "å·¥ç¨‹å»ºè®¾",
      "total_score": 92.5,
      "price_change": 3.2,
      "turnover_rate_percent": 2.1,
      "volume_days": 5.2
    }
  ]
}
```

#### `GET /api/sectors/search/{keyword}`
- **åŠŸèƒ½**: æœç´¢æ¿å—
- **å‚æ•°**:
  - `keyword` (path): æœç´¢å…³é”®è¯
- **è¿”å›**: `["å·¥ç¨‹å»ºè®¾", "å»ºç­‘è£…é¥°", ...]`

#### `GET /api/sectors/trend`
- **åŠŸèƒ½**: æ¿å—è¶‹åŠ¿ (å¤šæ—¥æœŸæ’åå˜åŒ–)
- **å‚æ•°**:
  - `days`: æ˜¾ç¤ºå¤©æ•° (3-60)
  - `limit`: å‰Nä¸ªæ¿å— (5-30)
  - `date`: ç»“æŸæ—¥æœŸ (å¯é€‰)
- **è¿”å›**:
```json
{
  "dates": ["20251105", "20251106", "20251107"],
  "sectors": ["å·¥ç¨‹å»ºè®¾", "å»ºç­‘è£…é¥°", ...],
  "rankings": {
    "å·¥ç¨‹å»ºè®¾": [5, 3, 1],
    "å»ºç­‘è£…é¥°": [12, 10, 8]
  }
}
```

#### `GET /api/sectors/rank-changes`
- **åŠŸèƒ½**: æ¿å—æ’åå˜åŒ–å¯¹æ¯”
- **å‚æ•°**:
  - `date`: å¯¹æ¯”æ—¥æœŸ (å¯é€‰)
  - `compare_days`: å¯¹æ¯”å¤©æ•° (1-7ï¼Œé»˜è®¤1)
- **è¿”å›**:
```json
{
  "date1": "20251106",
  "date2": "20251107",
  "changes": [
    {
      "sector_name": "å·¥ç¨‹å»ºè®¾",
      "rank1": 3,
      "rank2": 1,
      "rank_change": +2,
      "total_score1": 88.5,
      "total_score2": 92.5,
      "price_change": 3.2
    }
  ]
}
```

#### `GET /api/sectors/{sector_name}`
- **åŠŸèƒ½**: æ¿å—è¯¦ç»†ä¿¡æ¯
- **å‚æ•°**:
  - `sector_name` (path): æ¿å—åç§°
  - `days`: å†å²å¤©æ•° (7-365ï¼Œé»˜è®¤30)
- **è¿”å›**:
```json
{
  "sector_name": "å·¥ç¨‹å»ºè®¾",
  "history": [
    {
      "date": "20251107",
      "rank": 1,
      "total_score": 92.5,
      "price_change": 3.2,
      ...
    }
  ],
  "statistics": {
    "total_days": 30,
    "avg_rank": 5.2,
    "best_rank": 1,
    "worst_rank": 15,
    "avg_score": 85.6
  }
}
```

---

### 5.6 æ’åè·³å˜æ¥å£ (`/api`)

#### `GET /api/rank-jump` æˆ– `/api/rank_jump`
- **åŠŸèƒ½**: æ£€æµ‹æ’åå‰§çƒˆè·³å˜çš„è‚¡ç¥¨
- **å‚æ•°**:
  - `jump_threshold`: è·³å˜é˜ˆå€¼ (100-20000ï¼Œé»˜è®¤2500)
  - `board_type`: æ¿å—ç±»å‹ (all/main/bjs)
  - `date`: æŒ‡å®šæ—¥æœŸ (å¯é€‰)
- **è¿”å›**:
```json
{
  "stocks": [
    {
      "code": "000001",
      "name": "å¹³å®‰é“¶è¡Œ",
      "industry": "é“¶è¡Œ",
      "latest_rank": 123,
      "previous_rank": 3000,
      "rank_change": 2877,
      "latest_date": "20251107",
      "previous_date": "20251106",
      "price_change": 5.2,
      "turnover_rate": 3.5
    }
  ],
  "total_count": 15,
  "jump_threshold": 2500,
  "latest_date": "20251107",
  "previous_date": "20251106",
  "statistics": {
    "mean_rank_change": 3250.5,
    "std_rank_change": 850.2
  }
}
```

---

### 5.7 ç¨³æ­¥ä¸Šå‡æ¥å£ (`/api`)

#### `GET /api/steady-rise` æˆ– `/api/steady_rise`
- **åŠŸèƒ½**: æ£€æµ‹ç¨³æ­¥ä¸Šå‡çš„è‚¡ç¥¨
- **å‚æ•°**:
  - `period`: åˆ†æå‘¨æœŸ (2-14å¤©ï¼Œé»˜è®¤3)
  - `board_type`: æ¿å—ç±»å‹ (all/main/bjs)
  - `min_improvement`: æœ€å°æå‡å¹…åº¦ (é»˜è®¤100)
  - `date`: æŒ‡å®šæ—¥æœŸ (å¯é€‰)
- **è¿”å›**:
```json
{
  "stocks": [
    {
      "code": "000001",
      "name": "å¹³å®‰é“¶è¡Œ",
      "industry": "é“¶è¡Œ",
      "start_rank": 500,
      "end_rank": 150,
      "total_improvement": 350,
      "avg_daily_improvement": 175.0,
      "rank_history": [500, 400, 250, 150],
      "dates": ["20251104", "20251105", "20251106", "20251107"],
      "price_change": 2.5
    }
  ],
  "total_count": 25,
  "period": 3,
  "dates": ["20251105", "20251106", "20251107"],
  "min_rank_improvement": 100
}
```

---

### 5.8 ç¼“å­˜ç®¡ç†æ¥å£ (`/api/cache`)

#### `GET /api/cache/stats`
- **åŠŸèƒ½**: è·å–ç¼“å­˜ç»Ÿè®¡
- **è¿”å›**:
```json
{
  "services": {
    "analysis_service": {
      "entries": 15,
      "hit_rate": 85.3
    },
    "industry_service": {
      "entries": 8,
      "hit_rate": 92.1
    }
  },
  "memory": {
    "stocks": 5435,
    "daily_data": 27145,
    "sectors": 1430
  }
}
```

#### `POST /api/cache/clear`
- **åŠŸèƒ½**: æ¸…é™¤ç¼“å­˜
- **Body**:
```json
{
  "service": "industry_service",  // å¯é€‰
  "pattern": "period_*"           // å¯é€‰
}
```
- **è¿”å›**: `{cleared_count: 8, message: "..."}`

#### `POST /api/cache/cleanup-expired`
- **åŠŸèƒ½**: æ¸…ç†è¿‡æœŸç¼“å­˜
- **è¿”å›**:
```json
{
  "services": {
    "analysis_service": 3,
    "industry_service": 2
  },
  "total_cleaned": 5
}
```

#### `GET /api/cache/health`
- **åŠŸèƒ½**: ç¼“å­˜å¥åº·æ£€æŸ¥
- **è¿”å›**:
```json
{
  "status": "healthy",
  "memory": {
    "loaded": true,
    "stocks": 5435,
    "data_records": 27145
  },
  "services": {
    "analysis": "ok",
    "industry": "ok"
  }
}
```

---

## 6. åŠŸèƒ½æ¨¡å—è¯¦è§£

### 6.1 æœ€æ–°çƒ­ç‚¹åˆ†æ

**åŠŸèƒ½**: åˆ†æNæ—¥å†…é‡å¤å‡ºç°åœ¨å‰Måçš„çƒ­ç‚¹è‚¡ç¥¨

**ç®—æ³•æµç¨‹**:
1. è·å–æœ€è¿‘Nå¤©çš„æ‰€æœ‰æ—¥æœŸ
2. å¯¹æ¯ä¸€å¤©ï¼Œç­›é€‰å‰Måè‚¡ç¥¨
3. ç»Ÿè®¡æ¯åªè‚¡ç¥¨å‡ºç°çš„æ¬¡æ•°
4. æŒ‰å‡ºç°æ¬¡æ•°å’Œæœ€æ–°æ’åæ’åº
5. è¿”å›ç»“æœ

**å‰ç«¯äº¤äº’**:
- **å‘¨æœŸé€‰æ‹©**: 3/5/7/10/14/20å¤©
- **å‰Nåé€‰æ‹©**: 100/200/400/600/800/1000
- **æ—¥æœŸé€‰æ‹©**: æŒ‡å®šç»“æŸæ—¥æœŸ

**ä½¿ç”¨åœºæ™¯**:
- **çŸ­çº¿**: 3å¤© + å‰100å â†’ æœ€è¿‘æœ€ç«
- **ä¸­çº¿**: 7å¤© + å‰400å â†’ æŒç»­çƒ­é—¨
- **é•¿çº¿**: 14å¤© + å‰800å â†’ ç¨³å®šå…³æ³¨

---

### 6.2 è¡Œä¸šåŠ æƒçƒ­åº¦åˆ†æ â­

**åŠŸèƒ½**: é€šè¿‡åŠ æƒç®—æ³•åˆ†æè¡Œä¸šçƒ­åº¦

**å››ä¸ªç»´åº¦**:
1. **B1 (æ€»çƒ­åº¦)**: `Î£(1/rank^k)`
   - å«ä¹‰: ç²¾è‹±æ•°é‡
   - åœºæ™¯: è¿½çƒ­ç‚¹
   
2. **B2 (å¹³å‡çƒ­åº¦)**: `B1 / è‚¡ç¥¨æ•°`
   - å«ä¹‰: ç²¾è‹±å¯†åº¦
   - åœºæ™¯: æŒ–æ½œåŠ›
   
3. **C1 (æ€»åˆ†æ•°)**: `Î£(total_score)`
   - å«ä¹‰: æ€»èƒ½é‡
   - åœºæ™¯: çœ‹è¶‹åŠ¿
   
4. **C2 (å¹³å‡åˆ†æ•°)**: `C1 / è‚¡ç¥¨æ•°`
   - å«ä¹‰: å¹³å‡è´¨é‡
   - åœºæ™¯: é€‰è‚¡

**kå€¼è¯´æ˜**:
- **0.382**: å¹¿è§’é•œå¤´ï¼Œçœ‹å…¨å±€
- **0.618**: é»„é‡‘åˆ†å‰²ï¼Œå¹³è¡¡æ¨¡å¼ (æ¨è)
- **1.0**: æ ‡å‡†å€’æ•°
- **1.618**: é•¿ç„¦é•œå¤´ï¼Œåªçœ‹å¤´éƒ¨

**ä¸æ—§ç‰ˆå¯¹æ¯”**:
| ç»´åº¦ | æ—§ç‰ˆ | æ–°ç‰ˆ |
|------|------|------|
| æ•°æ®èŒƒå›´ | å‰1000/2000/3000/5000 | å…¨éƒ¨æ•°æ® |
| è®¡ç®—æ–¹å¼ | ç¡¬åˆ‡åˆ† | å¹³æ»‘è¡°å‡ |
| åˆ†æç»´åº¦ | 1ä¸ª | 4ä¸ª |
| å‚æ•°è°ƒèŠ‚ | å‰NåæŒ‰é’® | kå€¼æ»‘å— |

---

### 6.3 æ¿å—è¶‹åŠ¿åˆ†æ

**åŠŸèƒ½**: æŸ¥çœ‹æ¿å—æ’åã€è¶‹åŠ¿ã€è¯¦æƒ…

**ä¸»è¦åŠŸèƒ½**:
1. **æ¿å—æ’å**: å½“å‰æ’åå‰Nçš„æ¿å—
2. **è¶‹åŠ¿å›¾**: å¤šæ—¥æ’åå˜åŒ–è¶‹åŠ¿
3. **æ’åå¯¹æ¯”**: ä¸¤ä¸ªæ—¥æœŸçš„æ’åå˜åŒ–
4. **æ¿å—è¯¦æƒ…**: å•ä¸ªæ¿å—çš„å†å²æ•°æ®

**ä½¿ç”¨åœºæ™¯**:
- æ‰¾å½“å‰æœ€å¼ºæ¿å—
- è¿½è¸ªæ¿å—è½®åŠ¨
- åˆ†ææ¿å—æŒç»­æ€§

---

### 6.4 æ’åè·³å˜æ£€æµ‹

**åŠŸèƒ½**: æ£€æµ‹æ’åå‰§çƒˆè·³å˜çš„è‚¡ç¥¨

**ç®—æ³•**:
1. è·å–æœ€æ–°ä¸¤å¤©çš„æ•°æ®
2. å¯¹æ¯åªè‚¡ç¥¨ï¼Œè®¡ç®—æ’åå˜åŒ–
3. ç­›é€‰å˜åŒ–è¶…è¿‡é˜ˆå€¼çš„è‚¡ç¥¨
4. æŒ‰è·³å˜å¹…åº¦æ’åº

**ä½¿ç”¨åœºæ™¯**:
- æ•æ‰çªç„¶çˆ†å‘çš„è‚¡ç¥¨
- é¢„è­¦æ’åå¼‚å¸¸å˜åŒ–
- å¯»æ‰¾çŸ­çº¿æœºä¼š

**æ³¨æ„äº‹é¡¹**:
- è·³å˜å¯èƒ½æ˜¯çœŸå®çªç ´
- ä¹Ÿå¯èƒ½æ˜¯æ•°æ®å¼‚å¸¸
- éœ€è¦ç»“åˆåŸºæœ¬é¢åˆ¤æ–­

---

### 6.5 ç¨³æ­¥ä¸Šå‡æ£€æµ‹

**åŠŸèƒ½**: æ£€æµ‹è¿ç»­Nå¤©æ’åç¨³æ­¥æå‡çš„è‚¡ç¥¨

**ç®—æ³•**:
1. è·å–æœ€è¿‘Nå¤©çš„æ•°æ®
2. å¯¹æ¯åªè‚¡ç¥¨ï¼Œæ£€æŸ¥æ’åæ˜¯å¦è¿ç»­æå‡
3. è®¡ç®—æ€»æå‡å¹…åº¦å’Œæ—¥å‡æå‡
4. ç­›é€‰æå‡è¶…è¿‡é˜ˆå€¼çš„è‚¡ç¥¨

**ä½¿ç”¨åœºæ™¯**:
- å¯»æ‰¾ç¨³å¥ä¸Šæ¶¨çš„è‚¡ç¥¨
- ä¸­é•¿çº¿å¸ƒå±€
- é¿å…è¿½é«˜

---

## 7. æ•°æ®æµç¨‹

### 7.1 æ•°æ®å¯¼å…¥æµç¨‹

```
Excelæ–‡ä»¶
  â†“
update_daily_data.py è„šæœ¬
  â†“
è¯»å–Excel â†’ è§£ææ•°æ® â†’ æ£€æŸ¥é‡å¤ â†’ æ’å…¥æ•°æ®åº“
  â†“
æ›´æ–°çŠ¶æ€æ–‡ä»¶ (data_import_state.json)
  â†“
æ—¥å¿—è®°å½•
```

**é‡è¦æ–‡ä»¶**:
- `update_daily_data.py`: æ•°æ®å¯¼å…¥è„šæœ¬
- `data/data_import_state.json`: è‚¡ç¥¨å¯¼å…¥çŠ¶æ€ (âš ï¸ä¸æäº¤)
- `data/sector_import_state.json`: æ¿å—å¯¼å…¥çŠ¶æ€ (âš ï¸ä¸æäº¤)

**é˜²é‡å¤æœºåˆ¶**:
- æ•°æ®åº“å±‚: UNIQUE INDEX (stock_code, date)
- åº”ç”¨å±‚: çŠ¶æ€æ–‡ä»¶è®°å½•å·²å¯¼å…¥æ—¥æœŸ

---

### 7.2 åº”ç”¨å¯åŠ¨æµç¨‹

```
1. å¯åŠ¨æ£€æŸ¥ (run_startup_checks)
   â”œâ”€ æ£€æŸ¥æ•°æ®åº“è¿æ¥
   â”œâ”€ æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
   â””â”€ éªŒè¯ç´¢å¼•å­˜åœ¨

2. é¢„åŠ è½½ç¼“å­˜ (preload_cache)
   â”œâ”€ åŠ è½½è‚¡ç¥¨åŸºç¡€ä¿¡æ¯ â†’ memory_cache
   â”œâ”€ åŠ è½½æ‰€æœ‰æ¯æ—¥æ•°æ® â†’ memory_cache
   â”œâ”€ åŠ è½½æ¿å—æ•°æ® â†’ memory_cache
   â””â”€ æ„å»ºæ—¥æœŸç´¢å¼•

3. åˆå§‹åŒ–æœåŠ¡
   â”œâ”€ æ³¨å†Œè·¯ç”±
   â””â”€ å¯åŠ¨Uvicorn

4. è¿è¡Œæ—¶
   â”œâ”€ L1: memory_cache (åŸºç¡€æ•°æ®)
   â”œâ”€ L2: TTLCache (è®¡ç®—ç»“æœ)
   â””â”€ L3: Database (ä¸è®¿é—®)
```

---

### 7.3 APIè¯·æ±‚æµç¨‹

```
å®¢æˆ·ç«¯è¯·æ±‚
  â†“
Nginxåå‘ä»£ç†
  â†“
FastAPIè·¯ç”±
  â†“
æœåŠ¡å±‚ (Service)
  â”œâ”€ æ£€æŸ¥TTLç¼“å­˜ (L2)
  â”‚   â”œâ”€ å‘½ä¸­ â†’ ç›´æ¥è¿”å›
  â”‚   â””â”€ æœªå‘½ä¸­ â†“
  â”œâ”€ ä»memory_cacheè·å–æ•°æ® (L1)
  â”œâ”€ æ‰§è¡Œä¸šåŠ¡é€»è¾‘è®¡ç®—
  â”œâ”€ å­˜å…¥TTLç¼“å­˜ (30åˆ†é’Ÿ)
  â””â”€ è¿”å›ç»“æœ
  â†“
å“åº”å®¢æˆ·ç«¯
```

---

## 8. éƒ¨ç½²æ¶æ„

### 8.1 ç”Ÿäº§ç¯å¢ƒæ¶æ„

```
[ç”¨æˆ·æµè§ˆå™¨]
     â†“
[Nginx :80/:443]
     â”œâ”€â”€ / â†’ Frontend (:3000/build)
     â””â”€â”€ /api â†’ Backend (:8000)
           â†“
     [FastAPI + Uvicorn]
           â†“
     [PostgreSQL :5432]
```

### 8.2 æœåŠ¡ç®¡ç†

**åç«¯**:
- è¿›ç¨‹ç®¡ç†: systemd
- æœåŠ¡å: `stock-backend.service`
- æ—¥å¿—: `logs/backend.log`

**å‰ç«¯**:
- é™æ€æ–‡ä»¶æœåŠ¡: serve æˆ– Nginxç›´æ¥æœåŠ¡
- ç¼–è¯‘äº§ç‰©: `frontend/build/`

---

### 8.3 é‡è¦é…ç½®æ–‡ä»¶

**ä¸èƒ½æäº¤åˆ°Gitçš„æ–‡ä»¶** âš ï¸:
```
backend/app/database.py        # æ•°æ®åº“å¯†ç 
backend/.env                   # ç¯å¢ƒå˜é‡
data/*.json                    # å¯¼å…¥çŠ¶æ€
logs/                          # æ—¥å¿—æ–‡ä»¶
```

**å¿…é¡»æäº¤åˆ°Gitçš„æ–‡ä»¶** âœ…:
```
frontend/build/                # ç¼–è¯‘äº§ç‰©
backend/app/database.py.example  # é…ç½®æ¨¡æ¿
.gitignore                     # Gitå¿½ç•¥è§„åˆ™
```

---

## 9. å…³é”®ç‰¹æ€§æ€»ç»“

### 9.1 æ€§èƒ½ä¼˜åŒ–

- âœ… ä¸‰å±‚ç¼“å­˜æ¶æ„
- âœ… å¯åŠ¨æ—¶å…¨é‡åŠ è½½
- âœ… è¿è¡Œæ—¶é›¶æ•°æ®åº“æŸ¥è¯¢
- âœ… TTLç¼“å­˜è‡ªåŠ¨è¿‡æœŸ
- âœ… æŸ¥è¯¢é€Ÿåº¦æå‡30-150å€

### 9.2 æ•°æ®å®‰å…¨

- âœ… é˜²é‡å¤å¯¼å…¥æœºåˆ¶
- âœ… çŠ¶æ€æ–‡ä»¶ç®¡ç†
- âœ… æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥
- âœ… é…ç½®æ–‡ä»¶éš”ç¦»

### 9.3 ç”¨æˆ·ä½“éªŒ

- âœ… å“åº”å¼è®¾è®¡
- âœ… å®æ—¶æ•°æ®æ›´æ–°
- âœ… å¤šç»´åº¦åˆ†æ
- âœ… å‹å¥½çš„é”™è¯¯æç¤º

---

## 10. ä¸‹ä¸€æ­¥è®¡åˆ’

1. âœ… å®Œæˆ (v0.2.5): ä¸‰å±‚ç¼“å­˜æ¶æ„
2. ğŸ”„ è®¡åˆ’ä¸­: ç§»åŠ¨ç«¯å®Œæ•´é€‚é…
3. ğŸ”„ è®¡åˆ’ä¸­: æ¿å—æˆåˆ†è‚¡åŠ æƒåˆ†æ
4. ğŸ”„ è®¡åˆ’ä¸­: æœ€æ–°çƒ­ç‚¹å­—æ®µå¢å¼º

---

**æ–‡æ¡£å®Œæˆ**  
**å¦‚æœ‰ç–‘é—®ï¼Œè¯·å‚è€ƒé¡¹ç›®å†…å…¶ä»–æ–‡æ¡£æˆ–å’¨è¯¢å¼€å‘è€…**
