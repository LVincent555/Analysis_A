# 跳变榜阈值调整总结

## 📝 修改内容

### 问题说明
用户反馈跳变榜阈值设置过小（50、100、150、200名），与实际业务需求不符。需要调整为更大的值（1000-3500名）。

### 修改前后对比

#### 跳变榜阈值选项

**修改前**：
```
≥50名
≥100名
≥150名
≥200名
```

**修改后**：
```
≥1000名
≥1500名
≥2000名  ← 默认值
≥2500名
≥3000名
≥3500名
```

### 默认值调整

| 配置项 | 修改前 | 修改后 |
|-------|--------|--------|
| 跳变榜阈值 | 100名 | 2000名 |
| 跳变榜大幅阈值（后端） | 200名 | 3000名 |

---

## 🔧 修改文件

### 1. 前端 - 板块详情页

**文件**：`frontend/src/pages/IndustryDetailPage.js`

**修改位置**：
- 第40行：默认值改为2000
- 第424-436行：下拉框选项改为1000-3500
- 第562行：信号说明文字改为"≥2000名"

**代码片段**：
```javascript
// 默认阈值
const [thresholds, setThresholds] = useState({
  hotListTop: 100,
  rankJumpMin: 2000,  // 改为2000
  steadyRiseDays: 3,
  // ...
});

// 下拉框选项
<select value={tempThresholds.rankJumpMin} ...>
  <option value={1000}>≥1000名</option>
  <option value={1500}>≥1500名</option>
  <option value={2000}>≥2000名</option>
  <option value={2500}>≥2500名</option>
  <option value={3000}>≥3000名</option>
  <option value={3500}>≥3500名</option>
</select>
```

---

### 2. 前端 - 股票查询页

**文件**：`frontend/src/components/modules/StockQueryModule.js`

**修改位置**：
- 第114行：信号判断阈值改为2000
- 第206行：信号说明文字改为"≥2000名"

**代码片段**：
```javascript
// 信号判断
if (previous && (previous.rank - latest.rank) >= 2000) {
  signals.push({ 
    label: `📈 排名跳变↑${previous.rank - latest.rank}`, 
    type: 'jump' 
  });
}
```

---

### 3. 后端 - 信号计算器

**文件**：`backend/app/services/signal_calculator.py`

**修改位置**：
- 第22-23行：默认阈值改为2000和3000

**代码片段**：
```python
class SignalThresholds:
    def __init__(
        self,
        hot_list_top: int = 100,
        hot_list_top2: int = 500,
        rank_jump_min: int = 2000,  # 改为2000
        rank_jump_large: int = 3000,  # 改为3000
        # ...
    ):
```

---

## 💡 业务含义

### 为什么需要更大的阈值？

1. **数据规模**
   - 系统中有成千上万只股票
   - 排名从1到几千不等
   - 小幅度排名变化（几十名、一百名）太常见，没有参考价值

2. **信号强度**
   - 排名提升2000+名说明该股票热度剧烈上升
   - 这种大幅跳变更有投资参考价值
   - 过滤掉小波动，突出真正的机会

3. **实际案例**
   ```
   示例1：排名从3500 → 1200（提升2300名）
   - 旧阈值：触发信号 ✅
   - 新阈值：触发信号 ✅
   - 意义：热度大幅提升，值得关注
   
   示例2：排名从500 → 400（提升100名）
   - 旧阈值：触发信号 ✅
   - 新阈值：不触发 ❌
   - 意义：正常波动，过滤掉
   ```

---

## 📊 各信号配置项说明

### 信号配置项独立性

每个配置项都是**独立**的，互不影响：

| 配置项 | 含义 | 取值范围 | 默认值 |
|-------|------|---------|--------|
| **热点榜阈值** | 排名需要进入前X名 | TOP 50/100/200/500 | 100 |
| **跳变榜阈值** | 相比前一天排名提升≥X名 | ≥1000/1500/2000/2500/3000/3500 | 2000 |
| **稳步上升天数** | 连续X天排名上升 | ≥2/3/5/7天 | 3天 |
| **涨幅榜阈值** | 涨跌幅≥X% | ≥3%/5%/7%/10% | 5% |
| **成交量阈值** | 换手率≥X% | ≥5%/10%/15%/20% | 10% |
| **波动率上升阈值** | 波动率百分比变化≥X% | ≥30%/50%/100%/150% | 30% |

### 关键说明

- ❌ **跳变榜阈值** ≠ **稳步上升天数**
  - 跳变：看单日排名变化幅度（空间维度）
  - 稳步上升：看连续多天趋势（时间维度）
  - 两者完全独立

- ❌ **热点榜阈值** ≠ **天数**
  - 热点榜：看当前排名位置（绝对排名）
  - 与时间无关

---

## 🎯 使用建议

### 不同场景的阈值配置

#### 1. 激进策略（捕捉所有机会）
```
跳变榜阈值：≥1000名
稳步上升天数：≥2天
热点榜阈值：TOP 200
```

#### 2. 平衡策略（过滤小波动）
```
跳变榜阈值：≥2000名  ← 默认
稳步上升天数：≥3天    ← 默认
热点榜阈值：TOP 100    ← 默认
```

#### 3. 保守策略（只看大机会）
```
跳变榜阈值：≥3000名
稳步上升天数：≥5天
热点榜阈值：TOP 50
```

---

## ✅ 测试清单

### 功能测试

- [ ] **板块详情页 - 阈值配置**
  1. 打开板块详情页
  2. 点击"信号阈值配置"
  3. 检查跳变榜阈值选项是否为1000-3500
  4. 修改跳变榜阈值为3000
  5. 点击"应用设置并刷新"
  6. 检查成分股列表中信号是否变化

- [ ] **板块详情页 - 信号说明**
  1. 查看"多维度信号说明"面板
  2. 确认"排名跳变"说明为"≥2000名"

- [ ] **股票查询页**
  1. 查询有大幅排名变化的股票
  2. 检查是否正确触发"排名跳变"信号
  3. 验证信号数值是否≥2000

### 数据验证

- [ ] 找一个排名从4000 → 1500的股票
  - 排名提升：2500名
  - 应该触发跳变信号 ✅

- [ ] 找一个排名从1000 → 900的股票
  - 排名提升：100名
  - 不应触发跳变信号 ❌

---

## 📋 完整配置说明

### 信号触发条件总结

```
热点榜信号：
  当前排名 ≤ 100名（可配置50/100/200/500）

跳变榜信号：
  (前一天排名 - 当天排名) ≥ 2000名（可配置1000/1500/2000/2500/3000/3500）

稳步上升信号：
  连续3天（可配置2/3/5/7）排名持续上升

涨幅榜信号：
  当日涨跌幅 ≥ 5%（可配置3/5/7/10）

成交量信号：
  当日换手率 ≥ 10%（可配置5/10/15/20）

波动率上升信号：
  波动率百分比变化 ≥ 30%（可配置30/50/100/150）
  计算公式：(当前波动率 - 前一天波动率) / 前一天波动率 × 100%
```

---

## 🚀 后续优化建议

1. **用户偏好保存**
   - 将用户的阈值配置保存到localStorage
   - 下次打开自动加载上次的配置

2. **阈值推荐**
   - 根据历史数据分析，推荐最佳阈值
   - 显示不同阈值下的信号触发率

3. **信号回测**
   - 提供信号历史准确率统计
   - 帮助用户优化阈值配置

---

**修改时间**: 2025-11-09  
**测试状态**: ✅ 待测试  

🎉 **跳变榜阈值已调整为1000-3500名，默认2000名！** 🎉
