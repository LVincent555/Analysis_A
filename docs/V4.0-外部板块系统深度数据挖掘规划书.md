# ğŸš€ V4.0 å¤–éƒ¨æ¿å—ç³»ç»Ÿ - æ·±åº¦æ•°æ®æŒ–æ˜ä¸å¯è§†åŒ–è§„åˆ’ä¹¦

**ç‰ˆæœ¬**: V4.0 (The "Squeeze Dry" Edition)  
**åˆ›å»ºæ—¥æœŸ**: 2025-12-11  
**çŠ¶æ€**: ğŸ”´ å¾…å®æ–½  
**æ ¸å¿ƒç›®æ ‡**: **æ¦¨å¹²ç°æœ‰æ•°æ®çš„æ¯ä¸€æ»´ä»·å€¼**ï¼Œä»ç®€å•çš„â€œçœ‹æ¦œå•â€å‡çº§ä¸ºâ€œçœ‹æ ¼å±€â€ã€â€œæ‰¾å…±æŒ¯â€ã€â€œæŠ“æ½œä¼â€ã€‚

---

## ğŸ›‘ ç¬¬ä¸€éƒ¨åˆ†ï¼šå·¥ç¨‹å¡«å‘ (å¿…åšçš„æ€§èƒ½ä¼˜åŒ–)

åœ¨åšé¡µé¢ä¹‹å‰ï¼Œå¿…é¡»å¼ºåˆ¶ä¿®æ­£ä»¥ä¸‹ **3 ä¸ªå·¥ç¨‹éšæ‚£**ï¼š

### 1.1 æ€§èƒ½åœ°é›·ï¼šè¶…çº§è¡¨æ ¼æ’åº
*   **é—®é¢˜**ï¼šV3.5 è¦æ±‚æŒ‰ `è´¡çŒ®åº¦ (contribution)` æ’åºã€‚ä½† `contribution` æ˜¯ä¸ªè®¡ç®—å­—æ®µ (`weight * score`)ã€‚å®æ—¶è®¡ç®—ä¼šå¯¼è‡´æ’åºç¼“æ…¢ã€‚
*   **æŒ‡ä»¤**ï¼šåœ¨ ETL é˜¶æ®µï¼ˆ`task_board_heat.py`ï¼‰ç›´æ¥è®¡ç®— `contribution_score` å¹¶å†™å…¥ `ext_board_daily_snap` ç‰©ç†è¡¨ï¼Œå»ºç«‹ç´¢å¼•ã€‚

### 1.2 äº¤äº’åœ°é›·ï¼šDNA å¡ç‰‡çš„ç®—åŠ›çˆ†ç‚¸
*   **é—®é¢˜**ï¼šå‰ç«¯ Hover è§¦å‘å®æ—¶æŸ¥è¯¢ä¼šå¯¼è‡´åç«¯å‹åŠ›è¿‡å¤§ã€‚
*   **æŒ‡ä»¤**ï¼šåœ¨ `cache_stock_board_signal` è¡¨ä¸­æ–°å¢ `dna_json` å­—æ®µï¼ŒETL æ—¶ç›´æ¥æŠŠåšå¥½çš„é¥¼å›¾æ•°æ®ã€Fallbackæ—¥å¿—å­˜è¿›å»ã€‚å‰ç«¯åªè´Ÿè´£è¯»ã€‚

### 1.3 é€»è¾‘åœ°é›·ï¼šå®½æŒ‡å™ªéŸ³åˆ†çº§
*   **æŒ‡ä»¤**ï¼šå¼•å…¥ **ç°åå• (Greylist)** æœºåˆ¶ã€‚
    *   **é»‘åå• (æƒé‡=0)**: èèµ„èåˆ¸, è½¬èé€š, æ·±è‚¡é€š, æ²ªè‚¡é€š, æ¸¯è‚¡é€š (å®Œå…¨ä¸çœ‹)
    *   **ç°åå• (æƒé‡=0.1)**: å¤§ç›˜è‚¡, ä¸­ç›˜è‚¡, å°ç›˜è‚¡, åˆ›ä¸šæ¿ç»¼, ä¸Šè¯180, HS300 (ä¿ç•™åº•è‰²ï¼Œä¸å–§å®¾å¤ºä¸»)

### 1.4 Sçº§é€šèƒ€ä¿®æ­£
*   **æŒ‡ä»¤**ï¼šä¸ªè‚¡ S/A/B çº§å¿…é¡»åŸºäº **å…¨å¸‚åœº 5000+ è‚¡ç¥¨** çš„ `FinalScore` åˆ†ä½å€¼ï¼Œä¸¥ç¦ä½¿ç”¨æ¿å—å†…æ’åã€‚

---

## ğŸ¨ ç¬¬äºŒéƒ¨åˆ†ï¼šè¿˜èƒ½åšä»€ä¹ˆï¼Ÿ(7 å¤§æ•°æ®æŒ–æ˜åˆ›æ„)

### 2.1 å®è§‚ä¸Šå¸è§†è§’ (Macro View)

#### ğŸ“º é¡µé¢ä¸€ï¼šå…¨å¸‚åœºçƒ­åŠ›äº‘å›¾ (Market Treemap)
*   **è®¾è®¡**ï¼šECharts Treemapã€‚
    *   **çŸ©å½¢é¢ç§¯** = **èµ„é‡‘æ€»é‡** (`c1_score_sum`)ã€‚
    *   **çŸ©å½¢é¢œè‰²** = **æ¿å—çƒ­åº¦** (`heat_pct`)ã€‚
*   **ä»·å€¼**ï¼šä¸€çœ¼è¯†åˆ«"å¤§ç¥¨æ­å°"è¿˜æ˜¯"å°ç¥¨å”±æˆ"ã€‚

#### ğŸ“º é¡µé¢äºŒï¼šå¸‚åœºä¿¡å·ä½“æ£€ä»ª (Market Signal Bar)
*   **è®¾è®¡**ï¼šæ¨ªå‘å †å æ¡å½¢å›¾ã€‚
    *   `[ â–ˆâ–ˆ Sçº§ (5%) ] [ â–ˆâ–ˆâ–ˆ Açº§ (15%) ] [ â–‘â–‘â–‘â–‘ åƒåœ¾æ—¶é—´ (80%) ]`
*   **é€»è¾‘**ï¼šç»Ÿè®¡å…¨å¸‚åœºè‚¡ç¥¨ `board_signal_level` åˆ†å¸ƒã€‚
*   **ç­–ç•¥**ï¼šSçº§å æ¯” > 5% è¿›æ”»ï¼›< 1% é˜²å®ˆã€‚

### 2.2 æ¿å—æ·±åº¦é€è§† (Sector Deep Dive)

#### ğŸ§­ é¡µé¢ä¸‰ï¼šæ¿å—é£æ ¼ç½—ç›˜ (Style Matrix)
*   **è®¾è®¡**ï¼šå››è±¡é™æ•£ç‚¹å›¾ã€‚
    *   Xè½´ï¼š**æ¿å—å¯†åº¦** (`b2_rank_avg`ï¼Œä»£è¡¨å¤´éƒ¨å¼ºåº¦)ã€‚
    *   Yè½´ï¼š**æ¿å—è´¨é‡** (`c2_score_avg`ï¼Œä»£è¡¨å¹³å‡åˆ†)ã€‚
*   **è±¡é™**ï¼šçœŸä¸»çº¿(å³ä¸Š)ã€å¦–è‚¡(å³ä¸‹)ã€ç™½é©¬(å·¦ä¸Š)ã€‚

#### ğŸ“‰ é¡µé¢å››ï¼šåˆ†æ­§ç›‘æµ‹ä»ª (Divergence Monitor)
*   **æ•°æ®**ï¼šæ¿å—å†…æˆåˆ†è‚¡ `TotalScore` çš„æ ‡å‡†å·®ã€‚
*   **é€»è¾‘**ï¼šçƒ­åº¦é«˜ + æ ‡å‡†å·®å¤§ = è§é¡¶åˆ†æ­§ã€‚

### 2.3 ä¸ªè‚¡æŒ–æ˜ç¥å™¨ (Stock Picking)

#### ğŸ¦ é¡µé¢äº”ï¼šâ€œåŒSçº§â€å…±æŒ¯çŒæ‰‹ (Pure Resonance)
*   **é€»è¾‘**ï¼š**è¡Œä¸šé˜²å®ˆ = Sçº§** **AND** **æ¦‚å¿µè¿›æ”» = Sçº§**ã€‚
*   **å±•ç¤º**ï¼šé«˜äº®åˆ—è¡¨ã€‚

#### ğŸ•µï¸ é¡µé¢å…­ï¼šéšå½¢å† å†›æŒ–æ˜æœº (Hidden Gems)
*   **é€»è¾‘**ï¼šæ¿å—çƒ­åº¦ Sçº§ + ä¸ªè‚¡è¯„åˆ† > 85 + ä¸ªè‚¡æ’å > 1000åã€‚
*   **å±•ç¤º**ï¼šè¡¥æ¶¨è‚¡ç¥¨æ± ã€‚

#### ğŸ§¬ é¡µé¢ä¸ƒï¼šèµ„é‡‘æµå‘æ¡‘åŸºå›¾ (Capital Sankey)
*   **è®¾è®¡**ï¼šSankey Diagramã€‚
*   **é€»è¾‘**ï¼šå·¦è¾¹è‚¡ç¥¨ -> å³è¾¹å…³è”æ¿å—ï¼Œçº¿å®½ = `share_weight`ã€‚

---

## âš™ï¸ ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ•°æ®åº“å˜æ›´ (Schema Changes)

### 3.1 æ–°å¢è¡¨: `board_blacklist`
```sql
CREATE TABLE IF NOT EXISTS board_blacklist (
    id SERIAL PRIMARY KEY,
    keyword VARCHAR(50) NOT NULL UNIQUE,
    level VARCHAR(20) DEFAULT 'BLACK', -- 'BLACK' or 'GREY'
    reason VARCHAR(100),
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 3.2 è¡¨ç»“æ„ä¿®æ”¹
```sql
-- ext_board_daily_snap
ALTER TABLE ext_board_daily_snap ADD COLUMN IF NOT EXISTS contribution_score DECIMAL(20,8);
CREATE INDEX IF NOT EXISTS idx_snap_contrib ON ext_board_daily_snap(board_id, date, contribution_score DESC);

-- cache_stock_board_signal
ALTER TABLE cache_stock_board_signal ADD COLUMN IF NOT EXISTS dna_json TEXT;
ALTER TABLE cache_stock_board_signal ADD COLUMN IF NOT EXISTS final_score_pct DECIMAL(10,8);
ALTER TABLE cache_stock_board_signal ADD COLUMN IF NOT EXISTS fallback_reason VARCHAR(100);

-- ext_board_heat_daily
ALTER TABLE ext_board_heat_daily ADD COLUMN IF NOT EXISTS score_stddev DECIMAL(10,4); -- ç”¨äºåˆ†æ­§ç›‘æµ‹
```

---

## ğŸ“ ç¬¬å››éƒ¨åˆ†ï¼šå®æ–½è®¡åˆ’

### Phase 1: åç«¯æ ¸å¿ƒé‡æ„ (Day 1-2)
1.  æ‰§è¡Œæ•°æ®åº“è¿ç§» (V4.0 Schema).
2.  æ›´æ–° `task_board_heat.py` ETL é€»è¾‘:
    *   å®ç°é»‘/ç°åå•æƒé‡é€»è¾‘.
    *   è®¡ç®— `contribution_score` å¹¶å†™å…¥.
    *   ç”Ÿæˆ `dna_json` å¹¶å†™å…¥.
    *   åŸºäºå…¨å¸‚åœºåˆ†ä½è®¡ç®— S/A/B.
    *   è®¡ç®—æ¿å—æ ‡å‡†å·® `score_stddev`.

### Phase 2: API å‡çº§ (Day 2)
1.  æ›´æ–° `get_board_detail` æ”¯æŒåŸºäºç‰©ç†å­—æ®µçš„åˆ†é¡µå’Œæ’åº.
2.  æ–°å¢ `get_market_treemap` æ¥å£.
3.  æ–°å¢ `get_market_signal_bar` æ¥å£.
4.  æ–°å¢ `get_sector_matrix` æ¥å£.
5.  æ–°å¢ `get_stock_mining` æ¥å£ (Resonance, Hidden Gems).

### Phase 3: å‰ç«¯å¯è§†åŒ–å¼€å‘ (Day 3-5)
1.  å¼€å‘ `MarketTreemap` & `MarketSignalBar` ç»„ä»¶.
2.  å¼€å‘ `SectorMatrix` & `DivergenceChart` ç»„ä»¶.
3.  é‡æ„ `BoardDeepDivePage` (ä½¿ç”¨æ–° API).
4.  å¼€å‘ `StockBoardDNACard` (ç›´æ¥è¯»å– dna_json).
5.  å¼€å‘æŒ–æ˜é¡µé¢.

---
**ä½¿ç”¨æŒ‡å—**: æœ¬æ–‡æ¡£åˆå¹¶äº† V3.5 å’Œ V4.0 çš„æ‰€æœ‰éœ€æ±‚ã€‚ä¼˜å…ˆæ‰§è¡Œ Phase 1ï¼Œç¡®ä¿æ•°æ®åŸºç¡€åšå®ã€‚
