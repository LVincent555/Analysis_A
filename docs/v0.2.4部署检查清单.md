# v0.2.4 éƒ¨ç½²æ£€æŸ¥æ¸…å•

## ç‰ˆæœ¬ä¿¡æ¯
- **ç‰ˆæœ¬å·ï¼š** v0.2.4
- **å‘å¸ƒæ—¥æœŸï¼š** 2025-11-08
- **ä¸»è¦ç‰¹æ€§ï¼š** æ¿å—æ•°æ®å…¨é‡ç¼“å­˜ã€æ™ºèƒ½å»é‡ç³»ç»Ÿ

> âš ï¸ **é‡è¦æç¤ºï¼š** è¯·å…ˆé˜…è¯» [æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.md](./æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—.md) äº†è§£éƒ¨ç½²æµç¨‹

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆéµå¾ªç°æœ‰æµç¨‹ï¼‰

### æœ¬åœ°æ“ä½œ
```bash
# 1. ç¼–è¯‘å‰ç«¯
cd frontend
npm run build

# 2. æäº¤ä»£ç ï¼ˆä½¿ç”¨deployç›®å½•ä¸‹çš„è„šæœ¬ï¼‰
cd ..
deploy\git_commit_v0.2.4.bat  # Windows
# æˆ–
bash deploy/git_commit_v0.2.4.sh  # Linux/Mac
```

### æœåŠ¡å™¨æ“ä½œ
```bash
# 1. SSHè¿æ¥
ssh root@60.205.251.109

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/stock_analysis_app

# 3. æ‹‰å–ä»£ç 
git pull origin main

# 4. ä¸€é”®éƒ¨ç½²
bash deploy_server.sh
```

---

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

### 1. æ•°æ®åº“å‡†å¤‡ âœ…ï¼ˆå·²å®Œæˆï¼‰

- [x] åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„
- [x] ä¸Šä¼  data æ–‡ä»¶å¤¹å†…å®¹
- [ ] éªŒè¯æ•°æ®åº“è¿æ¥é…ç½®

**æ£€æŸ¥å‘½ä»¤ï¼š**
```bash
# è¿æ¥æ•°æ®åº“éªŒè¯
psql -h 192.168.182.128 -U postgres -d db_20251106_analysis_a -c "SELECT COUNT(*) FROM stocks;"
psql -h 192.168.182.128 -U postgres -d db_20251106_analysis_a -c "SELECT COUNT(*) FROM daily_stock_data;"
psql -h 192.168.182.128 -U postgres -d db_20251106_analysis_a -c "SELECT COUNT(*) FROM daily_sector_data;"
```

**é¢„æœŸç»“æœï¼š**
- stocks è¡¨ï¼šçº¦ 5,435 æ¡
- daily_stock_data è¡¨ï¼šçº¦ 27,145 æ¡
- daily_sector_data è¡¨ï¼šçº¦ 1,430 æ¡

---

### 2. é…ç½®æ–‡ä»¶æ£€æŸ¥

#### backend/app/database.py âš ï¸ é‡è¦
```python
# ç¡®è®¤æ•°æ®åº“è¿æ¥é…ç½®æ­£ç¡®
DATABASE_URL = "postgresql://postgres:your_password@192.168.182.128:5432/db_20251106_analysis_a"
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ•°æ®åº“åœ°å€æ­£ç¡®
- [ ] ç”¨æˆ·åå¯†ç æ­£ç¡®
- [ ] æ•°æ®åº“åç§°æ­£ç¡®
- [ ] é˜²ç«å¢™å·²å¼€æ”¾ 5432 ç«¯å£

#### backend/app/config.py
```python
# æ£€æŸ¥ CORS é…ç½®
ALLOWED_ORIGINS = [
    "http://localhost:3000",
    "http://your-domain.com",  # æ·»åŠ ç”Ÿäº§åŸŸå
]
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ·»åŠ æœåŠ¡å™¨åŸŸååˆ° ALLOWED_ORIGINS
- [ ] ç‰ˆæœ¬å·å·²æ›´æ–°ä¸º v0.2.4

---

### 3. æ•°æ®æ–‡ä»¶æ£€æŸ¥

**æœåŠ¡å™¨ data ç›®å½•ç»“æ„ï¼š**
```
data/
â”œâ”€â”€ 20251103_data_sma_feature_color.xlsx
â”œâ”€â”€ 20251104_data_sma_feature_color.xlsx
â”œâ”€â”€ 20251105_data_sma_feature_color.xlsx
â”œâ”€â”€ 20251105_allbk_sma_feature_color.xlsx
â”œâ”€â”€ 20251106_data_sma_feature_color.xlsx
â”œâ”€â”€ 20251106_allbk_sma_feature_color.xlsx
â”œâ”€â”€ 20251107_data_sma_feature_color.xlsx
â”œâ”€â”€ 20251107_allbk_sma_feature_color.xlsx
â”œâ”€â”€ data_import_state.json
â””â”€â”€ sector_import_state.json
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ‰€æœ‰ Excel æ–‡ä»¶å·²ä¸Šä¼ 
- [ ] JSON çŠ¶æ€æ–‡ä»¶å·²ä¸Šä¼ 
- [ ] æ–‡ä»¶æƒé™æ­£ç¡®ï¼ˆå¯è¯»ï¼‰

---

### 4. ä¾èµ–å®‰è£…

**åç«¯ä¾èµ–ï¼š**
```bash
cd backend
pip install -r requirements.txt
```

**å‰ç«¯ä¾èµ–ï¼š**
```bash
cd frontend
npm install
npm run build  # ç”Ÿäº§ç¯å¢ƒæ„å»º
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] Python ç‰ˆæœ¬ â‰¥ 3.8
- [ ] Node.js ç‰ˆæœ¬ â‰¥ 14
- [ ] æ‰€æœ‰ä¾èµ–å®‰è£…æˆåŠŸ

---

### 5. å¯åŠ¨æµ‹è¯•

#### åç«¯å¯åŠ¨
```bash
cd backend
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

**æ£€æŸ¥æ—¥å¿—ï¼š**
```
âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸
âœ… è‚¡ç¥¨æ€»æ•°: 5435
âœ… æ¿å—æ•°æ®è®°å½•: 1430
âœ… å…¨é‡å†…å­˜ç¼“å­˜å·²å°±ç»ª
âœ… åº”ç”¨å¯åŠ¨å®Œæˆï¼
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ— æŠ¥é”™ä¿¡æ¯
- [ ] æ•°æ®å¯¼å…¥æ£€æŸ¥é€šè¿‡
- [ ] å†…å­˜ç¼“å­˜åŠ è½½æˆåŠŸ
- [ ] API å¯è®¿é—®ï¼šhttp://æœåŠ¡å™¨IP:8000/docs

#### å‰ç«¯å¯åŠ¨
```bash
cd frontend
npm start  # å¼€å‘ç¯å¢ƒ
# æˆ–
serve -s build -p 3000  # ç”Ÿäº§ç¯å¢ƒ
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] å‰ç«¯é¡µé¢å¯è®¿é—®
- [ ] å¯ä»¥è¿æ¥åç«¯ API
- [ ] æ•°æ®æ­£å¸¸æ˜¾ç¤º

---

### 6. åŠŸèƒ½éªŒè¯

**å¿…æµ‹åŠŸèƒ½ï¼š**
- [ ] æœ€æ–°çƒ­ç‚¹ï¼šæ•°æ®æ˜¾ç¤ºæ­£å¸¸ï¼Œå‰ N åç­›é€‰å·¥ä½œ
- [ ] è¡Œä¸šè¶‹åŠ¿ï¼šå›¾è¡¨æ¸²æŸ“æ­£å¸¸ï¼Œæ•°æ®ç»Ÿè®¡å‡†ç¡®
- [ ] æ’åè·³å˜ï¼šè·³å˜æ£€æµ‹å·¥ä½œæ­£å¸¸
- [ ] ç¨³æ­¥ä¸Šå‡ï¼šè¿ç»­ä¸Šå‡å¤©æ•°è®¡ç®—æ­£ç¡®
- [ ] æ¿å—åˆ†æï¼šæ¿å—æ•°æ®æ˜¾ç¤ºæ­£å¸¸ï¼Œæ’åå‡†ç¡®

**æ–°åŠŸèƒ½éªŒè¯ï¼š**
- [ ] å¯åŠ¨æ—¶è‡ªåŠ¨å¯¼å…¥è‚¡ç¥¨å’Œæ¿å—æ•°æ®
- [ ] æ¿å—æ•°æ®å…¨é‡ç¼“å­˜å·¥ä½œæ­£å¸¸
- [ ] æ™ºèƒ½å»é‡åŠŸèƒ½æ­£å¸¸ï¼ˆæŸ¥çœ‹ JSON ä¸­çš„ dedup_infoï¼‰

---

### 7. æ€§èƒ½æ£€æŸ¥

**åç«¯æ€§èƒ½ï¼š**
```bash
# æŸ¥è¯¢å“åº”æ—¶é—´åº” < 100ms
curl -w "@curl-format.txt" -o /dev/null -s "http://localhost:8000/api/analysis/hot-spots"
```

**å†…å­˜ä½¿ç”¨ï¼š**
```bash
# å†…å­˜å ç”¨åº” < 500MB
ps aux | grep python
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] API å“åº”æ—¶é—´æ­£å¸¸
- [ ] å†…å­˜å ç”¨åˆç†
- [ ] CPU ä½¿ç”¨ç‡æ­£å¸¸

---

### 8. å®‰å…¨æ£€æŸ¥

**é…ç½®æ–‡ä»¶ï¼š**
- [ ] database.py å·²åŠ å…¥ .gitignoreï¼ˆä¸æäº¤åˆ° Gitï¼‰
- [ ] æ•æ„Ÿä¿¡æ¯å·²ä»ä»£ç ä¸­ç§»é™¤
- [ ] ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†å¯†ç 

**é˜²ç«å¢™ï¼š**
- [ ] ä»…å¼€æ”¾å¿…è¦ç«¯å£ï¼ˆ8000, 3000ï¼‰
- [ ] æ•°æ®åº“ç«¯å£ï¼ˆ5432ï¼‰ä»…å†…ç½‘è®¿é—®

---

### 9. æ—¥å¿—é…ç½®

**åç«¯æ—¥å¿—ï¼š**
```python
# backend/app/main.py
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('logs/app.log'),
        logging.StreamHandler()
    ]
)
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] æ—¥å¿—ç›®å½•å·²åˆ›å»º
- [ ] æ—¥å¿—è½®è½¬é…ç½®ï¼ˆé¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§ï¼‰

---

### 10. è¿›ç¨‹ç®¡ç†ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

**æ¨èä½¿ç”¨ PM2 æˆ– systemdï¼š**

**PM2 æ–¹å¼ï¼š**
```bash
# å®‰è£… PM2
npm install -g pm2

# åç«¯
pm2 start "uvicorn app.main:app --host 0.0.0.0 --port 8000" --name stock-backend

# å‰ç«¯ï¼ˆå¦‚æœéœ€è¦ï¼‰
pm2 start "serve -s build -p 3000" --name stock-frontend

# ä¿å­˜é…ç½®
pm2 save
pm2 startup
```

**systemd æ–¹å¼ï¼š**
```bash
# åˆ›å»ºæœåŠ¡æ–‡ä»¶
sudo nano /etc/systemd/system/stock-backend.service

[Unit]
Description=Stock Analysis Backend
After=network.target

[Service]
User=your_user
WorkingDirectory=/path/to/stock_analysis_app/backend
ExecStart=/usr/bin/python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000
Restart=always

[Install]
WantedBy=multi-user.target
```

**æ£€æŸ¥é¡¹ï¼š**
- [ ] è¿›ç¨‹ç®¡ç†å·¥å…·å·²é…ç½®
- [ ] è‡ªåŠ¨é‡å¯æœºåˆ¶å·²å¯ç”¨
- [ ] å¼€æœºè‡ªå¯åŠ¨å·²é…ç½®

---

## ğŸš€ éƒ¨ç½²å‘½ä»¤

### Git æäº¤
```bash
# 1. æŸ¥çœ‹ä¿®æ”¹
git status

# 2. æ·»åŠ æ–‡ä»¶
git add .

# 3. æäº¤
git commit -m "Release v0.2.4: æ¿å—æ•°æ®å…¨é‡ç¼“å­˜ã€æ™ºèƒ½å»é‡ç³»ç»Ÿ

ä¸»è¦æ›´æ–°ï¼š
- æ¿å—æ•°æ®å…¨é‡å†…å­˜ç¼“å­˜ï¼ŒæŸ¥è¯¢æ€§èƒ½ <1ms
- å¯åŠ¨æ—¶è‡ªåŠ¨å¯¼å…¥è‚¡ç¥¨å’Œæ¿å—æ•°æ®
- æ™ºèƒ½å»é‡ç³»ç»Ÿï¼ˆåŸºäºå…¨å±€ç¦»ç¾¤å€¼æ£€æµ‹ï¼‰
- å®Œå–„çš„æ•°æ®ä¸€è‡´æ€§æ£€éªŒ
- è¯¦ç»†çš„å»é‡æ—¥å¿—å’Œè¿½æº¯æœºåˆ¶

æŠ€æœ¯æ”¹è¿›ï¼š
- æ‰©å±• MemoryCacheManager æ”¯æŒæ¿å—æ•°æ®
- æ–°å¢ deduplicate_helper.py æ™ºèƒ½å»é‡æ¨¡å—
- æ”¹è¿› data_manager.py å¯åŠ¨æ£€æŸ¥é€»è¾‘
- å®Œå–„æ–‡æ¡£ï¼šæ™ºèƒ½å»é‡æŠ€æœ¯è¯¦è§£

Bug ä¿®å¤ï¼š
- ä¿®å¤ä¸´æ—¶åˆ—å¹²æ‰°é‡å¤æ£€æŸ¥çš„"ç¯ä¸‹é»‘"é—®é¢˜
- ä¿®å¤åˆ—åé€‚é…é—®é¢˜ï¼ˆæ”¯æŒ æ€»åˆ†/ç»¼åˆè¯„åˆ†/scoreï¼‰
"

# 4. æ‰“æ ‡ç­¾
git tag -a v0.2.4 -m "Release v0.2.4"

# 5. æ¨é€
git push origin main
git push origin v0.2.4
```

### æœåŠ¡å™¨éƒ¨ç½²
```bash
# 1. ç™»å½•æœåŠ¡å™¨
ssh user@your-server

# 2. æ‹‰å–æœ€æ–°ä»£ç 
cd /path/to/stock_analysis_app
git pull origin main

# 3. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœ‰æ–°å¢ï¼‰
cd backend
pip install -r requirements.txt

cd ../frontend
npm install

# 4. æ„å»ºå‰ç«¯ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
npm run build

# 5. é‡å¯æœåŠ¡
pm2 restart stock-backend
pm2 restart stock-frontend

# 6. æŸ¥çœ‹æ—¥å¿—
pm2 logs stock-backend --lines 100
```

---

## ğŸ“Š éªŒè¯éƒ¨ç½²æˆåŠŸ

### å¥åº·æ£€æŸ¥
```bash
# åç«¯å¥åº·æ£€æŸ¥
curl http://your-server:8000/health

# é¢„æœŸè¿”å›ï¼š
{"status": "healthy"}

# API æ–‡æ¡£
è®¿é—®ï¼šhttp://your-server:8000/docs
```

### åŠŸèƒ½æµ‹è¯•
1. è®¿é—®å‰ç«¯é¡µé¢
2. æµ‹è¯•æ‰€æœ‰åŠŸèƒ½æ¨¡å—
3. æ£€æŸ¥æ•°æ®æ˜¾ç¤ºæ­£å¸¸
4. éªŒè¯æ¿å—ç¼“å­˜å·¥ä½œ

---

## âš ï¸ å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥
```
é”™è¯¯ï¼šcould not connect to server
è§£å†³ï¼šæ£€æŸ¥æ•°æ®åº“åœ°å€ã€ç«¯å£ã€é˜²ç«å¢™
```

### 2. å†…å­˜ä¸è¶³
```
é”™è¯¯ï¼šMemoryError
è§£å†³ï¼šå¢åŠ æœåŠ¡å™¨å†…å­˜æˆ–ä¼˜åŒ–ç¼“å­˜ç­–ç•¥
```

### 3. ç«¯å£è¢«å ç”¨
```
é”™è¯¯ï¼šAddress already in use
è§£å†³ï¼šæ›´æ”¹ç«¯å£æˆ–åœæ­¢å ç”¨è¿›ç¨‹
```

### 4. å‰ç«¯æ— æ³•è¿æ¥åç«¯
```
é”™è¯¯ï¼šCORS policy blocked
è§£å†³ï¼šæ£€æŸ¥ config.py ä¸­çš„ ALLOWED_ORIGINS
```

---

## ğŸ“ å›æ»šæ–¹æ¡ˆ

å¦‚æœéƒ¨ç½²å¤±è´¥ï¼Œå¿«é€Ÿå›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬ï¼š

```bash
# å›é€€ä»£ç 
git checkout v0.2.3

# é‡å¯æœåŠ¡
pm2 restart all

# éªŒè¯å›æ»šæˆåŠŸ
curl http://your-server:8000/health
```

---

## âœ… éƒ¨ç½²å®Œæˆç¡®è®¤

- [ ] æ‰€æœ‰æ£€æŸ¥é¡¹é€šè¿‡
- [ ] åŠŸèƒ½éªŒè¯å®Œæˆ
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] æ— æŠ¥é”™æ—¥å¿—
- [ ] ç”¨æˆ·å¯æ­£å¸¸è®¿é—®

**éƒ¨ç½²äººå‘˜ï¼š** _____________

**éƒ¨ç½²æ—¶é—´ï¼š** _____________

**å¤‡æ³¨ï¼š** _____________

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2025-11-08  
**ç»´æŠ¤äººï¼š** Cascade AI
