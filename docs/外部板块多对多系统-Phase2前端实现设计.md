# å¤–éƒ¨æ¿å—å¤šå¯¹å¤šç³»ç»Ÿ - Phase 2 å‰ç«¯å®Œæ•´å®ç°è®¾è®¡

**åˆ›å»ºæ—¶é—´**: 2025-12-11  
**å…³è”æ–‡æ¡£**: 
- [å¤šå¯¹å¤šç³»ç»Ÿè®¾è®¡ç®€ç¨¿.md](./å¤šå¯¹å¤šç³»ç»Ÿè®¾è®¡ç®€ç¨¿.md)
- [å¤–éƒ¨æ¿å—å¤šå¯¹å¤šç³»ç»Ÿ-å¼€å‘æ‰§è¡Œè®¡åˆ’.md](./å¤–éƒ¨æ¿å—å¤šå¯¹å¤šç³»ç»Ÿ-å¼€å‘æ‰§è¡Œè®¡åˆ’.md)

**çŠ¶æ€**: ğŸ“ è®¾è®¡ä¸­

---

## â— å…³é”®ä¿®æ­£ï¼ˆç¨€ç–å¿«ç…§é€‚é…ï¼‰

> **èƒŒæ™¯**: ç”±äºé‡‡ç”¨äº†â€œç¨€ç–å¿«ç…§ (Sparse Snapshot)â€ç­–ç•¥ï¼Œ`ext_board_daily_snap` è¡¨é‡Œçš„æ—¥æœŸæ˜¯ä¸è¿ç»­çš„ï¼ˆåªæœ‰çˆ¬è™«æ—¥æœ‰æ•°æ®ï¼‰ã€‚è¿™å¯¼è‡´åŸè®¾è®¡çš„ SQL è§†å›¾æ–¹æ¡ˆå­˜åœ¨è‡´å‘½ç¼ºé™·ã€‚

### ğŸ›‘ ä¿®æ­£ 1ï¼šåºŸå¼ƒ SQL è§†å›¾ï¼Œæ”¹ç”¨â€œç‰©ç†ç¼“å­˜è¡¨â€

**é—®é¢˜æ‰€åœ¨**ï¼š
- å¦‚æœç”¨ View å†™ `JOIN ... ON snap.date = stock.date`ï¼Œåœ¨éçˆ¬è™«æ—¥ï¼ˆå¦‚ 3-3, 3-4ï¼‰è§†å›¾ç»“æœä¸ºç©º
- å¦‚æœç”¨å­æŸ¥è¯¢æ‰¾â€œæœ€è¿‘æ—¥æœŸâ€ï¼Œå…¨è¡¨æ‰«æä¼šè®© API å“åº”ææ…¢

**ä¿®æ­£æ–¹æ¡ˆ**ï¼š

```sql
-- æ–°å»ºç‰©ç†è¡¨ cache_stock_board_signal
CREATE TABLE cache_stock_board_signal (
    trade_date          DATE NOT NULL,
    stock_code          VARCHAR(10) NOT NULL,
    
    -- ä¸ªè‚¡åŸºç¡€æ•°æ®ï¼ˆå†—ä½™å­˜å‚¨é¿å… JOINï¼‰
    stock_name          VARCHAR(50),
    market_rank         INT,              -- å½“æ—¥å…¨å¸‚åœºæ’å
    total_score         DECIMAL(10,4),    -- ä¸ªè‚¡æ€»åˆ†
    
    -- æ¿å—ä¿¡å·ç»“æœ
    signal_level        VARCHAR(4),       -- 'S' | 'A' | 'B' | 'NONE'
    final_score         DECIMAL(10,4),    -- åˆæˆåˆ†ï¼ˆè‚¡+æ¿å—å…±æŒ¯ï¼‰
    
    -- æœ€å¼ºé©±åŠ¨æ¿å—ï¼ˆå†—ä½™åç§°é¿å…äºŒæ¬¡æŸ¥è¯¢ï¼‰
    max_driver_board_id BIGINT,
    max_driver_name     VARCHAR(100),     -- å¦‚ "é”‚ç”µæ± "
    max_driver_type     VARCHAR(20),      -- 'industry' | 'concept'
    max_driver_heat_pct DECIMAL(10,8),    -- è¯¥æ¿å—çš„çƒ­åº¦åˆ†ä½
    
    -- è¡Œä¸šé˜²å®ˆçŠ¶æ€
    primary_industry_id BIGINT,           -- ä¸»è¥è¡Œä¸š board_id
    primary_industry_name VARCHAR(100),
    primary_industry_heat_pct DECIMAL(10,8),
    industry_safe       BOOLEAN,          -- è¡Œä¸šçƒ­åº¦ > safe_pct?
    
    -- å…ƒæ•°æ®
    board_count         INT,              -- è¯¥è‚¡å…³è”æ¿å—æ•°
    updated_at          TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    PRIMARY KEY (trade_date, stock_code)
);

CREATE INDEX idx_cache_signal_level ON cache_stock_board_signal(trade_date, signal_level);
CREATE INDEX idx_cache_score ON cache_stock_board_signal(trade_date, final_score DESC);
```

**ETL æµç¨‹ä¿®æ”¹**ï¼š
åœ¨ `task_board_heat.py` ç®—å‡ºæ¿å—çƒ­åº¦åï¼ŒPython å†…å­˜é‡Œå·²ç»æœ‰äº†ï¼ˆä¸ªè‚¡åˆ†æ•°ã€æ¿å—çƒ­åº¦ã€æ˜ å°„å…³ç³»ï¼‰ã€‚ç›´æ¥åœ¨å†…å­˜é‡Œé¡ºæ‰‹ç®—å‡ºæ¯åªè‚¡ç¥¨çš„ `FinalScore` å’Œ `S/A/B` è¯„çº§ï¼Œå†™å…¥ Cache è¡¨ã€‚

---

### âš ï¸ ä¿®æ­£ 2ï¼šID ä¸ Code çš„â€œç¿»è¯‘å±‚â€

**é—®é¢˜æ‰€åœ¨**ï¼š
- æ•°æ®åº“åº•å±‚å…¨æ˜¯ `board_id` (INT)
- å‰ç«¯è·¯ç”±å’Œç”¨æˆ·ä¹ æƒ¯æ˜¯ `board_code` (Stringï¼Œå¦‚ `BK0420`)

**ä¿®æ­£æ–¹æ¡ˆ**ï¼š

```python
# åç«¯ Service å±‚å¢åŠ æ˜ å°„é€»è¾‘
class BoardCodeMapper:
    def __init__(self, engine):
        self._code_to_id: Dict[str, int] = {}
        self._id_to_code: Dict[int, str] = {}
        self._id_to_name: Dict[int, str] = {}
        self._load_mapping(engine)
    
    def _load_mapping(self, engine):
        sql = "SELECT id, board_code, board_name FROM ext_board_list WHERE is_active = true"
        with engine.connect() as conn:
            for row in conn.execute(text(sql)):
                self._code_to_id[row.board_code] = row.id
                self._id_to_code[row.id] = row.board_code
                self._id_to_name[row.id] = row.board_name
    
    def code_to_id(self, code: str) -> Optional[int]:
        return self._code_to_id.get(code)
    
    def id_to_code(self, id: int) -> Optional[str]:
        return self._id_to_code.get(id)
```

**å·²åœ¨ Cache è¡¨ä¸­å†—ä½™å­˜å…¥ `max_driver_name`**ï¼Œå‰ç«¯æ‹¿åˆ°å°±èƒ½ç›´æ¥æ˜¾ç¤ºï¼Œä¸ç”¨äºŒæ¬¡æŸ¥è¯¢ã€‚

---

### ğŸ›¡ï¸ ä¿®æ­£ 3ï¼šä¸»è¥è¡Œä¸šçš„â€œå›æµâ€

**é—®é¢˜æ‰€åœ¨**ï¼š
- æ”»å®ˆåˆ†ç¦»é€»è¾‘è¦æ±‚ï¼šâ€œè‹¥ä¸»è¥è¡Œä¸šçƒ­åº¦ä½åˆ™ç†”æ–­â€
- ä¸»è¥è¡Œä¸šæ¥è‡ª `stocks.industry`ï¼Œä¸æ˜¯çˆ¬è™«çˆ¬çš„
- å¿…é¡»åœ¨ ETL ä¸­å°†ä¸»è¥è¡Œä¸šå†™å…¥ `ext_board_daily_snap`

**ç°çŠ¶æ£€æŸ¥**ï¼š
- âœ… `stocks.industry` æœ‰æ•°æ®ï¼ˆæ ¼å¼ï¼š`['åŠå¯¼ä½“']`ï¼‰
- âœ… `ext_board_list` æœ‰ 86 ä¸ªè¡Œä¸šæ¿å—
- â— éœ€ç¡®è®¤ ETL æ˜¯å¦åŒ…å«ä¸»è¥è¡Œä¸šå›æµé€»è¾‘

**ä¿®æ­£æ–¹æ¡ˆ**ï¼š

åœ¨ `task_board_heat.py` è®¡ç®—ä¸ªè‚¡ä¿¡å·æ—¶ï¼Œéœ€è¦ï¼š

```python
# 1. è¯»å– stocks è¡¨çš„ industry åˆ—
def load_stock_industries(self) -> Dict[str, int]:
    """åŠ è½½ä¸ªè‚¡ä¸»è¥è¡Œä¸šæ˜ å°„ {stock_code: industry_board_id}"""
    sql = """
    SELECT s.stock_code, b.id as industry_board_id
    FROM stocks s
    JOIN ext_board_list b ON b.board_name = TRIM(BOTH '[]''' FROM s.industry)
        AND b.board_type = 'industry'
    WHERE s.industry IS NOT NULL AND s.industry != '[]'
    """
    # è¿”å› {stock_code: industry_board_id}

# 2. è®¡ç®—ä¿¡å·æ—¶æ£€æŸ¥è¡Œä¸šçƒ­åº¦
def calc_stock_signal(self, stock_code, boards_heat, stock_industry_map):
    industry_id = stock_industry_map.get(stock_code)
    if industry_id:
        industry_heat = boards_heat.get(industry_id, {}).get('heat_pct', 0)
        industry_safe = industry_heat >= self.config.get('board_safe_pct', 0.3)
    else:
        industry_safe = True  # æ— è¡Œä¸šä¿¡æ¯æ—¶ä¸ç†”æ–­
    
    # å¦‚æœè¡Œä¸šä¸å®‰å…¨ï¼Œåº”ç”¨æƒ©ç½šç³»æ•°
    if not industry_safe:
        final_score *= self.config.get('board_penalty_unsafe', 0.5)
```

---

### âœ… ä¿®æ­£åçš„ Phase 2 æ‰§è¡ŒæŒ‡ä»¤

| æ­¥éª¤ | ä»»åŠ¡ | æ–‡ä»¶ |
|------|------|------|
| 1 | å»ºè¡¨ `cache_stock_board_signal` | `005_cache_stock_signal.sql` |
| 2 | æ‰©å±• ETLï¼šåŠ è½½ä¸»è¥è¡Œä¸š + è®¡ç®—ä¸ªè‚¡ä¿¡å· + å†™å…¥ Cache è¡¨ | `task_board_heat.py` |
| 3 | åç«¯ APIï¼šæŸ¥ Cache è¡¨ + ID/Code è½¬æ¢ | `board_heat.py` |
| 4 | å‰ç«¯ï¼šå¯¹æ¥ API å±•ç¤º `[S] æ¦‚å¿µå` æ ‡ç­¾ | `BoardSignalBadge.js` |

---

## ä¸€ã€é—®é¢˜é™ˆè¿°

Phase 1 åªå®Œæˆäº†ï¼š
- âœ… æ•°æ®åº“è¡¨ `ext_board_heat_daily`
- âœ… ETL è„šæœ¬ `task_board_heat.py`
- âœ… åç«¯ API `/api/board-heat/*`
- âœ… å‰ç«¯åˆ‡æ¢æŒ‰é’®ï¼ˆä»…é…ç½®é¡¹ï¼‰
- âœ… `BoardSignalBadge` ç»„ä»¶ï¼ˆæœªä½¿ç”¨ï¼‰

**ç¼ºå¤±çš„å…³é”®éƒ¨åˆ†**ï¼š
- âŒ æ–°ç‰ˆæ¿å—çƒ­åº¦é¡µé¢ï¼ˆ527æ¿å—ï¼Œå¤šå¯¹å¤šï¼‰
- âŒ ä¸ªè‚¡æ¿å—ä¿¡å·åœ¨åˆ—è¡¨ä¸­å±•ç¤º
- âŒ æ¿å—è¯¦æƒ…å¼¹çª—ï¼ˆçœŸå®æ¿å—ç‰ˆï¼‰
- âŒ åˆ‡æ¢å API è°ƒç”¨é€»è¾‘å˜æ›´
- âŒ æ”»å®ˆåˆ†ç¦»ä¿¡å·å±•ç¤º

---

## äºŒã€ç›®æ ‡æ¶æ„

### 2.1 æ•°æ®æºåˆ‡æ¢é€»è¾‘

```
ç”¨æˆ·é€‰æ‹© boardDataSource:
â”œâ”€â”€ 'dc' (åŸç‰ˆ)
â”‚   â”œâ”€â”€ è¡Œä¸šçƒ­åº¦é¡µé¢ â†’ åŸæœ‰ /api/industry/* API
â”‚   â”œâ”€â”€ ä¸ªè‚¡ä¿¡å· â†’ åŸæœ‰ sector_daily æ•°æ®
â”‚   â””â”€â”€ æ¿å—è¯¦æƒ… â†’ IndustryDetailDialog (87è¡Œä¸š)
â”‚
â””â”€â”€ 'eastmoney' (æ–°ç‰ˆ) ğŸ†•
    â”œâ”€â”€ æ¿å—çƒ­åº¦é¡µé¢ â†’ /api/board-heat/ranking (527æ¿å—)
    â”œâ”€â”€ ä¸ªè‚¡ä¿¡å· â†’ /api/board-heat/stock/{code} (å¤šå¯¹å¤š)
    â””â”€â”€ æ¿å—è¯¦æƒ… â†’ BoardDetailDialog (è¡Œä¸š+æ¦‚å¿µ)
```

### 2.2 æ–°å¢/ä¿®æ”¹æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `pages/ExtBoardHeat.js` | æ–°å¢ | å¤–éƒ¨æ¿å—çƒ­åº¦æ¦œé¡µé¢ |
| `components/BoardDetailDialog.js` | æ–°å¢ | æ¿å—è¯¦æƒ…å¼¹çª— |
| `components/BoardSignalBadge.js` | å·²æœ‰ | ä¿¡å·æ ‡ç­¾ç»„ä»¶ |
| `services/boardHeatService.js` | æ–°å¢ | æ¿å—çƒ­åº¦APIå°è£… |
| `pages/IndustryHeat.js` | ä¿®æ”¹ | æ ¹æ®æ•°æ®æºåˆ‡æ¢æ¸²æŸ“ |
| `components/StockListTable.js` | ä¿®æ”¹ | æ·»åŠ æ¿å—ä¿¡å·åˆ— |
| `App.js` | ä¿®æ”¹ | æ·»åŠ æ–°è·¯ç”± |
| `Sidebar.js` | ä¿®æ”¹ | æ·»åŠ æ–°èœå•é¡¹ |

---

## ä¸‰ã€æ ¸å¿ƒé¡µé¢è®¾è®¡

### 3.1 å¤–éƒ¨æ¿å—çƒ­åº¦æ¦œé¡µé¢ (`ExtBoardHeat.js`)

**è·¯ç”±**: `/board-heat`

**é¡µé¢ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š æ¿å—çƒ­åº¦æ’åï¼ˆä¸œè´¢å¤šå¯¹å¤šç‰ˆï¼‰     å…± 527 ä¸ªæ¿å— Â· 2025-12-10 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç­›é€‰: [å…¨éƒ¨â–¼] [è¡Œä¸š(86)] [æ¦‚å¿µ(441)]    æ’åº: [çƒ­åº¦â–¼] [æˆåˆ†è‚¡â–¼] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ”¥ çƒ­é—¨æ¿å— TOP 30                                   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  1. é…¿é…’è¡Œä¸š [è¡Œä¸š] â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 99.8%  37è‚¡ â”‚   â”‚
â”‚  â”‚  2. æ•°å­—è´§å¸ [æ¦‚å¿µ] â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  98.5%  65è‚¡ â”‚   â”‚
â”‚  â”‚  3. é”‚ç”µæ±    [æ¦‚å¿µ] â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   96.2% 128è‚¡ â”‚   â”‚
â”‚  â”‚  ...                                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  ç‚¹å‡»æ¿å— â†’ å¼¹å‡ºæ¿å—è¯¦æƒ…ï¼ˆæˆåˆ†è‚¡åˆ—è¡¨ + çƒ­åº¦æ›²çº¿ï¼‰            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒåŠŸèƒ½**:
1. **æ¿å—ç±»å‹ç­›é€‰**: å…¨éƒ¨ / è¡Œä¸š(86) / æ¦‚å¿µ(441)
2. **æ’åºæ–¹å¼**: çƒ­åº¦åˆ†ä½ / æˆåˆ†è‚¡æ•°é‡ / æ¿å—åç§°
3. **çƒ­åº¦æ¡å½¢å›¾**: ç±»ä¼¼åŸè¡Œä¸šçƒ­åº¦é¡µé¢çš„å¯è§†åŒ–
4. **ç‚¹å‡»äº¤äº’**: ç‚¹å‡»æ¿å— â†’ æ‰“å¼€ `BoardDetailDialog`

**API è°ƒç”¨**:
```javascript
// è·å–æ¿å—çƒ­åº¦æ¦œå•
const response = await apiClient.get('/api/board-heat/ranking', {
  params: {
    trade_date: selectedDate,
    board_type: filterType, // 'industry' | 'concept' | null
    limit: 50,
    offset: 0
  }
});
```

---

### 3.2 æ¿å—è¯¦æƒ…å¼¹çª— (`BoardDetailDialog.js`)

**è§¦å‘æ–¹å¼**: ç‚¹å‡»æ¿å—çƒ­åº¦æ¦œä¸­çš„ä»»æ„æ¿å—

**å¼¹çª—ç»“æ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”¥ é”‚ç”µæ±  [æ¦‚å¿µ]                               çƒ­åº¦: 96.2%  X â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ˆ çƒ­åº¦æŒ‡æ ‡                                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ B1(é¾™å¤´çƒ­åº¦): 12.5   B2(å¯†åº¦): 0.098                      â”‚ â”‚
â”‚ â”‚ C1(æ€»é‡çƒ­åº¦): 856.3  C2(å¹³å‡): 6.70                       â”‚ â”‚
â”‚ â”‚ æˆåˆ†è‚¡æ•°é‡: 128      æ•°æ®æ¥æº: ä¸œæ–¹è´¢å¯Œ                    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ æˆåˆ†è‚¡ TOP 20 (æŒ‰å¸‚åœºæ’å)                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æ’å  ä»£ç     åç§°      æ€»åˆ†    æ¿å—å†…æ’å  æ¿å—ä¿¡å·       â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚ â”‚  15  300750  å®å¾·æ—¶ä»£   89.5      1      [Sçº§ï½œé”‚ç”µæ± ]   â”‚ â”‚
â”‚ â”‚  28  002594  æ¯”äºšè¿ª     82.3      2      [Açº§ï½œæ–°èƒ½æºè½¦] â”‚ â”‚
â”‚ â”‚  45  300014  äº¿çº¬é”‚èƒ½   78.1      3      [Açº§ï½œé”‚ç”µæ± ]   â”‚ â”‚
â”‚ â”‚ ...                                                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**API è°ƒç”¨**:
```javascript
// è·å–æ¿å—è¯¦æƒ…
const response = await apiClient.get(`/api/board-heat/board/${boardId}`, {
  params: { trade_date: selectedDate }
});
```

---

### 3.3 ä¸ªè‚¡æ¿å—ä¿¡å·é›†æˆ

**ç›®æ ‡é¡µé¢**: 
- è‚¡ç¥¨æŸ¥è¯¢é¡µ (`StockQueryModule.js`)
- çƒ­ç‚¹æ¦œ (`HotListModule.js`)
- è¡Œä¸šè¯¦æƒ…å¼¹çª— (`IndustryDetailDialog.js`)

**å±•ç¤ºæ•ˆæœ**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»£ç     åç§°      æ¶¨è·Œå¹…   æ€»åˆ†   æ’å   ä¿¡å·                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 300750  å®å¾·æ—¶ä»£   +3.5%   89.5   15   [Sçº§ï½œé”‚ç”µæ± ] [çƒ­ç‚¹TOP50] â”‚
â”‚ 002594  æ¯”äºšè¿ª     +2.1%   82.3   28   [Açº§ï½œæ–°èƒ½æºè½¦] [è·³å˜]    â”‚
â”‚ 600519  è´µå·èŒ…å°   +1.8%   78.9   32   [Bçº§ï½œé…¿é…’è¡Œä¸š]           â”‚
â”‚ 000001  å¹³å®‰é“¶è¡Œ   +0.5%   45.2  156   (æ— æ¿å—ä¿¡å·)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ•°æ®è·å–é€»è¾‘**:

```javascript
// æ–¹æ¡ˆA: æ‰¹é‡è·å–ï¼ˆæ¨èï¼Œå‡å°‘è¯·æ±‚ï¼‰
// åœ¨åˆ—è¡¨æ•°æ®è¿”å›æ—¶ï¼Œåç«¯åŒæ—¶è¿”å›æ¿å—ä¿¡å·å­—æ®µ

// æ–¹æ¡ˆB: å•ç‹¬è¯·æ±‚ï¼ˆçµæ´»ä½†è¯·æ±‚å¤šï¼‰
const boardSignal = await apiClient.get(`/api/board-heat/stock/${stockCode}`);
```

**æ¡ä»¶æ¸²æŸ“**:
```jsx
{signalConfig.boardDataSource === 'eastmoney' && stock.board_signal_level !== 'NONE' && (
  <BoardSignalBadge
    level={stock.board_signal_level}
    label={stock.board_signal_label}
    type={stock.max_concept_board_type}
    heatPct={stock.max_concept_heat_pct}
    onClick={() => openBoardDetail(stock.max_concept_board_id)}
  />
)}
```

---

## å››ã€æ•°æ®æµè®¾è®¡

### 4.1 çŠ¶æ€ç®¡ç†

```
SignalConfigContext
â”œâ”€â”€ signalThresholds
â”‚   â”œâ”€â”€ boardDataSource: 'dc' | 'eastmoney'  // æ•°æ®æºåˆ‡æ¢
â”‚   â”œâ”€â”€ ... (å…¶ä»–åŸæœ‰é…ç½®)
â”‚
â””â”€â”€ æ–°å¢ boardHeatState (å¯é€‰ï¼Œç”¨äºç¼“å­˜)
    â”œâ”€â”€ rankingData: []      // æ¿å—æ¦œå•ç¼“å­˜
    â”œâ”€â”€ selectedBoard: null  // å½“å‰é€‰ä¸­æ¿å—
    â””â”€â”€ lastFetchDate: null  // ä¸Šæ¬¡è·å–æ—¥æœŸ
```

### 4.2 API æœåŠ¡å°è£… (`boardHeatService.js`)

```javascript
// services/boardHeatService.js

import apiClient from './api';

const boardHeatService = {
  // è·å–æ¿å—çƒ­åº¦æ¦œå•
  async getRanking(params = {}) {
    const { trade_date, board_type, limit = 50, offset = 0 } = params;
    return await apiClient.get('/api/board-heat/ranking', {
      params: { trade_date, board_type, limit, offset }
    });
  },

  // è·å–ä¸ªè‚¡æ¿å—ä¿¡å·
  async getStockSignal(stockCode, tradeDate) {
    return await apiClient.get(`/api/board-heat/stock/${stockCode}`, {
      params: { trade_date: tradeDate }
    });
  },

  // è·å–æ¿å—è¯¦æƒ…
  async getBoardDetail(boardId, tradeDate) {
    return await apiClient.get(`/api/board-heat/board/${boardId}`, {
      params: { trade_date: tradeDate }
    });
  },

  // è·å–å¯ç”¨æ—¥æœŸ
  async getAvailableDates() {
    return await apiClient.get('/api/board-heat/dates');
  }
};

export default boardHeatService;
```

---

## äº”ã€è·¯ç”±ä¸å¯¼èˆª

### 5.1 æ–°å¢è·¯ç”± (`App.js`)

```jsx
// åœ¨è¡Œä¸šè¶‹åŠ¿åˆ†æä¸‹æ–°å¢
<Route path="/board-heat" element={<ExtBoardHeat />} />
```

### 5.2 ä¾§è¾¹æ èœå• (`Sidebar.js`)

```jsx
// è¡Œä¸šè¶‹åŠ¿åˆ†æ å­èœå•
{
  icon: BarChart3,
  label: 'è¡Œä¸šè¶‹åŠ¿åˆ†æ',
  children: [
    { path: '/industry-quantity', label: 'è‚¡ç¥¨æ¿å—-ç›´æ¥æ•°é‡ç»Ÿè®¡' },
    { path: '/industry-heat', label: 'è‚¡ç¥¨æ¿å—-æƒå€¼çƒ­åº¦' },
    { path: '/dc-board-analysis', label: 'DCæ¿å—æ•°æ®åˆ†æ' },
    // ğŸ†• æ–°å¢
    { path: '/board-heat', label: 'ä¸œè´¢æ¿å—çƒ­åº¦æ¦œ', badge: 'NEW' },
  ]
}
```

---

## å…­ã€è§†è§‰è®¾è®¡è§„èŒƒ

### 6.1 BoardSignalBadge æ ·å¼

| ç­‰çº§ | èƒŒæ™¯è‰² | æ–‡å­—è‰² | è¯´æ˜ |
|------|--------|--------|------|
| Sçº§ | æ©™â†’ç²‰æ¸å˜ | ç™½è‰² | æœ€å¼ºä¿¡å·ï¼Œé†’ç›® |
| Açº§ | ç´«â†’ç²‰æ¸å˜ | ç™½è‰² | æ¬¡å¼ºä¿¡å· |
| Bçº§ | ç°è‰²åŠé€æ˜ | æµ…ç° | ä¸€èˆ¬ä¿¡å· |
| NONE | ä¸æ˜¾ç¤º | - | æ— ä¿¡å· |

### 6.2 æ¿å—ç±»å‹æ ‡è¯†

| ç±»å‹ | å›¾æ ‡ | é¢œè‰² |
|------|------|------|
| è¡Œä¸š | ğŸ­ | è“è‰²ç³» |
| æ¦‚å¿µ | ğŸ’¡ | ç´«è‰²ç³» |

### 6.3 çƒ­åº¦æ¡å½¢å›¾é…è‰²

```javascript
const heatColors = {
  hot: '#ef4444',    // çƒ­åº¦ > 80%
  warm: '#f97316',   // çƒ­åº¦ 50-80%
  normal: '#3b82f6', // çƒ­åº¦ 20-50%
  cold: '#6b7280'    // çƒ­åº¦ < 20%
};
```

---

## ä¸ƒã€å®æ–½è®¡åˆ’

### Phase 2.1: åŸºç¡€é¡µé¢ (é¢„è®¡ 2h)

| ä»»åŠ¡ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| 2.1.1 | `boardHeatService.js` | API æœåŠ¡å°è£… |
| 2.1.2 | `ExtBoardHeat.js` | æ¿å—çƒ­åº¦æ¦œé¡µé¢ |
| 2.1.3 | `App.js` + `Sidebar.js` | è·¯ç”±å’Œèœå• |

### Phase 2.2: è¯¦æƒ…å¼¹çª— (é¢„è®¡ 1.5h)

| ä»»åŠ¡ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| 2.2.1 | `BoardDetailDialog.js` | æ¿å—è¯¦æƒ…å¼¹çª— |
| 2.2.2 | `ExtBoardHeat.js` | é›†æˆå¼¹çª—äº¤äº’ |

### Phase 2.3: ä¸ªè‚¡ä¿¡å·é›†æˆ (é¢„è®¡ 2h)

| ä»»åŠ¡ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| 2.3.1 | åç«¯ API æ‰©å±• | åˆ—è¡¨æ¥å£è¿”å›æ¿å—ä¿¡å· |
| 2.3.2 | `StockListTable.js` | æ·»åŠ ä¿¡å·åˆ— |
| 2.3.3 | `HotListModule.js` | çƒ­ç‚¹æ¦œé›†æˆ |

### Phase 2.4: æ•°æ®æºåˆ‡æ¢è”åŠ¨ (é¢„è®¡ 1h)

| ä»»åŠ¡ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| 2.4.1 | `IndustryHeat.js` | æ ¹æ®é…ç½®åˆ‡æ¢æ•°æ®æº |
| 2.4.2 | å…¨å±€çŠ¶æ€ | åˆ‡æ¢åè‡ªåŠ¨åˆ·æ–° |

---

## å…«ã€åç«¯ API è¡¥å……éœ€æ±‚

ä¸ºäº†æ”¯æŒå‰ç«¯å±•ç¤ºï¼Œåç«¯éœ€è¦æ‰©å±•ä»¥ä¸‹åŠŸèƒ½ï¼š

### 8.1 æ‰¹é‡ä¸ªè‚¡ä¿¡å·æ¥å£ (æ–°å¢)

```
POST /api/board-heat/stocks/batch
Body: { stock_codes: ["000001", "300750", ...], trade_date: "2025-12-10" }

Response: {
  "stocks": [
    {
      "stock_code": "300750",
      "board_signal_level": "S",
      "board_signal_label": "é”‚ç”µæ± ",
      "max_concept_board_id": 123,
      "max_concept_heat_pct": 0.96,
      "industry_safe": true
    },
    ...
  ]
}
```

### 8.2 ç°æœ‰åˆ—è¡¨ API æ‰©å±•

åœ¨ `/api/analysis/hotlist` ç­‰æ¥å£çš„è¿”å›æ•°æ®ä¸­ï¼Œæ·»åŠ æ¿å—ä¿¡å·å­—æ®µï¼š

```json
{
  "stocks": [
    {
      "stock_code": "300750",
      "name": "å®å¾·æ—¶ä»£",
      "total_score": 89.5,
      // ... åŸæœ‰å­—æ®µ
      
      // ğŸ†• æ–°å¢æ¿å—ä¿¡å·å­—æ®µ (å½“ boardDataSource=eastmoney æ—¶å¡«å……)
      "board_signal_level": "S",
      "board_signal_label": "é”‚ç”µæ± ",
      "max_concept_board_id": 123
    }
  ]
}
```

---

## ä¹ã€å¾…ç¡®è®¤é—®é¢˜

1. **æ•°æ®æºåˆ‡æ¢æ˜¯å¦éœ€è¦å…¨å±€åˆ·æ–°ï¼Ÿ**
   - æ–¹æ¡ˆA: åˆ‡æ¢åè‡ªåŠ¨åˆ·æ–°æ‰€æœ‰å·²æ‰“å¼€é¡µé¢
   - æ–¹æ¡ˆB: ä»…æ–°è¯·æ±‚ä½¿ç”¨æ–°æ•°æ®æº

2. **æ¿å—ä¿¡å·æ˜¯å¦éœ€è¦ç¼“å­˜ï¼Ÿ**
   - å»ºè®®: å½“æ—¥æ•°æ®ç¼“å­˜åˆ° localStorageï¼Œé¿å…é‡å¤è¯·æ±‚

3. **åŸæœ‰è¡Œä¸šçƒ­åº¦é¡µé¢æ˜¯å¦ä¿ç•™ï¼Ÿ**
   - å»ºè®®: ä¿ç•™ï¼Œä½œä¸º"DCåŸç‰ˆ"æ¨¡å¼çš„å±•ç¤º

---

## åã€éªŒæ”¶æ ‡å‡†

- [ ] æ¿å—çƒ­åº¦æ¦œé¡µé¢å¯æ­£å¸¸åŠ è½½ 527 ä¸ªæ¿å—
- [ ] æ”¯æŒæŒ‰è¡Œä¸š/æ¦‚å¿µç­›é€‰
- [ ] ç‚¹å‡»æ¿å—å¯æ‰“å¼€è¯¦æƒ…å¼¹çª—
- [ ] ä¸ªè‚¡åˆ—è¡¨æ˜¾ç¤º `[Sçº§ï½œé”‚ç”µæ± ]` æ ‡ç­¾
- [ ] åˆ‡æ¢æ•°æ®æºåï¼Œç›¸å…³é¡µé¢æ•°æ®æºåˆ‡æ¢
- [ ] æ— æ¿å—ä¿¡å·æ—¶ä¸æ˜¾ç¤ºæ ‡ç­¾ï¼ˆNONEï¼‰
