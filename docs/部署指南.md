# æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ“¦ æœ¬æ¬¡æ›´æ–°å†…å®¹

### å‰ç«¯æ›´æ–°
- âœ… æœ€æ–°çƒ­ç‚¹æ¨¡å—ï¼šæ·»åŠ "åˆ†æè‚¡ç¥¨æ•°"é€‰æ‹©åŠŸèƒ½ï¼ˆå‰100/200/400/600/800/1000ä¸ªï¼‰
- âœ… è¡Œä¸šè¶‹åŠ¿åˆ†æï¼šæ·»åŠ "å‰Nå"é€‰æ‹©åŠŸèƒ½ï¼ˆå‰1000/2000/3000/5000åï¼‰
- âœ… æ’åè·³å˜æ¨¡å—ï¼šæ·»åŠ å‰ç«¯æœç´¢åŠŸèƒ½
- âœ… ç¨³æ­¥ä¸Šå‡æ¨¡å—ï¼šæ·»åŠ å‰ç«¯æœç´¢åŠŸèƒ½
- âœ… å·²ç¼–è¯‘ç”Ÿäº§ç‰ˆæœ¬ï¼š`frontend/build/` ç›®å½•

### åç«¯æ›´æ–°
- âœ… `/api/analyze/{period}` - æ·»åŠ  `top_n` å‚æ•°æ”¯æŒ
- âœ… `/api/industry/top1000` - æ·»åŠ  `limit` å‚æ•°æ”¯æŒ
- âœ… åˆ é™¤ä¸å¿…è¦çš„ç¼“å­˜æœºåˆ¶
- âœ… æ·»åŠ è¯¦ç»†çš„APIè¯·æ±‚æ—¥å¿—
- âœ… æ·»åŠ Cache-Controlå¤´ç¦ç”¨æµè§ˆå™¨ç¼“å­˜

---

## ğŸš€ æœ¬åœ°æ¨é€åˆ°GitHub

### 1. æ·»åŠ æ‰€æœ‰ä¿®æ”¹
```bash
cd "D:\ProgramLanguage\py\Test\å¤§Aæ•°æ®\2025å¹´11æœˆ\stock_analysis_app"
git add .
```

### 2. æäº¤ä¿®æ”¹
```bash
git commit -m "feat: æ·»åŠ å‰Nä¸ªè‚¡ç¥¨é€‰æ‹©åŠŸèƒ½å’Œè¡Œä¸šè¶‹åŠ¿å‰NååŠŸèƒ½

- å‰ç«¯: æœ€æ–°çƒ­ç‚¹æ·»åŠ åˆ†æè‚¡ç¥¨æ•°é€‰æ‹©(100/200/400/600/800/1000)
- å‰ç«¯: è¡Œä¸šè¶‹åŠ¿æ·»åŠ å‰Nåé€‰æ‹©(1000/2000/3000/5000)
- å‰ç«¯: æ’åè·³å˜å’Œç¨³æ­¥ä¸Šå‡æ·»åŠ æœç´¢åŠŸèƒ½
- åç«¯: APIæ·»åŠ top_nå’Œlimitå‚æ•°æ”¯æŒ
- åç«¯: ä¼˜åŒ–ç¼“å­˜å’Œæ—¥å¿—æœºåˆ¶
- å·²ç¼–è¯‘ç”Ÿäº§ç‰ˆæœ¬åˆ°frontend/build"
```

### 3. æ¨é€åˆ°GitHub
```bash
git push origin main
```

æˆ–è€…å¦‚æœæ˜¯å…¶ä»–åˆ†æ”¯ï¼š
```bash
git push origin <åˆ†æ”¯å>
```

---

## ğŸ–¥ï¸ æœåŠ¡å™¨éƒ¨ç½²æ­¥éª¤

### 1. SSHè¿æ¥åˆ°æœåŠ¡å™¨
```bash
ssh root@60.205.251.109
```

### 2. è¿›å…¥é¡¹ç›®ç›®å½•
```bash
cd /path/to/stock_analysis_app
```

### 3. æ‹‰å–æœ€æ–°ä»£ç 
```bash
git pull origin main
```

### 4. åœæ­¢ç°æœ‰æœåŠ¡
```bash
# åœæ­¢å‰ç«¯
pkill -f "serve.*build"

# åœæ­¢åç«¯
pkill -f "uvicorn.*app.main"
```

### 5. é‡å¯åç«¯æœåŠ¡
```bash
cd backend
nohup python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 > ../logs/backend.log 2>&1 &
cd ..
```

### 6. éƒ¨ç½²å‰ç«¯ï¼ˆä½¿ç”¨å·²ç¼–è¯‘çš„buildç›®å½•ï¼‰
```bash
cd frontend
# å¦‚æœæ²¡æœ‰å®‰è£…serveï¼Œå…ˆå®‰è£…
npm install -g serve

# å¯åŠ¨å‰ç«¯ï¼ˆåå°è¿è¡Œï¼‰
nohup serve -s build -l 3002 > ../logs/frontend.log 2>&1 &
cd ..
```

### 7. é…ç½®Nginxï¼ˆå¦‚æœä½¿ç”¨ï¼‰
ç¼–è¾‘ `/etc/nginx/sites-available/stock_analysis`ï¼š
```nginx
server {
    listen 80;
    server_name 60.205.251.109;

    # å‰ç«¯
    location / {
        proxy_pass http://localhost:3002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # åç«¯API
    location /api {
        proxy_pass http://localhost:8000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        # ç¦ç”¨ç¼“å­˜
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        add_header Pragma "no-cache";
        add_header Expires "0";
    }
}
```

é‡å¯Nginxï¼š
```bash
sudo nginx -t
sudo systemctl restart nginx
```

### 8. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥åç«¯
ps aux | grep uvicorn

# æ£€æŸ¥å‰ç«¯
ps aux | grep serve

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/backend.log
tail -f logs/frontend.log
```

---

## ğŸ§ª éªŒè¯éƒ¨ç½²

### 1. è®¿é—®åº”ç”¨
æµè§ˆå™¨è®¿é—®ï¼š`http://60.205.251.109`

### 2. æµ‹è¯•æ–°åŠŸèƒ½
- æœ€æ–°çƒ­ç‚¹ï¼šç‚¹å‡»ä¸åŒçš„"å‰Nä¸ª"æŒ‰é’®ï¼Œè§‚å¯Ÿè‚¡ç¥¨æ•°é‡å˜åŒ–
- è¡Œä¸šè¶‹åŠ¿ï¼šç‚¹å‡»ä¸åŒçš„"å‰Nå"æŒ‰é’®ï¼Œè§‚å¯Ÿæ•°æ®å˜åŒ–

### 3. é¢„æœŸç»“æœï¼ˆ2å¤©å‘¨æœŸï¼‰
| é€‰æ‹© | é¢„æœŸè‚¡ç¥¨æ•° |
|------|-----------|
| å‰100ä¸ª | ~2åª |
| å‰200ä¸ª | ~9åª |
| å‰400ä¸ª | ~35åª |
| å‰1000ä¸ª | ~144åª |

---

## ğŸ“ é‡è¦æç¤º

### æ–‡ä»¶æƒé™
ç¡®ä¿æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶æœ‰æ­£ç¡®çš„æƒé™ï¼š
```bash
chmod +x restart.sh
chmod +x start_backend.py
chmod +x start_frontend.py
```

### æ—¥å¿—ç›®å½•
ç¡®ä¿æ—¥å¿—ç›®å½•å­˜åœ¨ï¼š
```bash
mkdir -p logs
```

### é˜²ç«å¢™
ç¡®ä¿ç«¯å£å¼€æ”¾ï¼š
```bash
# å¦‚æœä½¿ç”¨ufw
sudo ufw allow 80
sudo ufw allow 8000
sudo ufw allow 3002
```

### å¼€æœºè‡ªå¯åŠ¨ï¼ˆå¯é€‰ï¼‰
åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶ï¼š

**åç«¯æœåŠ¡** `/etc/systemd/system/stock-backend.service`ï¼š
```ini
[Unit]
Description=Stock Analysis Backend
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/path/to/stock_analysis_app/backend
ExecStart=/usr/bin/python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000
Restart=always

[Install]
WantedBy=multi-user.target
```

**å‰ç«¯æœåŠ¡** `/etc/systemd/system/stock-frontend.service`ï¼š
```ini
[Unit]
Description=Stock Analysis Frontend
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/path/to/stock_analysis_app/frontend
ExecStart=/usr/local/bin/serve -s build -l 3002
Restart=always

[Install]
WantedBy=multi-user.target
```

å¯ç”¨æœåŠ¡ï¼š
```bash
sudo systemctl enable stock-backend
sudo systemctl enable stock-frontend
sudo systemctl start stock-backend
sudo systemctl start stock-frontend
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### åç«¯æ— æ³•å¯åŠ¨
```bash
# æ£€æŸ¥Pythonç‰ˆæœ¬
python3 --version

# æ£€æŸ¥ä¾èµ–
cd backend
pip3 install -r requirements.txt

# æ‰‹åŠ¨å¯åŠ¨æŸ¥çœ‹é”™è¯¯
python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### å‰ç«¯æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥serveæ˜¯å¦å®‰è£…
which serve

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 3002

# æ‰‹åŠ¨å¯åŠ¨
cd frontend
serve -s build -l 3002
```

### APIè¿”å›æ—§æ•°æ®
æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼š
- Chrome: `Ctrl + Shift + Delete`
- æˆ–åœ¨å¼€å‘è€…å·¥å…·Networkæ ‡ç­¾å‹¾é€‰"Disable cache"

---

**éƒ¨ç½²å®Œæˆåï¼Œè®°å¾—æµ‹è¯•æ‰€æœ‰æ–°åŠŸèƒ½ï¼**
