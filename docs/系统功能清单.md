# 股票分析系统 - 功能清单

**更新日期**: 2025-12-23  
**版本**: v0.6.0

---

## 一、核心分析功能

### 1.1 最新热点 (`hot-spots`)

**功能描述**: 分析重复出现的股票，找出持续活跃的热门股票

**筛选参数**:
| 参数 | 选项 | 说明 |
|------|------|------|
| 板块类型 | 主板/全部/北交所 | 主板排除300/301/688/920开头 |
| 分析周期 | 2/3/5/7/14天 | 股票必须在指定周期内重复出现 |
| 分析股票数 | 100-3000 | 只分析排名前N的股票 |

**数据来源**: `daily_stock_data` 表

---

### 1.2 排名跳变 (`rank-jump`)

**功能描述**: 找出排名大幅跃升的股票（从低位跳到高位）

**筛选参数**:
| 参数 | 选项 | 说明 |
|------|------|------|
| 板块类型 | 主板/全部/北交所 | - |
| 跳变阈值 | 1000/1500/2000/2500/3000名 | 向前跳变的最小名次 |

**数据来源**: `daily_stock_data` 表（对比前一日排名）

---

### 1.3 稳步上升 (`steady-rise`)

**功能描述**: 找出排名连续上升的股票（持续改善型）

**筛选参数**:
| 参数 | 选项 | 说明 |
|------|------|------|
| 板块类型 | 主板/全部/北交所 | - |
| 分析周期 | 2/3/5/7/14天 | 连续上升的天数 |
| 最小提升幅度 | 100/500/1000/2000名 | 总提升名次阈值 |

**数据来源**: `daily_stock_data` 表

---

### 1.4 单针下二十策略 (`needle-under-20`)

**功能描述**: 特定K线形态策略筛选（长下影线 + 低位）

**数据来源**: `daily_stock_data` 表

---

## 二、查询系统

### 2.1 股票查询 (`stock-query`)

**功能描述**: 查询个股历史数据和走势

**输入**: 股票代码（如 300750）

**输出**: 
- 个股基本信息
- 历史排名走势
- 各项指标详情

---

### 2.2 板块查询 (`industry-query`)

**功能描述**: 查询板块信息

**数据来源**: DC 87行业分类（原版）

---

### 2.3 当日DC数据 (`sector-query`)

**功能描述**: 查看当日DC原始数据

**数据来源**: `sector_daily` 表

---

### 2.4 当日股票排名 (`stock-ranking`)

**功能描述**: 查看当日全部股票排名列表

**数据来源**: `daily_stock_data` 表

---

## 三、行业趋势分析

### 3.1 股票板块-直接数量统计 (`industry-trend`)

**功能描述**: 统计各行业股票数量分布

**筛选参数**:
| 参数 | 选项 | 说明 |
|------|------|------|
| 数据范围 | 前1000/2000/3000 | 只统计排名前N的股票 |

**数据来源**: DC 87行业 (`sector_daily` 表)

---

### 3.2 股票板块-权值热度 (`industry-weighted`)

**功能描述**: 基于权重计算的行业热度排名

**算法**: 加权计算行业内股票的热度贡献

**数据来源**: DC 87行业

---

### 3.3 DC板块数据分析 (`sector-trend`)

**功能描述**: 分析DC板块趋势变化

**数据来源**: `sector_daily` 表

---

## 四、系统管理（仅管理员）

### 4.1 数据管理 (`admin`)

**功能描述**: 
- 导入CSV数据
- 管理数据日期
- 查看导入历史

---

### 4.2 外部板块同步 (`ext-board-sync`)

**功能描述**: 
- 同步东财板块数据
- 查看同步历史
- 运维统计
- **A股交易日自动对齐**: 非交易日自动回退到最近交易日

**数据来源**: 东方财富 API (AKShare)

---

### 4.3 板块热度计算 (`ext-board-heat-calc`) 🆕

**功能描述**: 
- 计算板块热度指标 (ETL)
- 支持指定日期/全部日期/强制重算
- 允许借用历史快照（应对数据缺失）
- 实时日志显示 + 任务取消
- **A股交易日自动对齐**: 非交易日自动回退到最近交易日

**参数**:
| 参数 | 说明 |
|------|------|
| 指定日期 | 计算特定日期的热度 |
| 计算全部日期 | 计算所有可用交易日 |
| 强制重算 | 覆盖已有数据 |
| 允许借用快照 | 数据缺失时使用最近快照 |

**API接口**:
| 接口 | 方法 | 说明 |
|------|------|------|
| `/api/admin/ext-boards/heat/calc` | POST | 触发计算任务 |
| `/api/admin/ext-boards/heat/status` | GET | 获取状态和日志 |
| `/api/admin/ext-boards/heat/cancel` | POST | 取消任务 |

**数据写入**: `ext_board_heat_daily`, `cache_stock_board_signal`

---

### 4.4 用户中心

| 模块 | 功能 |
|------|------|
| **用户管理** (`user-management`) | 用户CRUD、状态切换、密码重置 |
| **角色管理** (`role-management`) | 角色CRUD、权限分配 |
| **会话管理** (`session-management`) | 在线会话管理、强制下线 |
| **操作日志** (`operation-logs`) | 查询、导出操作日志 |
| **登录记录** (`user-login-history`) | 用户登录历史记录 |
| **用户登录设置** (`user-security-settings`) | 密码/登录/会话策略配置 |

---

### 4.5 系统配置 (`system-config`)

**功能描述**: 系统参数配置（占位）

---

## 五、新版板块系统 (Phase 2) 🆕

> **切换方式**: 通过 `SignalConfigPanel` 中的 `boardDataSource` 配置切换
> - `dc`: 原版（DC 87行业）
> - `eastmoney`: 新版（东财527板块）

### 5.1 板块热度榜 ✅

**功能描述**: 527个板块热度排名

**数据来源**: `ext_board_heat_daily` 表

**实现文件**: `ExtBoardHeat.js`

**切换影响**: 
- `dc` 模式 → 显示原版行业热度页面
- `eastmoney` 模式 → 显示新版板块热度榜

---

### 5.2 个股板块信号 ✅

**功能描述**: 在股票列表中显示 `[S级｜锂电池]` 标签

**数据来源**: `cache_stock_board_signal` 表

**切换影响**:
- `dc` 模式 → 不显示板块信号标签
- `eastmoney` 模式 → 显示板块信号标签

---

### 5.3 板块详情弹窗 ✅

**功能描述**: 点击板块显示成分股列表、统计卡片、4维指标

**实现文件**: `BoardDetailDialog.js`

**切换影响**: 仅在 `eastmoney` 模式下可用

---

### 5.4 板块完整分析页面 ✅

**功能描述**: 多维度信号说明(T1-T6)、成分股详细表格、历史趋势(待实现)、板块对比(待实现)

**实现文件**: `BoardAnalysisPage.js`

**切换影响**: 仅在 `eastmoney` 模式下可用

---

## 六、新旧版切换方案

### 6.1 切换配置

已在 `SignalConfigContext` 中实现 `boardDataSource` 配置：

```javascript
// 信号配置上下文
const signalConfig = {
  boardDataSource: 'dc',  // 'dc' | 'eastmoney'
  // ... 其他配置
};
```

### 6.2 切换入口

位置: `SignalConfigPanel.js` 中的切换按钮

### 6.3 受影响的模块

| 模块 | dc模式（原版） | eastmoney模式（新版） |
|------|---------------|---------------------|
| **行业热度页面** | 显示DC 87行业 | 显示东财527板块 |
| **股票列表** | 无板块信号标签 | 显示 `[S\|概念名]` 标签 |
| **板块详情** | 原版板块弹窗 | 新版板块弹窗 |
| **行业查询** | DC板块数据 | 东财板块数据 |

### 6.4 实现原则

1. **默认使用原版**: `boardDataSource` 默认值为 `'dc'`
2. **条件渲染**: 根据配置决定显示哪个版本
3. **API切换**: 根据配置调用不同的后端接口
4. **组件复用**: 尽量复用现有组件，通过 props 区分数据源

### 6.5 代码示例

```jsx
// 条件渲染示例
import { useSignalConfig } from '../contexts/SignalConfigContext';

function IndustryPage() {
  const { signalConfig } = useSignalConfig();
  
  if (signalConfig.boardDataSource === 'eastmoney') {
    return <ExtBoardHeat />;  // 新版527板块
  }
  
  return <IndustryTrendModule />;  // 原版DC 87行业
}

// 条件显示板块信号标签
{signalConfig.boardDataSource === 'eastmoney' && 
 stock.board_signal_level !== 'NONE' && (
  <BoardSignalBadge
    level={stock.board_signal_level}
    label={stock.board_signal_label}
  />
)}
```

---

## 七、数据库表对照

| 功能 | 原版表 | 新版表 |
|------|--------|--------|
| 板块列表 | `sectors` | `ext_board_list` |
| 每日数据 | `sector_daily` | `ext_board_daily_snap` |
| 热度计算 | - | `ext_board_heat_daily` |
| 个股信号 | - | `cache_stock_board_signal` |

---

## 八、实现进度

### 已完成 ✅
- [x] `ExtBoardHeat.js` - 东财板块热度榜页面
- [x] `BoardDetailDialog.js` - 板块详情弹窗（统计卡片+4维指标+TOP10成分股）
- [x] `BoardAnalysisPage.js` - 板块完整分析页面（多维度信号说明+成分股表格+历史趋势）
- [x] 后端API扩展 - 板块详情接口补充统计字段
- [x] HotSpotsModule 集成板块信号标签（基础）
- [x] 板块历史趋势图表
- [x] V4.0 全市场热力云图 (MarketTreemap)
- [x] V4.0 市场信号体检仪 (MarketSignalBar)
- [x] V4.0 板块风格罗盘 (SectorMatrix)
- [x] V4.0 智能掘金 (MiningList)
- [x] 板块热度计算 ETL 集成（后台管理 + API）
- [x] A股交易日自动对齐（同步/热度计算脚本）
- [x] 快照日期修复工具 (`fix_snap_date.py`)

### 待完成 ⏳
- [ ] 各列表模块完整集成板块信号标签（排名跳变、稳步上升等）
- [ ] 数据源切换后自动刷新数据
- [ ] BoardAnalysisPage 板块对比 Tab

