# å¹½çµåè®® (Project Ghost)
## è‡ªç­¾å HTTPS + SSL Pinning + æµé‡æ··æ·† å®‰å…¨æ–¹æ¡ˆ

> ç‰ˆæœ¬: 1.1.0  
> åˆ›å»ºæ—¥æœŸ: 2025-12-06  
> æ›´æ–°æ—¥æœŸ: 2025-12-06 (çº¢é˜Ÿå®¡æŸ¥ä¼˜åŒ–)  
> çŠ¶æ€: é¢„æ¡ˆè®¾è®¡ï¼ˆæœåŠ¡å™¨è¢«æ”»å‡»æ—¶å¯ç”¨ï¼‰

---

## ç›®å½•

1. [æ–¹æ¡ˆæ¦‚è¿°](#1-æ–¹æ¡ˆæ¦‚è¿°)
2. [å¨èƒåˆ†æ](#2-å¨èƒåˆ†æ)
3. [æ•´ä½“æ¶æ„](#3-æ•´ä½“æ¶æ„)
4. [è¯ä¹¦ä½“ç³»](#4-è¯ä¹¦ä½“ç³»)
5. [æœåŠ¡ç«¯æ”¹é€ ](#5-æœåŠ¡ç«¯æ”¹é€ )
6. [å®¢æˆ·ç«¯æ”¹é€ ](#6-å®¢æˆ·ç«¯æ”¹é€ )
7. [æµé‡æ··æ·†](#7-æµé‡æ··æ·†)
8. [éƒ¨ç½²æ¸…å•](#8-éƒ¨ç½²æ¸…å•)
9. [åº”æ€¥åˆ‡æ¢](#9-åº”æ€¥åˆ‡æ¢)
10. [çº¢é˜Ÿå®¡æŸ¥è¦ç‚¹](#10-çº¢é˜Ÿå®¡æŸ¥è¦ç‚¹)

---

## 1. æ–¹æ¡ˆæ¦‚è¿°

### 1.1 å½“å‰æ¶æ„é—®é¢˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç°æœ‰: HTTP + AES-256-GCM                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âš ï¸  é—®é¢˜:                                                       â”‚
â”‚  1. HTTP å…ƒæ•°æ®æš´éœ²ï¼ˆIPã€ç«¯å£ã€è¯·æ±‚æ—¶é—´ã€æ•°æ®åŒ…å¤§å°ï¼‰             â”‚
â”‚  2. ç™»å½•å¯†ç åœ¨ TLS éš§é“å¤–ä¼ è¾“                                   â”‚
â”‚  3. æ— ä¼ è¾“å±‚ä¿æŠ¤ï¼Œæ˜“å—ä¸­é—´äººæ”»å‡»                                 â”‚
â”‚  4. æµé‡ç‰¹å¾æ˜æ˜¾ï¼Œæ˜“è¢« DPI è¯†åˆ«                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ–¹æ¡ˆç›®æ ‡

| ç›®æ ‡ | æè¿° |
|------|------|
| **ä¼ è¾“å±‚åŠ å¯†** | TLS 1.3 åŠ å¯†æ‰€æœ‰æµé‡ |
| **è¯ä¹¦é”å®š** | SSL Pinning é˜²ä¸­é—´äºº |
| **æµé‡ä¼ªè£…** | éšæœº Padding ç ´åæŒ‡çº¹ |
| **åŒå±‚åŠ å¯†** | TLS + AES çºµæ·±é˜²å¾¡ |

### 1.3 æ•ˆæœå¯¹æ¯”

| ç‰¹å¾ | HTTPæ–¹æ¡ˆ | å¹½çµåè®® |
|------|---------|---------|
| ä¼ è¾“å±‚ | æ˜æ–‡ | TLS 1.3 |
| ä¸­é—´äººé˜²æŠ¤ | æ—  | SSL Pinning |
| æµé‡åˆ†æ | å¯è¯†åˆ« | éšæœºåŒ– |
| ç«¯å£æ‰«æ | æš´éœ²æœåŠ¡ | è¯ä¹¦é”™è¯¯ |

---

## 2. å¨èƒåˆ†æ

### 2.1 æ”»å‡»é¢

- **ç½‘ç»œç›‘å¬**: ISPã€å…¬å…±WiFiå¯æŠ“åŒ…
- **DNSåŠ«æŒ**: é‡å®šå‘åˆ°æ¶æ„æœåŠ¡å™¨
- **ä¸­é—´äººæ”»å‡»**: ç¯¡æ”¹è¯·æ±‚/å“åº”
- **æµé‡åˆ†æ**: DPIè¯†åˆ«é‡‘èæ•°æ®ç‰¹å¾

### 2.2 å½“å‰é˜²æŠ¤çŠ¶æ€

```
[âœ“] åº”ç”¨å±‚ AES-256-GCM
[âœ“] JWT Token è®¤è¯
[âœ“] ä¼šè¯å¯†é’¥åŠ¨æ€ç”Ÿæˆ
[âœ—] ä¼ è¾“å±‚åŠ å¯†
[âœ—] è¯ä¹¦éªŒè¯
[âœ—] æµé‡ä¼ªè£…
```

---

## 3. æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Electron å®¢æˆ·ç«¯                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ SSL Pinning â”‚  â”‚ AES-256-GCM â”‚  â”‚ æµé‡æ··æ·† (Padding)  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                          â–¼                                      â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚         â”‚   TLS 1.3 éš§é“ (è‡ªç­¾åè¯ä¹¦ 443ç«¯å£)  â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ HTTPS (å…¨åŠ å¯†)
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FastAPI æœåŠ¡ç«¯                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Uvicorn SSL â†’ AESè§£å¯† â†’ åŠ å¯†ç½‘å…³ â†’ ä¸šåŠ¡é€»è¾‘ â†’ AESåŠ å¯†    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. è¯ä¹¦ä½“ç³»

### 4.1 è¯ä¹¦å±‚çº§

```
è‡ªç­¾å CA æ ¹è¯ä¹¦ (10å¹´)
    â”œâ”€â”€ ä¸»æœåŠ¡å™¨è¯ä¹¦ Cert A (2å¹´) â”€â”€â”€ å½“å‰ä½¿ç”¨
    â”‚       â””â”€â”€ å®¢æˆ·ç«¯é¢„ç½®æŒ‡çº¹ A
    â””â”€â”€ å¤‡ç”¨æœåŠ¡å™¨è¯ä¹¦ Cert B (2å¹´) â”€â”€â”€ å†·å¤‡
            â””â”€â”€ å®¢æˆ·ç«¯é¢„ç½®æŒ‡çº¹ B
```

### 4.2 ğŸ”´ åŒæŒ‡çº¹ç­–ç•¥ (å…³é”®)

**é£é™©**ï¼šå¦‚æœåªé¢„ç½®ä¸€ä¸ªæŒ‡çº¹ï¼Œè¯ä¹¦è¿‡æœŸæˆ–ç§é’¥æ³„éœ²æ—¶ï¼Œæ‰€æœ‰æ—§ç‰ˆå®¢æˆ·ç«¯å°†æ— æ³•è¿æ¥ã€‚

**è§£å†³**ï¼šåŒæ—¶ç”Ÿæˆä¸¤å¥—è¯ä¹¦ï¼Œå®¢æˆ·ç«¯é¢„ç½®åŒæŒ‡çº¹ï¼š

```javascript
// ssl-pinning.js
const VALID_FINGERPRINTS = [
  'PRIMARY_FINGERPRINT',   // ä¸»è¯ä¹¦ (å½“å‰ä½¿ç”¨)
  'BACKUP_FINGERPRINT'     // å¤‡ç”¨è¯ä¹¦ (ç§é’¥ç¦»çº¿å†·å­˜å‚¨)
];

// éªŒè¯æ—¶
if (VALID_FINGERPRINTS.includes(serverFingerprint)) {
  callback(0);  // é€šè¿‡
}
```

**æ“ä½œæµç¨‹**ï¼š
1. ç”Ÿæˆä¸¤å¥—è¯ä¹¦ (Cert A + Cert B)
2. æœåŠ¡ç«¯éƒ¨ç½² Cert A
3. å®¢æˆ·ç«¯é¢„ç½® A å’Œ B çš„æŒ‡çº¹
4. Cert B ç§é’¥ç¦»çº¿å­˜å‚¨ (Uç›˜/ä¿é™©ç®±)
5. å¦‚æœ Cert A å‡ºäº‹ï¼ŒæœåŠ¡ç«¯æ¢ä¸Š Cert Bï¼Œå®¢æˆ·ç«¯æ— éœ€æ›´æ–°

### 4.3 ç”Ÿæˆå‘½ä»¤ (Linux/Mac)

```bash
# 1. ç”ŸæˆCAç§é’¥å’Œè¯ä¹¦
openssl genrsa -aes256 -out ca.key 4096
openssl req -new -x509 -days 3650 -key ca.key -sha256 -out ca.crt \
    -subj "/CN=Stock Analysis Root CA"

# 2. ç”ŸæˆæœåŠ¡å™¨ç§é’¥
openssl genrsa -out server.key 2048

# 3. åˆ›å»ºCSR
openssl req -new -key server.key -out server.csr \
    -subj "/CN=YOUR_SERVER_IP"

# 4. åˆ›å»ºæ‰©å±•é…ç½®
cat > ext.cnf << EOF
basicConstraints=CA:FALSE
subjectAltName=IP:YOUR_SERVER_IP,IP:127.0.0.1,DNS:localhost
EOF

# 5. ç­¾å‘æœåŠ¡å™¨è¯ä¹¦
openssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key \
    -CAcreateserial -out server.crt -days 730 -sha256 -extfile ext.cnf

# 6. è·å–æŒ‡çº¹ (ç”¨äºå®¢æˆ·ç«¯)
openssl x509 -in server.crt -noout -fingerprint -sha256
```

### 4.4 ç”Ÿæˆå‘½ä»¤ (Windows PowerShell)

```powershell
# éœ€è¦å…ˆå®‰è£… OpenSSL: winget install OpenSSL
# å‘½ä»¤åŒä¸Šï¼Œè·¯å¾„ä½¿ç”¨ Windows æ ¼å¼
```

### 4.5 æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ç”¨é€” | å­˜å‚¨ä½ç½® |
|-----|------|--------|
| `ca.key` | CAç§é’¥ | ç¦»çº¿ä¿ç®¡(Uç›˜åŠ å¯†) |
| `ca.crt` | CAè¯ä¹¦ | å¯é€‰åˆ†å‘ |
| `server_a.key/crt` | ä¸»è¯ä¹¦ | æœåŠ¡ç«¯ (å½“å‰ä½¿ç”¨) |
| `server_b.key/crt` | å¤‡ç”¨è¯ä¹¦ | **ç§é’¥ç¦»çº¿å†·å­˜å‚¨** |
| `fingerprints.txt` | åŒæŒ‡çº¹ | å®¢æˆ·ç«¯ä»£ç  |

---

## 5. æœåŠ¡ç«¯æ”¹é€ 

### 5.1 ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ certs/
â”‚   â”œâ”€â”€ server.key
â”‚   â””â”€â”€ server.crt
â””â”€â”€ run_ssl.py          # HTTPSå¯åŠ¨è„šæœ¬
```

### 5.2 HTTPSå¯åŠ¨è„šæœ¬

```python
# backend/run_ssl.py
import uvicorn
import os

SSL_ENABLED = os.getenv("ENABLE_HTTPS", "false").lower() == "true"

if __name__ == "__main__":
    config = {
        "app": "app.main:app",
        "host": "0.0.0.0",
        "port": 443 if SSL_ENABLED else 8000,
    }
    
    if SSL_ENABLED:
        config.update({
            "ssl_keyfile": "./certs/server.key",
            "ssl_certfile": "./certs/server.crt",
            "ssl_ciphers": "TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256",
        })
    
    uvicorn.run(**config)
```

### 5.3 ç¯å¢ƒå˜é‡

```bash
# .env
ENABLE_HTTPS=true
HTTPS_PORT=443
SSL_KEYFILE=./certs/server.key
SSL_CERTFILE=./certs/server.crt
```

---

## 6. å®¢æˆ·ç«¯æ”¹é€ 

### 6.1 SSL Pinning æ¨¡å—

åˆ›å»º `frontend-client/electron/ssl-pinning.js`:

```javascript
const { session } = require('electron');
const crypto = require('crypto');

// é…ç½®
const PINNED_HOSTS = ['YOUR_SERVER_IP', '127.0.0.1'];
const PINNED_FINGERPRINT = 'REPLACE_WITH_SHA256_FINGERPRINT';

function initSSLPinning() {
  session.defaultSession.setCertificateVerifyProc((req, callback) => {
    const { hostname, certificate, verificationResult } = req;
    
    if (PINNED_HOSTS.includes(hostname)) {
      // è®¡ç®—è¯ä¹¦æŒ‡çº¹
      const fp = crypto.createHash('sha256')
        .update(certificate.data)
        .digest('hex');
      
      if (fp.toLowerCase() === PINNED_FINGERPRINT.toLowerCase()) {
        console.log('âœ… SSL Pinning éªŒè¯é€šè¿‡');
        callback(0);  // æˆåŠŸ
      } else {
        console.error('âŒ SSL Pinning å¤±è´¥ï¼Œå¯èƒ½æ˜¯ä¸­é—´äººæ”»å‡»');
        callback(-2); // å¤±è´¥
      }
    } else {
      callback(verificationResult);
    }
  });
}

module.exports = { initSSLPinning };
```

### 6.2 ä¿®æ”¹ main.js

```javascript
// åœ¨ app.whenReady ä¸­æ·»åŠ 
const { initSSLPinning } = require('./ssl-pinning');

app.whenReady().then(async () => {
  // åˆå§‹åŒ– SSL Pinning (åˆ›å»ºçª—å£å‰)
  initSSLPinning();
  
  // ... å…¶ä»–ç°æœ‰ä»£ç 
});
```

### 6.3 ä¿®æ”¹ API URL

```javascript
// frontend-client/src/constants.js
const USE_HTTPS = process.env.REACT_APP_USE_HTTPS === 'true';
export const API_BASE_URL = USE_HTTPS 
  ? 'https://YOUR_SERVER_IP:443'
  : 'http://YOUR_SERVER_IP:8000';
```

---

## 7. æµé‡æ··æ·†

### 7.1 éšæœº Padding

**åç«¯** (`aes_handler.py`):
```python
import random, string

def add_noise(data: dict, min_len=50, max_len=500) -> dict:
    noise = ''.join(random.choices(
        string.ascii_letters + string.digits,
        k=random.randint(min_len, max_len)
    ))
    return {**data, '_noise': noise}

def strip_noise(data: dict) -> dict:
    data.pop('_noise', None)
    return data
```

**å‰ç«¯** (`crypto.js`):
```javascript
function addNoise(data, minLen=50, maxLen=500) {
  const len = Math.floor(Math.random() * (maxLen - minLen)) + minLen;
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  let noise = '';
  for (let i = 0; i < len; i++) {
    noise += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return { ...data, _noise: noise };
}
```

### 7.2 å¿ƒè·³ä¼ªè£…

```javascript
// éšæœºåŒ–å¿ƒè·³é—´éš” (25-35ç§’)
const interval = 30000 + (Math.random() * 2 - 1) * 5000;

// ä¼ªè£…å¿ƒè·³æ•°æ®
const heartbeat = {
  type: 'sync',
  data: { state: Math.random().toString(36) },
  _padding: generateNoise(100, 300)
};
```

---

## 8. éƒ¨ç½²æ¸…å•

### 8.1 æœåŠ¡ç«¯

- [ ] ç”Ÿæˆè‡ªç­¾åè¯ä¹¦
- [ ] å¤åˆ¶ `server.key`, `server.crt` åˆ° `backend/certs/`
- [ ] è®¾ç½®æƒé™: `chmod 600 server.key`
- [ ] åˆ›å»º `run_ssl.py`
- [ ] é…ç½®ç¯å¢ƒå˜é‡ `ENABLE_HTTPS=true`
- [ ] å¼€æ”¾é˜²ç«å¢™ 443 ç«¯å£

### 8.2 å®¢æˆ·ç«¯

- [ ] è·å–è¯ä¹¦æŒ‡çº¹
- [ ] åˆ›å»º `ssl-pinning.js`
- [ ] ä¿®æ”¹ `main.js` å¼•å…¥ SSL Pinning
- [ ] æ›´æ–° `constants.js` API URL
- [ ] å¤åˆ¶ `server.crt` åˆ° `assets/certs/` (å¯é€‰)
- [ ] é‡æ–°æ‰“åŒ…å®¢æˆ·ç«¯

### 8.3 æµ‹è¯•

- [ ] æœ¬åœ° HTTPS è¿æ¥æµ‹è¯•
- [ ] SSL Pinning éªŒè¯æµ‹è¯•
- [ ] è¯ä¹¦é”™è¯¯æ‹’ç»æµ‹è¯•
- [ ] æµé‡æŠ“åŒ…ç¡®è®¤åŠ å¯†

---

## 9. åº”æ€¥åˆ‡æ¢

### 9.1 å¿«é€Ÿåˆ‡æ¢è„šæœ¬

```bash
#!/bin/bash
# switch_to_ghost.sh - ä¸€é”®åˆ‡æ¢åˆ°å¹½çµåè®®

echo "ğŸ” æ­£åœ¨åˆ‡æ¢åˆ°å¹½çµåè®®..."

# 1. æ£€æŸ¥è¯ä¹¦
if [ ! -f "./certs/server.key" ]; then
    echo "âŒ ç¼ºå°‘è¯ä¹¦ï¼Œè¯·å…ˆè¿è¡Œè¯ä¹¦ç”Ÿæˆè„šæœ¬"
    exit 1
fi

# 2. æ›´æ–°ç¯å¢ƒå˜é‡
export ENABLE_HTTPS=true
export SECURITY_MODE=ghost

# 3. é‡å¯æœåŠ¡
echo "é‡å¯åç«¯æœåŠ¡..."
pkill -f "uvicorn"
python run_ssl.py &

echo "âœ… åˆ‡æ¢å®Œæˆï¼"
echo "   HTTPS: https://0.0.0.0:443"
```

### 9.2 å›æ»šè„šæœ¬

```bash
#!/bin/bash
# switch_to_http.sh - å›æ»šåˆ°HTTPæ¨¡å¼

export ENABLE_HTTPS=false
export SECURITY_MODE=development

pkill -f "uvicorn"
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 &

echo "âš ï¸  å·²åˆ‡æ¢å›HTTPæ¨¡å¼"
```

### 9.3 âš ï¸ å›æ»šé™åˆ¶è¯´æ˜

**é‡è¦**ï¼šå®¢æˆ·ç«¯çš„ `USE_HTTPS` æ˜¯**ç¼–è¯‘æ—¶å˜é‡**ã€‚

å¦‚æœå®¢æˆ·ç«¯å·²å‘ç‰ˆå¹¶å¼ºåˆ¶ HTTPS + Pinningï¼š
- æœåŠ¡ç«¯å›æ»šåˆ° HTTP åï¼Œ**æ—§å®¢æˆ·ç«¯å°†æ— æ³•è¿æ¥**
- å¿…é¡»é‡æ–°ç¼–è¯‘å¹¶åˆ†å‘å®¢æˆ·ç«¯

è¿™æ˜¯å®‰å…¨ä»£ä»·çš„é¢„æœŸè¡Œä¸ºã€‚è§£å†³æ–¹æ¡ˆï¼š
1. åŒæŒ‡çº¹ç­–ç•¥å¯åº”å¯¹è¯ä¹¦é—®é¢˜ï¼ˆæ— éœ€å›æ»šï¼‰
2. ä¿æŒæœåŠ¡ç«¯ HTTPSï¼Œåªéœ€æ›´æ¢è¯ä¹¦
3. ç´§æ€¥æƒ…å†µï¼šå‘å¸ƒæ–°ç‰ˆå®¢æˆ·ç«¯

---

## 10. çº¢é˜Ÿå®¡æŸ¥è¦ç‚¹

### 10.1 ğŸ”´ æŒ‡çº¹ç¡¬ç¼–ç æ­»é” (å·²è§£å†³)

**é£é™©**ï¼šå•æŒ‡çº¹å¯¼è‡´è¯ä¹¦è¿‡æœŸæ—¶å®¢æˆ·ç«¯å˜ç –

**è§£å†³**ï¼šåŒæŒ‡çº¹ç­–ç•¥ (è§ 4.2 èŠ‚)
- ä¸»è¯ä¹¦ + å¤‡ç”¨è¯ä¹¦
- å¤‡ç”¨ç§é’¥ç¦»çº¿å­˜å‚¨
- è¯ä¹¦å‡ºäº‹æ—¶æ— ç¼åˆ‡æ¢

### 10.2 âœ… SAN æ‰©å±•é…ç½®

**çŠ¶æ€**ï¼šå·²æ­£ç¡®é…ç½®

è¯ä¹¦å¿…é¡»åŒ…å« `subjectAltName`ï¼Œå¦åˆ™ç°ä»£æµè§ˆå™¨/Chromium ä¼šæ‹’ç»ï¼š
```
subjectAltName=IP:YOUR_SERVER_IP,IP:127.0.0.1,DNS:localhost
```

### 10.3 ğŸŸ¡ æµé‡è¾¹ç•Œæ•ˆåº” (å¯ä¼˜åŒ–)

**é—®é¢˜**ï¼šå°åŒ… Padding æœ‰æ•ˆï¼Œå¤§æ–‡ä»¶ä¼ è¾“ä»æœ‰ç‰¹å¾

**å½“å‰æ–¹æ¡ˆ**ï¼š50-500 å­—èŠ‚éšæœº Paddingï¼Œè¶³å¤Ÿåº”å¯¹åŸºç¡€æµé‡åˆ†æ

**æè‡´ä¼˜åŒ–** (åæœŸå¯é€‰)ï¼š
```javascript
// å¤§æ–‡ä»¶åˆ†ç‰‡ä¼ è¾“ + åŠ¨æ€å»¶è¿Ÿ
async function sendChunked(data, chunkSize = 8192) {
  const chunks = splitIntoChunks(data, chunkSize);
  for (const chunk of chunks) {
    await sendChunk(chunk);
    // éšæœºå»¶è¿Ÿ 10-50ms
    await sleep(Math.random() * 40 + 10);
  }
}
```

### 10.4 ğŸŸ¡ æ—¶é’Ÿåç§»é™·é˜±

**é—®é¢˜**ï¼šç³»ç»Ÿæ—¶é—´ä¸æœåŠ¡å™¨åå·®è¿‡å¤§ä¼šå¯¼è‡´ TLS æ¡æ‰‹å¤±è´¥

**è§£å†³**ï¼šç¡®ä¿æœåŠ¡å™¨å¼€å¯ NTP æ—¶é—´åŒæ­¥
```bash
# Linux
sudo systemctl enable --now chronyd
# æˆ–
sudo timedatectl set-ntp true
```

### 10.5 ğŸŸ¡ callback(-2) è¡Œä¸º

**Electron è¯ä¹¦éªŒè¯å›è°ƒ**ï¼š
- `callback(0)` = ä¿¡ä»»è¯ä¹¦
- `callback(-2)` = è¿æ¥å¤±è´¥ (ERR_FAILED)

**æ³¨æ„**ï¼šæŸäº› Chromium ç‰ˆæœ¬åœ¨æ—¶é’Ÿåç§»æ—¶ä¼šåœ¨ Pinning é€»è¾‘ä¹‹å‰å°±å¤±è´¥

---

## é™„å½•

### A. å®‰å…¨æ¨¡å¼å¯¹ç…§è¡¨

| æ¨¡å¼ | HTTPS | SSL Pinning | å™ªå£° | é€‚ç”¨åœºæ™¯ |
|-----|-------|-------------|-----|---------|
| development | âœ— | âœ— | âœ— | æœ¬åœ°å¼€å‘ |
| production | âœ“ | âœ“ | âœ— | æ­£å¸¸ç”Ÿäº§ |
| ghost | âœ“ | âœ“ | âœ“ | è¢«æ”»å‡»æ—¶ |

### B. è¯ä¹¦è½®æ¢

1. ç”Ÿæˆæ–°è¯ä¹¦ï¼ˆCAç­¾å‘ï¼‰
2. å®¢æˆ·ç«¯æ·»åŠ æ–°æŒ‡çº¹ï¼ˆåŒæŒ‡çº¹è¿‡æ¸¡æœŸï¼‰
3. æœåŠ¡ç«¯æ›´æ¢è¯ä¹¦
4. å®¢æˆ·ç«¯ç§»é™¤æ—§æŒ‡çº¹
5. å‘å¸ƒå®¢æˆ·ç«¯æ›´æ–°

### C. æ•…éšœæ’æŸ¥

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|-----|---------|---------|
| è¿æ¥è¢«æ‹’ç» | æŒ‡çº¹ä¸åŒ¹é… | æ£€æŸ¥è¯ä¹¦æŒ‡çº¹ |
| è¯ä¹¦é”™è¯¯ | è¯ä¹¦è¿‡æœŸ | æ›´æ¢è¯ä¹¦ |
| æ¡æ‰‹å¤±è´¥ | TLSç‰ˆæœ¬ä¸æ”¯æŒ | æ£€æŸ¥åŠ å¯†å¥—ä»¶ |

---

> æ–‡æ¡£ç‰ˆæœ¬: 1.1.0  
> æœ€åæ›´æ–°: 2025-12-06  
> ä½œè€…: Cascade AI  
> å®¡æŸ¥: çº¢é˜Ÿå®‰å…¨å®¡æŸ¥ä¼˜åŒ–
