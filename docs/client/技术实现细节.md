# æŠ€æœ¯å®ç°ç»†èŠ‚

> æœ¬æ–‡æ¡£è¡¥å……å¼€å‘æ–‡æ¡£ä¸­çš„æŠ€æœ¯ç»†èŠ‚ï¼Œä¾›å¼€å‘æ—¶å‚è€ƒ

---

## 1. APIè·¯å¾„åŠ å¯†æ–¹æ¡ˆè¯¦è§£

### 1.1 ä¸ºä»€ä¹ˆå¯ä»¥åŠ å¯†APIè·¯å¾„ï¼Ÿ

**åŸç†**: å°†æ‰€æœ‰ä¸šåŠ¡è¯·æ±‚ç»Ÿä¸€æ”¶æ•›åˆ°ä¸€ä¸ªç«¯ç‚¹ `/api/secure`ï¼ŒçœŸå®çš„APIè·¯å¾„ã€æ–¹æ³•ã€å‚æ•°å…¨éƒ¨æ”¾åœ¨åŠ å¯†çš„è¯·æ±‚ä½“ä¸­ã€‚

```
ä¼ ç»Ÿæ–¹å¼:
  GET  /api/analyze/3?board_type=main     â† è·¯å¾„æš´éœ²
  GET  /api/stock/000001                  â† è·¯å¾„æš´éœ²
  POST /api/industry/trend                â† è·¯å¾„æš´éœ²

åŠ å¯†æ–¹å¼:
  POST /api/secure  â† ç»Ÿä¸€å…¥å£ï¼Œçœ‹ä¸å‡ºçœŸå®æ„å›¾
  Body: { "data": "åŠ å¯†å†…å®¹" }
```

### 1.2 åŠ å¯†è¯·æ±‚ç»“æ„

```typescript
// åŠ å¯†å‰çš„è¯·æ±‚å¯¹è±¡
interface SecureRequest {
  path: string;           // çœŸå®APIè·¯å¾„ï¼Œå¦‚ "/api/analyze/3"
  method: "GET" | "POST" | "PUT" | "DELETE";
  params?: Record<string, any>;  // URLæŸ¥è¯¢å‚æ•°
  body?: any;             // POSTè¯·æ±‚ä½“
  timestamp: number;      // æ—¶é—´æˆ³ï¼Œé˜²é‡æ”¾
  nonce: string;          // éšæœºæ•°ï¼Œé˜²é‡æ”¾
}

// ç¤ºä¾‹
{
  "path": "/api/analyze/3",
  "method": "GET",
  "params": {
    "board_type": "main",
    "date": "2025-12-01"
  },
  "body": null,
  "timestamp": 1701410400000,
  "nonce": "abc123xyz"
}
```

### 1.3 åç«¯åŠ å¯†ç½‘å…³å®ç°

```python
# backend/app/routers/secure.py

from fastapi import APIRouter, Depends, HTTPException, Request
from fastapi.responses import JSONResponse
from pydantic import BaseModel
import time

from ..auth.dependencies import get_current_user, get_session_key
from ..crypto.aes_handler import AESCrypto

router = APIRouter(tags=["secure"])

class EncryptedRequest(BaseModel):
    data: str  # Base64ç¼–ç çš„AESåŠ å¯†æ•°æ®

class EncryptedResponse(BaseModel):
    data: str  # Base64ç¼–ç çš„AESåŠ å¯†å“åº”

# å†…éƒ¨è·¯ç”±æ˜ å°„è¡¨
ROUTE_HANDLERS = {}

def register_secure_route(path: str, method: str):
    """è£…é¥°å™¨ï¼šæ³¨å†Œå®‰å…¨è·¯ç”±"""
    def decorator(func):
        key = f"{method.upper()}:{path}"
        ROUTE_HANDLERS[key] = func
        return func
    return decorator

@router.post("/api/secure", response_model=EncryptedResponse)
async def secure_gateway(
    request: EncryptedRequest,
    user = Depends(get_current_user),
    session_key: bytes = Depends(get_session_key)
):
    """
    åŠ å¯†ç½‘å…³ï¼šæ‰€æœ‰ä¸šåŠ¡è¯·æ±‚çš„ç»Ÿä¸€å…¥å£
    """
    crypto = AESCrypto(session_key)
    
    try:
        # 1. è§£å¯†è¯·æ±‚
        decrypted = crypto.decrypt(request.data)
        
        # 2. éªŒè¯æ—¶é—´æˆ³ï¼ˆé˜²é‡æ”¾ï¼Œ5åˆ†é’Ÿå†…æœ‰æ•ˆï¼‰
        timestamp = decrypted.get("timestamp", 0)
        if abs(time.time() * 1000 - timestamp) > 300000:
            raise HTTPException(400, "è¯·æ±‚å·²è¿‡æœŸ")
        
        # 3. æå–è·¯ç”±ä¿¡æ¯
        path = decrypted["path"]
        method = decrypted["method"]
        params = decrypted.get("params", {})
        body = decrypted.get("body")
        
        # 4. æŸ¥æ‰¾å¤„ç†å‡½æ•°
        route_key = f"{method}:{path}"
        
        # æ”¯æŒè·¯å¾„å‚æ•°åŒ¹é…ï¼Œå¦‚ /api/stock/{code}
        handler = find_handler(route_key, path)
        if not handler:
            raise HTTPException(404, f"è·¯ç”±ä¸å­˜åœ¨: {path}")
        
        # 5. æ‰§è¡Œå¤„ç†å‡½æ•°
        result = await handler(user=user, params=params, body=body, path=path)
        
        # 6. åŠ å¯†å“åº”
        encrypted_response = crypto.encrypt(result)
        
        return EncryptedResponse(data=encrypted_response)
        
    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(500, f"å¤„ç†å¤±è´¥: {str(e)}")


def find_handler(route_key: str, path: str):
    """
    æŸ¥æ‰¾è·¯ç”±å¤„ç†å‡½æ•°ï¼Œæ”¯æŒè·¯å¾„å‚æ•°
    """
    # ç²¾ç¡®åŒ¹é…
    if route_key in ROUTE_HANDLERS:
        return ROUTE_HANDLERS[route_key]
    
    # è·¯å¾„å‚æ•°åŒ¹é…
    method = route_key.split(":")[0]
    for registered_key, handler in ROUTE_HANDLERS.items():
        reg_method, reg_path = registered_key.split(":", 1)
        if method != reg_method:
            continue
        
        # ç®€å•çš„è·¯å¾„å‚æ•°åŒ¹é…
        # /api/stock/{code} åŒ¹é… /api/stock/000001
        if match_path_pattern(reg_path, path):
            return handler
    
    return None


def match_path_pattern(pattern: str, path: str) -> bool:
    """
    åŒ¹é…è·¯å¾„æ¨¡å¼
    pattern: /api/stock/{code}
    path: /api/stock/000001
    """
    pattern_parts = pattern.split("/")
    path_parts = path.split("/")
    
    if len(pattern_parts) != len(path_parts):
        return False
    
    for p, v in zip(pattern_parts, path_parts):
        if p.startswith("{") and p.endswith("}"):
            continue  # è·¯å¾„å‚æ•°ï¼Œè·³è¿‡
        if p != v:
            return False
    
    return True
```

### 1.4 æ³¨å†Œç°æœ‰è·¯ç”±åˆ°åŠ å¯†ç½‘å…³

```python
# backend/app/routers/secure_routes.py
# å°†ç°æœ‰APIæ³¨å†Œåˆ°åŠ å¯†ç½‘å…³

from .secure import register_secure_route
from ..services.analysis_service_db import AnalysisService
from ..services.stock_service_db import StockService

# åˆ†æAPI
@register_secure_route("/api/analyze/{period}", "GET")
async def analyze_period(user, params, body, path):
    period = int(path.split("/")[-1])
    board_type = params.get("board_type", "main")
    date = params.get("date")
    return await AnalysisService.analyze(period, board_type, date)

@register_secure_route("/api/dates", "GET")
async def get_dates(user, params, body, path):
    return await AnalysisService.get_available_dates()

# è‚¡ç¥¨API
@register_secure_route("/api/stock/{code}", "GET")
async def get_stock(user, params, body, path):
    code = path.split("/")[-1]
    date = params.get("date")
    return await StockService.get_stock_detail(code, date)

# ... å…¶ä»–è·¯ç”±æ³¨å†Œ
```

---

## 2. å‰ç«¯åŠ å¯†å±‚å°è£…

### 2.1 åŠ å¯†APIæœåŠ¡

```javascript
// frontend-client/src/services/secureApi.js

import axios from 'axios';
import AESCrypto from '../utils/crypto';
import { getToken, getSessionKey } from './authService';

const API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:8000';

class SecureApiService {
  constructor() {
    this.crypto = null;
  }

  /**
   * åˆå§‹åŒ–åŠ å¯†å™¨ï¼ˆç™»å½•æˆåŠŸåè°ƒç”¨ï¼‰
   */
  initCrypto(sessionKeyBase64) {
    this.crypto = new AESCrypto(sessionKeyBase64);
  }

  /**
   * å‘é€åŠ å¯†è¯·æ±‚
   */
  async request({ path, method = 'GET', params = {}, body = null }) {
    if (!this.crypto) {
      throw new Error('æœªåˆå§‹åŒ–åŠ å¯†å™¨ï¼Œè¯·å…ˆç™»å½•');
    }

    const token = getToken();
    if (!token) {
      throw new Error('æœªç™»å½•');
    }

    // æ„é€ è¯·æ±‚å¯¹è±¡
    const requestData = {
      path,
      method,
      params,
      body,
      timestamp: Date.now(),
      nonce: this.generateNonce()
    };

    // åŠ å¯†
    const encryptedData = this.crypto.encrypt(requestData);

    try {
      // å‘é€åˆ°ç»Ÿä¸€ç«¯ç‚¹
      const response = await axios.post(
        `${API_BASE}/api/secure`,
        { data: encryptedData },
        {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          }
        }
      );

      // è§£å¯†å“åº”
      const decryptedResponse = this.crypto.decrypt(response.data.data);
      return decryptedResponse;

    } catch (error) {
      if (error.response?.status === 401) {
        // Tokenè¿‡æœŸï¼Œå°è¯•åˆ·æ–°
        await this.handleTokenExpired();
        // é‡è¯•è¯·æ±‚
        return this.request({ path, method, params, body });
      }
      throw error;
    }
  }

  /**
   * ç”Ÿæˆéšæœºæ•°
   */
  generateNonce() {
    return Math.random().toString(36).substring(2) + Date.now().toString(36);
  }

  /**
   * å¤„ç†Tokenè¿‡æœŸ
   */
  async handleTokenExpired() {
    // å®ç°Tokenåˆ·æ–°é€»è¾‘
    const { refreshToken } = await import('./authService');
    await refreshToken();
  }

  // ä¾¿æ·æ–¹æ³•
  get(path, params = {}) {
    return this.request({ path, method: 'GET', params });
  }

  post(path, body, params = {}) {
    return this.request({ path, method: 'POST', params, body });
  }
}

export default new SecureApiService();
```

### 2.2 æ›¿æ¢ç°æœ‰APIè°ƒç”¨

```javascript
// frontend-client/src/services/api.js
// æ”¹é€ ç°æœ‰APIæœåŠ¡ï¼Œä½¿ç”¨åŠ å¯†é€šé“

import secureApi from './secureApi';

// åŸæ¥çš„è°ƒç”¨æ–¹å¼
// export const getAnalysis = (period, boardType, date) => 
//   axios.get(`/api/analyze/${period}`, { params: { board_type: boardType, date } });

// æ”¹é€ å
export const getAnalysis = (period, boardType, date) => 
  secureApi.get(`/api/analyze/${period}`, { board_type: boardType, date });

export const getDates = () => 
  secureApi.get('/api/dates');

export const getStockDetail = (code, date) => 
  secureApi.get(`/api/stock/${code}`, { date });

export const getIndustryTrend = (date, topN) => 
  secureApi.get('/api/industry/trend', { date, top_n: topN });

// ... å…¶ä»–API
```

---

## 3. Electronä¸»è¿›ç¨‹é…ç½®

### 3.1 ä¸»è¿›ç¨‹å…¥å£

```javascript
// frontend-client/electron/main.js

const { app, BrowserWindow, ipcMain } = require('electron');
const path = require('path');
const isDev = require('electron-is-dev');

// æ¨¡å—å¯¼å…¥
const db = require('./database');
const updater = require('./updater');

let mainWindow;

function createWindow() {
  mainWindow = new BrowserWindow({
    width: 1400,
    height: 900,
    minWidth: 1024,
    minHeight: 768,
    webPreferences: {
      nodeIntegration: false,
      contextIsolation: true,
      preload: path.join(__dirname, 'preload.js')
    },
    icon: path.join(__dirname, '../public/icon.ico'),
    title: 'Aè‚¡åˆ†æç³»ç»Ÿ'
  });

  // åŠ è½½é¡µé¢
  const startUrl = isDev
    ? 'http://localhost:3000'
    : `file://${path.join(__dirname, '../build/index.html')}`;
  
  mainWindow.loadURL(startUrl);

  // å¼€å‘æ¨¡å¼æ‰“å¼€DevTools
  if (isDev) {
    mainWindow.webContents.openDevTools();
  }

  // çª—å£å…³é—­
  mainWindow.on('closed', () => {
    mainWindow = null;
  });

  // å¯åŠ¨åæ£€æŸ¥æ›´æ–°ï¼ˆéå¼€å‘æ¨¡å¼ï¼‰
  if (!isDev) {
    setTimeout(() => {
      updater.checkForUpdates();
    }, 3000);
  }
}

// åº”ç”¨å°±ç»ª
app.whenReady().then(() => {
  createWindow();

  app.on('activate', () => {
    if (BrowserWindow.getAllWindows().length === 0) {
      createWindow();
    }
  });
});

// æ‰€æœ‰çª—å£å…³é—­æ—¶é€€å‡ºï¼ˆWindows/Linuxï¼‰
app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {
    app.quit();
  }
});

// IPCå¤„ç†å™¨
require('./ipc-handlers');
```

### 3.2 é¢„åŠ è½½è„šæœ¬ï¼ˆå®‰å…¨æ¡¥æ¥ï¼‰

```javascript
// frontend-client/electron/preload.js

const { contextBridge, ipcRenderer } = require('electron');

// æš´éœ²å®‰å…¨çš„APIç»™æ¸²æŸ“è¿›ç¨‹
contextBridge.exposeInMainWorld('electronAPI', {
  // æ•°æ®åº“æ“ä½œ
  queryLocalDB: (queryType, params) => 
    ipcRenderer.invoke('db:query', queryType, params),
  
  saveToLocalDB: (table, data) => 
    ipcRenderer.invoke('db:save', table, data),
  
  clearLocalDB: () => 
    ipcRenderer.invoke('db:clear'),
  
  // åŒæ­¥çŠ¶æ€
  getSyncStatus: () => 
    ipcRenderer.invoke('sync:status'),
  
  setSyncStatus: (key, value) => 
    ipcRenderer.invoke('sync:set-status', key, value),
  
  // æ›´æ–°ç›¸å…³
  checkForUpdates: () => 
    ipcRenderer.invoke('check-for-updates'),
  
  downloadUpdate: () => 
    ipcRenderer.invoke('download-update'),
  
  installUpdate: () => 
    ipcRenderer.invoke('install-update'),
  
  // æ›´æ–°äº‹ä»¶ç›‘å¬
  onUpdateAvailable: (callback) => 
    ipcRenderer.on('update-available', (_, data) => callback(data)),
  
  onUpdateProgress: (callback) => 
    ipcRenderer.on('update-progress', (_, data) => callback(data)),
  
  onUpdateDownloaded: (callback) => 
    ipcRenderer.on('update-downloaded', (_, version) => callback(version)),
  
  // åº”ç”¨ä¿¡æ¯
  getAppVersion: () => 
    ipcRenderer.invoke('app:version'),
  
  // ç½‘ç»œçŠ¶æ€
  isOnline: () => navigator.onLine
});
```

### 3.3 IPCå¤„ç†å™¨

```javascript
// frontend-client/electron/ipc-handlers.js

const { ipcMain, app } = require('electron');
const db = require('./database');

// æ•°æ®åº“æŸ¥è¯¢
ipcMain.handle('db:query', async (event, queryType, params) => {
  try {
    switch (queryType) {
      case 'stocks':
        return db.prepare('SELECT * FROM cached_stocks').all();
      
      case 'daily':
        const { date, limit = 100 } = params;
        return db.prepare(`
          SELECT * FROM cached_daily_data 
          WHERE date = ? 
          ORDER BY rank 
          LIMIT ?
        `).all(date, limit);
      
      case 'stock_detail':
        const { code } = params;
        return db.prepare(`
          SELECT d.*, s.stock_name, s.industry
          FROM cached_daily_data d
          JOIN cached_stocks s ON d.stock_code = s.stock_code
          WHERE d.stock_code = ?
          ORDER BY d.date DESC
          LIMIT 30
        `).all(code);
      
      default:
        throw new Error(`æœªçŸ¥æŸ¥è¯¢ç±»å‹: ${queryType}`);
    }
  } catch (error) {
    console.error('æ•°æ®åº“æŸ¥è¯¢é”™è¯¯:', error);
    throw error;
  }
});

// æ•°æ®åº“ä¿å­˜
ipcMain.handle('db:save', async (event, table, data) => {
  try {
    if (table === 'stocks') {
      const stmt = db.prepare(`
        INSERT OR REPLACE INTO cached_stocks 
        (stock_code, stock_name, industry, last_synced)
        VALUES (?, ?, ?, ?)
      `);
      const insertMany = db.transaction((items) => {
        for (const item of items) {
          stmt.run(item.stock_code, item.stock_name, item.industry, new Date().toISOString());
        }
      });
      insertMany(data);
    } else if (table === 'daily') {
      const stmt = db.prepare(`
        INSERT OR REPLACE INTO cached_daily_data 
        (stock_code, date, rank, total_score, price_change, turnover_rate_percent, volume_days, volatility)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?)
      `);
      const insertMany = db.transaction((items) => {
        for (const item of items) {
          stmt.run(
            item.stock_code, item.date, item.rank, item.total_score,
            item.price_change, item.turnover_rate_percent, item.volume_days, item.volatility
          );
        }
      });
      insertMany(data);
    }
    return { success: true };
  } catch (error) {
    console.error('æ•°æ®åº“ä¿å­˜é”™è¯¯:', error);
    throw error;
  }
});

// æ¸…ç©ºæ•°æ®åº“
ipcMain.handle('db:clear', async () => {
  try {
    db.exec('DELETE FROM cached_daily_data');
    db.exec('DELETE FROM cached_stocks');
    db.exec('DELETE FROM sync_status');
    return { success: true };
  } catch (error) {
    console.error('æ¸…ç©ºæ•°æ®åº“é”™è¯¯:', error);
    throw error;
  }
});

// åŒæ­¥çŠ¶æ€
ipcMain.handle('sync:status', async () => {
  try {
    const rows = db.prepare('SELECT * FROM sync_status').all();
    return Object.fromEntries(rows.map(r => [r.key, r.value]));
  } catch (error) {
    return {};
  }
});

ipcMain.handle('sync:set-status', async (event, key, value) => {
  try {
    db.prepare(`
      INSERT OR REPLACE INTO sync_status (key, value, updated_at)
      VALUES (?, ?, ?)
    `).run(key, value, new Date().toISOString());
    return { success: true };
  } catch (error) {
    throw error;
  }
});

// åº”ç”¨ç‰ˆæœ¬
ipcMain.handle('app:version', () => {
  return app.getVersion();
});
```

---

## 4. ç™»å½•é¡µé¢å®ç°

```jsx
// frontend-client/src/pages/LoginPage.js

import React, { useState } from 'react';
import { Lock, User, Eye, EyeOff, Loader2 } from 'lucide-react';
import authService from '../services/authService';

const LoginPage = ({ onLoginSuccess }) => {
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    setLoading(true);

    try {
      const result = await authService.login(username, password);
      if (result.success) {
        onLoginSuccess(result.user);
      } else {
        setError(result.message || 'ç™»å½•å¤±è´¥');
      }
    } catch (err) {
      setError(err.message || 'ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-4">
      <div className="w-full max-w-md">
        {/* LogoåŒºåŸŸ */}
        <div className="text-center mb-8">
          <div className="inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-2xl mb-4">
            <span className="text-3xl">ğŸ“Š</span>
          </div>
          <h1 className="text-2xl font-bold text-white">Aè‚¡åˆ†æç³»ç»Ÿ</h1>
          <p className="text-slate-400 mt-2">è¯·ç™»å½•ä»¥ç»§ç»­ä½¿ç”¨</p>
        </div>

        {/* ç™»å½•è¡¨å• */}
        <div className="bg-slate-800/50 backdrop-blur-xl rounded-2xl p-8 shadow-2xl border border-slate-700">
          <form onSubmit={handleSubmit} className="space-y-6">
            {/* ç”¨æˆ·å */}
            <div>
              <label className="block text-sm font-medium text-slate-300 mb-2">
                ç”¨æˆ·å
              </label>
              <div className="relative">
                <User className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                <input
                  type="text"
                  value={username}
                  onChange={(e) => setUsername(e.target.value)}
                  className="w-full pl-10 pr-4 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                  placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
                  required
                />
              </div>
            </div>

            {/* å¯†ç  */}
            <div>
              <label className="block text-sm font-medium text-slate-300 mb-2">
                å¯†ç 
              </label>
              <div className="relative">
                <Lock className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400" />
                <input
                  type={showPassword ? 'text' : 'password'}
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="w-full pl-10 pr-12 py-3 bg-slate-700/50 border border-slate-600 rounded-xl text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                  placeholder="è¯·è¾“å…¥å¯†ç "
                  required
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-300"
                >
                  {showPassword ? <EyeOff className="w-5 h-5" /> : <Eye className="w-5 h-5" />}
                </button>
              </div>
            </div>

            {/* é”™è¯¯æç¤º */}
            {error && (
              <div className="p-3 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400 text-sm">
                {error}
              </div>
            )}

            {/* ç™»å½•æŒ‰é’® */}
            <button
              type="submit"
              disabled={loading}
              className="w-full py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-600/50 text-white font-medium rounded-xl transition flex items-center justify-center gap-2"
            >
              {loading ? (
                <>
                  <Loader2 className="w-5 h-5 animate-spin" />
                  ç™»å½•ä¸­...
                </>
              ) : (
                'ç™» å½•'
              )}
            </button>
          </form>

          {/* ç‰ˆæœ¬ä¿¡æ¯ */}
          <div className="mt-6 text-center text-slate-500 text-sm">
            ç‰ˆæœ¬ {window.electronAPI?.getAppVersion?.() || '1.0.0'}
          </div>
        </div>
      </div>
    </div>
  );
};

export default LoginPage;
```

---

## 5. å¼€å‘ç¯å¢ƒæ­å»º

### 5.1 åˆ›å»ºfrontend-clienté¡¹ç›®

```bash
# 1. å¤åˆ¶ç°æœ‰å‰ç«¯é¡¹ç›®
cd stock_analysis_app
cp -r frontend frontend-client

# 2. è¿›å…¥ç›®å½•
cd frontend-client

# 3. å®‰è£…Electronç›¸å…³ä¾èµ–
npm install --save-dev electron electron-builder electron-is-dev concurrently wait-on
npm install electron-updater better-sqlite3 crypto-js

# 4. åˆ›å»ºelectronç›®å½•
mkdir electron

# 5. ä¿®æ”¹package.json (è§ä¸‹æ–¹)
```

### 5.2 package.jsoné…ç½®

```json
{
  "name": "stock-analysis-client",
  "version": "1.0.0",
  "private": true,
  "main": "electron/main.js",
  "homepage": "./",
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "electron:dev": "concurrently \"npm start\" \"wait-on http://localhost:3000 && electron .\"",
    "electron:build": "npm run build && electron-builder",
    "electron:build:win": "npm run build && electron-builder --win",
    "postinstall": "electron-builder install-app-deps"
  },
  "build": {
    "extends": null,
    "appId": "com.stockanalysis.client",
    "productName": "Aè‚¡åˆ†æç³»ç»Ÿ",
    "directories": {
      "output": "dist"
    },
    "files": [
      "build/**/*",
      "electron/**/*",
      "node_modules/**/*",
      "package.json"
    ],
    "win": {
      "target": "nsis",
      "icon": "public/icon.ico"
    },
    "nsis": {
      "oneClick": false,
      "allowToChangeInstallationDirectory": true
    },
    "publish": {
      "provider": "generic",
      "url": "http://your-server:8000/updates/"
    }
  }
}
```

### 5.3 å¼€å‘æµç¨‹

```bash
# å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
npm run electron:dev

# æ‰“åŒ…Windowså®‰è£…ç¨‹åº
npm run electron:build:win

# è¾“å‡ºä½ç½®
# dist/Aè‚¡åˆ†æç³»ç»Ÿ-1.0.0-setup.exe
```

---

## 6. åç«¯ä¾èµ–å®‰è£…

```bash
cd backend

# å®‰è£…æ–°ä¾èµ–
pip install python-jose[cryptography] bcrypt

# æ›´æ–°requirements.txt
echo "python-jose[cryptography]==3.3.0" >> requirements.txt
echo "bcrypt==4.1.2" >> requirements.txt
```

---

## 7. æµ‹è¯•æ¸…å•

### 7.1 åŠ å¯†é€šä¿¡æµ‹è¯•

- [ ] ç™»å½•æˆåŠŸè·å–Tokenå’Œä¼šè¯å¯†é’¥
- [ ] åŠ å¯†è¯·æ±‚èƒ½æ­£ç¡®å‘é€
- [ ] æœåŠ¡ç«¯èƒ½æ­£ç¡®è§£å¯†è¯·æ±‚
- [ ] å“åº”èƒ½æ­£ç¡®åŠ å¯†è¿”å›
- [ ] å®¢æˆ·ç«¯èƒ½æ­£ç¡®è§£å¯†å“åº”
- [ ] æ—¶é—´æˆ³è¿‡æœŸè¯·æ±‚è¢«æ‹’ç»
- [ ] Tokenè¿‡æœŸèƒ½è‡ªåŠ¨åˆ·æ–°

### 7.2 ç¦»çº¿åŠŸèƒ½æµ‹è¯•

- [ ] é¦–æ¬¡ç™»å½•èƒ½åŒæ­¥æ•°æ®åˆ°æœ¬åœ°
- [ ] æ–­ç½‘åèƒ½æŸ¥çœ‹ç¼“å­˜æ•°æ®
- [ ] æ¢å¤ç½‘ç»œåèƒ½å¢é‡åŒæ­¥
- [ ] æœ¬åœ°æ•°æ®èƒ½æ­£ç¡®æ¸…ç†è¿‡æœŸæ•°æ®

### 7.3 è‡ªåŠ¨æ›´æ–°æµ‹è¯•

- [ ] èƒ½æ£€æµ‹åˆ°æ–°ç‰ˆæœ¬
- [ ] èƒ½ä¸‹è½½æ–°ç‰ˆæœ¬
- [ ] ä¸‹è½½è¿›åº¦æ­£ç¡®æ˜¾ç¤º
- [ ] èƒ½å®‰è£…å¹¶é‡å¯

---

> æ–‡æ¡£ç‰ˆæœ¬: 1.0.0  
> æœ€åæ›´æ–°: 2025-12-01
