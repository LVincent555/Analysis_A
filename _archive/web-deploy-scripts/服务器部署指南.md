# æœåŠ¡å™¨éƒ¨ç½²æŒ‡å— v0.4.0

## ğŸš€ ä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

### æ–¹æ³•1ï¼šä½¿ç”¨ä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd ~/DA/Analysis_A

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# ä¸€é”®éƒ¨ç½²
bash ä¸€é”®éƒ¨ç½².sh
```

**è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆ**ï¼š
1. âœ… å¤‡ä»½é‡è¦é…ç½®æ–‡ä»¶ï¼ˆdatabase.pyã€çŠ¶æ€æ–‡ä»¶ï¼‰
2. âœ… æ‹‰å–æœ€æ–°ä»£ç 
3. âœ… æ£€æŸ¥å¹¶æ¢å¤é…ç½®æ–‡ä»¶ï¼ˆé˜²æ­¢è¢«è¦†ç›–ï¼‰
4. âœ… æ£€æŸ¥å‰ç«¯æ„å»ºæ–‡ä»¶
5. âœ… æ¸…é™¤Pythonç¼“å­˜
6. âœ… åœæ­¢æ—§æœåŠ¡
7. âœ… æ£€æŸ¥å¹¶åˆå§‹åŒ–ç”¨æˆ·è´¦æˆ·ï¼ˆé¦–æ¬¡éƒ¨ç½²ï¼‰
8. âœ… å¯åŠ¨æ–°æœåŠ¡

---

## ğŸ“‹ æ‰‹åŠ¨éƒ¨ç½²ï¼ˆå¤‡é€‰ï¼‰

### æ­¥éª¤1ï¼šå¤‡ä»½é…ç½®

```bash
cd ~/DA/Analysis_A

# å¤‡ä»½æ•°æ®åº“é…ç½®
cp backend/app/database.py ~/database.py.backup

# å¤‡ä»½æ•°æ®çŠ¶æ€
cp data/data_import_state.json ~/data_import_state.json.backup
cp data/sector_import_state.json ~/sector_import_state.json.backup
```

### æ­¥éª¤2ï¼šæ‹‰å–ä»£ç 

```bash
git pull origin main
```

### æ­¥éª¤3ï¼šæ£€æŸ¥é…ç½®

```bash
# æ£€æŸ¥database.py
cat backend/app/database.py | grep DB_HOST

# å¦‚æœçœ‹åˆ°"192.168.182.128"è¯´æ˜è¢«è¦†ç›–ï¼Œæ¢å¤å¤‡ä»½ï¼š
cp ~/database.py.backup backend/app/database.py
```

### æ­¥éª¤4ï¼šæ¸…é™¤ç¼“å­˜

```bash
find backend -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null
find backend -name "*.pyc" -delete
```

### æ­¥éª¤5ï¼šé‡å¯æœåŠ¡

```bash
bash stop.sh
bash start_all.sh
```

### æ­¥éª¤6ï¼šéªŒè¯

```bash
# æ£€æŸ¥åç«¯
curl http://localhost:8000/api/dates

# æ£€æŸ¥Nginxä»£ç†
curl http://localhost/api/dates

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/backend.log
```

---

## âš ï¸ é‡è¦æç¤º

### å¿…é¡»æ£€æŸ¥çš„é…ç½®æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ | æ£€æŸ¥æ–¹æ³• |
|-----|------|---------|
| `backend/app/database.py` | æ•°æ®åº“é…ç½® | `grep DB_HOST backend/app/database.py` |
| `data/data_import_state.json` | æ•°æ®å¯¼å…¥çŠ¶æ€ | æ–‡ä»¶å¤§å°åº”è¯¥ > 100å­—èŠ‚ |
| `frontend/build/` | å‰ç«¯æ„å»ºæ–‡ä»¶ | `ls frontend/build/` åº”æœ‰æ–‡ä»¶ |

### å¸¸è§é—®é¢˜

#### é—®é¢˜1ï¼šgit pullåæœåŠ¡æ— æ³•å¯åŠ¨

**åŸå› **ï¼š`database.py`è¢«è¦†ç›–ä¸ºæœ¬åœ°é…ç½®

**è§£å†³**ï¼š
```bash
cp ~/database.py.backup backend/app/database.py
bash stop.sh && bash start_all.sh
```

#### é—®é¢˜2ï¼šå‰ç«¯æ˜¾ç¤º404

**åŸå› **ï¼š`frontend/build`æœªæ›´æ–°

**è§£å†³**ï¼š
```bash
# æœ¬åœ°æ‰§è¡Œ
cd frontend
npm run build
git add frontend/build
git commit -m "build: æ›´æ–°å‰ç«¯"
git push

# æœåŠ¡å™¨æ‰§è¡Œ
git pull
sudo systemctl reload nginx
```

#### é—®é¢˜3ï¼šé…ç½®ä¸ç”Ÿæ•ˆ

**åŸå› **ï¼šPythonç¼“å­˜æœªæ¸…é™¤

**è§£å†³**ï¼š
```bash
find backend -name __pycache__ -delete
bash stop.sh && bash start_all.sh
```

---

## ğŸ“ éªŒè¯æ¸…å•

### éƒ¨ç½²åå¿…é¡»éªŒè¯

- [ ] åç«¯æœåŠ¡è¿è¡Œï¼š`ps aux | grep uvicorn`
- [ ] APIå“åº”æ­£å¸¸ï¼š`curl http://localhost:8000/api/dates`
- [ ] Nginxä»£ç†æ­£å¸¸ï¼š`curl http://localhost/api/dates`
- [ ] å‰ç«¯å¯è®¿é—®ï¼šæµè§ˆå™¨è®¿é—® http://60.205.251.109
- [ ] æ•°æ®åº“é…ç½®æ­£ç¡®ï¼š`grep DB_HOST backend/app/database.py`
- [ ] æ— é”™è¯¯æ—¥å¿—ï¼š`tail -100 logs/backend.log | grep ERROR`

---

## ğŸ”„ å›æ»šæ“ä½œ

å¦‚æœéƒ¨ç½²åå‡ºç°é—®é¢˜ï¼Œç«‹å³å›æ»šï¼š

```bash
# æ–¹å¼1ï¼šGitå›æ»š
cd ~/DA/Analysis_A
git log --oneline -5  # æŸ¥çœ‹æäº¤å†å²
git reset --hard <ä¸Šä¸€ä¸ªcommit-id>
bash stop.sh && bash start_all.sh

# æ–¹å¼2ï¼šæ¢å¤å¤‡ä»½é…ç½®
cp ~/database.py.backup backend/app/database.py
cp ~/data_import_state.json.backup data/data_import_state.json
bash stop.sh && bash start_all.sh
```

---

## ğŸ“ å¸¸ç”¨å‘½ä»¤

### æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
bash start_all.sh

# åœæ­¢æ‰€æœ‰æœåŠ¡
bash stop.sh

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
ps aux | grep uvicorn

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/backend.log
```

### Nginxç®¡ç†

```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload nginx

# é‡å¯Nginx
sudo systemctl restart nginx

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### æ•°æ®åº“ç›¸å…³

```bash
# è¿æ¥æ•°æ®åº“
psql -h localhost -U postgres -d db_20251106_analysis_a

# æŸ¥çœ‹æ•°æ®é‡
psql -h localhost -U postgres -d db_20251106_analysis_a -c "SELECT COUNT(*) FROM daily_stock_data;"

# æ¸…ç©ºæ•°æ®ï¼ˆè°¨æ…ï¼ï¼‰
psql -h localhost -U postgres -d db_20251106_analysis_a -c "TRUNCATE TABLE daily_stock_data CASCADE;"
```

---

## ğŸ‘¤ ç”¨æˆ·ç®¡ç†

### é¦–æ¬¡éƒ¨ç½² - è‡ªåŠ¨åˆ›å»ºç”¨æˆ·

ä¸€é”®éƒ¨ç½²è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹ç”¨æˆ·è¡¨ï¼Œå¦‚æœä¸ºç©ºåˆ™è‡ªåŠ¨åˆ›å»ºé»˜è®¤ç”¨æˆ·ï¼ˆéšæœºå¯†ç ï¼‰ã€‚

### æ‰‹åŠ¨åˆ›å»ºç”¨æˆ·

```bash
cd backend
source ../venv/bin/activate

# äº¤äº’å¼åˆ›å»ºï¼ˆæ¨èï¼‰
python scripts/init_users.py

# è‡ªåŠ¨åˆ›å»ºé»˜è®¤ç”¨æˆ·ï¼ˆéšæœºå¯†ç ï¼‰
python scripts/init_users.py --auto

# åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·
python scripts/init_users.py --list
```

### äº¤äº’å¼èœå•

```
ğŸ”§ ç”¨æˆ·ç®¡ç†å·¥å…·
==================================================
1. åˆ›å»ºæ–°ç”¨æˆ·      <- æ‰‹åŠ¨è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
2. åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·
3. è‡ªåŠ¨åˆ›å»ºé»˜è®¤ç”¨æˆ· (admin + user)
0. é€€å‡º
```

### åˆ é™¤ç”¨æˆ·

```bash
# è¿æ¥æ•°æ®åº“åˆ é™¤ç”¨æˆ·
sudo -u postgres psql -d db_20251106_analysis_a -c "DELETE FROM users WHERE username='ç”¨æˆ·å';"
```

---

## ğŸ¯ é¦–æ¬¡éƒ¨ç½²ï¼ˆå…¨æ–°æœåŠ¡å™¨ï¼‰

å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡éƒ¨ç½²åˆ°æ–°æœåŠ¡å™¨ï¼š

**æ ¸å¿ƒæ­¥éª¤**ï¼š
1. å…‹éš†ä»£ç 
2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–
3. åˆ›å»º`backend/app/database.py`ï¼ˆå‚è€ƒ`.example`ï¼‰
4. å®‰è£… Python ä¾èµ–
5. é…ç½®Nginx
6. åˆå§‹åŒ–ç”¨æˆ·
7. å¯åŠ¨æœåŠ¡

### å®Œæ•´å‘½ä»¤

```bash
# 1. å…‹éš†ä»£ç 
git clone https://github.com/your-repo/Analysis_A.git
cd Analysis_A

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# 3. å®‰è£…ä¾èµ–
cd backend
pip install -r requirements.txt

# 4. é…ç½®æ•°æ®åº“ï¼ˆå¤åˆ¶å¹¶ä¿®æ”¹ï¼‰
cp app/database.py.example app/database.py
nano app/database.py  # ä¿®æ”¹ DB_NAME, DB_PASSWORD

# 5. åˆå§‹åŒ–ç”¨æˆ·
python scripts/init_users.py

# 6. å¯åŠ¨æœåŠ¡
cd ..
bash start_all.sh
```

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- **é…ç½®ç®¡ç†**ï¼š`docs/âš ï¸é‡è¦-é…ç½®æ–‡ä»¶ç®¡ç†å’Œå¸¸è§é”™è¯¯.md`
- **ç‰ˆæœ¬è¯´æ˜**ï¼š`docs/v0.2.6-ä¸Šçº¿æ€»ç»“.md`
- **ä¸Šçº¿æ£€æŸ¥**ï¼š`ä¸Šçº¿å‰æœ€ç»ˆæ£€æŸ¥.md`

---

## ğŸ†˜ ç´§æ€¥è”ç³»

å¦‚æœé‡åˆ°æ— æ³•è§£å†³çš„é—®é¢˜ï¼š

1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼š`tail -100 logs/backend.log`
2. æŸ¥çœ‹Nginxæ—¥å¿—ï¼š`sudo tail -50 /var/log/nginx/error.log`
3. æ£€æŸ¥è¿›ç¨‹çŠ¶æ€ï¼š`ps aux | grep uvicorn`
4. æŸ¥çœ‹éƒ¨ç½²æ–‡æ¡£ä¸­çš„"é—®é¢˜æ’æŸ¥"éƒ¨åˆ†

---

**æœ€åæ›´æ–°æ—¶é—´**: 2025-12-01  
**å½“å‰ç‰ˆæœ¬**: v0.4.0  
**ç»´æŠ¤äººå‘˜**: å¼€å‘å›¢é˜Ÿ
